import{q as qe,u as Le,b as Te,r as U,l as ae,c as I,d as V,j as e,B as j,C as te,m as ne,n as re,a as ie,F as O,e as l,f as o,g as i,h as c,I as p,i as d,aB as T,k as w}from"./index-CuDmVYun.js";import{D as Be,a as je,T as ge,aq as De}from"./dashboard-layout-RBv1DXX2.js";import{T as H}from"./textarea-CpuNoaOI.js";import{D as z,a as _,b as G,c as W}from"./dialog-CYNkLpdV.js";import{T as Qe,a as Me,b as le,c as oe}from"./tabs-CX8s-N0D.js";import{S as B,a as D,b as Q,c as M,d as r}from"./select-7c0Tajxe.js";import{B as ve}from"./badge-DMaRL5Qw.js";import{C as ye}from"./checkbox-C--WSSL-.js";import{u as ke}from"./use-realtime-query-CGmARpos.js";import{P as ce,T as Ee,H as Ke}from"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";import"./use-websocket-CCUHb1Px.js";function Ze(){const{user:m}=qe(),{toast:f}=Le(),S=Te(),[be,E]=U.useState(!1),[fe,K]=U.useState(!1),[a,P]=U.useState(null),[Ue,$]=U.useState(!1),[Pe,J]=U.useState(!1),[R,de]=U.useState("package"),[A,ue]=U.useState("base"),[X,Ne]=U.useState("all"),[y,N]=U.useState([]),{data:Se=[]}=ae({queryKey:["/api/hotels/current/inventory-items"],refetchInterval:3e3});ke({queryKey:["/api/hotels/current/inventory-items"],events:["inventory:created","inventory:updated","inventory:deleted"]});const F=Se.filter(s=>{if(X==="all")return!0;const t=s.departments||[];return t.includes("all")||t.includes(X)}),{data:xe=[]}=ae({queryKey:["/api/hotels/current/users"]}),{data:he=[]}=ae({queryKey:["/api/hotels/current/inventory-transactions"],refetchInterval:3e3});ke({queryKey:["/api/hotels/current/inventory-transactions"],events:["inventory_transaction:created","inventory_transaction:updated"]});const b=I({defaultValues:{name:"",description:"",sku:"",baseUnit:"piece",packageUnit:"",baseUnitsPerPackage:0,reorderLevel:0,storageLocation:"",costPerUnit:0,department:"",expiryDate:"",hasExpiry:!1}}),k=I({defaultValues:{name:"",description:"",sku:"",baseUnit:"piece",packageUnit:"",baseUnitsPerPackage:0,reorderLevel:0,storageLocation:"",costPerUnit:0,expiryDate:"",hasExpiry:!1}}),g=I({defaultValues:{qtyPackage:0,qtyBase:0,supplierName:"",referenceNumber:"",notes:""}}),v=I({defaultValues:{issuedToUserId:"",department:"",qtyPackage:0,qtyBase:0,notes:""}}),Y=V({mutationFn:async s=>{if(y.length===0)throw new Error("Please select at least one department");const t=s.packageUnit&&parseFloat(s.baseUnitsPerPackage)||0,n=s.sku.trim()||`SKU-${Date.now()}`;await w("POST","/api/hotels/current/inventory-items",{hotelId:m==null?void 0:m.hotelId,name:s.name,description:s.description||"",sku:n,unit:s.baseUnit,baseUnit:s.baseUnit,packageUnit:s.packageUnit||null,baseUnitsPerPackage:t>0?t.toString():"0",packageStockQty:"0",baseStockQty:"0",reorderLevel:s.reorderLevel.toString(),storageLocation:s.storageLocation||"",costPerUnit:s.costPerUnit.toString(),departments:y})},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/hotels/current/inventory-items"]}),f({title:"Inventory item created successfully"}),b.reset(),N([]),E(!1)},onError:s=>{f({title:"Error",description:s.message||"Failed to create inventory item",variant:"destructive"})}}),Z=V({mutationFn:async s=>{if(y.length===0)throw new Error("Please select at least one department");const t=s.packageUnit&&parseFloat(s.baseUnitsPerPackage)||0;await w("PUT",`/api/hotels/current/inventory-items/${a.id}`,{name:s.name,description:s.description||"",sku:s.sku,unit:s.baseUnit,baseUnit:s.baseUnit,packageUnit:s.packageUnit||null,baseUnitsPerPackage:t>0?t.toString():"0",reorderLevel:s.reorderLevel.toString(),storageLocation:s.storageLocation||"",costPerUnit:s.costPerUnit.toString(),departments:y})},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/hotels/current/inventory-items"]}),f({title:"Inventory item updated successfully"}),k.reset(),N([]),P(null),K(!1)},onError:s=>{f({title:"Error",description:s.message||"Failed to update inventory item",variant:"destructive"})}}),ee=V({mutationFn:async s=>{const t=a,n=t.packageUnit&&parseFloat(t.baseUnitsPerPackage)>0,u=parseFloat(t.baseUnitsPerPackage)||1;let x=0,h=0;n&&R==="package"?(x=parseFloat(s.qtyPackage)||0,h=x*u):(h=parseFloat(s.qtyBase)||0,n&&(x=h/u));const C=parseFloat(t.packageStockQty)||0,q={baseStockQty:((parseFloat(t.baseStockQty)||0)+h).toFixed(3)};n&&(q.packageStockQty=(C+x).toFixed(3)),await w("PUT",`/api/hotels/current/inventory-items/${t.id}`,q);const L={hotelId:m==null?void 0:m.hotelId,itemId:t.id,transactionType:"receive",qtyBase:h.toFixed(3),recordedBy:m==null?void 0:m.id,supplierName:s.supplierName||"",referenceNumber:s.referenceNumber||"",notes:s.notes||""};n&&(L.qtyPackage=x.toFixed(3)),await w("POST","/api/hotels/current/inventory-transactions",L)},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/hotels/current/inventory-items"]}),S.invalidateQueries({queryKey:["/api/hotels/current/inventory-transactions"]}),f({title:"Stock received successfully"}),g.reset(),P(null),$(!1)}}),se=V({mutationFn:async s=>{const t=a,n=t.packageUnit&&parseFloat(t.baseUnitsPerPackage)>0,u=parseFloat(t.baseUnitsPerPackage)||1;let x=0,h=0;n&&A==="package"?(x=parseFloat(s.qtyPackage)||0,h=x*u):(h=parseFloat(s.qtyBase)||0,n&&(x=h/u));const C=parseFloat(t.baseStockQty)||0;if(h>C)throw new Error(`Insufficient stock. Available: ${C} ${t.baseUnit}`);const me=parseFloat(t.packageStockQty)||0,q={baseStockQty:Math.max(0,C-h).toFixed(3)};n&&(q.packageStockQty=Math.max(0,me-x).toFixed(3)),await w("PUT",`/api/hotels/current/inventory-items/${t.id}`,q);const L={hotelId:m==null?void 0:m.hotelId,itemId:t.id,transactionType:"issue",qtyBase:h.toFixed(3),issuedToUserId:s.issuedToUserId||null,department:s.department||null,recordedBy:m==null?void 0:m.id,notes:s.notes};n&&(L.qtyPackage=x.toFixed(3)),await w("POST","/api/hotels/current/inventory-transactions",L)},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/hotels/current/inventory-items"]}),S.invalidateQueries({queryKey:["/api/hotels/current/inventory-transactions"]}),f({title:"Stock issued successfully"}),v.reset(),P(null),J(!1)},onError:s=>{f({title:"Failed to issue stock",description:s.message,variant:"destructive"})}}),Fe=s=>{if(s.packageUnit&&(!s.baseUnitsPerPackage||s.baseUnitsPerPackage<=0)){f({title:"Invalid input",description:"Please specify how many base units are in one package",variant:"destructive"});return}Y.mutate(s)},we=s=>{ee.mutate(s)},Ce=s=>{if(!s.issuedToUserId&&!s.department){f({title:"Missing information",description:"Please select a user or enter a department",variant:"destructive"});return}se.mutate(s)},pe=s=>{const t=xe.find(n=>n.id===s);return t?t.username:"Unknown User"};return e.jsxs(Be,{title:"Inventory Management",children:[e.jsxs(Qe,{defaultValue:"items",className:"space-y-4 sm:space-y-6 p-4 sm:p-6",children:[e.jsxs(Me,{className:"grid w-full grid-cols-3 max-w-full sm:max-w-[500px]",children:[e.jsx(le,{value:"items",className:"text-xs sm:text-sm",children:"Inventory Items"}),e.jsx(le,{value:"transactions",className:"text-xs sm:text-sm",children:"Transactions"}),e.jsx(le,{value:"low-stock",className:"text-xs sm:text-sm",children:"Low Stock"})]}),e.jsxs(oe,{value:"items",className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold",children:"Manage Inventory Items"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs(B,{value:X,onValueChange:Ne,children:[e.jsx(D,{className:"w-full sm:w-[180px]",children:e.jsx(Q,{placeholder:"Filter by Department"})}),e.jsxs(M,{children:[e.jsx(r,{value:"all",children:"All Departments"}),e.jsx(r,{value:"kitchen",children:"Kitchen"}),e.jsx(r,{value:"restaurant",children:"Restaurant"}),e.jsx(r,{value:"bar",children:"Bar"}),e.jsx(r,{value:"housekeeping",children:"Housekeeping"}),e.jsx(r,{value:"laundry",children:"Laundry"}),e.jsx(r,{value:"maintenance",children:"Maintenance"}),e.jsx(r,{value:"front_desk",children:"Front Desk"}),e.jsx(r,{value:"security",children:"Security"})]})]}),e.jsxs(j,{onClick:()=>E(!0),"data-testid":"button-add-item",className:"w-full sm:w-auto",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Add New Item"]})]})]}),e.jsxs(te,{children:[e.jsx(ne,{children:e.jsxs(re,{children:["Inventory Items (",F.length,")"]})}),e.jsx(ie,{children:F.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8","data-testid":"no-items-message",children:"No inventory items. Add your first item to get started."}):e.jsx("div",{className:"space-y-3",children:F.map(s=>{const t=parseFloat(s.baseStockQty)||0,n=parseFloat(s.packageStockQty)||0,u=parseFloat(s.reorderLevel)||0,x=t<=u;return e.jsx("div",{className:`p-3 sm:p-4 border rounded-lg hover:bg-accent transition-colors ${x?"border-red-300 bg-red-50 dark:bg-red-950/20":""}`,"data-testid":`manage-item-${s.id}`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-base",children:s.name}),x&&e.jsxs(ve,{variant:"destructive",className:"text-xs w-fit",children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"Low Stock"]})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 sm:gap-3 text-xs sm:text-sm",children:[e.jsxs("span",{className:"font-medium",children:["Stock: ",t.toFixed(2)," ",s.baseUnit,s.packageUnit&&` (${n.toFixed(2)} ${s.packageUnit})`]}),s.storageLocation&&e.jsxs("span",{className:"text-muted-foreground",children:["Location: ",s.storageLocation]})]})]}),e.jsxs("div",{className:"flex flex-row sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>{P(s);const h=s.departments??(s.department?[s.department]:[]);N(h),k.reset({name:s.name,description:s.description||"",sku:s.sku,baseUnit:s.baseUnit,packageUnit:s.packageUnit||"",baseUnitsPerPackage:parseFloat(s.baseUnitsPerPackage)||0,reorderLevel:parseFloat(s.reorderLevel)||0,storageLocation:s.storageLocation||"",costPerUnit:parseFloat(s.costPerUnit)||0}),K(!0)},"data-testid":`button-edit-item-${s.id}`,className:"flex-1 sm:flex-none",children:[e.jsx(ce,{className:"w-4 h-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Edit"})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>{P(s),$(!0),g.reset()},"data-testid":`button-receive-stock-${s.id}`,className:"flex-1 sm:flex-none",children:[e.jsx(Ee,{className:"w-4 h-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Receive"})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>{P(s),J(!0),v.reset()},"data-testid":`button-issue-stock-${s.id}`,className:"flex-1 sm:flex-none",children:[e.jsx(De,{className:"w-4 h-4 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Issue"})]})]})]})},s.id)})})})]})]}),e.jsx(oe,{value:"transactions",className:"space-y-6",children:e.jsxs(te,{children:[e.jsx(ne,{children:e.jsxs(re,{className:"flex items-center",children:[e.jsx(Ke,{className:"w-5 h-5 mr-2"}),"Transaction History"]})}),e.jsx(ie,{children:he.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No transactions recorded yet"}):e.jsx("div",{className:"space-y-3",children:he.map(s=>{const t=F.find(h=>h.id===s.itemId),n=s.transactionType==="receive",u=s.transactionType==="wastage",x=()=>n?"default":u?"destructive":"secondary";return e.jsx("div",{className:"p-4 border rounded-lg space-y-2","data-testid":`transaction-${s.id}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{variant:x(),children:s.transactionType.toUpperCase()}),e.jsx("span",{className:"font-medium",children:(t==null?void 0:t.name)||"Unknown Item"})]}),e.jsxs("div",{className:"mt-2 text-sm space-y-1",children:[e.jsxs("p",{children:["Quantity: ",parseFloat(s.qtyBase).toFixed(2)," ",t==null?void 0:t.baseUnit,(t==null?void 0:t.packageUnit)&&s.qtyPackage&&` (${parseFloat(s.qtyPackage).toFixed(2)} ${t.packageUnit})`]}),s.issuedToUserId&&e.jsxs("p",{className:"text-muted-foreground",children:["Issued to: ",pe(s.issuedToUserId)]}),s.department&&e.jsxs("p",{className:"text-muted-foreground",children:["Department: ",s.department]}),s.notes&&e.jsxs("p",{className:"text-muted-foreground",children:["Notes: ",s.notes]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[new Date(s.createdAt).toLocaleString()," by ",pe(s.recordedBy)]})]})]})})},s.id)})})})]})}),e.jsx(oe,{value:"low-stock",className:"space-y-6",children:e.jsxs(te,{children:[e.jsx(ne,{children:e.jsxs(re,{className:"flex items-center",children:[e.jsx(ge,{className:"w-5 h-5 mr-2 text-red-500"}),"Low Stock Items"]})}),e.jsx(ie,{children:F.filter(s=>(parseFloat(s.baseStockQty)||0)<=(parseFloat(s.reorderLevel)||0)).length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No items are low on stock"}):e.jsx("div",{className:"space-y-3",children:F.filter(s=>(parseFloat(s.baseStockQty)||0)<=(parseFloat(s.reorderLevel)||0)).map(s=>e.jsx("div",{className:"p-4 border border-red-300 bg-red-50 dark:bg-red-950/20 rounded-lg","data-testid":`low-stock-item-${s.id}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Current: ",parseFloat(s.baseStockQty).toFixed(2)," ",s.baseUnit," | Reorder Level: ",parseFloat(s.reorderLevel).toFixed(2)," ",s.baseUnit]})]}),e.jsxs(j,{size:"sm",onClick:()=>{P(s),$(!0),g.reset()},children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),"Restock"]})]})},s.id))})})]})})]}),e.jsx(z,{open:be,onOpenChange:E,children:e.jsxs(_,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(G,{children:[e.jsx(W,{children:"Add Inventory Item"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Create a new inventory item"})]}),e.jsx(O,{...b,children:e.jsxs("form",{onSubmit:b.handleSubmit(Fe),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:b.control,name:"name",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Item Name *"}),e.jsx(c,{children:e.jsx(p,{...s,placeholder:"Enter item name","data-testid":"input-item-name"})}),e.jsx(d,{})]})}),e.jsx(l,{control:b.control,name:"sku",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"SKU"}),e.jsx(c,{children:e.jsx(p,{...s,placeholder:"Enter SKU","data-testid":"input-sku"})}),e.jsx(d,{})]})})]}),e.jsx(l,{control:b.control,name:"description",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Description"}),e.jsx(c,{children:e.jsx(H,{...s,placeholder:"Enter description",rows:3,"data-testid":"input-item-description"})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:b.control,name:"baseUnit",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Unit *"}),e.jsxs(B,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(D,{"data-testid":"select-base-unit",children:e.jsx(Q,{placeholder:"Select unit"})})}),e.jsxs(M,{children:[e.jsx(r,{value:"piece",children:"Piece"}),e.jsx(r,{value:"kg",children:"Kilogram (kg)"}),e.jsx(r,{value:"g",children:"Gram (g)"}),e.jsx(r,{value:"L",children:"Liter (L)"}),e.jsx(r,{value:"ml",children:"Milliliter (ml)"}),e.jsx(r,{value:"pack",children:"Pack"}),e.jsx(r,{value:"dozen",children:"Dozen"})]})]}),e.jsx(d,{})]})}),e.jsx(l,{control:b.control,name:"reorderLevel",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Reorder Level"}),e.jsx(c,{children:e.jsx(p,{...s,type:"number",value:s.value||"",onChange:t=>s.onChange(parseFloat(t.target.value)||0),placeholder:"Minimum stock level","data-testid":"input-reorder-level"})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:b.control,name:"storageLocation",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Storage Location"}),e.jsx(c,{children:e.jsx(p,{...s,placeholder:"Storage location","data-testid":"input-storage-location"})}),e.jsx(d,{})]})}),e.jsx(l,{control:b.control,name:"costPerUnit",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Cost Per Unit"}),e.jsx(c,{children:e.jsx(p,{...s,type:"number",value:s.value||"",onChange:t=>s.onChange(parseFloat(t.target.value)||0),placeholder:"Cost per unit","data-testid":"input-cost-per-unit"})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{children:"Departments * (Select one or more)"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 p-4 border rounded-md",children:[{value:"all",label:"All Departments"},{value:"kitchen",label:"Kitchen"},{value:"restaurant",label:"Restaurant"},{value:"bar",label:"Bar"},{value:"housekeeping",label:"Housekeeping"},{value:"laundry",label:"Laundry"},{value:"maintenance",label:"Maintenance"},{value:"front_desk",label:"Front Desk"},{value:"security",label:"Security"}].map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{id:`dept-${s.value}`,checked:y.includes(s.value),onCheckedChange:t=>{N(t?[...y,s.value]:y.filter(n=>n!==s.value))},"data-testid":`checkbox-dept-${s.value}`}),e.jsx("label",{htmlFor:`dept-${s.value}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:s.label})]},s.value))}),y.length===0&&e.jsx("p",{className:"text-sm text-red-500",children:"Please select at least one department"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>E(!1),"data-testid":"button-cancel-add",children:"Cancel"}),e.jsx(j,{type:"submit",disabled:Y.isPending,"data-testid":"button-submit-item",children:Y.isPending?"Adding...":"Add Item"})]})]})})]})}),e.jsx(z,{open:fe,onOpenChange:K,children:e.jsxs(_,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(G,{children:[e.jsx(W,{children:"Edit Inventory Item"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update inventory item details"})]}),e.jsx(O,{...k,children:e.jsxs("form",{onSubmit:k.handleSubmit(s=>Z.mutate(s)),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:k.control,name:"name",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Item Name *"}),e.jsx(c,{children:e.jsx(p,{...s,placeholder:"Enter item name"})}),e.jsx(d,{})]})}),e.jsx(l,{control:k.control,name:"sku",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"SKU *"}),e.jsx(c,{children:e.jsx(p,{...s,placeholder:"Enter SKU"})}),e.jsx(d,{})]})})]}),e.jsx(l,{control:k.control,name:"description",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Description"}),e.jsx(c,{children:e.jsx(H,{...s,placeholder:"Enter description",rows:3})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:k.control,name:"baseUnit",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Unit *"}),e.jsxs(B,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(D,{children:e.jsx(Q,{placeholder:"Select unit"})})}),e.jsxs(M,{children:[e.jsx(r,{value:"piece",children:"Piece"}),e.jsx(r,{value:"kg",children:"Kilogram (kg)"}),e.jsx(r,{value:"g",children:"Gram (g)"}),e.jsx(r,{value:"L",children:"Liter (L)"}),e.jsx(r,{value:"ml",children:"Milliliter (ml)"}),e.jsx(r,{value:"pack",children:"Pack"}),e.jsx(r,{value:"dozen",children:"Dozen"})]})]}),e.jsx(d,{})]})}),e.jsx(l,{control:k.control,name:"reorderLevel",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Reorder Level"}),e.jsx(c,{children:e.jsx(p,{...s,type:"number",value:s.value||"",onChange:t=>s.onChange(parseFloat(t.target.value)||0),placeholder:"Minimum stock level"})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:k.control,name:"storageLocation",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Storage Location"}),e.jsx(c,{children:e.jsx(p,{...s,placeholder:"Storage location"})}),e.jsx(d,{})]})}),e.jsx(l,{control:k.control,name:"costPerUnit",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Cost Per Unit"}),e.jsx(c,{children:e.jsx(p,{...s,type:"number",value:s.value||"",onChange:t=>s.onChange(parseFloat(t.target.value)||0),placeholder:"Cost per unit"})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{children:"Departments * (Select one or more)"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 p-4 border rounded-md",children:[{value:"all",label:"All Departments"},{value:"kitchen",label:"Kitchen"},{value:"restaurant",label:"Restaurant"},{value:"bar",label:"Bar"},{value:"housekeeping",label:"Housekeeping"},{value:"laundry",label:"Laundry"},{value:"maintenance",label:"Maintenance"},{value:"front_desk",label:"Front Desk"},{value:"security",label:"Security"}].map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{id:`edit-dept-${s.value}`,checked:y.includes(s.value),onCheckedChange:t=>{N(t?[...y,s.value]:y.filter(n=>n!==s.value))}}),e.jsx("label",{htmlFor:`edit-dept-${s.value}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:s.label})]},s.value))}),y.length===0&&e.jsx("p",{className:"text-sm text-red-500",children:"Please select at least one department"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>{K(!1),N([]),P(null)},children:"Cancel"}),e.jsx(j,{type:"submit",disabled:Z.isPending,children:Z.isPending?"Updating...":"Update Item"})]})]})})]})}),e.jsx(z,{open:Ue,onOpenChange:$,children:e.jsxs(_,{children:[e.jsx(G,{children:e.jsxs(W,{children:["Receive Stock: ",a==null?void 0:a.name]})}),e.jsx(O,{...g,children:e.jsxs("form",{onSubmit:g.handleSubmit(we),className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs(j,{type:"button",variant:R==="package"?"default":"outline",onClick:()=>de("package"),disabled:!(a!=null&&a.packageUnit),className:"flex-1","data-testid":"button-mode-package",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"By Package"]}),e.jsxs(j,{type:"button",variant:R==="base"?"default":"outline",onClick:()=>de("base"),className:"flex-1","data-testid":"button-mode-base",children:["By ",(a==null?void 0:a.baseUnit)||"Unit"]})]}),R==="package"?e.jsx(l,{control:g.control,name:"qtyPackage",render:({field:s})=>e.jsxs(o,{children:[e.jsxs(i,{children:["Quantity (",a==null?void 0:a.packageUnit,")"]}),e.jsx(c,{children:e.jsx(p,{...s,type:"number",step:"0.001",onChange:t=>{const n=parseFloat(t.target.value)||0;s.onChange(n);const u=parseFloat(a==null?void 0:a.baseUnitsPerPackage)||1;g.setValue("qtyBase",n*u)},"data-testid":"input-receive-qty-package"})}),e.jsxs(T,{children:["= ",(g.watch("qtyPackage")*(parseFloat(a==null?void 0:a.baseUnitsPerPackage)||1)).toFixed(2)," ",a==null?void 0:a.baseUnit]}),e.jsx(d,{})]})}):e.jsx(l,{control:g.control,name:"qtyBase",render:({field:s})=>e.jsxs(o,{children:[e.jsxs(i,{children:["Quantity (",a==null?void 0:a.baseUnit,")"]}),e.jsx(c,{children:e.jsx(p,{...s,type:"number",step:"0.001",onChange:t=>{const n=parseFloat(t.target.value)||0;s.onChange(n);const u=parseFloat(a==null?void 0:a.baseUnitsPerPackage)||1;g.setValue("qtyPackage",n/u)},"data-testid":"input-receive-qty-base"})}),(a==null?void 0:a.packageUnit)&&e.jsxs(T,{children:["= ",(g.watch("qtyBase")/(parseFloat(a==null?void 0:a.baseUnitsPerPackage)||1)).toFixed(3)," ",a==null?void 0:a.packageUnit]}),e.jsx(d,{})]})}),e.jsx(l,{control:g.control,name:"supplierName",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Supplier Name *"}),e.jsx(c,{children:e.jsx(p,{...s,placeholder:"Enter supplier/vendor name","data-testid":"input-supplier-name"})}),e.jsx(T,{children:"Required for purchase tracking"}),e.jsx(d,{})]})}),e.jsx(l,{control:g.control,name:"referenceNumber",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Bill/Invoice Number"}),e.jsx(c,{children:e.jsx(p,{...s,placeholder:"Enter bill or invoice number","data-testid":"input-reference-number"})}),e.jsx(d,{})]})}),e.jsx(l,{control:g.control,name:"notes",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Additional Notes"}),e.jsx(c,{children:e.jsx(H,{...s,placeholder:"Any additional details...","data-testid":"input-receive-notes"})}),e.jsx(d,{})]})}),e.jsx(j,{type:"submit",className:"w-full",disabled:ee.isPending,"data-testid":"button-submit-receive",children:ee.isPending?"Processing...":"Receive Stock"})]})})]})}),e.jsx(z,{open:Pe,onOpenChange:J,children:e.jsxs(_,{children:[e.jsx(G,{children:e.jsxs(W,{children:["Issue Stock: ",a==null?void 0:a.name]})}),e.jsx(O,{...v,children:e.jsxs("form",{onSubmit:v.handleSubmit(Ce),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:v.control,name:"issuedToUserId",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Issued To (User)"}),e.jsxs(B,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(D,{"data-testid":"select-issued-to-user",children:e.jsx(Q,{placeholder:"Select user"})})}),e.jsx(M,{children:xe.map(t=>e.jsxs(r,{value:t.id,children:[t.username," - ",t.roleName]},t.id))})]}),e.jsx(d,{})]})}),e.jsx(l,{control:v.control,name:"department",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Department"}),e.jsxs(B,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(D,{"data-testid":"select-department",children:e.jsx(Q,{placeholder:"Select department"})})}),e.jsxs(M,{children:[e.jsx(r,{value:"kitchen",children:"Kitchen"}),e.jsx(r,{value:"housekeeping",children:"Housekeeping"}),e.jsx(r,{value:"front_desk",children:"Front Desk"}),e.jsx(r,{value:"restaurant",children:"Restaurant"}),e.jsx(r,{value:"bar",children:"Bar"}),e.jsx(r,{value:"maintenance",children:"Maintenance"}),e.jsx(r,{value:"security",children:"Security"})]})]}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs(j,{type:"button",variant:A==="package"?"default":"outline",onClick:()=>ue("package"),disabled:!(a!=null&&a.packageUnit),className:"flex-1","data-testid":"button-issue-mode-package",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"By Package"]}),e.jsxs(j,{type:"button",variant:A==="base"?"default":"outline",onClick:()=>ue("base"),className:"flex-1","data-testid":"button-issue-mode-base",children:["By ",(a==null?void 0:a.baseUnit)||"Unit"]})]}),A==="package"?e.jsx(l,{control:v.control,name:"qtyPackage",render:({field:s})=>e.jsxs(o,{children:[e.jsxs(i,{children:["Quantity (",a==null?void 0:a.packageUnit,")"]}),e.jsx(c,{children:e.jsx(p,{...s,type:"number",step:"0.001",onChange:t=>{const n=parseFloat(t.target.value)||0;s.onChange(n);const u=parseFloat(a==null?void 0:a.baseUnitsPerPackage)||1;v.setValue("qtyBase",n*u)},"data-testid":"input-issue-qty-package"})}),e.jsxs(T,{children:["= ",(v.watch("qtyPackage")*(parseFloat(a==null?void 0:a.baseUnitsPerPackage)||1)).toFixed(2)," ",a==null?void 0:a.baseUnit,e.jsx("br",{}),"Available: ",parseFloat((a==null?void 0:a.baseStockQty)||0).toFixed(2)," ",a==null?void 0:a.baseUnit]}),e.jsx(d,{})]})}):e.jsx(l,{control:v.control,name:"qtyBase",render:({field:s})=>e.jsxs(o,{children:[e.jsxs(i,{children:["Quantity (",a==null?void 0:a.baseUnit,")"]}),e.jsx(c,{children:e.jsx(p,{...s,type:"number",step:"0.001",onChange:t=>{const n=parseFloat(t.target.value)||0;s.onChange(n);const u=parseFloat(a==null?void 0:a.baseUnitsPerPackage)||1;v.setValue("qtyPackage",n/u)},"data-testid":"input-issue-qty-base"})}),e.jsxs(T,{children:["Available: ",parseFloat((a==null?void 0:a.baseStockQty)||0).toFixed(2)," ",a==null?void 0:a.baseUnit,(a==null?void 0:a.packageUnit)&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"= ",(v.watch("qtyBase")/(parseFloat(a==null?void 0:a.baseUnitsPerPackage)||1)).toFixed(3)," ",a==null?void 0:a.packageUnit]})]}),e.jsx(d,{})]})}),e.jsx(l,{control:v.control,name:"notes",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Notes"}),e.jsx(c,{children:e.jsx(H,{...s,placeholder:"Purpose, reason...","data-testid":"input-issue-notes"})}),e.jsx(d,{})]})}),e.jsx(j,{type:"submit",className:"w-full",disabled:se.isPending,"data-testid":"button-submit-issue",children:se.isPending?"Processing...":"Issue Stock"})]})})]})})]})}export{Ze as default};
