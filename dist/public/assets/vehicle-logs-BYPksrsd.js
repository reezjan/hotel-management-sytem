import{q,u as D,b as I,r as o,l as A,d as g,j as e,C as m,a as v,m as C,n as k,y as V,B as x,s as l,I as n,k as S}from"./index-CuDmVYun.js";import{D as H,a9 as w,a as Q}from"./dashboard-layout-RBv1DXX2.js";import{S as $,a as B,b as E,c as K,d as i}from"./select-7c0Tajxe.js";import{f as L}from"./format-BOBWS5Wu.js";import"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";function Z(){const{user:d}=q(),{toast:r}=D(),p=I(),[h,j]=o.useState(!1),[t,c]=o.useState({vehicleNumber:"",vehicleType:"car",driverName:"",purpose:""}),[a,O]=o.useState(""),{data:T=[],isLoading:F}=A({queryKey:["/api/hotels/current/vehicle-logs"],refetchInterval:3e3}),u=g({mutationFn:async s=>await S("POST","/api/hotels/current/vehicle-logs",s),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/hotels/current/vehicle-logs"]}),r({title:"Vehicle checked in successfully"}),c({vehicleNumber:"",vehicleType:"car",driverName:"",purpose:""}),j(!1)},onError:s=>{r({title:"Failed to check in vehicle",description:s.message||"An error occurred",variant:"destructive"})}}),y=g({mutationFn:async s=>await S("PATCH",`/api/vehicle-logs/${s}/checkout`,{}),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/hotels/current/vehicle-logs"]}),r({title:"Vehicle checked out successfully"})},onError:s=>{r({title:"Failed to check out vehicle",description:s.message||"An error occurred",variant:"destructive"})}}),P=s=>{if(s.preventDefault(),!t.vehicleNumber||!t.vehicleType||!t.driverName){r({title:"Vehicle number, type, and driver name are required",variant:"destructive"});return}u.mutate(t)},N=T.filter(s=>s.recordedBy===(d==null?void 0:d.id)),M=N.filter(s=>!s.checkOut),f=N.filter(s=>{var b;return a===""||s.vehicleNumber.toLowerCase().includes(a.toLowerCase())||((b=s.driverName)==null?void 0:b.toLowerCase().includes(a.toLowerCase()))});return e.jsx(H,{title:"Vehicle Logs",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(m,{children:e.jsx(v,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Vehicles On Premises"}),e.jsx("p",{className:"text-4xl font-bold",children:M.length})]}),e.jsx(w,{className:"h-12 w-12 text-purple-500"})]})})}),e.jsxs(m,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(k,{children:"Vehicle Check-in"}),e.jsx(V,{children:"Record new vehicle entry"})]}),e.jsxs(x,{onClick:()=>j(!h),size:"sm","data-testid":"button-toggle-form",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),h?"Cancel":"Check-in Vehicle"]})]})}),h&&e.jsx(v,{children:e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vehicleNumber",children:"Vehicle Number *"}),e.jsx(n,{id:"vehicleNumber","data-testid":"input-vehicle-number",value:t.vehicleNumber,onChange:s=>c({...t,vehicleNumber:s.target.value}),placeholder:"e.g., BA 12 PA 1234",required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"vehicleType",children:"Vehicle Type *"}),e.jsxs($,{value:t.vehicleType,onValueChange:s=>c({...t,vehicleType:s}),children:[e.jsx(B,{"data-testid":"select-vehicle-type",children:e.jsx(E,{})}),e.jsxs(K,{children:[e.jsx(i,{value:"car",children:"Car"}),e.jsx(i,{value:"motorcycle",children:"Motorcycle"}),e.jsx(i,{value:"truck",children:"Truck"}),e.jsx(i,{value:"van",children:"Van"}),e.jsx(i,{value:"bus",children:"Bus"}),e.jsx(i,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"driverName",children:"Driver Name *"}),e.jsx(n,{id:"driverName","data-testid":"input-driver-name",value:t.driverName,onChange:s=>c({...t,driverName:s.target.value}),placeholder:"Driver's full name",required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"purpose",children:"Purpose"}),e.jsx(n,{id:"purpose","data-testid":"input-purpose",value:t.purpose,onChange:s=>c({...t,purpose:s.target.value}),placeholder:"Purpose of visit"})]})]}),e.jsx(x,{type:"submit",disabled:u.isPending,"data-testid":"button-submit-checkin",children:u.isPending?"Checking in...":"Check-in Vehicle"})]})})]}),e.jsxs(m,{children:[e.jsxs(C,{children:[e.jsx(k,{children:"My Vehicle Logs"}),e.jsx(V,{children:e.jsxs("div",{className:"mt-2",children:[e.jsx(l,{htmlFor:"vehicleSearch",children:"Search"}),e.jsx(n,{id:"vehicleSearch","data-testid":"input-vehicle-search",placeholder:"Search by vehicle number or driver name...",value:a,onChange:s=>O(s.target.value),className:"mt-1"})]})})]}),e.jsx(v,{children:F?e.jsx("div",{className:"text-center py-8","data-testid":"loading-vehicles",children:"Loading vehicle logs..."}):f.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground","data-testid":"no-vehicles",children:a?"No matching vehicles found.":"No vehicle logs yet."}):e.jsx("div",{className:"space-y-3",children:f.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors","data-testid":`vehicle-${s.id}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-1",children:[e.jsx(w,{className:"h-5 w-5 text-muted-foreground"}),e.jsx("span",{className:"font-semibold text-lg","data-testid":`vehicle-number-${s.id}`,children:s.vehicleNumber}),e.jsx("span",{className:"px-2 py-0.5 rounded text-xs bg-blue-100 text-blue-800",children:s.vehicleType})]}),e.jsxs("div",{className:"text-sm text-muted-foreground ml-8",children:[e.jsxs("p",{children:["Driver: ",s.driverName]}),s.purpose&&e.jsxs("p",{children:["Purpose: ",s.purpose]}),e.jsxs("p",{className:"mt-1",children:["Check-in: ",L(new Date(s.checkIn),"MMM dd, yyyy HH:mm")]}),s.checkOut&&e.jsxs("p",{children:["Check-out: ",L(new Date(s.checkOut),"MMM dd, yyyy HH:mm")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${s.checkOut?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800"}`,"data-testid":`vehicle-status-${s.id}`,children:s.checkOut?"Checked Out":"On Premises"}),!s.checkOut&&e.jsx(x,{size:"sm",variant:"outline",onClick:()=>y.mutate(s.id),disabled:y.isPending,"data-testid":`button-checkout-${s.id}`,children:"Check Out"})]})]},s.id))})})]})]})})}export{Z as default};
