import{q as j,u as f,b as y,l as v,d as C,j as e,C as k,m as N,n as T,a as b,a2 as S,B as c,k as w}from"./index-CuDmVYun.js";import{D as B,i as P,I as u}from"./dashboard-layout-RBv1DXX2.js";import{B as n}from"./badge-DMaRL5Qw.js";import{S as d}from"./stats-card-CKM6aMdl.js";import"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";function L(){const{user:t}=j(),{toast:l}=f(),m=y(),{data:i=[],isLoading:x}=v({queryKey:["/api/users",t==null?void 0:t.id,"tasks"],enabled:!!(t!=null&&t.id),refetchInterval:5e3,refetchIntervalInBackground:!0}),r=C({mutationFn:async({taskId:s,status:a})=>{await w("PUT",`/api/hotels/current/tasks/${s}`,{status:a})},onSuccess:()=>{m.invalidateQueries({queryKey:["/api/users",t==null?void 0:t.id,"tasks"]}),l({title:"Task updated successfully"})},onError:s=>{l({title:s.message||"Failed to update task",variant:"destructive"})}}),p=i.filter(s=>s.status==="pending"),g=i.filter(s=>s.status==="in_progress"),h=i.filter(s=>s.status==="completed"||s.status==="pending_review"),o=(s,a)=>{r.mutate({taskId:s.id,status:a})};return e.jsx(B,{title:"My Tasks",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(d,{title:"Pending Tasks",value:p.length,icon:e.jsx(P,{}),iconColor:"text-orange-500"}),e.jsx(d,{title:"In Progress",value:g.length,icon:e.jsx(u,{}),iconColor:"text-blue-500"}),e.jsx(d,{title:"Completed",value:h.length,icon:e.jsx(u,{}),iconColor:"text-green-500"})]}),e.jsxs(k,{children:[e.jsx(N,{children:e.jsx(T,{children:"All My Tasks"})}),e.jsx(b,{children:x?e.jsx("p",{className:"text-muted-foreground",children:"Loading tasks..."}):i.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4","data-testid":"no-tasks-message",children:"No tasks assigned"}):e.jsx("div",{className:"space-y-3",children:i.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg","data-testid":`task-item-${a}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-foreground",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center space-x-3 mt-2",children:[e.jsx(n,{className:S(s.status),variant:"secondary",children:s.status}),s.priority&&e.jsxs(n,{variant:"outline",className:"text-xs",children:["Priority: ",s.priority]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Created: ",new Date(s.createdAt).toLocaleDateString("en-GB",{timeZone:"Asia/Kathmandu"})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2 ml-4",children:[s.status==="pending"&&e.jsx(c,{size:"sm",onClick:()=>o(s,"in_progress"),disabled:r.isPending,"data-testid":`button-start-task-${a}`,children:"Start Task"}),s.status==="in_progress"&&e.jsx(c,{size:"sm",onClick:()=>o(s,"completed"),disabled:r.isPending,"data-testid":`button-complete-task-${a}`,children:"Mark Complete"}),s.status==="pending_review"&&e.jsx(n,{className:"bg-yellow-100 text-yellow-800",variant:"secondary",children:"Pending Approval"}),s.status==="completed"&&e.jsx(n,{className:"bg-green-100 text-green-800",variant:"secondary",children:"Done âœ“"})]})]},s.id))})})]})]})})}export{L as default};
