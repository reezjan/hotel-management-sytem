import{q as ee,u as se,b as ae,o as te,r as c,l as N,d as O,j as e,B as l,s as v,I as re,C as k,m as R,n as A,a as T,k as P}from"./index-CuDmVYun.js";import{D as ne,i as B,Z as E,o as K,q as W}from"./dashboard-layout-RBv1DXX2.js";import{S as y}from"./stats-card-CKM6aMdl.js";import{B as ie}from"./badge-DMaRL5Qw.js";import{T as Q}from"./textarea-CpuNoaOI.js";import{D as L,f as le,a as M,b as z,c as F,d as H}from"./dialog-CYNkLpdV.js";import{S as ce,a as de,b as oe,c as ue,d as me}from"./select-7c0Tajxe.js";import{P as xe}from"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";function we(){ee();const{toast:n}=se(),V=ae();te();const[U,d]=c.useState(!1),[X,C]=c.useState(!1),[b,D]=c.useState(null),[o,w]=c.useState(""),[r,u]=c.useState({itemId:"",qty:"",unit:"",reason:""}),{data:i=[]}=N({queryKey:["/api/hotels/current/kot-orders"],refetchInterval:3e3,refetchIntervalInBackground:!0}),{data:S=[]}=N({queryKey:["/api/hotels/current/restaurant-tables"],refetchInterval:5e3,refetchIntervalInBackground:!0}),{data:f=[]}=N({queryKey:["/api/hotels/current/inventory-items"]}),m=O({mutationFn:async({id:s,data:t})=>await P("PUT",`/api/kot-items/${s}`,t),onSuccess:()=>{V.invalidateQueries({queryKey:["/api/hotels/current/kot-orders"]}),n({title:"KOT item updated successfully"}),d(!1),w(""),D(null)},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),I=O({mutationFn:async s=>await P("POST","/api/hotels/current/wastages",s),onSuccess:()=>{n({title:"Wastage recorded successfully"}),C(!1),u({itemId:"",qty:"",unit:"",reason:""})},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),Z=s=>{m.mutate({id:s.id,data:{status:"approved"}})},$=s=>{D(s),d(!0)},G=s=>{m.mutate({id:s.id,data:{status:"ready"}})},J=()=>{if(!b||!o.trim()){n({title:"Please provide a reason for declining",variant:"destructive"});return}if(o.trim().length<10){n({title:"Decline reason must be at least 10 characters",variant:"destructive"});return}m.mutate({id:b.id,data:{status:"declined",declineReason:o.trim()}})},Y=()=>{if(!r.itemId||!r.qty||!r.reason.trim()){n({title:"Please fill all wastage fields",variant:"destructive"});return}const s=parseFloat(r.qty);if(isNaN(s)||s<=0){n({title:"Please enter a valid quantity",variant:"destructive"});return}I.mutate({itemId:r.itemId,qty:s.toString(),unit:r.unit,reason:r.reason.trim()})},x=Array.isArray(i)?i.filter(s=>{var t;return(t=s.items)==null?void 0:t.some(a=>a.status==="pending")}):[],h=Array.isArray(i)?i.filter(s=>{var t;return(t=s.items)==null?void 0:t.some(a=>a.status==="approved")}):[],g=Array.isArray(i)?i.filter(s=>{var t;return(t=s.items)==null?void 0:t.every(a=>a.status==="ready")}):[],p=Array.isArray(i)?i.filter(s=>{var t;return(t=s.items)==null?void 0:t.some(a=>a.status==="declined")}):[],_=s=>{if(!Array.isArray(S))return s;const t=S.find(a=>a.id===s);return(t==null?void 0:t.name)||s},j=s=>{var t;return e.jsxs(k,{children:[e.jsx(R,{children:e.jsxs(A,{className:"flex justify-between items-center",children:[e.jsx("span",{children:_(s.tableId)}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(s.createdAt).toLocaleTimeString()})]})}),e.jsx(T,{children:(t=s.items)==null?void 0:t.map(a=>{var q;return e.jsxs("div",{className:"mb-4 p-3 border rounded",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:(q=a.menuItem)==null?void 0:q.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Quantity: ",a.qty]}),a.notes&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Notes: ",a.notes]}),a.declineReason&&e.jsxs("p",{className:"text-sm text-red-600",children:["Declined: ",a.declineReason]})]}),e.jsx(ie,{variant:a.status==="approved"||a.status==="ready"?"default":a.status==="declined"?"destructive":"secondary",children:a.status})]}),a.status==="pending"&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs(l,{size:"sm",onClick:()=>Z(a),className:"flex-1",children:[e.jsx(K,{className:"w-4 h-4 mr-1"})," Approve"]}),e.jsxs(l,{size:"sm",variant:"destructive",onClick:()=>$(a),className:"flex-1",children:[e.jsx(W,{className:"w-4 h-4 mr-1"})," Decline"]})]}),a.status==="approved"&&e.jsxs(l,{size:"sm",onClick:()=>G(a),className:"w-full mt-2",children:[e.jsx(B,{className:"w-4 h-4 mr-1"})," Set Ready"]})]},a.id)})})]},s.id)};return e.jsxs(ne,{title:"Barista Dashboard",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(y,{title:"Pending Orders",value:x.length,icon:e.jsx(B,{}),iconColor:"text-orange-500"}),e.jsx(y,{title:"Brewing",value:h.length,icon:e.jsx(E,{}),iconColor:"text-brown-500"}),e.jsx(y,{title:"Ready to Serve",value:g.length,icon:e.jsx(K,{}),iconColor:"text-green-500"}),e.jsx(y,{title:"Declined",value:p.length,icon:e.jsx(W,{}),iconColor:"text-red-500"})]}),e.jsx("div",{className:"flex gap-2 justify-end",children:e.jsxs(L,{open:X,onOpenChange:C,children:[e.jsx(le,{asChild:!0,children:e.jsxs(l,{variant:"outline",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"})," Record Wastage"]})}),e.jsxs(M,{children:[e.jsxs(z,{children:[e.jsx(F,{children:"Record Wastage"}),e.jsx(H,{children:"Record inventory wastage with reason"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{children:"Inventory Item"}),e.jsxs(ce,{value:r.itemId,onValueChange:s=>{const t=f.find(a=>a.id===s);u({...r,itemId:s,unit:(t==null?void 0:t.unit)||"piece"})},children:[e.jsx(de,{children:e.jsx(oe,{placeholder:"Select item"})}),e.jsx(ue,{children:Array.isArray(f)&&f.map(s=>e.jsxs(me,{value:s.id,children:[s.name," (",s.unit,")"]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Quantity"}),e.jsx(re,{type:"number",step:"0.01",value:r.qty,onChange:s=>u({...r,qty:s.target.value}),placeholder:"Enter quantity"})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Reason"}),e.jsx(Q,{value:r.reason,onChange:s=>u({...r,reason:s.target.value}),placeholder:"Explain reason for wastage"})]}),e.jsx(l,{onClick:Y,className:"w-full",disabled:I.isPending,children:"Record Wastage"})]})]})]})}),e.jsxs(k,{children:[e.jsx(R,{children:e.jsxs(A,{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"h-5 w-5 text-brown-500"}),e.jsx("span",{children:"Coffee Orders"})]})}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["Pending Orders (",x.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.length===0?e.jsx("p",{className:"text-gray-500 col-span-full text-center py-4",children:"No pending orders"}):x.map(j)})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["Brewing (",h.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.length===0?e.jsx("p",{className:"text-gray-500 col-span-full text-center py-4",children:"No orders brewing"}):h.map(j)})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["Ready (",g.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.length===0?e.jsx("p",{className:"text-gray-500 col-span-full text-center py-4",children:"No ready orders"}):g.map(j)})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["Declined (",p.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p.length===0?e.jsx("p",{className:"text-gray-500 col-span-full text-center py-4",children:"No declined orders"}):p.map(j)})]})]})})]})]}),e.jsx(L,{open:U,onOpenChange:d,children:e.jsxs(M,{children:[e.jsxs(z,{children:[e.jsx(F,{children:"Decline KOT Item"}),e.jsx(H,{children:"Please provide a reason for declining this item"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{children:"Reason for Decline"}),e.jsx(Q,{value:o,onChange:s=>w(s.target.value),placeholder:"e.g., Out of stock, Machine malfunction"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>d(!1),className:"flex-1",children:"Cancel"}),e.jsx(l,{onClick:J,className:"flex-1",variant:"destructive",disabled:m.isPending,children:"Decline"})]})]})]})})]})}export{we as default};
