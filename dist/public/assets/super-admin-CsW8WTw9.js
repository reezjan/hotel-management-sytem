import{z as n,u as Q,b as O,c as z,d as T,j as e,H as A,F as B,e as l,f as i,g as o,h as c,I as h,i as d,B as p,L as Z,t as R,k as H,l as q,r as C,C as se,m as te,n as ae,a as re}from"./index-CuDmVYun.js";import{D as ne,P as le,S as ie,a as oe}from"./dashboard-layout-RBv1DXX2.js";import{S}from"./stats-card-CKM6aMdl.js";import{D as $}from"./data-table-B69p7Klv.js";import{D as F,a as k,b as E,c as I,d as ce,e as de}from"./dialog-CYNkLpdV.js";import{T as me}from"./textarea-CpuNoaOI.js";import{S as he,a as xe,b as ue,c as je,d as pe}from"./select-7c0Tajxe.js";import{U as D,T as ge}from"./users-DXv82DeH.js";import{t as K}from"./index-hq1wgpuD.js";import"./circle-alert-CPwmOhkC.js";import"./badge-DMaRL5Qw.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";const be=n.object({name:n.string().min(1,"Hotel name is required").max(100,"Hotel name must be less than 100 characters"),address:n.string().min(1,"Address is required").max(255,"Address must be less than 255 characters"),city:n.string().min(1,"City is required").max(50,"City must be less than 50 characters"),state:n.string().min(1,"State is required").max(50,"State must be less than 50 characters"),zipCode:n.string().min(1,"ZIP code is required").max(10,"ZIP code must be less than 10 characters"),country:n.string().min(1,"Country is required").max(50,"Country must be less than 50 characters"),phone:n.string().min(1,"Phone number is required").max(20,"Phone number must be less than 20 characters"),email:n.string().email("Please enter a valid email address"),vatNo:n.string().optional(),description:n.string().optional()});function fe({isOpen:b,onClose:g}){const{toast:v}=Q(),y=O(),r=z({resolver:R(be),defaultValues:{name:"",address:"",city:"",state:"",zipCode:"",country:"",phone:"",email:"",vatNo:"",description:""}}),j=T({mutationFn:async s=>await(await H("POST","/api/hotels",s)).json(),onSuccess:()=>{y.invalidateQueries({queryKey:["/api/hotels"]}),v({title:"Hotel Created Successfully",description:"The new hotel has been added to the system."}),r.reset(),g()},onError:s=>{v({title:"Failed to Create Hotel",description:s.message||"Please check your input and try again.",variant:"destructive"})}}),m=s=>{j.mutate(s)},x=()=>{j.isPending||(r.reset(),g())};return e.jsx(F,{open:b,onOpenChange:x,children:e.jsxs(k,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto","data-testid":"modal-create-hotel",children:[e.jsx(E,{children:e.jsxs(I,{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"h-5 w-5 text-primary"}),e.jsx("span",{children:"Create New Hotel"})]})}),e.jsx(B,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(m),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:r.control,name:"name",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Hotel Name *"}),e.jsx(c,{children:e.jsx(h,{placeholder:"Enter hotel name",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:r.control,name:"email",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Email *"}),e.jsx(c,{children:e.jsx(h,{type:"email",placeholder:"hotel@example.com",...s})}),e.jsx(d,{})]})})]}),e.jsx(l,{control:r.control,name:"address",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Address *"}),e.jsx(c,{children:e.jsx(h,{placeholder:"Enter hotel address",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(l,{control:r.control,name:"city",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"City *"}),e.jsx(c,{children:e.jsx(h,{placeholder:"City",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:r.control,name:"state",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"State *"}),e.jsx(c,{children:e.jsx(h,{placeholder:"State",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:r.control,name:"zipCode",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"ZIP Code *"}),e.jsx(c,{children:e.jsx(h,{placeholder:"ZIP Code",...s})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:r.control,name:"country",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Country *"}),e.jsx(c,{children:e.jsx(h,{placeholder:"Country",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:r.control,name:"phone",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Phone Number *"}),e.jsx(c,{children:e.jsx(h,{placeholder:"Phone number",...s})}),e.jsx(d,{})]})})]}),e.jsx(l,{control:r.control,name:"vatNo",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"VAT Number"}),e.jsx(c,{children:e.jsx(h,{placeholder:"VAT registration number (optional)",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:r.control,name:"description",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Description"}),e.jsx(c,{children:e.jsx(me,{placeholder:"Hotel description (optional)",className:"min-h-[80px]",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(p,{type:"button",variant:"outline",onClick:x,disabled:j.isPending,children:"Cancel"}),e.jsxs(p,{type:"submit",disabled:j.isPending,"data-testid":"button-create-hotel",children:[j.isPending&&e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Hotel"]})]})]})})]})})}const ve=n.object({hotelId:n.string().min(1,"Please select a hotel"),username:n.string().min(3,"Username must be at least 3 characters").max(50,"Username must be less than 50 characters"),email:n.string().email("Please enter a valid email address"),firstName:n.string().min(1,"First name is required").max(50,"First name must be less than 50 characters"),lastName:n.string().min(1,"Last name is required").max(50,"Last name must be less than 50 characters"),phone:n.string().min(1,"Phone number is required").max(20,"Phone number must be less than 20 characters"),address:n.string().min(1,"Address is required").max(255,"Address must be less than 255 characters"),password:n.string().min(6,"Password must be at least 6 characters"),confirmPassword:n.string().min(6,"Password confirmation is required")}).refine(b=>b.password===b.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function ye({isOpen:b,onClose:g}){const{toast:v}=Q(),y=O(),{data:r=[],isLoading:j}=q({queryKey:["/api/hotels"],queryFn:async()=>await(await H("GET","/api/hotels")).json()}),m=z({resolver:R(ve),defaultValues:{hotelId:"",username:"",email:"",firstName:"",lastName:"",phone:"",address:"",password:"",confirmPassword:""}}),x=T({mutationFn:async t=>{const{confirmPassword:f,...L}=t,N={...L,role:"owner"};return await(await H("POST","/api/users",N)).json()},onSuccess:()=>{y.invalidateQueries({queryKey:["/api/users"]}),v({title:"Owner Created Successfully",description:"The new owner account has been created and can now access the system."}),m.reset(),g()},onError:t=>{v({title:"Failed to Create Owner",description:t.message||"Please check your input and try again.",variant:"destructive"})}}),s=t=>{x.mutate(t)},w=()=>{x.isPending||(m.reset(),g())};return e.jsx(F,{open:b,onOpenChange:w,children:e.jsxs(k,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto","data-testid":"modal-create-owner",children:[e.jsx(E,{children:e.jsxs(I,{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{children:"Create New Hotel Owner"})]})}),e.jsx(B,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(s),className:"space-y-4",children:[e.jsx(l,{control:m.control,name:"hotelId",render:({field:t})=>e.jsxs(i,{children:[e.jsx(o,{children:"Select Hotel *"}),e.jsxs(he,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(c,{children:e.jsx(xe,{children:e.jsx(ue,{placeholder:j?"Loading hotels...":"Select a hotel"})})}),e.jsx(je,{children:r.map(f=>e.jsx(pe,{value:f.id,children:f.name},f.id))})]}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:m.control,name:"firstName",render:({field:t})=>e.jsxs(i,{children:[e.jsx(o,{children:"First Name *"}),e.jsx(c,{children:e.jsx(h,{placeholder:"Enter first name",...t})}),e.jsx(d,{})]})}),e.jsx(l,{control:m.control,name:"lastName",render:({field:t})=>e.jsxs(i,{children:[e.jsx(o,{children:"Last Name *"}),e.jsx(c,{children:e.jsx(h,{placeholder:"Enter last name",...t})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:m.control,name:"username",render:({field:t})=>e.jsxs(i,{children:[e.jsx(o,{children:"Username *"}),e.jsx(c,{children:e.jsx(h,{placeholder:"Enter username",...t})}),e.jsx(d,{})]})}),e.jsx(l,{control:m.control,name:"email",render:({field:t})=>e.jsxs(i,{children:[e.jsx(o,{children:"Email *"}),e.jsx(c,{children:e.jsx(h,{type:"email",placeholder:"owner@example.com",...t})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:m.control,name:"phone",render:({field:t})=>e.jsxs(i,{children:[e.jsx(o,{children:"Phone Number *"}),e.jsx(c,{children:e.jsx(h,{placeholder:"Phone number",...t})}),e.jsx(d,{})]})}),e.jsx(l,{control:m.control,name:"address",render:({field:t})=>e.jsxs(i,{children:[e.jsx(o,{children:"Address *"}),e.jsx(c,{children:e.jsx(h,{placeholder:"Enter address",...t})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-foreground mb-3",children:"Account Security"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:m.control,name:"password",render:({field:t})=>e.jsxs(i,{children:[e.jsx(o,{children:"Password *"}),e.jsx(c,{children:e.jsx(h,{type:"password",placeholder:"Enter password",...t})}),e.jsx(d,{})]})}),e.jsx(l,{control:m.control,name:"confirmPassword",render:({field:t})=>e.jsxs(i,{children:[e.jsx(o,{children:"Confirm Password *"}),e.jsx(c,{children:e.jsx(h,{type:"password",placeholder:"Confirm password",...t})}),e.jsx(d,{})]})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(p,{type:"button",variant:"outline",onClick:w,disabled:x.isPending,children:"Cancel"}),e.jsxs(p,{type:"submit",disabled:x.isPending,"data-testid":"button-create-owner",children:[x.isPending&&e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Owner"]})]})]})})]})})}function Ee(){const[b,g]=C.useState(!1),[v,y]=C.useState(!1),[r,j]=C.useState(null),[m,x]=C.useState(!1),[s,w]=C.useState(null),t=O(),{data:f=[],isLoading:L}=q({queryKey:["/api/hotels"],refetchInterval:3e3}),{data:N=[],isLoading:G}=q({queryKey:["/api/users"],refetchInterval:3e3}),P=T({mutationFn:async({hotelId:a,activate:u})=>{const ee=u?`/api/hotels/${a}/activate`:`/api/hotels/${a}/deactivate`,U=await fetch(ee,{method:"PATCH",credentials:"include"});if(!U.ok)throw new Error(`Failed to ${u?"activate":"deactivate"} hotel`);return U.json()},onSuccess:(a,u)=>{t.invalidateQueries({queryKey:["/api/hotels"]}),K.success(`Hotel ${u.activate?"activated":"deactivated"} successfully`),x(!1),j(null),w(null)},onError:()=>{K.error("Failed to update hotel status")}}),M=(a,u)=>{j(a),w(u?"activate":"deactivate"),x(!0)},_=()=>{r&&s&&P.mutate({hotelId:r.id,activate:s==="activate"})},J=[{key:"name",label:"Hotel Name",sortable:!0},{key:"address",label:"Address",sortable:!0},{key:"vatNo",label:"VAT No",sortable:!0},{key:"createdAt",label:"Created",sortable:!0},{key:"isActive",label:"Status",render:a=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${a?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a?"Active":"Inactive"})}],W=[{key:"username",label:"Username",sortable:!0},{key:"email",label:"Email",sortable:!0},{key:"createdAt",label:"Created",sortable:!0},{key:"isActive",label:"Status",render:a=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${a?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a?"Active":"Inactive"})}],X=[{label:"Activate",action:a=>M(a,!0),variant:"default",show:a=>!a.isActive},{label:"Deactivate",action:a=>M(a,!1),variant:"destructive",show:a=>a.isActive}],Y=[{label:"View Details",action:a=>{}}],V=N.filter(a=>{var u;return((u=a.role)==null?void 0:u.name)==="owner"});return e.jsxs(ne,{title:"Super Admin Dashboard",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(S,{title:"Total Hotels",value:f.length,icon:e.jsx(A,{}),iconColor:"text-primary"}),e.jsx(S,{title:"Active Hotels",value:f.filter(a=>a.isActive).length,icon:e.jsx(le,{}),iconColor:"text-green-500"}),e.jsx(S,{title:"Total Owners",value:V.length,icon:e.jsx(D,{}),iconColor:"text-blue-500"}),e.jsx(S,{title:"Super Admins",value:N.filter(a=>{var u;return((u=a.role)==null?void 0:u.name)==="super_admin"}).length,icon:e.jsx(ie,{}),iconColor:"text-orange-500"})]}),e.jsx($,{title:"Hotel Management",data:f,columns:J,actions:X,onAdd:()=>g(!0),addButtonLabel:"Create Hotel",searchPlaceholder:"Search hotels..."}),e.jsx($,{title:"Owner Management",data:V,columns:W,actions:Y,onAdd:()=>y(!0),addButtonLabel:"Create Owner",searchPlaceholder:"Search owners..."}),e.jsxs(se,{children:[e.jsx(te,{children:e.jsx(ae,{children:"Quick Actions"})}),e.jsx(re,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(p,{variant:"outline",className:"h-20 flex flex-col","data-testid":"button-create-hotel",onClick:()=>g(!0),children:[e.jsx(A,{className:"h-6 w-6 mb-2"}),e.jsx("span",{className:"text-sm",children:"Create Hotel"})]}),e.jsxs(p,{variant:"outline",className:"h-20 flex flex-col","data-testid":"button-manage-owners",onClick:()=>y(!0),children:[e.jsx(D,{className:"h-6 w-6 mb-2"}),e.jsx("span",{className:"text-sm",children:"Create Owner"})]}),e.jsxs(p,{variant:"outline",className:"h-20 flex flex-col","data-testid":"button-system-analytics",children:[e.jsx(ge,{className:"h-6 w-6 mb-2"}),e.jsx("span",{className:"text-sm",children:"System Analytics"})]}),e.jsxs(p,{variant:"outline",className:"h-20 flex flex-col","data-testid":"button-create-superadmin",children:[e.jsx(oe,{className:"h-6 w-6 mb-2"}),e.jsx("span",{className:"text-sm",children:"Create Super Admin"})]})]})})]})]}),e.jsx(fe,{isOpen:b,onClose:()=>g(!1)}),e.jsx(ye,{isOpen:v,onClose:()=>y(!1)}),e.jsx(F,{open:m,onOpenChange:x,children:e.jsxs(k,{children:[e.jsxs(E,{children:[e.jsx(I,{children:s==="activate"?"Activate Hotel":"Deactivate Hotel"}),e.jsx(ce,{children:s==="activate"?`Are you sure you want to activate "${r==null?void 0:r.name}"? Users will be able to log in again.`:`Are you sure you want to deactivate "${r==null?void 0:r.name}"? All users from this hotel will be unable to log in, but their data will be preserved.`})]}),e.jsxs(de,{children:[e.jsx(p,{variant:"outline",onClick:()=>{x(!1),j(null),w(null)},children:"Cancel"}),e.jsx(p,{variant:s==="activate"?"default":"destructive",onClick:_,disabled:P.isPending,children:P.isPending?"Processing...":s==="activate"?"Activate":"Deactivate"})]})]})})]})}export{Ee as default};
