import{q as I,r as j,l as w,j as e,B as g,C as N,w as y}from"./index-CuDmVYun.js";import{D as W}from"./dashboard-layout-RBv1DXX2.js";import{S as M,a as D,b,c as C,d as f}from"./select-7c0Tajxe.js";import{a as q,b as E,C as O}from"./users-DXv82DeH.js";import{t as v,f as a,b as F}from"./format-BOBWS5Wu.js";import{b as S,a as V}from"./addWeeks-Pc006p7j.js";import{s as B,e as P}from"./startOfMonth-CkZi6Jlw.js";import"./circle-alert-CPwmOhkC.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";function _(l,d){const u=v(l.start),s=v(l.end);let n=+u>+s;const r=n?+u:+s,i=n?s:u;i.setHours(0,0,0,0);let p=1;const c=[];for(;+i<=r;)c.push(v(i)),i.setDate(i.getDate()+p),i.setHours(0,0,0,0);return n?c.reverse():c}function z(l,d){return S(l,-d)}function te(){const{user:l}=I(),[d,u]=j.useState(""),[s,n]=j.useState(new Date),[r,i]=j.useState("week"),{data:p=[]}=w({queryKey:["/api/halls"],refetchInterval:3e3,enabled:!!(l!=null&&l.hotelId)}),{data:c}=w({queryKey:["/api/halls",d,"calendar",a(s,"yyyy-MM-dd")],refetchInterval:3e3,enabled:!!d,queryFn:async()=>(await fetch(`/api/halls/${d}/calendar?date=${a(s,"yyyy-MM-dd")}`,{credentials:"include"})).json()}),x=r==="week"?(()=>{const t=F(s,{weekStartsOn:0});return Array.from({length:7},(m,h)=>V(t,h))})():(()=>{const t=B(s),m=P(s);return _({start:t,end:m})})(),k=()=>{n(r==="week"?z(s,1):new Date(s.getFullYear(),s.getMonth()-1,1))},H=()=>{n(r==="week"?S(s,1):new Date(s.getFullYear(),s.getMonth()+1,1))},$=t=>c!=null&&c.slots?c.slots.filter(m=>{const h=new Date(m.startTime);return a(h,"yyyy-MM-dd")===a(t,"yyyy-MM-dd")}):[],T=t=>{switch(t){case"confirmed":return"bg-red-500";case"in_progress":return"bg-yellow-500";case"quotation":return"bg-blue-500";case"deposit_pending":return"bg-orange-500";default:return"bg-gray-500"}};return e.jsx(W,{title:"Hall Calendar",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"heading-hall-calendar",children:"Hall Calendar"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(M,{value:r,onValueChange:t=>i(t),children:[e.jsx(D,{className:"w-32","data-testid":"select-view",children:e.jsx(b,{})}),e.jsxs(C,{children:[e.jsx(f,{value:"week",children:"Week"}),e.jsx(f,{value:"month",children:"Month"})]})]})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(M,{value:d,onValueChange:u,children:[e.jsx(D,{className:"w-64","data-testid":"select-hall-calendar",children:e.jsx(b,{placeholder:"Select a hall"})}),e.jsx(C,{children:p.map(t=>e.jsx(f,{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:"outline",size:"icon",onClick:k,"data-testid":"button-previous",children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx("div",{className:"text-lg font-semibold min-w-[200px] text-center",children:r==="week"?`${a(x[0],"MMM d")} - ${a(x[6],"MMM d, yyyy")}`:a(s,"MMMM yyyy")}),e.jsx(g,{variant:"outline",size:"icon",onClick:H,"data-testid":"button-next",children:e.jsx(E,{className:"h-4 w-4"})})]}),e.jsx(g,{variant:"outline",onClick:()=>n(new Date),"data-testid":"button-today",children:"Today"})]}),d?e.jsxs(N,{className:"p-4",children:[e.jsxs("div",{className:y("grid gap-2","grid-cols-7"),children:[r==="week"&&x.map(t=>e.jsx("div",{className:"text-center font-medium text-sm text-muted-foreground p-2",children:a(t,"EEE")},t.toString())),x.map(t=>{const m=$(t),h=a(t,"yyyy-MM-dd")===a(new Date,"yyyy-MM-dd");return e.jsxs("div",{className:y("min-h-[120px] border rounded-lg p-2 space-y-1",h&&"border-primary bg-primary/5"),"data-testid":`calendar-day-${a(t,"yyyy-MM-dd")}`,children:[e.jsx("div",{className:y("text-sm font-medium",h&&"text-primary"),children:a(t,"d")}),e.jsx("div",{className:"space-y-1",children:m.map(o=>e.jsxs("div",{className:y("text-xs p-1 rounded text-white truncate",T(o.status)),title:`${o.customerName} - ${a(new Date(o.startTime),"HH:mm")} - ${a(new Date(o.endTime),"HH:mm")}`,"data-testid":`booking-slot-${o.id}`,children:[a(new Date(o.startTime),"HH:mm")," ",o.customerName]},o.id))})]},t.toString())})]}),e.jsxs("div",{className:"mt-4 flex gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-blue-500"}),e.jsx("span",{children:"Quotation"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-orange-500"}),e.jsx("span",{children:"Deposit Pending"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-red-500"}),e.jsx("span",{children:"Confirmed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-yellow-500"}),e.jsx("span",{children:"In Progress"})]})]})]}):e.jsx(N,{className:"p-8",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(O,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Select a hall to view its calendar"})]})})]})})}export{te as default};
