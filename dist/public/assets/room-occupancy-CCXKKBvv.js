import{q as ss,u as as,v as ns,b as os,r as n,l as M,d as I,j as e,C as is,m as rs,n as ls,a as cs,s as l,I as p,B as x,w as Pt,p as C,k as g}from"./index-CuDmVYun.js";import{D as ds,B as us,d as ms}from"./dashboard-layout-RBv1DXX2.js";import{S as ue}from"./stats-card-CKM6aMdl.js";import{D as St}from"./data-table-B69p7Klv.js";import{D as H,a as J,b as z,c as X,d as Y}from"./dialog-CYNkLpdV.js";import{S as q,a as V,b as K,c as $,d as v}from"./select-7c0Tajxe.js";import{C as kt}from"./calendar-eJamnjJO.js";import{P as Dt,a as Tt,b as It}from"./popover-B3_UkTKl.js";import{u as hs}from"./use-websocket-CCUHb1Px.js";import{U as ps,C as Fe}from"./users-DXv82DeH.js";import{f as Ot}from"./format-BOBWS5Wu.js";import"./circle-alert-CPwmOhkC.js";import"./badge-DMaRL5Qw.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";import"./addWeeks-Pc006p7j.js";import"./startOfMonth-CkZi6Jlw.js";function Es(){var lt,ct,dt,ut;const{user:o}=ss(),{toast:i}=as(),{confirm:wt}=ns(),m=os(),Z=hs(),[Rt,ee]=n.useState(!1),[Et,te]=n.useState(!1),[G,se]=n.useState(!1),[ae,ne]=n.useState(!1),[s,D]=n.useState(null),[me,oe]=n.useState(!1),[P,ie]=n.useState(!1),[T,Ae]=n.useState(null),[he,pe]=n.useState(""),[Me,xe]=n.useState(""),[qe,ye]=n.useState(""),[re,f]=n.useState(""),[le,b]=n.useState(""),[je,Ve]=n.useState(""),[Ke,$e]=n.useState(""),[ve,Ge]=n.useState(""),[_e,Qe]=n.useState(""),[Be,Ue]=n.useState(""),[O,We]=n.useState(new Date),[w,Le]=n.useState(),[R,He]=n.useState(""),[ge,Je]=n.useState(""),[ze,Xe]=n.useState(""),[_,Ye]=n.useState("walkin"),[fe,Ze]=n.useState(""),[be,et]=n.useState(""),[S,tt]=n.useState(""),[Ne,Ce]=n.useState(""),[u,ce]=n.useState(null),[st,at]=n.useState(!1),{data:Q=[]}=M({queryKey:["/api/hotels/current/rooms"],refetchInterval:3e3}),{data:E=[]}=M({queryKey:["/api/hotels/current/room-types"],refetchInterval:3e3}),{data:Ft=[]}=M({queryKey:["/api/hotels/current/reservations"],refetchInterval:3e3}),{data:nt=[]}=M({queryKey:["/api/hotels",o==null?void 0:o.hotelId,"meal-plans"],refetchInterval:3e3,enabled:!!(o!=null&&o.hotelId)}),{data:At=[]}=M({queryKey:["/api/hotels/current/taxes"],refetchInterval:3e3,enabled:!!(o!=null&&o.hotelId)}),{data:Mt=[]}=M({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3,enabled:!!(o!=null&&o.hotelId)});n.useEffect(()=>{const t=[Z.on("room:updated",()=>{m.invalidateQueries({queryKey:["/api/hotels/current/rooms"]}),m.invalidateQueries({queryKey:["/api/hotels/current/reservations"]})}),Z.on("transaction:created",()=>{m.invalidateQueries({queryKey:["/api/hotels/current/transactions"]})}),Z.on("transaction:updated",()=>{m.invalidateQueries({queryKey:["/api/hotels/current/transactions"]})})];return()=>{t.forEach(a=>a())}},[Z,m]);const B=()=>{pe(""),xe(""),ye(""),Ae(null)};n.useEffect(()=>{var t;s&&G?(f(s.roomNumber||""),b(((t=s.roomTypeId)==null?void 0:t.toString())||"")):ae&&!s?(f(""),b("")):!G&&!ae&&(f(""),b(""),D(null))},[s,G,ae]),n.useEffect(()=>{T&&P?(pe(T.name||""),xe(T.priceWalkin||""),ye(T.priceInhouse||"")):!P&&!me&&B()},[T,P,me]);const Pe=I({mutationFn:async t=>{await g("POST","/api/rooms",t)},onSuccess:()=>{m.invalidateQueries({queryKey:["/api/hotels/current/rooms"]}),i({title:"Success",description:"Room created successfully!"}),ne(!1),f(""),b("")},onError:()=>{i({title:"Error",description:"Failed to create room",variant:"destructive"})}}),Se=I({mutationFn:async({id:t,data:a})=>{await g("PUT",`/api/rooms/${t}`,a)},onSuccess:()=>{m.invalidateQueries({queryKey:["/api/hotels/current/rooms"]}),i({title:"Success",description:"Room updated successfully!"}),se(!1),f(""),b("")},onError:()=>{i({title:"Error",description:"Failed to update room",variant:"destructive"})}}),ke=I({mutationFn:async t=>{await g("POST","/api/room-types",t)},onSuccess:()=>{m.invalidateQueries({queryKey:["/api/hotels/current/room-types"]}),i({title:"Success",description:"Room type created successfully!"}),oe(!1),B()},onError:()=>{i({title:"Error",description:"Failed to create room type",variant:"destructive"})}}),De=I({mutationFn:async({id:t,data:a})=>{await g("PUT",`/api/room-types/${t}`,a)},onSuccess:()=>{m.invalidateQueries({queryKey:["/api/hotels/current/room-types"]}),i({title:"Success",description:"Room type updated successfully!"}),ie(!1),B()},onError:()=>{i({title:"Error",description:"Failed to update room type",variant:"destructive"})}}),qt=I({mutationFn:async t=>{await g("DELETE",`/api/room-types/${t}`)},onSuccess:()=>{m.invalidateQueries({queryKey:["/api/hotels/current/room-types"]}),i({title:"Success",description:"Room type deleted successfully!"})},onError:()=>{i({title:"Error",description:"Failed to delete room type",variant:"destructive"})}}),Te=I({mutationFn:async t=>{const a=nt.find(j=>j.id===t.mealPlanId),c=Q.find(j=>j.id===t.roomId),d=E.find(j=>j.id===(c==null?void 0:c.roomTypeId));if(!d)throw new Error("Room type information is missing. Please ensure the room is properly configured.");const h=t.guestType==="inhouse"?d.priceInhouse:d.priceWalkin,k=h?Number(h):0;if(k<=0)throw new Error(`Room price is not configured for ${t.guestType} guests. Please configure room pricing first.`);await g("PUT",`/api/rooms/${t.roomId}`,{isOccupied:!0,occupantDetails:{name:t.guestName,email:t.guestEmail,phone:t.guestPhone,idNumber:t.idNumber,nationality:t.nationality,checkInDate:t.checkInDate,checkOutDate:t.checkOutDate,guestType:t.guestType||"walkin",officeName:t.officeName||null,roomTypeId:(d==null?void 0:d.id)||null,roomTypeName:(d==null?void 0:d.name)||null,roomPrice:k,mealPlan:a?{planId:a.id,planType:a.planType,planName:a.planName,pricePerPerson:a.pricePerPerson,numberOfPersons:Number(t.numberOfPersons)||0,totalCost:Number(a.pricePerPerson)*(Number(t.numberOfPersons)||0)}:null}}),t.advancePayment&&Number(t.advancePayment)>0&&await g("POST","/api/transactions",{hotelId:o==null?void 0:o.hotelId,txnType:t.paymentMethod==="cash"?"cash_in":t.paymentMethod==="pos"?"pos_in":"fonepay_in",amount:String(Number(t.advancePayment)),paymentMethod:t.paymentMethod,purpose:"room_advance_payment",reference:`Room ${s==null?void 0:s.roomNumber} - ${t.guestName}`,details:{roomId:t.roomId,roomNumber:s==null?void 0:s.roomNumber,guestName:t.guestName,checkInDate:t.checkInDate},createdBy:o==null?void 0:o.id})},onSuccess:()=>{m.invalidateQueries({queryKey:["/api/hotels/current/rooms"]}),m.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),i({title:"Guest checked in successfully"}),Oe(),ee(!1)},onError:t=>{i({title:"Check-in failed",description:t.message||"Failed to check in guest",variant:"destructive"})}}),Ie=I({mutationFn:async t=>{var a,c,d,h,k,j,U;if(!S||!["cash","pos","fonepay"].includes(S))throw new Error("Please select a payment method (Cash, POS, or Fonepay) before checking out");await g("PUT",`/api/rooms/${t.roomId}`,{isOccupied:!1,occupantDetails:null}),t.finalAmount>0&&await g("POST","/api/transactions",{hotelId:o==null?void 0:o.hotelId,txnType:S==="cash"?"cash_in":S==="pos"?"pos_in":"fonepay_in",amount:String(t.finalAmount),paymentMethod:S,purpose:"room_checkout_payment",reference:`Checkout - Room ${t.roomNumber} - ${t.guestName}${t.voucherId?" (Voucher Applied)":""}`,details:{roomNumber:t.roomNumber,guestName:t.guestName,checkInDate:(a=s==null?void 0:s.occupantDetails)==null?void 0:a.checkInDate,checkOutDate:(c=s==null?void 0:s.occupantDetails)==null?void 0:c.checkOutDate,numberOfDays:((d=t.billingDetails)==null?void 0:d.numberOfDays)||1,subtotal:((h=t.billingDetails)==null?void 0:h.subtotal)||0,roomCharges:((k=t.billingDetails)==null?void 0:k.totalRoomCharges)||0,mealPlanCharges:((j=t.billingDetails)==null?void 0:j.totalMealPlanCharges)||0,totalTax:((U=t.billingDetails)==null?void 0:U.totalTax)||0,discountAmount:t.discountAmount,voucherCode:(u==null?void 0:u.code)||null,grandTotal:t.finalAmount,paymentMethod:S},createdBy:o==null?void 0:o.id}),t.voucherId&&await g("POST","/api/vouchers/redeem",{voucherId:t.voucherId})},onSuccess:()=>{m.invalidateQueries({queryKey:["/api/hotels/current/rooms"]}),m.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),i({title:"Guest checked out successfully"}),we(),te(!1)},onError:t=>{i({title:"Checkout failed",description:t.message||"Failed to check out guest",variant:"destructive"})}}),ot=()=>{if(!re.trim()){i({title:"Error",description:"Room number is required",variant:"destructive"});return}const t={roomNumber:re,roomTypeId:le?parseInt(le):null};s&&G?Se.mutate({id:s.id,data:t}):Pe.mutate(t)},Oe=()=>{Ve(""),$e(""),Ge(""),Qe(""),Ue(""),We(new Date),Le(void 0),He(""),Je(""),Xe(""),Ye("walkin"),Ze(""),et("")},we=()=>{Ce(""),ce(null),tt("")},Vt=t=>{D(t),Oe(),ee(!0)},Kt=t=>{D(t),we(),te(!0)},$t=async()=>{if(!Ne.trim()){i({title:"Please enter a voucher code",variant:"destructive"});return}at(!0);try{const a=await(await fetch("/api/vouchers/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:Ne}),credentials:"include"})).json();a.valid?(ce(a.voucher),i({title:"Voucher applied successfully!"})):(ce(null),i({title:"Invalid voucher",description:a.message||"Voucher code is invalid",variant:"destructive"}))}catch{i({title:"Error validating voucher",variant:"destructive"})}finally{at(!1)}},it=t=>{var yt,jt,vt,gt,ft;const a=(yt=t.occupantDetails)!=null&&yt.roomPrice?Number(t.occupantDetails.roomPrice):0,c=(jt=t.occupantDetails)!=null&&jt.checkInDate?new Date(t.occupantDetails.checkInDate):null,d=new Date;let h=1;if(c){const r=d.getTime()-c.getTime(),y=2*60*60*1e3,N=Math.max(0,r-y);h=Math.max(1,Math.ceil(N/(1e3*3600*24)))}const k=a*h,j=((gt=(vt=t.occupantDetails)==null?void 0:vt.mealPlan)==null?void 0:gt.totalCost)||0,U=parseFloat(j.toString())*h,F=k+U;let W=0,L=F;u&&(u.discountType==="percentage"?(W=Math.round(F*(parseFloat(u.discountAmount)/100)*100)/100,L=Math.round((F-W)*100)/100):u.discountType==="fixed"&&(W=Math.min(parseFloat(u.discountAmount),F),L=Math.round((F-W)*100)/100));const zt=At.filter(r=>r.isActive),mt=["vat","service_tax","luxury_tax"],Xt=zt.sort((r,y)=>{const N=mt.indexOf(r.taxType),A=mt.indexOf(y.taxType);return(N===-1?999:N)-(A===-1?999:A)});let Re=L;const Ee={};Xt.forEach(r=>{const y=parseFloat(r.percent)/100,N=Math.round(Re*y*100)/100,A=r.taxType==="vat"?"VAT":r.taxType==="service_tax"?"Service Tax":r.taxType==="luxury_tax"?"Luxury Tax":r.taxType;Ee[A]={rate:parseFloat(r.percent),amount:N},Re=Math.round((Re+N)*100)/100});const ht=Object.values(Ee).reduce((r,y)=>r+y.amount,0);let pt=Math.round((L+ht)*100)/100;const Yt=t.id,Zt=((ft=t.occupantDetails)==null?void 0:ft.name)||"",es=t.roomNumber||"",xt=Mt.filter(r=>{var bt,Nt,Ct;const y=r.purpose==="room_advance_payment";if((bt=r.details)!=null&&bt.roomId)return y&&r.details.roomId===Yt;const N=(Nt=r.reference)==null?void 0:Nt.includes(`Room ${es}`),A=(Ct=r.reference)==null?void 0:Ct.includes(Zt);return y&&N&&A}).reduce((r,y)=>r+(parseFloat(y.amount)||0),0),ts=Math.max(0,Math.round((pt-xt)*100)/100);return{subtotal:F,discountedSubtotal:L,taxBreakdown:Ee,totalTax:ht,discountAmount:W,advancePayment:xt,grandTotal:pt,finalAmount:ts,numberOfDays:h,totalRoomCharges:k,mealPlanCostPerDay:parseFloat(j.toString()),totalMealPlanCharges:parseFloat(U.toString())}},Gt=()=>{if(!je.trim()||!ve.trim()||!O||!w){i({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}if(!be&&R&&Number(R)>0){i({title:"Error",description:"Please select payment method for advance payment",variant:"destructive"});return}if(_==="inhouse"&&!fe.trim()){i({title:"Error",description:"Office name is required for in-house guests",variant:"destructive"});return}Te.mutate({roomId:s==null?void 0:s.id,guestName:je,guestEmail:Ke,guestPhone:ve,idNumber:_e,nationality:Be,checkInDate:O.toISOString(),checkOutDate:w.toISOString(),advancePayment:R,mealPlanId:ge,numberOfPersons:ze,guestType:_,officeName:_==="inhouse"?fe:null,paymentMethod:be})},_t=()=>{var a;if(!s)return;const t=it(s);Ie.mutate({roomId:s.id,roomNumber:s.roomNumber,guestName:((a=s.occupantDetails)==null?void 0:a.name)||"",totalAmount:t.grandTotal,discountAmount:t.discountAmount,finalAmount:t.finalAmount,voucherId:u==null?void 0:u.id,billingDetails:t})},Qt=()=>{if(!he.trim()){i({title:"Error",description:"Room type name is required",variant:"destructive"});return}const t={hotelId:o==null?void 0:o.hotelId,name:he,priceWalkin:Me||"0",priceInhouse:qe||"0"};T&&P?De.mutate({id:T.id,data:t}):ke.mutate(t)},de=Q.length,rt=Q.filter(t=>t.isOccupied).length,Bt=de-rt,Ut=de>0?rt/de*100:0,Wt=[{key:"roomNumber",label:"Room Number",sortable:!0},{key:"roomType",label:"Room Type",sortable:!0,render:(t,a)=>{const c=E.find(d=>d.id===a.roomTypeId);return(c==null?void 0:c.name)||"Unknown"}},{key:"isOccupied",label:"Status",render:t=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:t?"Occupied":"Available"})},{key:"occupantDetails",label:"Guest Details",render:t=>t&&t.name||"N/A"}],Lt=[{label:"Check In",action:t=>Vt(t),show:t=>!t.isOccupied},{label:"Check Out",action:t=>Kt(t),show:t=>t.isOccupied},{label:"Edit",action:t=>{D(t),se(!0)}}],Ht=[{key:"name",label:"Room Type Name",sortable:!0},{key:"priceWalkin",label:"Walk-in Price",sortable:!0,render:t=>`NPR ${Number(t||0).toFixed(2)}`},{key:"priceInhouse",label:"In-house Price",sortable:!0,render:t=>`NPR ${Number(t||0).toFixed(2)}`}],Jt=[{label:"Edit",action:t=>{Ae(t),ie(!0)}},{label:"Delete",action:async t=>{await wt({title:"Delete Room Type",description:`Are you sure you want to delete room type "${t.name}"?`,confirmText:"Delete",cancelText:"Cancel",variant:"destructive",onConfirm:()=>{qt.mutate(t.id)}})},variant:"destructive"}];return e.jsx(ds,{title:"Room Occupancy",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(ue,{title:"Total Rooms",value:de,icon:e.jsx(us,{}),iconColor:"text-blue-500"}),e.jsx(ue,{title:"Occupancy Rate",value:`${Ut.toFixed(1)}%`,icon:e.jsx(ps,{}),iconColor:"text-green-500"}),e.jsx(ue,{title:"Available Rooms",value:Bt,icon:e.jsx(ms,{}),iconColor:"text-purple-500"}),e.jsx(ue,{title:"Reservations",value:Ft.length,icon:e.jsx(Fe,{}),iconColor:"text-orange-500"})]}),e.jsxs(is,{children:[e.jsx(rs,{children:e.jsx(ls,{children:"Room Types"})}),e.jsx(cs,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:E.map(t=>{const a=Q.filter(h=>h.roomTypeId===t.id),c=a.filter(h=>h.isOccupied).length,d=a.length>0?c/a.length*100:0;return e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h3",{className:"font-medium text-lg",children:t.name}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total: ",a.length," rooms"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Occupied: ",c," rooms"]}),e.jsxs("div",{className:"text-sm font-medium",children:["Occupancy: ",d.toFixed(1),"%"]})]})]},t.id)})})})]}),e.jsx(St,{title:"Room Types & Pricing",data:E,columns:Ht,actions:Jt,onAdd:()=>oe(!0),addButtonLabel:"Add Room Type",searchPlaceholder:"Search room types..."}),e.jsx(St,{title:"All Rooms",data:Q,columns:Wt,actions:Lt,onAdd:()=>ne(!0),addButtonLabel:"Add Room",searchPlaceholder:"Search rooms..."}),e.jsx(H,{open:Rt,onOpenChange:t=>{ee(t),t||(D(null),Oe())},children:e.jsxs(J,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(z,{children:[e.jsxs(X,{children:["Check In - Room ",s==null?void 0:s.roomNumber]}),e.jsx(Y,{children:"Enter guest information to check in"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Guest Type"}),e.jsxs(q,{value:_,onValueChange:t=>Ye(t),children:[e.jsx(V,{"data-testid":"select-guest-type",children:e.jsx(K,{})}),e.jsxs($,{children:[e.jsx(v,{value:"walkin",children:"Walk-in Guest"}),e.jsx(v,{value:"inhouse",children:"In-House Guest"})]})]})]}),_==="inhouse"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"office-name",children:"Office/Company Name *"}),e.jsx(p,{id:"office-name",value:fe,onChange:t=>Ze(t.target.value),placeholder:"Enter office or company name","data-testid":"input-office-name"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"guest-name",children:"Guest Name *"}),e.jsx(p,{id:"guest-name",value:je,onChange:t=>Ve(t.target.value),placeholder:"Enter guest name","data-testid":"input-guest-name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"guest-phone",children:"Phone Number *"}),e.jsx(p,{id:"guest-phone",value:ve,onChange:t=>Ge(t.target.value),placeholder:"Enter phone number","data-testid":"input-guest-phone"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"guest-email",children:"Email"}),e.jsx(p,{id:"guest-email",type:"email",value:Ke,onChange:t=>$e(t.target.value),placeholder:"Enter email","data-testid":"input-guest-email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"id-number",children:"ID Number"}),e.jsx(p,{id:"id-number",value:_e,onChange:t=>Qe(t.target.value),placeholder:"Enter ID number","data-testid":"input-id-number"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"nationality",children:"Nationality"}),e.jsx(p,{id:"nationality",value:Be,onChange:t=>Ue(t.target.value),placeholder:"Enter nationality","data-testid":"input-nationality"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Meal Plan"}),e.jsxs(q,{value:ge,onValueChange:Je,children:[e.jsx(V,{"data-testid":"select-meal-plan",children:e.jsx(K,{placeholder:"Select meal plan (optional)"})}),e.jsx($,{children:nt.map(t=>e.jsxs(v,{value:t.id,children:[t.planName," (",t.planType,") - NPR ",t.pricePerPerson,"/person"]},t.id))})]})]})]}),ge&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"num-persons",children:"Number of Persons"}),e.jsx(p,{id:"num-persons",type:"number",value:ze,onChange:t=>Xe(t.target.value),placeholder:"Enter number of persons","data-testid":"input-num-persons"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Check-In Date *"}),e.jsxs(Dt,{children:[e.jsx(Tt,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:Pt("w-full justify-start text-left font-normal",!O&&"text-muted-foreground"),"data-testid":"button-checkin-date",children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),O?Ot(O,"PPP"):"Select date"]})}),e.jsx(It,{className:"w-auto p-0",children:e.jsx(kt,{mode:"single",selected:O,onSelect:We,initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Check-Out Date *"}),e.jsxs(Dt,{children:[e.jsx(Tt,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:Pt("w-full justify-start text-left font-normal",!w&&"text-muted-foreground"),"data-testid":"button-checkout-date",children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),w?Ot(w,"PPP"):"Select date"]})}),e.jsx(It,{className:"w-auto p-0",children:e.jsx(kt,{mode:"single",selected:w,onSelect:Le,initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"advance-payment",children:"Advance Payment"}),e.jsx(p,{id:"advance-payment",type:"number",value:R,onChange:t=>He(t.target.value),placeholder:"Enter advance amount","data-testid":"input-advance-payment"})]}),R&&Number(R)>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Payment Method"}),e.jsxs(q,{value:be,onValueChange:et,children:[e.jsx(V,{"data-testid":"select-payment-method",children:e.jsx(K,{placeholder:"Select payment method"})}),e.jsxs($,{children:[e.jsx(v,{value:"cash",children:"Cash"}),e.jsx(v,{value:"pos",children:"POS"}),e.jsx(v,{value:"fonepay",children:"Fonepay"})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4",children:[e.jsx(x,{variant:"outline",onClick:()=>ee(!1),"data-testid":"button-cancel-checkin",children:"Cancel"}),e.jsx(x,{onClick:Gt,disabled:Te.isPending,"data-testid":"button-submit-checkin",children:Te.isPending?"Checking in...":"Check In"})]})]})]})}),e.jsx(H,{open:Et,onOpenChange:t=>{te(t),t||(D(null),we())},children:e.jsxs(J,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(z,{children:[e.jsxs(X,{children:["Check Out - Room ",s==null?void 0:s.roomNumber]}),e.jsx(Y,{children:"Review bill and complete checkout"})]}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Guest Information"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",(lt=s.occupantDetails)==null?void 0:lt.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"})," ",(ct=s.occupantDetails)==null?void 0:ct.phone]}),((dt=s.occupantDetails)==null?void 0:dt.email)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",(ut=s.occupantDetails)==null?void 0:ut.email]})]})]}),(()=>{const t=it(s);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Room Charges (",t.numberOfDays," nights):"]}),e.jsx("span",{children:C(t.totalRoomCharges)})]}),t.totalMealPlanCharges>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Meal Plan (",t.numberOfDays," nights):"]}),e.jsx("span",{children:C(t.totalMealPlanCharges)})]}),e.jsxs("div",{className:"flex justify-between font-semibold pt-2 border-t",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:C(t.subtotal)})]}),t.discountAmount>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-",C(t.discountAmount)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Discounted Subtotal:"}),e.jsx("span",{children:C(t.discountedSubtotal)})]})]}),Object.entries(t.taxBreakdown).map(([a,c])=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[a," (",c.rate,"%):"]}),e.jsx("span",{children:C(c.amount)})]},a)),e.jsxs("div",{className:"flex justify-between font-semibold pt-2 border-t",children:[e.jsx("span",{children:"Grand Total:"}),e.jsx("span",{children:C(t.grandTotal)})]}),t.advancePayment>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-blue-600",children:[e.jsx("span",{children:"Advance Payment:"}),e.jsxs("span",{children:["-",C(t.advancePayment)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Amount Due:"}),e.jsx("span",{children:C(t.finalAmount)})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"voucher-code",children:"Apply Voucher Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{id:"voucher-code",value:Ne,onChange:a=>Ce(a.target.value),placeholder:"Enter voucher code",disabled:!!u,"data-testid":"input-voucher-code"}),u?e.jsx(x,{variant:"outline",onClick:()=>{Ce(""),ce(null)},"data-testid":"button-remove-voucher",children:"Remove"}):e.jsx(x,{onClick:$t,disabled:st,"data-testid":"button-apply-voucher",children:st?"Validating...":"Apply"})]}),u&&e.jsxs("p",{className:"text-sm text-green-600",children:['Voucher "',u.code,'" applied!']})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Payment Method *"}),e.jsxs(q,{value:S,onValueChange:tt,children:[e.jsx(V,{"data-testid":"select-checkout-payment",children:e.jsx(K,{placeholder:"Select payment method"})}),e.jsxs($,{children:[e.jsx(v,{value:"cash",children:"Cash"}),e.jsx(v,{value:"pos",children:"POS"}),e.jsx(v,{value:"fonepay",children:"Fonepay"})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4",children:[e.jsx(x,{variant:"outline",onClick:()=>te(!1),"data-testid":"button-cancel-checkout",children:"Cancel"}),e.jsx(x,{onClick:_t,disabled:Ie.isPending||!S,"data-testid":"button-submit-checkout",children:Ie.isPending?"Checking out...":"Check Out"})]})]})})()]})]})}),e.jsx(H,{open:G,onOpenChange:t=>{se(t),t||(D(null),f(""),b(""))},children:e.jsxs(J,{children:[e.jsxs(z,{children:[e.jsxs(X,{children:["Edit Room ",s==null?void 0:s.roomNumber]}),e.jsx(Y,{children:"Update room details"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-room-number",children:"Room Number"}),e.jsx(p,{id:"edit-room-number",value:re,onChange:t=>f(t.target.value),placeholder:"Enter room number","data-testid":"input-room-number"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"edit-room-type",children:"Room Type"}),e.jsxs(q,{value:le,onValueChange:b,children:[e.jsx(V,{id:"edit-room-type","data-testid":"select-room-type",children:e.jsx(K,{placeholder:"Select room type"})}),e.jsx($,{children:E.map(t=>e.jsx(v,{value:t.id.toString(),children:t.name},t.id))})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(x,{variant:"outline",onClick:()=>se(!1),"data-testid":"button-cancel-edit",children:"Cancel"}),e.jsx(x,{onClick:ot,disabled:Se.isPending,"data-testid":"button-save-room",children:Se.isPending?"Saving...":"Save Changes"})]})]})]})}),e.jsx(H,{open:ae,onOpenChange:t=>{ne(t),t||(f(""),b(""))},children:e.jsxs(J,{children:[e.jsxs(z,{children:[e.jsx(X,{children:"Add New Room"}),e.jsx(Y,{children:"Create a new room"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"add-room-number",children:"Room Number"}),e.jsx(p,{id:"add-room-number",value:re,onChange:t=>f(t.target.value),placeholder:"Enter room number","data-testid":"input-room-number"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"add-room-type",children:"Room Type"}),e.jsxs(q,{value:le,onValueChange:b,children:[e.jsx(V,{id:"add-room-type","data-testid":"select-room-type",children:e.jsx(K,{placeholder:"Select room type"})}),e.jsx($,{children:E.map(t=>e.jsx(v,{value:t.id.toString(),children:t.name},t.id))})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(x,{variant:"outline",onClick:()=>ne(!1),"data-testid":"button-cancel-add",children:"Cancel"}),e.jsx(x,{onClick:ot,disabled:Pe.isPending,"data-testid":"button-create-room",children:Pe.isPending?"Creating...":"Create Room"})]})]})]})}),e.jsx(H,{open:me||P,onOpenChange:t=>{t||(oe(!1),ie(!1),B())},children:e.jsxs(J,{className:"max-w-md",children:[e.jsxs(z,{children:[e.jsx(X,{children:P?"Edit Room Type":"Add Room Type"}),e.jsx(Y,{children:P?"Update room type and pricing information":"Create a new room type with pricing"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"room-type-name",children:"Room Type Name *"}),e.jsx(p,{id:"room-type-name",value:he,onChange:t=>pe(t.target.value),placeholder:"e.g., Deluxe, Standard, Suite","data-testid":"input-room-type-name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"price-walkin",children:"Walk-in Price (NPR) *"}),e.jsx(p,{id:"price-walkin",type:"number",value:Me,onChange:t=>xe(t.target.value),placeholder:"Enter walk-in price","data-testid":"input-price-walkin"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"price-inhouse",children:"In-house Price (NPR) *"}),e.jsx(p,{id:"price-inhouse",type:"number",value:qe,onChange:t=>ye(t.target.value),placeholder:"Enter in-house price","data-testid":"input-price-inhouse"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(x,{variant:"outline",onClick:()=>{oe(!1),ie(!1),B()},"data-testid":"button-cancel-room-type",children:"Cancel"}),e.jsx(x,{onClick:Qt,disabled:ke.isPending||De.isPending,"data-testid":"button-save-room-type",children:ke.isPending||De.isPending?"Saving...":P?"Update":"Create"})]})]})]})})]})})}export{Es as default};
