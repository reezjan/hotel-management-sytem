import{r as c,b as Q,l as K,d as z,j as e,C as i,m as d,n as h,a as m,s as o,B as M,I as S}from"./index-CuDmVYun.js";import{D as H,R as G,F as P,C as F,G as k,a as J}from"./dashboard-layout-RBv1DXX2.js";import{D as W}from"./data-table-B69p7Klv.js";import{S as p,a as j,b as y,c as f,d as t}from"./select-7c0Tajxe.js";import{D as $,a as U,b as X,c as Y}from"./dialog-CYNkLpdV.js";import{t as g}from"./index-hq1wgpuD.js";import{u as Z}from"./use-websocket-CCUHb1Px.js";import"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./badge-DMaRL5Qw.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";function me(){const[D,x]=c.useState(!1),[N,O]=c.useState("all"),[v,R]=c.useState("all"),[n,l]=c.useState({amount:"",paymentMethod:"",txnType:"",purpose:""}),u=Q(),b=Z(),{data:r=[],isLoading:L}=K({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3,queryFn:async()=>{const s=await fetch("/api/hotels/current/transactions",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch transactions");return s.json()}});c.useEffect(()=>{const s=[b.on("transaction:created",()=>{u.invalidateQueries({queryKey:["/api/hotels/current/transactions"]})}),b.on("transaction:updated",()=>{u.invalidateQueries({queryKey:["/api/hotels/current/transactions"]})})];return()=>{s.forEach(a=>a())}},[b,u]);const T=z({mutationFn:async s=>{const a=await fetch("/api/transactions",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...s,amount:parseFloat(s.amount)})});if(!a.ok){const C=await a.json();throw new Error(C.message||"Failed to create transaction")}return a.json()},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),x(!1),l({amount:"",paymentMethod:"",txnType:"",purpose:""}),g.success("Transaction recorded successfully")},onError:s=>{g.error(s.message||"Failed to record transaction")}}),w=r.filter(s=>{const a=N==="all"||s.paymentMethod===N,C=v==="all"||s.txnType===v;return a&&C}),A=w.reduce((s,a)=>s+Number(a.amount),0),q=r.filter(s=>s.paymentMethod==="cash").reduce((s,a)=>s+Number(a.amount),0),E=r.filter(s=>s.paymentMethod==="pos").reduce((s,a)=>s+Number(a.amount),0),V=r.filter(s=>s.paymentMethod==="fonepay").reduce((s,a)=>s+Number(a.amount),0),_=[{key:"amount",label:"Amount",sortable:!0,render:s=>`रु${Number(s).toLocaleString()}`},{key:"paymentMethod",label:"Payment Method",sortable:!0,render:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[s==="cash"&&e.jsx(P,{className:"h-4 w-4 text-green-500"}),s==="pos"&&e.jsx(F,{className:"h-4 w-4 text-blue-500"}),s==="fonepay"&&e.jsx(k,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"capitalize",children:s})]})},{key:"txnType",label:"Type",sortable:!0,render:s=>e.jsx("span",{className:"capitalize",children:s.replace(/_/g," ")})},{key:"purpose",label:"Purpose",sortable:!0},{key:"createdAt",label:"Date",sortable:!0,render:s=>new Date(s).toLocaleString()}],B=()=>{if(!n.amount||!n.paymentMethod||!n.txnType){g.error("Please fill in all required fields");return}if(isNaN(Number(n.amount))||Number(n.amount)<=0){g.error("Please enter a valid amount");return}T.mutate(n)},I=()=>{l({amount:"",paymentMethod:"",txnType:"",purpose:""})};return e.jsx(H,{title:"Transaction Management",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(i,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Total Transactions"}),e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["रु",A.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[w.length," transactions"]})]})]}),e.jsxs(i,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Cash Payments"}),e.jsx(P,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["रु",q.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.filter(s=>s.paymentMethod==="cash").length," transactions"]})]})]}),e.jsxs(i,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"POS Payments"}),e.jsx(F,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["रु",E.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.filter(s=>s.paymentMethod==="pos").length," transactions"]})]})]}),e.jsxs(i,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Fonepay Payments"}),e.jsx(k,{className:"h-4 w-4 text-purple-500"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["रु",V.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.filter(s=>s.paymentMethod==="fonepay").length," transactions"]})]})]})]}),e.jsxs(i,{children:[e.jsx(d,{children:e.jsx(h,{children:"Filters & Actions"})}),e.jsx(m,{children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"filter-method",children:"Payment Method"}),e.jsxs(p,{value:N,onValueChange:O,children:[e.jsx(j,{className:"w-[180px]",children:e.jsx(y,{})}),e.jsxs(f,{children:[e.jsx(t,{value:"all",children:"All Methods"}),e.jsx(t,{value:"cash",children:"Cash"}),e.jsx(t,{value:"pos",children:"POS"}),e.jsx(t,{value:"fonepay",children:"Fonepay"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"filter-type",children:"Transaction Type"}),e.jsxs(p,{value:v,onValueChange:R,children:[e.jsx(j,{className:"w-[180px]",children:e.jsx(y,{})}),e.jsxs(f,{children:[e.jsx(t,{value:"all",children:"All Types"}),e.jsx(t,{value:"room_booking",children:"Room Booking"}),e.jsx(t,{value:"restaurant_order",children:"Restaurant Order"}),e.jsx(t,{value:"vendor_payment",children:"Vendor Payment"}),e.jsx(t,{value:"maintenance",children:"Maintenance"}),e.jsx(t,{value:"other",children:"Other"})]})]})]}),e.jsxs(M,{onClick:()=>x(!0),className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Record Transaction"]})]})})]}),e.jsx(W,{title:"All Transactions",data:w,columns:_,searchPlaceholder:"Search transactions...",isLoading:L}),e.jsx($,{open:D,onOpenChange:x,children:e.jsxs(U,{className:"max-w-md",children:[e.jsx(X,{children:e.jsx(Y,{children:"Record New Transaction"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"amount",children:"Amount *"}),e.jsx(S,{id:"amount",type:"number",step:"0.01",placeholder:"0.00",value:n.amount,onChange:s=>l(a=>({...a,amount:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"paymentMethod",children:"Payment Method *"}),e.jsxs(p,{value:n.paymentMethod,onValueChange:s=>l(a=>({...a,paymentMethod:s})),children:[e.jsx(j,{children:e.jsx(y,{placeholder:"Select payment method"})}),e.jsxs(f,{children:[e.jsx(t,{value:"cash",children:"Cash"}),e.jsx(t,{value:"pos",children:"POS"}),e.jsx(t,{value:"fonepay",children:"Fonepay"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"txnType",children:"Transaction Type *"}),e.jsxs(p,{value:n.txnType,onValueChange:s=>l(a=>({...a,txnType:s})),children:[e.jsx(j,{children:e.jsx(y,{placeholder:"Select transaction type"})}),e.jsxs(f,{children:[e.jsx(t,{value:"room_booking",children:"Room Booking"}),e.jsx(t,{value:"restaurant_order",children:"Restaurant Order"}),e.jsx(t,{value:"vendor_payment",children:"Vendor Payment"}),e.jsx(t,{value:"maintenance",children:"Maintenance"}),e.jsx(t,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"purpose",children:"Purpose/Description"}),e.jsx(S,{id:"purpose",placeholder:"Optional description",value:n.purpose,onChange:s=>l(a=>({...a,purpose:s.target.value}))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(M,{onClick:B,disabled:T.isPending,className:"flex-1",children:T.isPending?"Recording...":"Record Transaction"}),e.jsx(M,{type:"button",variant:"outline",onClick:()=>{I(),x(!1)},children:"Cancel"})]})]})]})})]})})}export{me as default};
