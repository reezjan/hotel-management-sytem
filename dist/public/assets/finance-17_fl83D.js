import{q as Le,u as Ke,b as Qe,o as Ue,r as P,c as B,l as O,d as C,j as e,p as a,C as q,m as E,n as S,a as D,B as f,F as V,e as d,f as i,g as o,h as l,I as u,k as w}from"./index-CuDmVYun.js";import{D as pe,b as je,R as _,ab as He,C as Je,G as ze,o as be,q as fe}from"./dashboard-layout-RBv1DXX2.js";import{S as $}from"./stats-card-CKM6aMdl.js";import{D as L}from"./data-table-B69p7Klv.js";import{B as T}from"./badge-DMaRL5Qw.js";import{D as K,a as Q,b as U,c as H}from"./dialog-CYNkLpdV.js";import{T as J}from"./textarea-CpuNoaOI.js";import{S as z,a as W,b as G,c as X,d as c}from"./select-7c0Tajxe.js";import{u as ce}from"./use-realtime-query-CGmARpos.js";import{D as ye,T as ge}from"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";import"./use-websocket-CCUHb1Px.js";function hs(){const{user:n}=Le(),{toast:m}=Ke(),g=Qe();Ue();const[Ne,Y]=P.useState(!1),[ve,M]=P.useState(!1),[ke,F]=P.useState(!1),[Ce,R]=P.useState(!1),[We,Z]=P.useState(null),N=B({defaultValues:{amount:"",bankName:"",notes:""}}),h=B({defaultValues:{vendorId:"",amount:"",paymentMethod:"",chequeNumber:"",bankName:"",notes:""}}),y=B({defaultValues:{name:"",phone:"",email:"",address:""}}),p=B({defaultValues:{category:"utilities",amount:"",paymentMethod:"cash",chequeNumber:"",bankName:"",description:""}}),{data:x=[],isLoading:we}=O({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3,enabled:!!(n!=null&&n.hotelId)});ce({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3,events:["transaction:created","transaction:updated"]}),ce({queryKey:["/api/hotels/current/users"],refetchInterval:3e3,events:["user:created","user:updated"]}),ce({queryKey:["/api/hotels/current/maintenance-requests"],refetchInterval:3e3,events:["maintenance:updated","maintenance:created"]});const{data:Pe=[],isLoading:qe}=O({queryKey:["/api/hotels/current/maintenance-requests"],refetchInterval:3e3,enabled:!!(n!=null&&n.hotelId)}),{data:ee=[],isLoading:Ee}=O({queryKey:["/api/hotels/current/vendors"],refetchInterval:3e3,enabled:!!(n!=null&&n.hotelId)});O({queryKey:["/api/hotels/current/users"],refetchInterval:3e3,enabled:!!(n!=null&&n.hotelId)});const se=x.filter(s=>s.txnType==="cash_deposit_request").filter(s=>{var t,r;return!((t=s.reference)!=null&&t.includes("APPROVED"))&&!((r=s.reference)!=null&&r.includes("REJECTED"))}),me=C({mutationFn:async s=>{const t=x.find(b=>b.id===s);if(!t)throw new Error("Transaction not found");const r=t.details||{};await w("PUT",`/api/transactions/${s}`,{reference:`${t.reference||""} - APPROVED by ${n==null?void 0:n.username}`,details:{...r,approvedBy:n==null?void 0:n.username,approvedAt:new Date().toISOString()}})},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),m({title:"Cash deposit request approved successfully"})},onError:()=>{m({title:"Error",description:"Failed to approve cash deposit request",variant:"destructive"})}}),xe=C({mutationFn:async s=>{const t=x.find(b=>b.id===s);if(!t)throw new Error("Transaction not found");const r=t.details||{};await w("PUT",`/api/transactions/${s}`,{reference:`${t.reference||""} - REJECTED by ${n==null?void 0:n.username}`,details:{...r,rejectedBy:n==null?void 0:n.username,rejectedAt:new Date().toISOString()}})},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),m({title:"Cash deposit request rejected"})},onError:()=>{m({title:"Error",description:"Failed to reject cash deposit request",variant:"destructive"})}}),te=C({mutationFn:async s=>{const t=parseFloat(s.amount);if(isNaN(t)||t<=0)throw new Error("Please enter a valid amount");if(!s.bankName||s.bankName.trim()==="")throw new Error("Bank name is required");await w("POST","/api/transactions",{hotelId:n==null?void 0:n.hotelId,txnType:"bank_deposit",amount:t.toFixed(2),paymentMethod:"cash",purpose:"Cash deposited to bank",reference:`Deposited by ${n==null?void 0:n.username}`,details:{bankName:s.bankName.trim(),notes:s.notes||"",depositedBy:n==null?void 0:n.username,depositedAt:new Date().toISOString()},createdBy:n==null?void 0:n.id})},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),m({title:"Success",description:"Cash deposited to bank successfully"}),N.reset(),Y(!1)},onError:s=>{m({title:"Error",description:s.message||"Failed to deposit cash to bank",variant:"destructive"})}}),ne=C({mutationFn:async s=>{const t=parseFloat(s.amount);if(isNaN(t)||t<=0)throw new Error("Please enter a valid amount");if(!s.vendorId)throw new Error("Please select a vendor");if(!s.paymentMethod)throw new Error("Please select a payment method");if(s.paymentMethod==="cheque"){if(!s.chequeNumber||s.chequeNumber.trim()==="")throw new Error("Cheque number is required");if(!s.bankName||s.bankName.trim()==="")throw new Error("Bank name is required for cheque payment")}const r=ee.find($e=>$e.id===s.vendorId),b={vendorId:s.vendorId,vendorName:(r==null?void 0:r.name)||"Unknown",notes:s.notes||"",paidBy:n==null?void 0:n.username};s.paymentMethod==="cheque"&&(b.chequeNumber=s.chequeNumber.trim(),b.bankName=s.bankName.trim()),await w("POST","/api/transactions",{hotelId:n==null?void 0:n.hotelId,txnType:"vendor_payment",amount:t.toFixed(2),paymentMethod:s.paymentMethod,purpose:`Payment to ${(r==null?void 0:r.name)||"vendor"}`,reference:`Paid by ${n==null?void 0:n.username}`,details:b,createdBy:n==null?void 0:n.id})},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),m({title:"Success",description:"Vendor payment processed successfully"}),h.reset(),M(!1),Z(null)},onError:s=>{m({title:"Error",description:s.message||"Failed to process vendor payment",variant:"destructive"})}}),ae=C({mutationFn:async s=>{if(!s.name||s.name.trim()==="")throw new Error("Vendor name is required");const t={};s.phone&&(t.phone=s.phone.trim()),s.email&&(t.email=s.email.trim()),s.address&&(t.address=s.address.trim()),await w("POST","/api/hotels/current/vendors",{hotelId:n==null?void 0:n.hotelId,name:s.name.trim(),contact:t})},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/hotels/current/vendors"]}),m({title:"Success",description:"Vendor added successfully"}),y.reset(),F(!1)},onError:s=>{m({title:"Error",description:s.message||"Failed to add vendor",variant:"destructive"})}}),re=C({mutationFn:async s=>{const t=parseFloat(s.amount);if(isNaN(t)||t<=0)throw new Error("Please enter a valid amount");if(s.paymentMethod==="cheque"){if(!s.chequeNumber||s.chequeNumber.trim()==="")throw new Error("Cheque number is required");if(!s.bankName||s.bankName.trim()==="")throw new Error("Bank name is required for cheque payment")}const r={};s.paymentMethod==="cheque"&&(r.chequeNumber=s.chequeNumber.trim(),r.bankName=s.bankName.trim()),await w("POST","/api/transactions",{hotelId:n==null?void 0:n.hotelId,txnType:"cash_out",amount:t.toFixed(2),paymentMethod:s.paymentMethod,purpose:`${s.category} - ${s.description}`,reference:s.category,details:r,createdBy:n==null?void 0:n.id})},onSuccess:()=>{g.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),m({title:"Success",description:"Expense recorded successfully"}),p.reset(),R(!1)},onError:s=>{m({title:"Error",description:s.message||"Failed to record expense",variant:"destructive"})}}),v=x.filter(s=>s.txnType==="cash_in"||s.txnType==="pos_in"||s.txnType==="fonepay_in"||s.txnType==="revenue"||s.txnType&&s.txnType.includes("_in")),de=x.filter(s=>(s.txnType==="cash_out"||s.txnType==="vendor_payment"||s.txnType&&s.txnType.includes("_out"))&&s.txnType!=="cash_deposit_request"),ie=v.filter(s=>s.paymentMethod==="cash").reduce((s,t)=>s+Number(t.amount||0),0),oe=v.filter(s=>s.paymentMethod==="pos").reduce((s,t)=>s+Number(t.amount||0),0),le=v.filter(s=>s.paymentMethod==="fonepay").reduce((s,t)=>s+Number(t.amount||0),0),j=v.reduce((s,t)=>s+Number(t.amount||0),0),A=de.reduce((s,t)=>s+Number(t.amount||0),0),k=j-A,he=j>0?k/j*100:0,Se=x.filter(s=>s.paymentMethod==="cash"),De=x.filter(s=>s.paymentMethod==="pos"),Te=x.filter(s=>s.paymentMethod==="fonepay");x.filter(s=>s.txnType==="vendor_payment").reduce((s,t)=>s+Number(t.amount||0),0);const ue=x.filter(s=>s.txnType==="bank_deposit"),I=ue.reduce((s,t)=>s+Number(t.amount||0),0),Me=oe+le+I,Fe=ie-I,Re=[{key:"description",label:"Request",sortable:!0},{key:"department",label:"Department",sortable:!0},{key:"reportedBy",label:"Raised By",render:(s,t)=>typeof s=="object"&&(s!=null&&s.username)?s.username:"Unknown"},{key:"status",label:"Status",sortable:!0},{key:"createdAt",label:"Date",sortable:!0}],Ae=[{key:"txnType",label:"Type",sortable:!0},{key:"amount",label:"Amount",sortable:!0,render:s=>a(s)},{key:"paymentMethod",label:"Method",sortable:!0},{key:"purpose",label:"Purpose",sortable:!0,render:(s,t)=>t.purpose==="room_checkout_payment"&&t.details?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:s}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Room ",t.details.roomNumber," - ",t.details.guestName,t.details.numberOfDays&&` (${t.details.numberOfDays} day${t.details.numberOfDays>1?"s":""})`]})]}):s},{key:"details",label:"Details",render:(s,t)=>{var r,b;return t.txnType==="cash_deposit_request"?(r=t.reference)!=null&&r.includes("APPROVED")?e.jsxs(T,{className:"bg-green-600 text-white","data-testid":`status-approved-${t.id}`,children:[e.jsx(be,{className:"h-3 w-3 mr-1"}),"Approved"]}):(b=t.reference)!=null&&b.includes("REJECTED")?e.jsxs(T,{variant:"destructive","data-testid":`status-rejected-${t.id}`,children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),"Rejected"]}):e.jsx(T,{variant:"secondary","data-testid":`status-pending-${t.id}`,children:"Pending"}):t.purpose==="room_checkout_payment"&&s?e.jsxs("div",{className:"text-xs space-y-1",children:[s.roomCharges>0&&e.jsxs("div",{className:"text-muted-foreground",children:["Room: ",a(s.roomCharges)]}),s.mealPlanCharges>0&&e.jsxs("div",{className:"text-muted-foreground",children:["Meals: ",a(s.mealPlanCharges)]}),s.foodCharges>0&&e.jsxs("div",{className:"text-muted-foreground",children:["Food: ",a(s.foodCharges)]}),s.totalTax>0&&e.jsxs("div",{className:"text-muted-foreground",children:["Tax: ",a(s.totalTax)]}),s.discountAmount>0&&e.jsxs("div",{className:"text-green-600",children:["Discount: -",a(s.discountAmount)]})]}):"-"}},{key:"createdAt",label:"Date",sortable:!0}],Ie=[{key:"name",label:"Vendor Name",sortable:!0},{key:"contact",label:"Contact",render:s=>typeof s=="object"&&(s!=null&&s.phone)?s.phone:"N/A"},{key:"createdAt",label:"Added",sortable:!0}],Be=[{key:"purpose",label:"Expense",sortable:!0},{key:"amount",label:"Amount",sortable:!0,render:s=>a(s)},{key:"paymentMethod",label:"Payment Method",sortable:!0},{key:"createdAt",label:"Date",sortable:!0}],Oe=[{label:"Pay",action:s=>{Z(s),h.setValue("vendorId",s.id),M(!0)}}],Ve=[],_e=x.filter(s=>s.txnType==="cash_out"||s.txnType==="vendor_payment");return we||qe||Ee?e.jsx(pe,{title:"Finance Dashboard",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading financial data..."})]})})}):e.jsx(pe,{title:"Finance Dashboard",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx($,{title:"Total Revenue",value:a(j),icon:e.jsx(ye,{}),iconColor:"text-green-500",trend:{value:v.length,label:"transactions",isPositive:!0}}),e.jsx($,{title:"Net Revenue",value:a(k),icon:e.jsx(ge,{}),iconColor:"text-blue-500",trend:{value:Number(he.toFixed(1)),label:"profit margin",isPositive:he>0}}),e.jsx($,{title:"Total Expenses",value:a(A),icon:e.jsx(je,{}),iconColor:"text-red-500",trend:{value:de.length,label:"transactions",isPositive:!1}}),e.jsx($,{title:"Pending Cash Deposits",value:se.length,icon:e.jsx(_,{}),iconColor:"text-orange-500"})]}),e.jsxs(q,{children:[e.jsxs(E,{children:[e.jsx(S,{children:"Bank Balance & Cash Flow"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Bank balance includes POS + Fonepay revenue. Cash deposits to bank are deducted from cash."})]}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-blue-950 dark:to-indigo-950 rounded-lg border-2 border-blue-200 dark:border-blue-800","data-testid":"balance-bank",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(He,{className:"h-12 w-12 text-blue-600 dark:text-blue-400"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bank Balance"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:a(Me)})]})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"POS Revenue:"}),e.jsx("span",{className:"font-medium",children:a(oe)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Fonepay Revenue:"}),e.jsx("span",{className:"font-medium",children:a(le)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cash Deposits:"}),e.jsx("span",{className:"font-medium",children:a(I)})]})]})]}),e.jsxs("div",{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-100 dark:from-green-950 dark:to-emerald-950 rounded-lg border-2 border-green-200 dark:border-green-800","data-testid":"balance-cash",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(_,{className:"h-12 w-12 text-green-600 dark:text-green-400"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cash on Hand"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:a(Fe)})]})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cash Revenue:"}),e.jsx("span",{className:"font-medium",children:a(ie)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Deposited to Bank:"}),e.jsxs("span",{className:"font-medium text-red-600 dark:text-red-400",children:["-",a(I)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Deposits Count:"}),e.jsx("span",{className:"font-medium",children:ue.length})]})]})]})]})})]}),e.jsxs(q,{children:[e.jsx(E,{children:e.jsx(S,{children:"Revenue by Payment Method"})}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center p-6 bg-green-50 dark:bg-green-950 rounded-lg","data-testid":"revenue-cash",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-4 text-green-600 dark:text-green-400"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Cash Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:a(ie)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Se.length," total transactions"]})]}),e.jsxs("div",{className:"text-center p-6 bg-blue-50 dark:bg-blue-950 rounded-lg","data-testid":"revenue-pos",children:[e.jsx(Je,{className:"h-12 w-12 mx-auto mb-4 text-blue-600 dark:text-blue-400"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"POS Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:a(oe)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[De.length," total transactions"]})]}),e.jsxs("div",{className:"text-center p-6 bg-purple-50 dark:bg-purple-950 rounded-lg","data-testid":"revenue-fonepay",children:[e.jsx(ze,{className:"h-12 w-12 mx-auto mb-4 text-purple-600 dark:text-purple-400"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Fonepay Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:a(le)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Te.length," total transactions"]})]})]})})]}),e.jsx(L,{title:"Maintenance Requests from Departments",data:Pe,columns:Re,searchPlaceholder:"Search maintenance requests..."}),e.jsx(L,{title:"Recent Transactions",data:x.slice(0,20),columns:Ae,searchPlaceholder:"Search transactions..."}),e.jsx(L,{title:"Expense Tracking",data:_e,columns:Be,actions:Ve,onAdd:()=>R(!0),addButtonLabel:"Add Expense",searchPlaceholder:"Search expenses..."}),e.jsx(L,{title:"Vendor Management",data:ee,columns:Ie,actions:Oe,onAdd:()=>F(!0),addButtonLabel:"Add Vendor",searchPlaceholder:"Search vendors..."}),e.jsxs(q,{children:[e.jsx(E,{children:e.jsx(S,{children:"Monthly Financial Summary"})}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg","data-testid":"summary-revenue",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:a(j)}),e.jsx("div",{className:"text-sm text-green-700",children:"Total Revenue"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg","data-testid":"summary-expenses",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:a(A)}),e.jsx("div",{className:"text-sm text-red-700",children:"Total Expenses"})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg","data-testid":"summary-profit",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a(k)}),e.jsx("div",{className:"text-sm text-blue-700",children:"Net Profit"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg","data-testid":"summary-margin",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[j>0?(k/j*100).toFixed(1):0,"%"]}),e.jsx("div",{className:"text-sm text-purple-700",children:"Profit Margin"})]})]})})]}),se.length>0&&e.jsxs(q,{children:[e.jsx(E,{children:e.jsx(S,{children:"Pending Cash Deposit Requests"})}),e.jsx(D,{children:e.jsx("div",{className:"space-y-3",children:se.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border-2 border-orange-200 rounded-lg bg-orange-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(_,{className:"h-4 w-4 text-orange-600"}),e.jsx("h4",{className:"font-semibold text-foreground",children:s.purpose})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.reference}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(T,{variant:"outline",className:"text-orange-700 border-orange-300",children:a(Number(s.amount))}),e.jsx(T,{variant:"secondary",className:"text-xs",children:new Date(s.createdAt||"").toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(f,{size:"sm",variant:"outline",className:"text-green-600 border-green-600 hover:bg-green-50",onClick:()=>me.mutate(s.id),disabled:me.isPending,"data-testid":`button-approve-${s.id}`,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(f,{size:"sm",variant:"outline",className:"text-red-600 border-red-600 hover:bg-red-50",onClick:()=>xe.mutate(s.id),disabled:xe.isPending,"data-testid":`button-reject-${s.id}`,children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]},s.id))})})]}),e.jsxs(q,{children:[e.jsx(E,{children:e.jsx(S,{children:"Cash Flow Analysis"})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-50 rounded-lg","data-testid":"cashflow-inflow",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"text-green-500 mr-3 h-6 w-6"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:"Cash Inflow"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Revenue from all sources"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-green-600",children:a(j)}),e.jsxs("p",{className:"text-sm text-green-700",children:[v.length," transactions"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 rounded-lg","data-testid":"cashflow-outflow",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(je,{className:"text-red-500 mr-3 h-6 w-6"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:"Cash Outflow"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Expenses and vendor payments"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-red-600",children:a(A)}),e.jsxs("p",{className:"text-sm text-red-700",children:[de.length," transactions"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-lg","data-testid":"cashflow-net",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"text-blue-500 mr-3 h-6 w-6"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:"Net Cash Flow"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Inflow minus outflow"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-blue-600",children:a(k)}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Profit margin: ",j>0?(k/j*100).toFixed(1):0,"%"]})]})]})]})})]}),e.jsx(K,{open:Ne,onOpenChange:Y,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsx(U,{children:e.jsx(H,{children:"Deposit Cash to Bank"})}),e.jsx(V,{...N,children:e.jsxs("form",{onSubmit:N.handleSubmit(s=>te.mutate(s)),className:"space-y-4",children:[e.jsx(d,{control:N.control,name:"amount",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Amount *"}),e.jsx(l,{children:e.jsx(u,{...s,type:"number",step:"0.01",placeholder:"0.00","data-testid":"input-bank-amount"})})]})}),e.jsx(d,{control:N.control,name:"bankName",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Bank Name *"}),e.jsx(l,{children:e.jsx(u,{...s,placeholder:"Enter bank name","data-testid":"input-bank-name"})})]})}),e.jsx(d,{control:N.control,name:"notes",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Notes (Optional)"}),e.jsx(l,{children:e.jsx(J,{...s,placeholder:"Additional notes...",rows:2,"data-testid":"textarea-bank-notes"})})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(f,{type:"submit",className:"flex-1",disabled:te.isPending,"data-testid":"button-submit-bank-deposit",children:te.isPending?"Processing...":"Deposit to Bank"}),e.jsx(f,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>Y(!1),"data-testid":"button-cancel-bank-deposit",children:"Cancel"})]})]})})]})}),e.jsx(K,{open:ve,onOpenChange:M,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsx(U,{children:e.jsx(H,{children:"Vendor Payment"})}),e.jsx(V,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(s=>ne.mutate(s)),className:"space-y-4",children:[e.jsx(d,{control:h.control,name:"vendorId",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Vendor *"}),e.jsxs(z,{onValueChange:s.onChange,value:s.value,children:[e.jsx(l,{children:e.jsx(W,{"data-testid":"select-vendor",children:e.jsx(G,{placeholder:"Select vendor"})})}),e.jsx(X,{children:ee.map(t=>e.jsx(c,{value:t.id,children:t.name},t.id))})]})]})}),e.jsx(d,{control:h.control,name:"amount",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Amount *"}),e.jsx(l,{children:e.jsx(u,{...s,type:"number",step:"0.01",placeholder:"0.00","data-testid":"input-vendor-amount"})})]})}),e.jsx(d,{control:h.control,name:"paymentMethod",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Payment Method *"}),e.jsxs(z,{onValueChange:s.onChange,value:s.value,children:[e.jsx(l,{children:e.jsx(W,{"data-testid":"select-payment-method",children:e.jsx(G,{placeholder:"Select payment method"})})}),e.jsxs(X,{children:[e.jsx(c,{value:"cash",children:"Cash"}),e.jsx(c,{value:"cheque",children:"Cheque"}),e.jsx(c,{value:"pos",children:"POS"}),e.jsx(c,{value:"fonepay",children:"Fonepay"})]})]})]})}),h.watch("paymentMethod")==="cheque"&&e.jsxs(e.Fragment,{children:[e.jsx(d,{control:h.control,name:"chequeNumber",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Cheque Number *"}),e.jsx(l,{children:e.jsx(u,{...s,placeholder:"Enter cheque number","data-testid":"input-cheque-number"})})]})}),e.jsx(d,{control:h.control,name:"bankName",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Bank Name *"}),e.jsx(l,{children:e.jsx(u,{...s,placeholder:"Which bank cheque issued from","data-testid":"input-cheque-bank"})})]})})]}),e.jsx(d,{control:h.control,name:"notes",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Notes (Optional)"}),e.jsx(l,{children:e.jsx(J,{...s,placeholder:"Additional notes...",rows:2,"data-testid":"textarea-vendor-notes"})})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(f,{type:"submit",className:"flex-1",disabled:ne.isPending,"data-testid":"button-submit-vendor-payment",children:ne.isPending?"Processing...":"Process Payment"}),e.jsx(f,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>{M(!1),Z(null)},"data-testid":"button-cancel-vendor-payment",children:"Cancel"})]})]})})]})}),e.jsx(K,{open:ke,onOpenChange:F,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsx(U,{children:e.jsx(H,{children:"Add New Vendor"})}),e.jsx(V,{...y,children:e.jsxs("form",{onSubmit:y.handleSubmit(s=>ae.mutate(s)),className:"space-y-4",children:[e.jsx(d,{control:y.control,name:"name",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Vendor Name *"}),e.jsx(l,{children:e.jsx(u,{...s,placeholder:"Enter vendor name","data-testid":"input-vendor-name"})})]})}),e.jsx(d,{control:y.control,name:"phone",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Phone"}),e.jsx(l,{children:e.jsx(u,{...s,placeholder:"Enter phone number","data-testid":"input-vendor-phone"})})]})}),e.jsx(d,{control:y.control,name:"email",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Email"}),e.jsx(l,{children:e.jsx(u,{...s,type:"email",placeholder:"Enter email address","data-testid":"input-vendor-email"})})]})}),e.jsx(d,{control:y.control,name:"address",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Address"}),e.jsx(l,{children:e.jsx(J,{...s,placeholder:"Enter address",rows:2,"data-testid":"textarea-vendor-address"})})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(f,{type:"submit",className:"flex-1",disabled:ae.isPending,"data-testid":"button-submit-add-vendor",children:ae.isPending?"Adding...":"Add Vendor"}),e.jsx(f,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>F(!1),"data-testid":"button-cancel-add-vendor",children:"Cancel"})]})]})})]})}),e.jsx(K,{open:Ce,onOpenChange:R,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsx(U,{children:e.jsx(H,{children:"Add New Expense"})}),e.jsx(V,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(s=>re.mutate(s)),className:"space-y-4",children:[e.jsx(d,{control:p.control,name:"category",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Category *"}),e.jsxs(z,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(l,{children:e.jsx(W,{"data-testid":"select-expense-category",children:e.jsx(G,{})})}),e.jsxs(X,{children:[e.jsx(c,{value:"utilities",children:"Utilities"}),e.jsx(c,{value:"maintenance",children:"Maintenance"}),e.jsx(c,{value:"supplies",children:"Supplies"}),e.jsx(c,{value:"salaries",children:"Salaries"}),e.jsx(c,{value:"rent",children:"Rent"}),e.jsx(c,{value:"insurance",children:"Insurance"}),e.jsx(c,{value:"marketing",children:"Marketing"}),e.jsx(c,{value:"other",children:"Other"})]})]})]})}),e.jsx(d,{control:p.control,name:"amount",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Amount *"}),e.jsx(l,{children:e.jsx(u,{...s,type:"number",step:"0.01",placeholder:"0.00","data-testid":"input-expense-amount"})})]})}),e.jsx(d,{control:p.control,name:"paymentMethod",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Payment Method *"}),e.jsxs(z,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(l,{children:e.jsx(W,{"data-testid":"select-expense-payment-method",children:e.jsx(G,{})})}),e.jsxs(X,{children:[e.jsx(c,{value:"cash",children:"Cash"}),e.jsx(c,{value:"cheque",children:"Cheque"}),e.jsx(c,{value:"pos",children:"POS"}),e.jsx(c,{value:"fonepay",children:"Fonepay"})]})]})]})}),p.watch("paymentMethod")==="cheque"&&e.jsxs(e.Fragment,{children:[e.jsx(d,{control:p.control,name:"chequeNumber",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Cheque Number *"}),e.jsx(l,{children:e.jsx(u,{...s,placeholder:"Enter cheque number","data-testid":"input-expense-cheque-number"})})]})}),e.jsx(d,{control:p.control,name:"bankName",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Bank Name *"}),e.jsx(l,{children:e.jsx(u,{...s,placeholder:"Which bank cheque issued from","data-testid":"input-expense-cheque-bank"})})]})})]}),e.jsx(d,{control:p.control,name:"description",render:({field:s})=>e.jsxs(i,{children:[e.jsx(o,{children:"Description *"}),e.jsx(l,{children:e.jsx(J,{...s,placeholder:"Expense description",rows:3,"data-testid":"textarea-expense-description"})})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(f,{type:"submit",className:"flex-1",disabled:re.isPending,"data-testid":"button-submit-add-expense",children:re.isPending?"Recording...":"Record Expense"}),e.jsx(f,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>R(!1),"data-testid":"button-cancel-add-expense",children:"Cancel"})]})]})})]})})]})})}export{hs as default};
