import{q as F,u as T,b as A,r as a,l as B,d as I,j as e,C as w,m as S,n as C,a as k,s,I as x,B as U,k as E}from"./index-CuDmVYun.js";import{D as Q,V as q,i as V,s as H,L as K}from"./dashboard-layout-RBv1DXX2.js";import{T as _}from"./textarea-CpuNoaOI.js";import{B as P}from"./badge-DMaRL5Qw.js";import{S as O,a as W,b as $,c as z,d as h}from"./select-7c0Tajxe.js";import"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";function re(){const{user:n}=F(),{toast:l}=T(),R=A(),[d,p]=a.useState(""),[o,g]=a.useState(""),[j,y]=a.useState("medium"),[c,b]=a.useState(""),[r,f]=a.useState(""),{data:v=[]}=B({queryKey:["/api/hotels/current/maintenance-requests"],refetchInterval:3e3,select:t=>t.filter(i=>i.reportedBy===(n==null?void 0:n.id))}),u=I({mutationFn:async t=>{await E("POST","/api/hotels/current/maintenance-requests",t)},onSuccess:()=>{R.invalidateQueries({queryKey:["/api/hotels/current/maintenance-requests"]}),l({title:"Maintenance request submitted successfully to Manager"}),p(""),g(""),y("medium"),b(""),f("")},onError:()=>{l({title:"Failed to submit request",description:"Please try again later",variant:"destructive"})}}),L=t=>{if(t.preventDefault(),!d||!o||!c||!r){l({title:"Missing information",description:"Please fill in all required fields including photo",variant:"destructive"});return}u.mutate({title:d,description:o,priority:j,location:c,photo:r,status:"pending"})},M=t=>{switch(t){case"high":return"bg-red-100 text-red-800 border-red-200 dark:bg-red-950 dark:text-red-300 dark:border-red-800";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-950 dark:text-yellow-300 dark:border-yellow-800";case"low":return"bg-green-100 text-green-800 border-green-200 dark:bg-green-950 dark:text-green-300 dark:border-green-800";default:return"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700"}},D=t=>{switch(t){case"completed":return e.jsx(K,{className:"h-5 w-5 text-green-600 dark:text-green-400"});case"in_progress":return e.jsx(H,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"});case"pending":default:return e.jsx(V,{className:"h-5 w-5 text-orange-500 dark:text-orange-400"})}};return e.jsx(Q,{title:"Maintenance Requests",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(C,{className:"flex items-center",children:[e.jsx(q,{className:"h-5 w-5 mr-2"}),"Submit Request to Manager"]})}),e.jsx(k,{children:e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"title",children:"Issue Title *"}),e.jsx(x,{id:"title",placeholder:"e.g., Broken AC in Lobby",value:d,onChange:t=>p(t.target.value),required:!0,"data-testid":"input-maintenance-title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"location",children:"Location *"}),e.jsx(x,{id:"location",placeholder:"e.g., Room 101, Lobby Area",value:c,onChange:t=>b(t.target.value),required:!0,"data-testid":"input-maintenance-location"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"priority",children:"Priority *"}),e.jsxs(O,{value:j,onValueChange:y,children:[e.jsx(W,{id:"priority",className:"h-11","data-testid":"select-maintenance-priority",children:e.jsx($,{})}),e.jsxs(z,{children:[e.jsx(h,{value:"low",children:"Low - Can wait"}),e.jsx(h,{value:"medium",children:"Medium - Soon"}),e.jsx(h,{value:"high",children:"High - Urgent"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"description",children:"Description *"}),e.jsx(_,{id:"description",placeholder:"Provide detailed information about the issue...",value:o,onChange:t=>g(t.target.value),rows:4,required:!0,"data-testid":"input-maintenance-description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(s,{htmlFor:"photo",children:"Photo *"}),e.jsx(x,{id:"photo",type:"file",accept:"image/*",required:!0,"data-testid":"input-maintenance-photo",onChange:t=>{var N;const i=(N=t.target.files)==null?void 0:N[0];if(i){const m=new FileReader;m.onloadend=()=>{f(m.result)},m.readAsDataURL(i)}}}),r&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:r,alt:"Preview",className:"max-w-full h-32 object-cover rounded border"})})]}),e.jsx(U,{type:"submit",className:"w-full h-11 min-h-11",disabled:u.isPending,"data-testid":"button-submit-maintenance",children:u.isPending?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Submit to Manager"]})})]})})]}),e.jsxs(w,{children:[e.jsx(S,{children:e.jsx(C,{children:"My Requests"})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-3",children:v.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No maintenance requests submitted yet"}):v.map(t=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-2 hover:bg-accent/50 transition-colors","data-testid":`maintenance-request-${t.id}`,children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[D(t.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-foreground leading-tight",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.location})]})]})}),e.jsx("p",{className:"text-sm text-muted-foreground pl-8",children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 pl-8",children:[e.jsx(P,{className:M(t.priority),variant:"outline",children:t.priority.toUpperCase()}),e.jsx(P,{variant:"secondary",children:t.status.replace("_"," ").toUpperCase()}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(t.createdAt).toLocaleDateString()})]}),t.resolvedAt&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 pl-8",children:["âœ“ Resolved on ",new Date(t.resolvedAt).toLocaleDateString()]})]},t.id))})})]})]})})}export{re as default};
