import{o as Y,b as $,l as x,r as T,j as t,p as C,C as m,m as p,n as f,a as j,B as v}from"./index-CuDmVYun.js";import{D as _,B as E,T as I,S as B,R as L}from"./dashboard-layout-RBv1DXX2.js";import{S as N}from"./stats-card-CKM6aMdl.js";import{u as U}from"./use-websocket-CCUHb1Px.js";import{D as H,U as F}from"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";var z=Object.defineProperty,V=(r,s,n)=>s in r?z(r,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[s]=n,y=(r,s,n)=>V(r,typeof s!="symbol"?s+"":s,n);const A=Symbol.for("constructDateFrom");function k(r,s){return typeof r=="function"?r(s):r&&typeof r=="object"&&A in r?r[A](s):r instanceof Date?new r.constructor(s):new Date(s)}function h(r,s){return k(r,r)}function W(r,s,n){const i=h(r);return isNaN(s)?k(r,NaN):(s&&i.setDate(i.getDate()+s),i)}function K(r){const s=h(r),n=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return n.setUTCFullYear(s.getFullYear()),+r-+n}function P(r,...s){const n=k.bind(null,s.find(i=>typeof i=="object"));return s.map(n)}function M(r,s){const n=h(r);return n.setHours(0,0,0,0),n}function G(r,s,n){const[i,c]=P(void 0,r,s),o=M(i),d=M(c),u=+o-K(o),b=+d-K(d);return Math.round((u-b)/864e5)}function J(r,s){const n=h(r);return n.setHours(23,59,59,999),n}function X(r,s,n){const i=+h(r),[c,o]=[+h(s.start),+h(s.end)].sort((d,u)=>d-u);return i>=c&&i<=o}const e=[];e[1975]=[31,31,32,32,31,30,30,29,30,29,30,30,365];e[1976]=[31,32,31,32,31,30,30,30,29,29,30,31,366];e[1977]=[30,32,31,32,31,31,29,30,30,29,29,31,365];e[1978]=[31,31,32,31,31,31,30,29,30,29,30,30,365];e[1979]=e[1975];e[1980]=e[1976];e[1981]=[31,31,31,32,31,31,29,30,30,29,29,31,365];e[1982]=e[1978];e[1983]=e[1975];e[1984]=e[1976];e[1985]=[31,31,31,32,31,31,29,30,30,29,30,30,365];e[1986]=e[1978];e[1987]=[31,32,31,32,31,30,30,29,30,29,30,30,365];e[1988]=e[1976];e[1989]=[31,31,31,32,31,31,30,29,30,29,30,30,365];e[1990]=e[1978];e[1991]=[31,32,31,32,31,30,30,30,29,29,30,30,365];e[1992]=[31,32,31,32,31,30,30,30,29,30,29,31,366];e[1993]=e[1989];e[1994]=e[1978];e[1995]=e[1991];e[1996]=e[1992];e[1997]=e[1978];e[1998]=[31,31,32,31,32,30,30,29,30,29,30,30,365];e[1999]=e[1976];e[2e3]=[30,32,31,32,31,30,30,30,29,30,29,31,365];e[2001]=e[1978];e[2002]=e[1975];e[2003]=e[1976];e[2004]=e[2e3];e[2005]=e[1978];e[2006]=e[1975];e[2007]=e[1976];e[2008]=e[1981];e[2009]=e[1978];e[2010]=e[1975];e[2011]=e[1976];e[2012]=e[1985];e[2013]=e[1978];e[2014]=e[1975];e[2015]=e[1976];e[2016]=e[1985];e[2017]=e[1978];e[2018]=e[1987];e[2019]=e[1992];e[2020]=e[1989];e[2021]=e[1978];e[2022]=e[1991];e[2023]=e[1992];e[2024]=e[1989];e[2025]=e[1978];e[2026]=e[1976];e[2027]=e[2e3];e[2028]=e[1978];e[2029]=e[1998];e[2030]=e[1976];e[2031]=e[2e3];e[2032]=e[1978];e[2033]=e[1975];e[2034]=e[1976];e[2035]=e[1977];e[2036]=e[1978];e[2037]=e[1975];e[2038]=e[1976];e[2039]=e[1985];e[2040]=e[1978];e[2041]=e[1975];e[2042]=e[1976];e[2043]=e[1985];e[2044]=e[1978];e[2045]=e[1987];e[2046]=e[1976];e[2047]=e[1989];e[2048]=e[1978];e[2049]=e[1991];e[2050]=e[1992];e[2051]=e[1989];e[2052]=e[1978];e[2053]=e[1991];e[2054]=e[1992];e[2055]=e[1978];e[2056]=e[1998];e[2057]=e[1976];e[2058]=e[2e3];e[2059]=e[1978];e[2060]=e[1975];e[2061]=e[1976];e[2062]=[30,32,31,32,31,31,29,30,29,30,29,31,365];e[2063]=e[1978];e[2064]=e[1975];e[2065]=e[1976];e[2066]=e[1981];e[2067]=e[1978];e[2068]=e[1975];e[2069]=e[1976];e[2070]=e[1985];e[2071]=e[1978];e[2072]=e[1987];e[2073]=e[1976];e[2074]=e[1989];e[2075]=e[1978];e[2076]=e[1991];e[2077]=e[1992];e[2078]=e[1989];e[2079]=e[1978];e[2080]=e[1991];e[2081]=e[1992];e[2082]=e[1989];e[2083]=e[1978];e[2084]=e[1976];e[2085]=e[2e3];e[2086]=e[1978];e[2087]=e[1975];e[2088]=e[1976];e[2089]=e[2e3];e[2090]=e[1978];e[2091]=e[1975];e[2092]=e[1976];e[2093]=e[1981];e[2094]=e[1978];e[2095]=e[1975];e[2096]=e[1976];e[2097]=e[1985];e[2098]=e[1978];e[2099]=e[1975];class O{constructor(s){y(this,"startDate",new Date("1918-04-13")),y(this,"endDate",new Date("2043-04-13")),y(this,"dateRangeError","The input date is out of supported range."),y(this,"inputYear"),y(this,"inputMonth"),y(this,"inputDate");const[n,i,c]=this.parseDateString(s);this.inputYear=n,this.inputMonth=i,this.inputDate=c}parseDateString(s){const n=this.numToEn(s).replace(/[./|,]/g,"-").trim(),[i,c,o]=n.split("-").map(Number);return[i,c,o]}numToEn(s){const n=["०","१","२","३","४","५","६","७","८","९"];return s.replace(/[०१२३४५६७८९]/g,i=>n.indexOf(i).toString())}numToDay(s){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][s]}getAdDate(s,n,i){let c=0;for(let o=1975;o<s;o++)c+=e[o][12];for(let o=0;o<n-1;o++)c+=e[s][o];return c+=i-1,W(this.startDate,c)}getBsDate(s){const n=new Date(s);let i=G(n,this.startDate);for(const c in e){const o=e[c][12];if(i>=o){i-=o;continue}for(let d=0;d<12;d++){const u=e[c][d];if(i>=u){i-=u;continue}return{year:Number(c),month:d+1,date:i+1}}}throw new Error(this.dateRangeError)}toAd(){if(this.inputYear<1975||this.inputYear>2099)throw new Error(this.dateRangeError);const s=this.getAdDate(this.inputYear,this.inputMonth,this.inputDate),n=this.numToDay(s.getDay());return{year:s.getFullYear(),month:s.getMonth()+1,date:s.getDate(),day:n}}toBs(){const s=`${this.inputYear}-${this.inputMonth}-${this.inputDate}`,n=new Date(s);if(!X(n,{start:M(this.startDate),end:J(this.endDate)}))throw new Error(this.dateRangeError);const i=this.getBsDate(s),c=this.numToDay(n.getDay());return{...i,day:c}}}function ie(){const[,r]=Y(),s=$(),n=U(),{data:i=[]}=x({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3}),{data:c=[]}=x({queryKey:["/api/hotels/current/rooms"],refetchInterval:3e3}),{data:o=[]}=x({queryKey:["/api/hotels/current/users"],refetchInterval:3e3}),{data:d=[]}=x({queryKey:["/api/hotels/current/inventory-items"],refetchInterval:3e3}),{data:u}=x({queryKey:["/api/hotels/current"],refetchInterval:3e3}),{data:b=[]}=x({queryKey:["/api/attendance/daily"],refetchInterval:3e3});T.useEffect(()=>{const a=[n.on("transaction:created",()=>{s.invalidateQueries({queryKey:["/api/hotels/current/transactions"]})}),n.on("transaction:updated",()=>{s.invalidateQueries({queryKey:["/api/hotels/current/transactions"]})}),n.on("room:updated",()=>{s.invalidateQueries({queryKey:["/api/hotels/current/rooms"]})}),n.on("stock:updated",()=>{s.invalidateQueries({queryKey:["/api/hotels/current/inventory-items"]})}),n.on("attendance:updated",()=>{s.invalidateQueries({queryKey:["/api/attendance/daily"]})}),n.on("guest:created",()=>{s.invalidateQueries({queryKey:["/api/hotels/current"]})}),n.on("guest:updated",()=>{s.invalidateQueries({queryKey:["/api/hotels/current"]})})];return()=>{a.forEach(l=>l())}},[n,s]);const D=T.useMemo(()=>{const a=new Date;return new O(`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`).toBs()},[]),R=T.useMemo(()=>i.filter(a=>{try{const l=new Date(a.createdAt),g=new O(`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`).toBs();return g.year===D.year&&g.month===D.month}catch{return!1}}),[i,D]).filter(a=>["revenue","cash_in","pos_in","fonepay_in"].includes(a.txnType)).reduce((a,l)=>a+(Number(l.amount)||0),0),w=c.filter(a=>a.isOccupied).length,Q=c.length>0?w/c.length*100:0,q=d.filter(a=>Number(a.baseStockQty)<=Number(a.reorderLevel)).length;return t.jsx(_,{title:"Owner Dashboard",currentHotel:u==null?void 0:u.name,children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(N,{title:"Total Revenue",value:C(R),icon:t.jsx(H,{}),iconColor:"text-green-500"}),t.jsx(N,{title:"Room Occupancy",value:`${Q.toFixed(0)}%`,icon:t.jsx(E,{}),iconColor:"text-blue-500"}),t.jsx(N,{title:"Total Staff",value:o.length,icon:t.jsx(F,{}),iconColor:"text-purple-500"}),t.jsx(N,{title:"Low Stock Items",value:q,icon:t.jsx(I,{}),iconColor:"text-orange-500"})]}),t.jsxs(m,{children:[t.jsx(p,{children:t.jsx(f,{children:"Owner Operations"})}),t.jsx(j,{children:t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs(v,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-audit",onClick:()=>r("/owner/audit-transparency"),children:[t.jsx(B,{className:"h-6 w-6"}),t.jsx("span",{className:"text-sm",children:"Audit & Transparency"})]}),t.jsxs(v,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-financial",onClick:()=>r("/owner/financial"),children:[t.jsx(L,{className:"h-6 w-6"}),t.jsx("span",{className:"text-sm",children:"Financial"})]}),t.jsxs(v,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-occupancy",onClick:()=>r("/owner/occupancy"),children:[t.jsx(E,{className:"h-6 w-6"}),t.jsx("span",{className:"text-sm",children:"Occupancy"})]}),t.jsxs(v,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-staff",onClick:()=>r("/owner/staff"),children:[t.jsx(F,{className:"h-6 w-6"}),t.jsx("span",{className:"text-sm",children:"Staff"})]})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[t.jsxs(m,{children:[t.jsx(p,{children:t.jsx(f,{children:"Financial Summary"})}),t.jsx(j,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Total Revenue:"}),t.jsx("span",{className:"font-bold text-green-600",children:C(R)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Transactions:"}),t.jsx("span",{className:"font-medium",children:i.length})]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"View detailed financial reports in Financial Overview"})]})})]}),t.jsxs(m,{children:[t.jsx(p,{children:t.jsx(f,{children:"Room Summary"})}),t.jsx(j,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Total Rooms:"}),t.jsx("span",{className:"font-bold",children:c.length})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Occupied:"}),t.jsx("span",{className:"font-medium text-blue-600",children:w})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Available:"}),t.jsx("span",{className:"font-medium text-green-600",children:c.length-w})]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"View detailed room status in Room Occupancy"})]})})]}),t.jsxs(m,{children:[t.jsx(p,{children:t.jsx(f,{children:"Staff Summary"})}),t.jsx(j,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Total Staff:"}),t.jsx("span",{className:"font-bold",children:o.length})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"On Duty:"}),t.jsx("span",{className:"font-medium text-green-600",children:o.filter(a=>b.some(l=>l.userId===a.id&&l.status==="active")).length})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Active:"}),t.jsx("span",{className:"font-medium",children:o.filter(a=>a.isActive).length})]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Manage staff in Staff Management"})]})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs(m,{children:[t.jsx(p,{children:t.jsx(f,{children:"Recent Transactions"})}),t.jsx(j,{children:t.jsxs("div",{className:"space-y-2",children:[i.slice(0,5).map((a,l)=>{var S,g;return t.jsxs("div",{className:"flex justify-between items-center p-2 border-b",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium",children:a.purpose||((S=a.txnType)==null?void 0:S.replace(/_/g," "))}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[new Date(a.createdAt).toLocaleDateString()," • ",(g=a.paymentMethod)==null?void 0:g.replace(/_/g," ")]})]}),t.jsx("div",{className:`text-sm font-bold ${["revenue","cash_in","pos_in","fonepay_in"].includes(a.txnType)?"text-green-600":"text-red-600"}`,children:C(Number(a.amount))})]},a.id||l)}),i.length===0&&t.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No recent transactions"})]})})]}),t.jsxs(m,{children:[t.jsx(p,{children:t.jsx(f,{children:"Inventory Alerts"})}),t.jsx(j,{children:t.jsxs("div",{className:"space-y-2",children:[d.filter(a=>Number(a.baseStockQty)<=Number(a.reorderLevel)).slice(0,5).map((a,l)=>t.jsxs("div",{className:"flex justify-between items-center p-2 border-b",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium",children:a.name}),t.jsx("div",{className:"text-xs text-orange-600",children:"Low Stock"})]}),t.jsxs("div",{className:"text-sm",children:[Number(a.baseStockQty).toFixed(2)," ",a.baseUnit,a.packageUnit&&` (${Number(a.packageStockQty).toFixed(2)} ${a.packageUnit})`]})]},a.id||l)),q===0&&t.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"All items are well stocked"})]})})]})]})]})})}export{ie as default};
