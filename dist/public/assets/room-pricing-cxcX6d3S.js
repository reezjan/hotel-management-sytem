import{r as t,j as e,C as x,a as h,X as b,m as B,n as $,y as q,B as j,s as v,I as k}from"./index-CuDmVYun.js";import{D as w,E as C,t as O}from"./dashboard-layout-RBv1DXX2.js";import{D as U,a as z,b as A,c as J,d as M}from"./dialog-CYNkLpdV.js";import{T as X,a as G,b as R,c as n,d as K,e as a}from"./table-DYfKu6CY.js";import{t as i}from"./index-hq1wgpuD.js";import{D as S}from"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";function ie(){const[c,D]=t.useState([]),[I,g]=t.useState(!0),[r,f]=t.useState(null),[T,N]=t.useState(!1),[l,m]=t.useState(""),[o,u]=t.useState("");t.useEffect(()=>{y()},[]);const y=async()=>{try{g(!0);const s=await fetch("/api/hotels/current/room-types",{credentials:"include"});if(s.ok){const L=await s.json();D(L)}else i.error("Failed to fetch room types")}catch{i.error("Failed to fetch room types")}finally{g(!1)}},W=s=>{f(s),m(s.priceInhouse||""),u(s.priceWalkin||""),N(!0)},E=async()=>{if(r){if(!l||!o){i.error("Both in-house and walk-in prices are required");return}if(isNaN(Number(l))||Number(l)<0){i.error("Please enter a valid in-house price");return}if(isNaN(Number(o))||Number(o)<0){i.error("Please enter a valid walk-in price");return}try{(await fetch(`/api/room-types/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:r.name,description:r.description,priceInhouse:Number(l).toFixed(2),priceWalkin:Number(o).toFixed(2)})})).ok?(i.success("Room pricing updated successfully"),y(),p()):i.error("Failed to update room pricing")}catch{i.error("Failed to update room pricing")}}},p=()=>{f(null),m(""),u(""),N(!1)},P=s=>s?`NPR ${Number(s).toLocaleString()}`:"Not set",d=s=>s.priceInhouse&&s.priceWalkin;if(I)return e.jsx(w,{title:"Room Pricing",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-center",children:"Loading room types..."})})});const F=c.filter(s=>d(s)),H=c.filter(s=>!d(s));return e.jsx(w,{title:"Room Pricing",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Room Pricing Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Set prices for different room types with separate rates for in-house guests and walk-in customers."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(x,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:c.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Room Types"})]})]})})}),e.jsx(x,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:F.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Priced Room Types"})]})]})})}),e.jsx(x,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:H.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Unpriced Room Types"})]})]})})})]}),e.jsxs(x,{children:[e.jsxs(B,{children:[e.jsx($,{children:"Room Type Pricing"}),e.jsx(q,{children:"Configure daily rates for each room type"})]}),e.jsx(h,{children:c.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(S,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No room types found"}),e.jsx("p",{className:"text-sm",children:"Create room types in the Room Setup page first"})]}):e.jsxs(X,{children:[e.jsx(G,{children:e.jsxs(R,{children:[e.jsx(n,{children:"Room Type"}),e.jsx(n,{children:"Description"}),e.jsx(n,{children:"In-House Price"}),e.jsx(n,{children:"Walk-in Price"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(K,{children:c.map(s=>e.jsxs(R,{children:[e.jsx(a,{className:"font-medium",children:s.name}),e.jsx(a,{className:"text-sm text-muted-foreground",children:s.description||"No description"}),e.jsx(a,{children:e.jsx("span",{className:s.priceInhouse?"":"text-muted-foreground italic",children:P(s.priceInhouse)})}),e.jsx(a,{children:e.jsx("span",{className:s.priceWalkin?"":"text-muted-foreground italic",children:P(s.priceWalkin)})}),e.jsx(a,{children:d(s)?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(C,{className:"h-3 w-3 mr-1"}),"Priced"]}):e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:[e.jsx(b,{className:"h-3 w-3 mr-1"}),"Not Set"]})}),e.jsx(a,{children:e.jsxs(j,{size:"sm",variant:"outline",onClick:()=>W(s),"data-testid":`button-edit-pricing-${s.id}`,children:[e.jsx(O,{className:"h-4 w-4 mr-1"}),d(s)?"Edit":"Set"," Price"]})})]},s.id))})]})})]}),e.jsx(U,{open:T,onOpenChange:s=>!s&&p(),children:e.jsxs(z,{children:[e.jsxs(A,{children:[e.jsx(J,{children:r?`Set Pricing for ${r.name}`:"Set Room Pricing"}),e.jsx(M,{children:"Configure daily rates for in-house guests and walk-in customers"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"price-inhouse",children:"In-House Price (NPR) *"}),e.jsx(k,{id:"price-inhouse",type:"number",step:"0.01",placeholder:"2500.00",value:l,onChange:s=>m(s.target.value),"data-testid":"input-price-inhouse"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Price per night for hotel guests"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"price-walkin",children:"Walk-in Price (NPR) *"}),e.jsx(k,{id:"price-walkin",type:"number",step:"0.01",placeholder:"3500.00",value:o,onChange:s=>u(s.target.value),"data-testid":"input-price-walkin"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Price per night for external customers"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(j,{onClick:E,className:"flex-1","data-testid":"button-save-pricing",children:"Save Pricing"}),e.jsx(j,{variant:"outline",onClick:p,"data-testid":"button-cancel-pricing",children:"Cancel"})]})]})]})})]})})}export{ie as default};
