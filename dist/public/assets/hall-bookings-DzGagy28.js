import{a4 as jt,a5 as gt,r as y,an as vt,j as e,aa as ue,a7 as be,a9 as qe,at as yt,w as pe,z as k,q as _e,u as Ke,c as Ae,l as ie,d as ce,F as Ge,e as I,f as A,g as D,h as E,i as B,B as O,I as $,C as Z,p as v,L as Oe,t as De,k as ae,A as Nt,X as bt,b as wt,au as Le,m as Pe,n as Te,a as Ce}from"./index-CuDmVYun.js";import{o as Ie,i as ke,M as St,a as Xe,k as Pt,a7 as Tt,D as Ct,aj as It,q as Re,v as At,aa as Dt,t as Et}from"./dashboard-layout-RBv1DXX2.js";import{B as Bt}from"./badge-DMaRL5Qw.js";import{T as Ee}from"./textarea-CpuNoaOI.js";import{D as ye,a as Ne,b as Be,c as Fe}from"./dialog-CYNkLpdV.js";import{e as Je,S as fe,a as je,b as ge,c as ve,d as K}from"./select-7c0Tajxe.js";import{a as Ft}from"./schema-BzoXWHjr.js";import{u as qt}from"./index-D12ZMnos.js";import{u as Mt}from"./index-dzpsPapz.js";import{C as Rt}from"./calendar-eJamnjJO.js";import{P as Ot,a as kt,b as $t}from"./popover-B3_UkTKl.js";import{S as le}from"./separator-e5QVHWOR.js";import{C as We,U as Ze,D as $e,F as zt}from"./users-DXv82DeH.js";import{C as Vt}from"./circle-alert-CPwmOhkC.js";import{f as U}from"./format-BOBWS5Wu.js";import"./addWeeks-Pc006p7j.js";import"./startOfMonth-CkZi6Jlw.js";var et=["PageUp","PageDown"],tt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],st={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},he="Slider",[ze,Ht,_t]=jt(he),[at,Is]=gt(he,[_t]),[Kt,Me]=at(he),nt=y.forwardRef((t,d)=>{const{name:n,min:m=0,max:o=100,step:i=1,orientation:x="horizontal",disabled:g=!1,minStepsBetweenThumbs:f=0,defaultValue:S=[m],value:P,onValueChange:p=()=>{},onValueCommit:w=()=>{},inverted:q=!1,form:M,...u}=t,b=y.useRef(new Set),N=y.useRef(0),r=x==="horizontal"?Gt:Qt,[C=[],_]=vt({prop:P,defaultProp:S,onChange:j=>{var R;(R=[...b.current][N.current])==null||R.focus(),p(j)}}),T=y.useRef(C);function L(j){const c=Xt(C,j);l(j,c)}function ee(j){l(j,N.current)}function J(){const j=T.current[N.current];C[N.current]!==j&&w(C)}function l(j,c,{commit:R}={commit:!1}){const W=ts(i),re=ss(Math.round((j-m)/i)*i+m,W),ne=Je(re,[m,o]);_((te=[])=>{const Y=Wt(te,ne,c);if(es(Y,f*i)){N.current=Y.indexOf(ne);const de=String(Y)!==String(te);return de&&R&&w(Y),de?Y:te}else return te})}return e.jsx(Kt,{scope:t.__scopeSlider,name:n,disabled:g,min:m,max:o,valueIndexToChangeRef:N,thumbs:b.current,values:C,orientation:x,form:M,children:e.jsx(ze.Provider,{scope:t.__scopeSlider,children:e.jsx(ze.Slot,{scope:t.__scopeSlider,children:e.jsx(r,{"aria-disabled":g,"data-disabled":g?"":void 0,...u,ref:d,onPointerDown:ue(u.onPointerDown,()=>{g||(T.current=C)}),min:m,max:o,inverted:q,onSlideStart:g?void 0:L,onSlideMove:g?void 0:ee,onSlideEnd:g?void 0:J,onHomeKeyDown:()=>!g&&l(m,0,{commit:!0}),onEndKeyDown:()=>!g&&l(o,C.length-1,{commit:!0}),onStepKeyDown:({event:j,direction:c})=>{if(!g){const re=et.includes(j.key)||j.shiftKey&&tt.includes(j.key)?10:1,ne=N.current,te=C[ne],Y=i*re*c;l(te+Y,ne,{commit:!0})}}})})})})});nt.displayName=he;var[it,rt]=at(he,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Gt=y.forwardRef((t,d)=>{const{min:n,max:m,dir:o,inverted:i,onSlideStart:x,onSlideMove:g,onSlideEnd:f,onStepKeyDown:S,...P}=t,[p,w]=y.useState(null),q=be(d,r=>w(r)),M=y.useRef(void 0),u=qt(o),b=u==="ltr",N=b&&!i||!b&&i;function V(r){const C=M.current||p.getBoundingClientRect(),_=[0,C.width],L=Qe(_,N?[n,m]:[m,n]);return M.current=C,L(r-C.left)}return e.jsx(it,{scope:t.__scopeSlider,startEdge:N?"left":"right",endEdge:N?"right":"left",direction:N?1:-1,size:"width",children:e.jsx(lt,{dir:u,"data-orientation":"horizontal",...P,ref:q,style:{...P.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:r=>{const C=V(r.clientX);x==null||x(C)},onSlideMove:r=>{const C=V(r.clientX);g==null||g(C)},onSlideEnd:()=>{M.current=void 0,f==null||f()},onStepKeyDown:r=>{const _=st[N?"from-left":"from-right"].includes(r.key);S==null||S({event:r,direction:_?-1:1})}})})}),Qt=y.forwardRef((t,d)=>{const{min:n,max:m,inverted:o,onSlideStart:i,onSlideMove:x,onSlideEnd:g,onStepKeyDown:f,...S}=t,P=y.useRef(null),p=be(d,P),w=y.useRef(void 0),q=!o;function M(u){const b=w.current||P.current.getBoundingClientRect(),N=[0,b.height],r=Qe(N,q?[m,n]:[n,m]);return w.current=b,r(u-b.top)}return e.jsx(it,{scope:t.__scopeSlider,startEdge:q?"bottom":"top",endEdge:q?"top":"bottom",size:"height",direction:q?1:-1,children:e.jsx(lt,{"data-orientation":"vertical",...S,ref:p,style:{...S.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:u=>{const b=M(u.clientY);i==null||i(b)},onSlideMove:u=>{const b=M(u.clientY);x==null||x(b)},onSlideEnd:()=>{w.current=void 0,g==null||g()},onStepKeyDown:u=>{const N=st[q?"from-bottom":"from-top"].includes(u.key);f==null||f({event:u,direction:N?-1:1})}})})}),lt=y.forwardRef((t,d)=>{const{__scopeSlider:n,onSlideStart:m,onSlideMove:o,onSlideEnd:i,onHomeKeyDown:x,onEndKeyDown:g,onStepKeyDown:f,...S}=t,P=Me(he,n);return e.jsx(qe.span,{...S,ref:d,onKeyDown:ue(t.onKeyDown,p=>{p.key==="Home"?(x(p),p.preventDefault()):p.key==="End"?(g(p),p.preventDefault()):et.concat(tt).includes(p.key)&&(f(p),p.preventDefault())}),onPointerDown:ue(t.onPointerDown,p=>{const w=p.target;w.setPointerCapture(p.pointerId),p.preventDefault(),P.thumbs.has(w)?w.focus():m(p)}),onPointerMove:ue(t.onPointerMove,p=>{p.target.hasPointerCapture(p.pointerId)&&o(p)}),onPointerUp:ue(t.onPointerUp,p=>{const w=p.target;w.hasPointerCapture(p.pointerId)&&(w.releasePointerCapture(p.pointerId),i(p))})})}),ot="SliderTrack",ct=y.forwardRef((t,d)=>{const{__scopeSlider:n,...m}=t,o=Me(ot,n);return e.jsx(qe.span,{"data-disabled":o.disabled?"":void 0,"data-orientation":o.orientation,...m,ref:d})});ct.displayName=ot;var Ve="SliderRange",dt=y.forwardRef((t,d)=>{const{__scopeSlider:n,...m}=t,o=Me(Ve,n),i=rt(Ve,n),x=y.useRef(null),g=be(d,x),f=o.values.length,S=o.values.map(w=>ut(w,o.min,o.max)),P=f>1?Math.min(...S):0,p=100-Math.max(...S);return e.jsx(qe.span,{"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,...m,ref:g,style:{...t.style,[i.startEdge]:P+"%",[i.endEdge]:p+"%"}})});dt.displayName=Ve;var He="SliderThumb",mt=y.forwardRef((t,d)=>{const n=Ht(t.__scopeSlider),[m,o]=y.useState(null),i=be(d,g=>o(g)),x=y.useMemo(()=>m?n().findIndex(g=>g.ref.current===m):-1,[n,m]);return e.jsx(Ut,{...t,ref:i,index:x})}),Ut=y.forwardRef((t,d)=>{const{__scopeSlider:n,index:m,name:o,...i}=t,x=Me(He,n),g=rt(He,n),[f,S]=y.useState(null),P=be(d,V=>S(V)),p=f?x.form||!!f.closest("form"):!0,w=yt(f),q=x.values[m],M=q===void 0?0:ut(q,x.min,x.max),u=Yt(m,x.values.length),b=w==null?void 0:w[g.size],N=b?Jt(b,M,g.direction):0;return y.useEffect(()=>{if(f)return x.thumbs.add(f),()=>{x.thumbs.delete(f)}},[f,x.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[g.startEdge]:`calc(${M}% + ${N}px)`},children:[e.jsx(ze.ItemSlot,{scope:t.__scopeSlider,children:e.jsx(qe.span,{role:"slider","aria-label":t["aria-label"]||u,"aria-valuemin":x.min,"aria-valuenow":q,"aria-valuemax":x.max,"aria-orientation":x.orientation,"data-orientation":x.orientation,"data-disabled":x.disabled?"":void 0,tabIndex:x.disabled?void 0:0,...i,ref:P,style:q===void 0?{display:"none"}:t.style,onFocus:ue(t.onFocus,()=>{x.valueIndexToChangeRef.current=m})})}),p&&e.jsx(Lt,{name:o??(x.name?x.name+(x.values.length>1?"[]":""):void 0),form:x.form,value:q},m)]})});mt.displayName=He;var Lt=t=>{const{value:d,...n}=t,m=y.useRef(null),o=Mt(d);return y.useEffect(()=>{const i=m.current,x=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(x,"value").set;if(o!==d&&f){const S=new Event("input",{bubbles:!0});f.call(i,d),i.dispatchEvent(S)}},[o,d]),e.jsx("input",{style:{display:"none"},...n,ref:m,defaultValue:d})};function Wt(t=[],d,n){const m=[...t];return m[n]=d,m.sort((o,i)=>o-i)}function ut(t,d,n){const i=100/(n-d)*(t-d);return Je(i,[0,100])}function Yt(t,d){return d>2?`Value ${t+1} of ${d}`:d===2?["Minimum","Maximum"][t]:void 0}function Xt(t,d){if(t.length===1)return 0;const n=t.map(o=>Math.abs(o-d)),m=Math.min(...n);return n.indexOf(m)}function Jt(t,d,n){const m=t/2,i=Qe([0,50],[0,m]);return(m-i(d)*n)*n}function Zt(t){return t.slice(0,-1).map((d,n)=>t[n+1]-d)}function es(t,d){if(d>0){const n=Zt(t);return Math.min(...n)>=d}return!0}function Qe(t,d){return n=>{if(t[0]===t[1]||d[0]===d[1])return d[0];const m=(d[1]-d[0])/(t[1]-t[0]);return d[0]+m*(n-t[0])}}function ts(t){return(String(t).split(".")[1]||"").length}function ss(t,d){const n=Math.pow(10,d);return Math.round(t*n)/n}var ht=nt,as=ct,ns=dt,is=mt;const xt=y.forwardRef(({className:t,...d},n)=>e.jsxs(ht,{ref:n,className:pe("relative flex w-full touch-none select-none items-center",t),...d,children:[e.jsx(as,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(ns,{className:"absolute h-full bg-primary"})}),e.jsx(is,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));xt.displayName=ht.displayName;const rs=k.object({hallId:k.string().min(1,"Hall is required"),date:k.date(),startTime:k.string().min(1,"Start time is required"),endTime:k.string().min(1,"End time is required"),duration:k.number().min(1,"Duration must be at least 1 hour"),isInHouseGuest:k.boolean().default(!1),customerName:k.string().min(1,"Customer name is required"),customerPhone:k.string().min(1,"Phone is required"),customerEmail:k.string().email().optional().or(k.literal("")),guestId:k.string().optional(),numberOfPeople:k.number().min(1,"Estimated number of people is required"),totalAmount:k.number(),advancePaid:k.number().min(0,"Advance cannot be negative"),balanceDue:k.number(),paymentMethod:k.string().optional(),specialRequests:k.string().optional()}).refine(t=>t.advancePaid<=t.totalAmount,{message:"Advance payment cannot exceed total amount",path:["advancePaid"]});function ls({open:t,onOpenChange:d,onSuccess:n}){const{user:m}=_e(),{toast:o}=Ke(),[i,x]=y.useState(1),[g,f]=y.useState(""),[S,P]=y.useState(!1),[p,w]=y.useState(null),[q,M]=y.useState(""),[u,b]=y.useState(0),[N,V]=y.useState([]),r=Ae({resolver:De(rs),defaultValues:{hallId:"",date:new Date,startTime:"",endTime:"",duration:1,isInHouseGuest:!1,customerName:"",customerPhone:"",customerEmail:"",numberOfPeople:1,totalAmount:0,advancePaid:0,balanceDue:0,paymentMethod:"",specialRequests:""}}),{data:C=[]}=ie({queryKey:["/api/halls"],enabled:!!(m!=null&&m.hotelId)&&t});ie({queryKey:["/api/hotels/current"],enabled:!!(m!=null&&m.hotelId)&&t});const{data:_=[]}=ie({queryKey:["/api/hotels/current/taxes"],enabled:!!(m!=null&&m.hotelId)&&t}),T=r.watch("hallId"),L=r.watch("date"),ee=r.watch("startTime"),J=r.watch("endTime"),l=r.watch("duration"),j=r.watch("numberOfPeople"),c=C.find(a=>a.id===T);y.useEffect(()=>{w(null)},[T,L,ee,J]);const R=(a,h)=>{if(!a||!h)return 0;const[H,z]=a.split(":").map(Number),[se,Q]=h.split(":").map(Number),we=H*60+z,Se=se*60+Q;return Math.max(0,(Se-we)/60)},W=a=>{r.setValue("startTime",a);const h=R(a,J);h>0&&(r.setValue("duration",h),X())},re=a=>{r.setValue("endTime",a);const h=R(ee,a);h>0&&(r.setValue("duration",h),X())},ne=async()=>{var a;if(!T||!L||!ee||!J)return!0;w(null);try{const h=await ae("POST","/api/halls/check-availability-quick",{hallId:T,date:U(L,"yyyy-MM-dd"),startTime:ee,endTime:J});return h&&h.available===!1?(w(h),o({title:"Hall Not Available",description:(a=h.suggestions)!=null&&a.length?"Alternative time slots are suggested below":"No alternative slots available for this date",variant:"destructive"}),!1):!0}catch{return o({title:"Error checking availability",variant:"destructive"}),!1}},te=()=>{V([...N,{id:Date.now().toString(),name:"",quantity:1,unitPrice:0}])},Y=(a,h,H)=>{V(N.map(z=>z.id===a?{...z,[h]:H}:z))},de=a=>{V(N.filter(h=>h.id!==a))},oe=()=>N.reduce((a,h)=>a+h.quantity*h.unitPrice,0),X=()=>{if(!c)return;const H=(r.getValues("isInHouseGuest")?c.priceInhouse?Number(c.priceInhouse):0:c.priceWalkin?Number(c.priceWalkin):0)*l,z=j*u,se=oe(),Q=H+z+se;let we=0;_.forEach(Ue=>{if(Ue.isActive){const ft=Q*(Number(Ue.percent)/100);we+=ft}});const Se=Q+we;r.setValue("totalAmount",Number(Se.toFixed(2)));const pt=r.getValues("advancePaid")||0;r.setValue("balanceDue",Number((Se-pt).toFixed(2)))},xe=async()=>{if(g){P(!0);try{const a=await ae("GET",`/api/guests/search?phone=${encodeURIComponent(g)}`);a?(r.setValue("customerName",`${a.firstName} ${a.lastName}`),r.setValue("customerPhone",a.phone),r.setValue("customerEmail",a.email||""),r.setValue("guestId",a.id),o({title:"Guest found",description:"Information auto-filled"})):o({title:"Guest not found",description:"Please enter details manually"})}catch{o({title:"Search failed",variant:"destructive"})}finally{P(!1)}}};y.useEffect(()=>{i===3&&X()},[u,N,i]);const me=ce({mutationFn:async a=>{const h=N.filter(Q=>Q.name.trim()).map(Q=>`${Q.name} (${Q.quantity} × ${v(Q.unitPrice)} = ${v(Q.quantity*Q.unitPrice)})`).join(", "),z=[u>0?`Food: ${q||"Not specified"} (${a.numberOfPeople} persons × ${v(u)} = ${v(a.numberOfPeople*u)})`:"",h].filter(Q=>Q).join(" | "),se={hallId:a.hallId,customerName:a.customerName,customerPhone:a.customerPhone,customerEmail:a.customerEmail||void 0,guestId:a.guestId||void 0,isInHouseGuest:a.isInHouseGuest,bookingStartTime:new Date(`${U(a.date,"yyyy-MM-dd")}T${a.startTime}`),bookingEndTime:new Date(`${U(a.date,"yyyy-MM-dd")}T${a.endTime}`),duration:a.duration.toString(),numberOfPeople:a.numberOfPeople,hallBasePrice:(a.isInHouseGuest?c!=null&&c.priceInhouse?Number(c.priceInhouse)*a.duration:0:c!=null&&c.priceWalkin?Number(c.priceWalkin)*a.duration:0).toFixed(2),totalAmount:a.totalAmount.toString(),advancePaid:a.advancePaid.toString(),balanceDue:a.balanceDue.toString(),paymentMethod:a.paymentMethod||void 0,specialRequests:a.specialRequests||void 0,foodServices:z||void 0,status:"quotation"};await ae("POST",`/api/hotels/${m==null?void 0:m.hotelId}/hall-bookings`,se)},onSuccess:()=>{o({title:"Booking created successfully"}),r.reset(),x(1),w(null),M(""),b(0),V([]),n(),d(!1)},onError:a=>{o({title:"Booking failed",description:a.message||"Failed to create booking",variant:"destructive"})}}),s=async()=>{let a=!1;switch(i){case 1:if(a=await r.trigger(["hallId","date","startTime","endTime","duration"]),!a){o({title:"Validation Error",description:"Please fill in all required fields correctly",variant:"destructive"});return}await ne()&&x(2);break;case 2:if(a=await r.trigger(["customerName","customerPhone","customerEmail","numberOfPeople"]),!a){o({title:"Validation Error",description:"Please fill in all customer information",variant:"destructive"});return}X(),x(3);break;case 3:r.handleSubmit(H=>me.mutate(H))();break}},F=()=>{i>1&&x(i-1)},G=[{number:1,title:"Hall & Time",icon:We},{number:2,title:"Customer Info",icon:Ze},{number:3,title:"Quotation",icon:$e}];return e.jsx(ye,{open:t,onOpenChange:d,children:e.jsxs(Ne,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Be,{children:e.jsx(Fe,{children:"Create New Booking"})}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex justify-between items-center",children:G.map((a,h)=>{const H=a.icon,z=i===a.number,se=i>a.number;return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:pe("w-10 h-10 rounded-full flex items-center justify-center transition-colors",z&&"bg-primary text-primary-foreground",se&&"bg-green-500 text-white",!z&&!se&&"bg-muted text-muted-foreground"),children:se?e.jsx(Ie,{className:"w-5 h-5"}):e.jsx(H,{className:"w-5 h-5"})}),e.jsx("span",{className:pe("text-sm mt-2",z&&"font-semibold text-primary",!z&&"text-muted-foreground"),children:a.title})]}),h<G.length-1&&e.jsx(le,{className:pe("flex-1 mx-2",se&&"bg-green-500")})]},a.number)})})}),e.jsxs(Ge,{...r,children:[e.jsxs("div",{className:"space-y-4",children:[i===1&&e.jsxs(e.Fragment,{children:[e.jsx(I,{control:r.control,name:"isInHouseGuest",render:({field:a})=>e.jsxs(A,{children:[e.jsx(D,{children:"Customer Type"}),e.jsxs(fe,{onValueChange:h=>{a.onChange(h==="true"),X()},value:a.value?"true":"false",children:[e.jsx(E,{children:e.jsx(je,{"data-testid":"select-customer-type",children:e.jsx(ge,{})})}),e.jsxs(ve,{children:[e.jsx(K,{value:"false",children:"Walk-in Customer"}),e.jsx(K,{value:"true",children:"In-House Guest"})]})]}),e.jsx(B,{})]})}),e.jsx(I,{control:r.control,name:"hallId",render:({field:a})=>e.jsxs(A,{children:[e.jsx(D,{children:"Select Hall"}),e.jsxs(fe,{onValueChange:h=>{a.onChange(h),X()},value:a.value,children:[e.jsx(E,{children:e.jsx(je,{"data-testid":"select-hall-wizard",children:e.jsx(ge,{placeholder:"Choose a hall"})})}),e.jsx(ve,{className:"max-h-[300px] overflow-y-auto",children:C.map(h=>e.jsxs(K,{value:h.id,children:[h.name," - Capacity: ",h.capacity]},h.id))})]}),e.jsx(B,{})]})}),e.jsx(I,{control:r.control,name:"date",render:({field:a})=>e.jsxs(A,{className:"flex flex-col",children:[e.jsx(D,{children:"Date"}),e.jsxs(Ot,{children:[e.jsx(kt,{asChild:!0,children:e.jsx(E,{children:e.jsxs(O,{variant:"outline",className:pe("w-full pl-3 text-left font-normal",!a.value&&"text-muted-foreground"),"data-testid":"button-select-date",children:[a.value?U(a.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(We,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx($t,{className:"w-auto p-0",align:"start",children:e.jsx(Rt,{mode:"single",selected:a.value,onSelect:a.onChange,disabled:h=>h<new Date(new Date().setHours(0,0,0,0)),initialFocus:!0})})]}),e.jsx(B,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(I,{control:r.control,name:"startTime",render:({field:a})=>e.jsxs(A,{children:[e.jsx(D,{children:"Start Time"}),e.jsx(E,{children:e.jsx($,{type:"time",...a,onChange:h=>{a.onChange(h),W(h.target.value)},"data-testid":"input-start-time"})}),e.jsx(B,{})]})}),e.jsx(I,{control:r.control,name:"endTime",render:({field:a})=>e.jsxs(A,{children:[e.jsx(D,{children:"End Time"}),e.jsx(E,{children:e.jsx($,{type:"time",...a,onChange:h=>{a.onChange(h),re(h.target.value)},"data-testid":"input-end-time"})}),e.jsx(B,{})]})})]}),e.jsx(I,{control:r.control,name:"duration",render:({field:a})=>e.jsxs(A,{children:[e.jsxs(D,{children:["Duration: ",a.value," hour(s)"]}),e.jsx(E,{children:e.jsx(xt,{min:1,max:24,step:.5,value:[a.value],onValueChange:h=>{a.onChange(h[0]),X()},"data-testid":"slider-duration"})}),e.jsx(B,{})]})}),c&&e.jsx(Z,{className:"p-4 bg-muted",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Price Type:"}),e.jsx("span",{className:"font-medium",children:r.watch("isInHouseGuest")?"In-House Guest":"Walk-in Customer"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Hourly Rate:"}),e.jsx("span",{className:"font-medium",children:v(r.watch("isInHouseGuest")?Number(c.priceInhouse||0):Number(c.priceWalkin||0))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Base Price (",l,"h):"]}),e.jsx("span",{className:"font-medium",children:v((r.watch("isInHouseGuest")?Number(c.priceInhouse||0):Number(c.priceWalkin||0))*l)})]})]})}),p&&!p.available&&p.suggestions&&p.suggestions.length>0&&e.jsx(Z,{className:"p-4 border-yellow-500",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Vt,{className:"w-5 h-5 text-yellow-500 mt-0.5"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Alternative Time Slots:"}),p.suggestions.map((a,h)=>e.jsxs(O,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>{const H=U(new Date(a.startTime),"HH:mm"),z=U(new Date(a.endTime),"HH:mm");r.setValue("startTime",H),r.setValue("endTime",z),W(H),re(z),w(null)},children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),U(new Date(a.startTime),"h:mm a")," - ",U(new Date(a.endTime),"h:mm a")]},h))]})]})})]}),i===2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{placeholder:"Search by phone or email",value:g,onChange:a=>f(a.target.value),"data-testid":"input-guest-search"}),e.jsx(O,{type:"button",onClick:xe,disabled:S,"data-testid":"button-search-guest",children:S?e.jsx(Oe,{className:"w-4 h-4 animate-spin"}):e.jsx(St,{className:"w-4 h-4"})})]}),e.jsx(I,{control:r.control,name:"customerName",render:({field:a})=>e.jsxs(A,{children:[e.jsx(D,{children:"Customer Name"}),e.jsx(E,{children:e.jsx($,{...a,placeholder:"Enter customer name","data-testid":"input-customer-name"})}),e.jsx(B,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(I,{control:r.control,name:"customerPhone",render:({field:a})=>e.jsxs(A,{children:[e.jsx(D,{children:"Phone"}),e.jsx(E,{children:e.jsx($,{...a,placeholder:"Phone number","data-testid":"input-customer-phone"})}),e.jsx(B,{})]})}),e.jsx(I,{control:r.control,name:"customerEmail",render:({field:a})=>e.jsxs(A,{children:[e.jsx(D,{children:"Email (Optional)"}),e.jsx(E,{children:e.jsx($,{...a,type:"email",placeholder:"email@example.com","data-testid":"input-customer-email"})}),e.jsx(B,{})]})})]}),e.jsx(I,{control:r.control,name:"numberOfPeople",render:({field:a})=>e.jsxs(A,{children:[e.jsx(D,{children:"Number of People"}),e.jsx(E,{children:e.jsx($,{...a,type:"number",min:1,onChange:h=>a.onChange(parseInt(h.target.value)||1),"data-testid":"input-number-people"})}),e.jsx(B,{})]})})]}),i===3&&e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"my-4"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Food Buffet (Per Person)"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Food Items Description"}),e.jsx(Ee,{value:q,onChange:a=>M(a.target.value),placeholder:"E.g., Chicken curry, Dal, Vegetable curry, Rice, Naan, Mixed salad, Dessert...",rows:3,"data-testid":"textarea-food-description"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Describe what food items are included in the buffet"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Price Per Person"}),e.jsx($,{type:"number",step:"0.01",min:0,value:u,onChange:a=>b(parseFloat(a.target.value)||0),"data-testid":"input-per-person-price"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Total food cost: ",v(j*u)]})]})]}),e.jsx(le,{className:"my-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Additional Services"}),e.jsxs(O,{type:"button",variant:"outline",size:"sm",onClick:te,"data-testid":"button-add-service",children:[e.jsx(Xe,{className:"w-4 h-4 mr-1"}),"Add Service"]})]}),N.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:'No additional services added. Click "Add Service" to include decoration, sound system, etc.'}):e.jsx("div",{className:"space-y-2",children:N.map(a=>e.jsx(Z,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-end",children:[e.jsxs("div",{className:"col-span-5",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Service Name"}),e.jsx($,{placeholder:"E.g., Decoration, Sound System",value:a.name,onChange:h=>Y(a.id,"name",h.target.value),"data-testid":`input-service-name-${a.id}`})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Qty"}),e.jsx($,{type:"number",min:1,value:a.quantity,onChange:h=>Y(a.id,"quantity",parseInt(h.target.value)||1),"data-testid":`input-service-qty-${a.id}`})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Unit Price"}),e.jsx($,{type:"number",step:"0.01",min:0,value:a.unitPrice,onChange:h=>Y(a.id,"unitPrice",parseFloat(h.target.value)||0),"data-testid":`input-service-price-${a.id}`})]}),e.jsxs("div",{className:"col-span-2 flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:v(a.quantity*a.unitPrice)}),e.jsx(O,{type:"button",variant:"ghost",size:"sm",onClick:()=>de(a.id),"data-testid":`button-remove-service-${a.id}`,children:e.jsx(Pt,{className:"w-4 h-4 text-destructive"})})]})]})},a.id))})]}),e.jsx(le,{className:"my-4"}),e.jsxs(Z,{className:"p-4 bg-muted",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Quotation Breakdown"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Hall Base Price (",l,"h):"]}),e.jsx("span",{className:"font-medium",children:v((r.watch("isInHouseGuest")?c!=null&&c.priceInhouse?Number(c.priceInhouse):0:c!=null&&c.priceWalkin?Number(c.priceWalkin):0)*l)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Food (",j," × ",v(u),"):"]}),e.jsx("span",{className:"font-medium",children:v(j*u)})]}),N.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Additional Services:"}),e.jsx("span",{className:"font-medium",children:v(oe())})]}),e.jsx(le,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:v((r.watch("isInHouseGuest")?c!=null&&c.priceInhouse?Number(c.priceInhouse):0:c!=null&&c.priceWalkin?Number(c.priceWalkin):0)*l+j*u+oe())})]}),_.filter(a=>a.isActive).map(a=>{const H=((r.watch("isInHouseGuest")?c!=null&&c.priceInhouse?Number(c.priceInhouse):0:c!=null&&c.priceWalkin?Number(c.priceWalkin):0)*l+j*u+oe())*(Number(a.percent)/100);return e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[a.taxType.replace(/_/g," ").replace(/\b\w/g,z=>z.toUpperCase())," (",a.percent,"%):"]}),e.jsx("span",{className:"font-medium",children:v(H)})]},a.id)}),e.jsx(le,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Quotation Amount:"}),e.jsx("span",{children:v(r.getValues("totalAmount"))})]})]})]}),e.jsx(I,{control:r.control,name:"advancePaid",render:({field:a})=>e.jsxs(A,{children:[e.jsx(D,{children:"Advance Payment"}),e.jsx(E,{children:e.jsx($,{type:"number",step:"0.01",value:a.value,onChange:h=>{const H=Number(h.target.value||0);a.onChange(H);const z=r.getValues("totalAmount");r.setValue("balanceDue",Number((z-H).toFixed(2)))},"data-testid":"input-advance-paid"})}),e.jsx(B,{})]})}),e.jsx(I,{control:r.control,name:"paymentMethod",render:({field:a})=>e.jsxs(A,{children:[e.jsx(D,{children:"Payment Method (Optional)"}),e.jsxs(fe,{onValueChange:a.onChange,value:a.value,children:[e.jsx(E,{children:e.jsx(je,{"data-testid":"select-payment-method",children:e.jsx(ge,{placeholder:"Select payment method"})})}),e.jsxs(ve,{children:[e.jsx(K,{value:"cash",children:"Cash"}),e.jsx(K,{value:"pos",children:"POS/Card"}),e.jsx(K,{value:"fonepay",children:"Fonepay"}),e.jsx(K,{value:"bank_transfer",children:"Bank Transfer"})]})]}),e.jsx(B,{})]})}),e.jsx(I,{control:r.control,name:"specialRequests",render:({field:a})=>e.jsxs(A,{children:[e.jsx(D,{children:"Special Requests (Optional)"}),e.jsx(E,{children:e.jsx(Ee,{...a,placeholder:"Any special requirements or notes",rows:3,"data-testid":"textarea-special-requests"})}),e.jsx(B,{})]})}),e.jsx(Z,{className:"p-4 border-green-500 bg-green-50 dark:bg-green-950",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Balance Due:"}),e.jsx("span",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:v(r.getValues("balanceDue"))})]})})]})]}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsx(O,{type:"button",variant:"outline",onClick:F,disabled:i===1,"data-testid":"button-back",children:"Back"}),e.jsxs(O,{type:"button",onClick:s,disabled:me.isPending,"data-testid":"button-next",children:[me.isPending&&e.jsx(Oe,{className:"w-4 h-4 mr-2 animate-spin"}),i===4?"Create Booking":"Next"]})]})]})]})})}const os=k.object({actualNumberOfPeople:k.number().min(1,"Number of people is required"),finalPaymentMethod:k.string().min(1,"Payment method is required"),finalPaymentAmount:k.number().min(0,"Payment amount must be positive")});function cs({open:t,onOpenChange:d,booking:n,onSuccess:m}){const{user:o}=_e(),{toast:i}=Ke(),[x,g]=y.useState(0);ie({queryKey:["/api/hotels/current/taxes"],enabled:!!(o!=null&&o.hotelId)&&t});const f=Ae({resolver:De(os),defaultValues:{actualNumberOfPeople:(n==null?void 0:n.numberOfPeople)||1,finalPaymentMethod:"",finalPaymentAmount:0}}),S=f.watch("actualNumberOfPeople");f.watch("finalPaymentAmount");const P=()=>{if(!n)return 0;const u=Number(n.totalAmount||0);return g(u),u};y.useEffect(()=>{t&&n&&f.reset({actualNumberOfPeople:n.numberOfPeople||1,finalPaymentMethod:"",finalPaymentAmount:0})},[t,n==null?void 0:n.id]),y.useEffect(()=>{if(t&&n){const u=P(),b=Number(n.advancePaid||0),N=u-b;f.setValue("finalPaymentAmount",Math.max(0,N))}},[S,t,n]);const p=ce({mutationFn:async u=>{if(!n)throw new Error("No booking selected");const b=P(),N=Number(n.advancePaid||0),V=b-N,r={actualNumberOfPeople:u.actualNumberOfPeople,totalAmount:b.toFixed(2),balanceDue:V.toFixed(2),paymentMethod:u.finalPaymentMethod,status:"completed"};await ae("PATCH",`/api/hotels/${o==null?void 0:o.hotelId}/hall-bookings/${n.id}`,r),u.finalPaymentAmount>0&&await ae("POST",`/api/hotels/${o==null?void 0:o.hotelId}/booking-payments`,{bookingId:n.id,amount:u.finalPaymentAmount.toFixed(2),paymentMethod:u.finalPaymentMethod,notes:"Final payment"})},onSuccess:()=>{i({title:"Billing finalized successfully"}),Nt.invalidateQueries({queryKey:["/api/hotels"]}),f.reset(),m(),d(!1)},onError:u=>{i({title:"Failed to finalize billing",description:u.message||"An error occurred",variant:"destructive"})}});if(!n)return null;const w=u=>{p.mutate(u)},q=Number(n.totalAmount||0),M=Number(n.advancePaid||0);return e.jsx(ye,{open:t,onOpenChange:d,children:e.jsxs(Ne,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Be,{children:e.jsxs(Fe,{children:["Final Billing - ",n.customerName]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Z,{className:"p-4 bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Booking Summary"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Estimated Guest Count:"}),e.jsxs("span",{className:"font-medium",children:[n.numberOfPeople," people"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Quotation Amount:"}),e.jsx("span",{className:"font-medium",children:v(q)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Advance Paid:"}),e.jsx("span",{className:"font-medium",children:v(M)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment Method:"}),e.jsx("span",{className:"font-medium",children:n.paymentMethod||"N/A"})]}),n.foodServices&&typeof n.foodServices=="string"?e.jsxs("div",{className:"mt-2 pt-2 border-t",children:[e.jsx("span",{className:"text-muted-foreground",children:"Services Included:"}),e.jsx("p",{className:"font-medium text-sm mt-1",children:n.foodServices})]}):null]})]}),e.jsx(Ge,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit(w),className:"space-y-4",children:[e.jsx(I,{control:f.control,name:"actualNumberOfPeople",render:({field:u})=>e.jsxs(A,{children:[e.jsx(D,{children:"Actual Number of People (Event Day)"}),e.jsx(E,{children:e.jsx($,{type:"number",min:1,...u,onChange:b=>{u.onChange(parseInt(b.target.value)||1),setTimeout(P,0)},"data-testid":"input-actual-people"})}),e.jsx(B,{})]})}),e.jsx(le,{className:"my-4"}),e.jsxs(Z,{className:"p-4 bg-muted",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Final Bill"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total Amount:"}),e.jsx("span",{children:v(x)})]}),e.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[e.jsx("span",{className:"text-sm",children:"Advance Paid:"}),e.jsxs("span",{className:"font-medium",children:["- ",v(M)]})]}),e.jsx(le,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold text-primary",children:[e.jsx("span",{children:"Balance Due:"}),e.jsx("span",{children:v(Math.max(0,x-M))})]})]})]}),e.jsx(I,{control:f.control,name:"finalPaymentAmount",render:({field:u})=>e.jsxs(A,{children:[e.jsx(D,{children:"Final Payment Amount"}),e.jsx(E,{children:e.jsx($,{type:"number",step:"0.01",min:0,...u,onChange:b=>u.onChange(parseFloat(b.target.value)||0),"data-testid":"input-final-payment"})}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Balance due: ",v(Math.max(0,x-M))]}),e.jsx(B,{})]})}),e.jsx(I,{control:f.control,name:"finalPaymentMethod",render:({field:u})=>e.jsxs(A,{children:[e.jsx(D,{children:"Final Payment Method"}),e.jsxs(fe,{onValueChange:u.onChange,value:u.value,children:[e.jsx(E,{children:e.jsx(je,{"data-testid":"select-final-payment-method",children:e.jsx(ge,{placeholder:"Select payment method"})})}),e.jsxs(ve,{children:[e.jsx(K,{value:"cash",children:"Cash"}),e.jsx(K,{value:"cheque",children:"Cheque"}),e.jsx(K,{value:"pos",children:"POS/Card"}),e.jsx(K,{value:"fonepay",children:"Fonepay"}),e.jsx(K,{value:"bank_transfer",children:"Bank Transfer"})]})]}),e.jsx(B,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(O,{type:"button",variant:"outline",onClick:()=>d(!1),"data-testid":"button-cancel-billing",children:"Cancel"}),e.jsxs(O,{type:"submit",disabled:p.isPending,"data-testid":"button-finalize-billing",children:[p.isPending&&e.jsx(Oe,{className:"mr-2 h-4 w-4 animate-spin"}),"Finalize Billing"]})]})]})})]})]})})}function ds({booking:t,open:d,onOpenChange:n}){const m=y.useRef(null),{data:o}=ie({queryKey:[`/api/halls/${t==null?void 0:t.hallId}`],enabled:!!(t!=null&&t.hallId)}),{data:i}=ie({queryKey:[`/api/hotels/${t==null?void 0:t.hotelId}`],enabled:!!(t!=null&&t.hotelId)}),{data:x}=ie({queryKey:[`/api/hotels/${t==null?void 0:t.hotelId}/taxes`],enabled:!!(t!=null&&t.hotelId)}),g=()=>{const l=m.current;if(!l)return;const j=window.open("","_blank");j&&(j.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Hall Booking Quotation - ${t.id}</title>
          <style>
            @media print {
              @page {
                size: A4;
                margin: 0;
              }
              body {
                margin: 0;
                padding: 0;
              }
              .no-print {
                display: none;
              }
            }
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            body {
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              color: #1a1a1a;
              background: white;
            }
            .page {
              width: 210mm;
              min-height: 297mm;
              padding: 15mm;
              margin: 0 auto;
              background: white;
              box-shadow: 0 0 10px rgba(0,0,0,0.1);
            }
            .header {
              border-bottom: 2px solid #2c3e50;
              padding-bottom: 12px;
              margin-bottom: 15px;
            }
            .hotel-name {
              font-size: 22px;
              font-weight: 700;
              color: #2c3e50;
              margin-bottom: 6px;
              letter-spacing: 0.5px;
            }
            .hotel-details {
              font-size: 9px;
              color: #555;
              line-height: 1.4;
            }
            .quotation-title {
              text-align: center;
              font-size: 18px;
              font-weight: 600;
              color: #2c3e50;
              margin: 12px 0;
              text-transform: uppercase;
              letter-spacing: 1px;
            }
            .meta-info {
              display: flex;
              justify-content: space-between;
              margin-bottom: 15px;
              font-size: 9px;
            }
            .meta-box {
              flex: 1;
            }
            .meta-label {
              font-weight: 600;
              color: #2c3e50;
              margin-bottom: 3px;
            }
            .section {
              margin-bottom: 15px;
            }
            .section-title {
              font-size: 11px;
              font-weight: 600;
              color: #2c3e50;
              border-bottom: 1px solid #ecf0f1;
              padding-bottom: 5px;
              margin-bottom: 10px;
              text-transform: uppercase;
              letter-spacing: 0.5px;
            }
            .info-grid {
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 8px;
              font-size: 9px;
            }
            .info-item {
              display: flex;
              gap: 6px;
            }
            .info-label {
              font-weight: 600;
              color: #555;
              min-width: 100px;
            }
            .info-value {
              color: #1a1a1a;
            }
            table {
              width: 100%;
              border-collapse: collapse;
              margin: 10px 0;
              font-size: 9px;
            }
            thead {
              background: #2c3e50;
              color: white;
            }
            th {
              padding: 8px;
              text-align: left;
              font-weight: 600;
              font-size: 9px;
              text-transform: uppercase;
              letter-spacing: 0.3px;
            }
            td {
              padding: 6px 8px;
              border-bottom: 1px solid #ecf0f1;
            }
            tbody tr:hover {
              background: #f8f9fa;
            }
            .text-right {
              text-align: right;
            }
            .summary-table {
              margin-top: 10px;
              width: 100%;
              max-width: 350px;
              margin-left: auto;
            }
            .summary-table td {
              padding: 5px 8px;
              border: none;
            }
            .summary-row {
              font-size: 9px;
            }
            .total-row {
              font-size: 11px;
              font-weight: 700;
              border-top: 2px solid #2c3e50;
              color: #2c3e50;
            }
            .terms {
              margin-top: 15px;
              padding: 10px;
              background: #f8f9fa;
              border-left: 3px solid #2c3e50;
              font-size: 7px;
              line-height: 1.4;
            }
            .terms-title {
              font-weight: 600;
              margin-bottom: 5px;
              color: #2c3e50;
              font-size: 8px;
            }
            .terms ul {
              margin-left: 15px;
              margin-top: 4px;
            }
            .terms li {
              margin-bottom: 2px;
            }
            .footer {
              margin-top: 15px;
              padding-top: 10px;
              border-top: 1px solid #ecf0f1;
              text-align: center;
              font-size: 8px;
              color: #777;
            }
            .signature-section {
              margin-top: 20px;
              display: flex;
              justify-content: space-between;
            }
            .signature-box {
              text-align: center;
              flex: 1;
            }
            .signature-line {
              border-top: 1px solid #000;
              margin-top: 40px;
              padding-top: 6px;
              font-size: 9px;
              font-weight: 600;
            }
            .status-badge {
              display: inline-block;
              padding: 4px 12px;
              border-radius: 4px;
              font-size: 10px;
              font-weight: 600;
              text-transform: uppercase;
            }
            .status-quotation {
              background: #3498db;
              color: white;
            }
            .status-confirmed {
              background: #27ae60;
              color: white;
            }
          </style>
        </head>
        <body>
          ${l.innerHTML}
        </body>
      </html>
    `),j.document.close(),j.focus(),setTimeout(()=>{j.print(),j.close()},250))};let f=[],S=[],P=[];if(Array.isArray(t.foodServices))f=t.foodServices;else if(typeof t.foodServices=="string"&&t.foodServices){const l=t.foodServices.match(/Food:\s*(.+?)\s*\((\d+)\s*persons\s*×\s*(?:रु)?([\d,]+(?:\.\d+)?)\s*=\s*(?:रु)?([\d,]+(?:\.\d+)?)\)/);l&&(f=[{name:"Food & Beverage",description:l[1].trim(),numberOfPersons:parseInt(l[2]),pricePerPerson:parseFloat(l[3].replace(/,/g,"")),totalPrice:parseFloat(l[4].replace(/,/g,""))}])}Array.isArray(t.otherServices)&&(S=t.otherServices),Array.isArray(t.servicePackages)&&(P=t.servicePackages);const p=parseFloat(t.hallBasePrice||"0"),w=f.reduce((l,j)=>l+parseFloat(j.totalPrice||j.total||"0"),0),q=S.reduce((l,j)=>l+parseFloat(j.totalPrice||j.total||"0"),0),M=P.reduce((l,j)=>l+parseFloat(j.totalPrice||j.total||"0"),0),u=p+w+q+M,b=(x==null?void 0:x.filter(l=>l.isActive))||[],N=b.find(l=>l.taxType==="vat"),V=b.find(l=>l.taxType==="service_charge"),r=b.find(l=>l.taxType==="luxury_tax"),C=N?u*(parseFloat(N.percent||"0")/100):0,_=V?u*(parseFloat(V.percent||"0")/100):0,T=r?u*(parseFloat(r.percent||"0")/100):0,L=C+_+T,ee=u+L,J=parseFloat(t.totalAmount||"0")||ee;return e.jsx(ye,{open:d,onOpenChange:n,children:e.jsxs(Ne,{className:"max-w-[900px] max-h-[90vh] overflow-y-auto p-0",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10 no-print",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Hall Booking Quotation"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{onClick:g,"data-testid":"button-print-quotation",children:[e.jsx(Tt,{className:"w-4 h-4 mr-2"}),"Print"]}),e.jsx(O,{variant:"outline",size:"icon",onClick:()=>n(!1),"data-testid":"button-close-quotation",children:e.jsx(bt,{className:"w-4 h-4"})})]})]}),e.jsx("div",{ref:m,children:e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"header",children:[e.jsx("div",{className:"hotel-name",children:(i==null?void 0:i.name)||"Hotel Name"}),e.jsxs("div",{className:"hotel-details",children:[(i==null?void 0:i.address)&&e.jsx("div",{children:i.address}),(i==null?void 0:i.phone)&&e.jsxs("div",{children:["Phone: ",i.phone]}),(i==null?void 0:i.vatNo)&&e.jsxs("div",{children:["VAT No: ",i.vatNo]})]})]}),e.jsx("div",{className:"quotation-title",children:"Hall Booking Quotation"}),e.jsxs("div",{className:"meta-info",children:[e.jsxs("div",{className:"meta-box",children:[e.jsx("div",{className:"meta-label",children:"Quotation No:"}),e.jsx("div",{children:t.id.substring(0,8).toUpperCase()})]}),e.jsxs("div",{className:"meta-box",children:[e.jsx("div",{className:"meta-label",children:"Date:"}),e.jsx("div",{children:U(new Date(t.createdAt),"PPP")})]}),e.jsxs("div",{className:"meta-box",children:[e.jsx("div",{className:"meta-label",children:"Status:"}),e.jsx("div",{children:e.jsx("span",{className:`status-badge status-${t.status}`,children:t.status})})]})]}),e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-title",children:"Customer Information"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Name:"}),e.jsx("span",{className:"info-value",children:t.customerName})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Phone:"}),e.jsx("span",{className:"info-value",children:t.customerPhone})]}),t.customerEmail&&e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Email:"}),e.jsx("span",{className:"info-value",children:t.customerEmail})]})]})]}),e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-title",children:"Event Details"}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Hall:"}),e.jsx("span",{className:"info-value",children:(o==null?void 0:o.name)||"N/A"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Capacity:"}),e.jsxs("span",{className:"info-value",children:[(o==null?void 0:o.capacity)||"N/A"," persons"]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Event Date:"}),e.jsx("span",{className:"info-value",children:t.bookingStartTime?U(new Date(t.bookingStartTime),"PPP"):"N/A"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Event Time:"}),e.jsx("span",{className:"info-value",children:t.bookingStartTime&&t.bookingEndTime?`${U(new Date(t.bookingStartTime),"p")} - ${U(new Date(t.bookingEndTime),"p")}`:"N/A"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Number of Guests:"}),e.jsxs("span",{className:"info-value",children:[t.numberOfPeople||0," persons"]})]}),t.duration&&e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Duration:"}),e.jsxs("span",{className:"info-value",children:[t.duration," hours"]})]})]})]}),e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-title",children:"Services & Pricing"}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"10%"},children:"#"}),e.jsx("th",{style:{width:"45%"},children:"Description"}),e.jsx("th",{style:{width:"15%"},className:"text-right",children:"Quantity"}),e.jsx("th",{style:{width:"15%"},className:"text-right",children:"Unit Price"}),e.jsx("th",{style:{width:"15%"},className:"text-right",children:"Amount"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"1"}),e.jsxs("td",{children:[e.jsx("strong",{children:"Hall Rental"}),e.jsx("br",{}),(o==null?void 0:o.name)||"Hall",t.duration&&e.jsxs("span",{style:{fontSize:"8px",color:"#666",display:"block",marginTop:"2px"},children:["(",t.duration," hours @ ",v(p/parseFloat(t.duration))," per hour)"]})]}),e.jsx("td",{className:"text-right",children:t.duration?`${t.duration} hrs`:"1"}),e.jsx("td",{className:"text-right",children:t.duration?v(p/parseFloat(t.duration)):v(p)}),e.jsx("td",{className:"text-right",children:v(p)})]}),f.length>0&&f.map((l,j)=>{const c=l.quantity||l.numberOfPersons||0,R=parseFloat(l.pricePerPerson||l.price||"0"),W=parseFloat(l.totalPrice||l.total||"0");return e.jsxs("tr",{children:[e.jsx("td",{children:j+2}),e.jsxs("td",{children:[e.jsx("strong",{children:l.itemName||l.name||"Food & Beverage"}),l.description&&e.jsx("br",{}),l.description&&e.jsx("span",{style:{fontSize:"8px",color:"#666"},children:l.description}),c>0&&R>0&&e.jsxs("span",{style:{fontSize:"8px",color:"#666",display:"block",marginTop:"2px"},children:["(",c," persons × ",v(R)," per person)"]})]}),e.jsx("td",{className:"text-right",children:c>0?`${c} pax`:"1"}),e.jsx("td",{className:"text-right",children:v(R)}),e.jsx("td",{className:"text-right",children:v(W)})]},`food-${j}`)}),S.length>0&&S.map((l,j)=>{const c=l.quantity||1,R=parseFloat(l.price||"0"),W=parseFloat(l.totalPrice||l.total||"0");return e.jsxs("tr",{children:[e.jsx("td",{children:j+2+f.length}),e.jsxs("td",{children:[e.jsx("strong",{children:l.serviceName||l.name||"Additional Service"}),l.description&&e.jsx("br",{}),l.description&&e.jsx("span",{style:{fontSize:"8px",color:"#666"},children:l.description}),c>1&&R>0&&e.jsxs("span",{style:{fontSize:"8px",color:"#666",display:"block",marginTop:"2px"},children:["(",c," × ",v(R)," per unit)"]})]}),e.jsx("td",{className:"text-right",children:c}),e.jsx("td",{className:"text-right",children:v(R)}),e.jsx("td",{className:"text-right",children:v(W)})]},`service-${j}`)}),P.length>0&&P.map((l,j)=>{const c=l.quantity||1,R=parseFloat(l.price||"0"),W=parseFloat(l.totalPrice||l.total||"0");return e.jsxs("tr",{children:[e.jsx("td",{children:j+2+f.length+S.length}),e.jsxs("td",{children:[e.jsx("strong",{children:l.packageName||l.name||"Service Package"}),l.description&&e.jsx("br",{}),l.description&&e.jsx("span",{style:{fontSize:"8px",color:"#666"},children:l.description}),c>1&&R>0&&e.jsxs("span",{style:{fontSize:"8px",color:"#666",display:"block",marginTop:"2px"},children:["(",c," × ",v(R)," per package)"]})]}),e.jsx("td",{className:"text-right",children:c}),e.jsx("td",{className:"text-right",children:v(R)}),e.jsx("td",{className:"text-right",children:v(W)})]},`package-${j}`)})]})]}),e.jsx("table",{className:"summary-table",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"summary-row",children:[e.jsx("td",{children:e.jsx("strong",{children:"Subtotal (Services):"})}),e.jsx("td",{className:"text-right",children:e.jsx("strong",{children:v(u)})})]}),e.jsx("tr",{style:{height:"8px"},children:e.jsx("td",{colSpan:2})}),N&&e.jsxs("tr",{className:"summary-row",children:[e.jsxs("td",{style:{paddingLeft:"12px"},children:["VAT (",N.percent,"%):"]}),e.jsx("td",{className:"text-right",children:v(C)})]}),V&&e.jsxs("tr",{className:"summary-row",children:[e.jsxs("td",{style:{paddingLeft:"12px"},children:["Service Charge (",V.percent,"%):"]}),e.jsx("td",{className:"text-right",children:v(_)})]}),r&&e.jsxs("tr",{className:"summary-row",children:[e.jsxs("td",{style:{paddingLeft:"12px"},children:["Luxury Tax (",r.percent,"%):"]}),e.jsx("td",{className:"text-right",children:v(T)})]}),L>0&&e.jsxs(e.Fragment,{children:[e.jsx("tr",{style:{height:"4px"},children:e.jsx("td",{colSpan:2})}),e.jsxs("tr",{className:"summary-row",style:{borderTop:"1px solid #ddd"},children:[e.jsx("td",{children:e.jsx("strong",{children:"Total Taxes:"})}),e.jsx("td",{className:"text-right",children:e.jsx("strong",{children:v(L)})})]})]}),e.jsx("tr",{style:{height:"8px"},children:e.jsx("td",{colSpan:2})}),e.jsxs("tr",{className:"total-row",style:{fontSize:"12px"},children:[e.jsx("td",{children:e.jsx("strong",{children:"GRAND TOTAL:"})}),e.jsx("td",{className:"text-right",children:e.jsx("strong",{children:v(J)})})]}),parseFloat(t.advancePaid||"0")>0&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"summary-row",children:[e.jsx("td",{children:"Advance Paid:"}),e.jsxs("td",{className:"text-right",style:{color:"#27ae60"},children:["-",v(parseFloat(t.advancePaid||"0"))]})]}),e.jsxs("tr",{className:"total-row",children:[e.jsx("td",{children:"Balance Due:"}),e.jsx("td",{className:"text-right",style:{color:"#e74c3c"},children:v(parseFloat(t.balanceDue||"0"))})]})]})]})})]}),t.specialRequests&&e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-title",children:"Special Requests"}),e.jsx("div",{style:{fontSize:"9px",lineHeight:"1.4",padding:"6px",background:"#f8f9fa",borderRadius:"4px"},children:t.specialRequests})]}),e.jsxs("div",{className:"terms",children:[e.jsx("div",{className:"terms-title",children:"Terms & Conditions"}),e.jsxs("ul",{children:[e.jsx("li",{children:"This quotation is valid for 30 days from the date of issue."}),e.jsx("li",{children:"A minimum advance payment of 50% is required to confirm the booking."}),e.jsx("li",{children:"The balance amount must be paid before or on the event date."}),e.jsx("li",{children:"Cancellation must be notified at least 7 days in advance for a full refund of the advance."}),e.jsx("li",{children:"Any additional services requested on the event day will be charged separately."}),e.jsx("li",{children:"The hall must be vacated by the agreed end time. Overtime charges may apply."}),e.jsx("li",{children:"The client is responsible for any damage to hotel property during the event."}),e.jsx("li",{children:"All prices are inclusive of applicable taxes unless stated otherwise."})]})]}),e.jsxs("div",{className:"signature-section",children:[e.jsxs("div",{className:"signature-box",children:[e.jsx("div",{className:"signature-line",children:"Authorized Signature"}),e.jsx("div",{style:{fontSize:"10px",marginTop:"4px",color:"#666"},children:(i==null?void 0:i.name)||"Hotel Management"})]}),e.jsxs("div",{className:"signature-box",children:[e.jsx("div",{className:"signature-line",children:"Customer Signature"}),e.jsx("div",{style:{fontSize:"10px",marginTop:"4px",color:"#666"},children:t.customerName})]})]}),e.jsxs("div",{className:"footer",children:[e.jsxs("div",{children:["Thank you for choosing ",(i==null?void 0:i.name)||"our hotel","!"]}),e.jsxs("div",{style:{marginTop:"8px"},children:["For any queries, please contact us at ",(i==null?void 0:i.phone)||"our reception desk"]})]})]})})]})})}const Ye=Ft.omit({hotelId:!0,createdBy:!0,confirmedBy:!0,cancelledBy:!0,cancellationReason:!0});function As(){var me;const{user:t}=_e(),{toast:d}=Ke(),n=wt(),[m,o]=y.useState(!1),[i,x]=y.useState(!1),[g,f]=y.useState(null),[S,P]=y.useState(!1),[p,w]=y.useState(""),[q,M]=y.useState(!1),[u,b]=y.useState(!1),[N,V]=y.useState(null),{data:r=[]}=ie({queryKey:["/api/halls"],refetchInterval:3e3,enabled:!!(t!=null&&t.hotelId)}),{data:C=[]}=ie({queryKey:["/api/hotels",t==null?void 0:t.hotelId,"hall-bookings"],refetchInterval:3e3,enabled:!!(t!=null&&t.hotelId)}),_=Ae({resolver:De(Ye),defaultValues:{hallId:"",customerName:"",customerEmail:"",customerPhone:"",bookingStartTime:new Date,bookingEndTime:new Date,numberOfPeople:0,hallBasePrice:"0",totalAmount:"0",advancePaid:"0",balanceDue:"0",paymentMethod:"",specialRequests:"",status:"pending"}});_.watch("hallId"),_.watch("numberOfPeople"),_.watch("hallBasePrice");const T=Ae({resolver:De(Ye.partial()),defaultValues:{customerName:"",customerEmail:"",customerPhone:"",bookingStartTime:new Date,bookingEndTime:new Date,numberOfPeople:0,hallBasePrice:"0",totalAmount:"0",advancePaid:"0",balanceDue:"0",paymentMethod:"",specialRequests:""}}),L=s=>{const F=parseFloat(s||"0"),G=parseFloat(T.getValues("totalAmount")||"0");T.setValue("balanceDue",(G-F).toFixed(2))},ee=s=>{const F=parseFloat(s||"0"),G=parseFloat(T.getValues("advancePaid")||"0");T.setValue("balanceDue",(F-G).toFixed(2))},J=ce({mutationFn:async s=>await ae("POST",`/api/halls/${s.hallId}/check-availability`,{startTime:s.startTime.toISOString(),endTime:s.endTime.toISOString(),excludeBookingId:s.excludeBookingId})});ce({mutationFn:async s=>{if(!(await J.mutateAsync({hallId:s.hallId,startTime:s.bookingStartTime,endTime:s.bookingEndTime})).available)throw new Error("Hall is not available for the selected time");await ae("POST",`/api/hotels/${t==null?void 0:t.hotelId}/hall-bookings`,{...s,bookingStartTime:s.bookingStartTime.toISOString(),bookingEndTime:s.bookingEndTime.toISOString()})},onSuccess:()=>{n.invalidateQueries({queryKey:["/api/hotels",t==null?void 0:t.hotelId,"hall-bookings"]}),d({title:"Booking created successfully"}),_.reset(),o(!1)},onError:s=>{d({title:"Booking failed",description:s.message||"Failed to create booking",variant:"destructive"})}});const l=ce({mutationFn:async s=>{var G,a;if((s.bookingStartTime||s.bookingEndTime)&&!(await J.mutateAsync({hallId:g.hallId,startTime:s.bookingStartTime||new Date(g.bookingStartTime),endTime:s.bookingEndTime||new Date(g.bookingEndTime),excludeBookingId:g.id})).available)throw new Error("Hall is not available for the selected time");const F={...s,bookingStartTime:(G=s.bookingStartTime)==null?void 0:G.toISOString(),bookingEndTime:(a=s.bookingEndTime)==null?void 0:a.toISOString()};await ae("PUT",`/api/hall-bookings/${g.id}`,F)},onSuccess:()=>{n.invalidateQueries({queryKey:["/api/hotels",t==null?void 0:t.hotelId,"hall-bookings"]}),d({title:"Booking updated successfully"}),T.reset(),x(!1),f(null)},onError:s=>{d({title:"Update failed",description:s.message||"Failed to update booking",variant:"destructive"})}}),j=ce({mutationFn:async s=>{await ae("POST",`/api/hall-bookings/${s}/confirm`,{})},onSuccess:()=>{n.invalidateQueries({queryKey:["/api/hotels",t==null?void 0:t.hotelId,"hall-bookings"]}),d({title:"Booking confirmed successfully"})}}),c=ce({mutationFn:async({bookingId:s,reason:F})=>{await ae("POST",`/api/hall-bookings/${s}/cancel`,{reason:F})},onSuccess:()=>{n.invalidateQueries({queryKey:["/api/hotels",t==null?void 0:t.hotelId,"hall-bookings"]}),d({title:"Booking cancelled successfully"}),P(!1),f(null),w("")}}),R=s=>{f(s),T.reset({customerName:s.customerName,customerEmail:s.customerEmail||"",customerPhone:s.customerPhone||"",bookingStartTime:s.bookingStartTime?new Date(s.bookingStartTime):new Date,bookingEndTime:s.bookingEndTime?new Date(s.bookingEndTime):new Date,numberOfPeople:s.numberOfPeople||0,hallBasePrice:s.hallBasePrice||"0",totalAmount:s.totalAmount||"0",advancePaid:s.advancePaid||"0",balanceDue:s.balanceDue||"0",paymentMethod:s.paymentMethod||"",specialRequests:s.specialRequests||""}),x(!0)},W=s=>{f(s),P(!0)},re=s=>{const F={pending:{variant:"secondary",icon:ke},confirmed:{variant:"default",icon:Ie},cancelled:{variant:"destructive",icon:Re}},G=F[s]||F.pending,a=G.icon;return e.jsxs(Bt,{variant:G.variant,"data-testid":`badge-status-${s}`,children:[e.jsx(a,{className:"w-3 h-3 mr-1"}),s.charAt(0).toUpperCase()+s.slice(1)]})},ne=s=>s?{cash:"Cash",cheque:"Cheque",pos:"POS/Card",fonepay:"Fonepay",bank_transfer:"Bank Transfer"}[s]||s:"N/A",te=C.filter(s=>s.status==="pending"||s.status==="quotation"),Y=C.filter(s=>s.status==="confirmed"||s.status==="deposit_pending"||s.status==="in_progress"||s.status==="completed"),de=C.filter(s=>s.status==="cancelled"),oe=((me=t==null?void 0:t.role)==null?void 0:me.name)||"",X=["manager","owner","super_admin"].includes(oe),xe=oe==="finance";return e.jsx(Ct,{title:"Hall Bookings",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"heading-hall-bookings",children:"Hall Bookings"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage hall reservations and events"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Le,{href:"/dashboard/hall-calendar",children:e.jsxs(O,{variant:"outline","data-testid":"button-calendar-view",children:[e.jsx(It,{className:"w-4 h-4 mr-2"}),"Calendar View"]})}),X&&e.jsxs(O,{onClick:()=>o(!0),"data-testid":"button-create-booking",children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"New Booking"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(Z,{children:[e.jsxs(Pe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Te,{className:"text-sm font-medium",children:"Pending Bookings"}),e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(Ce,{children:e.jsx("div",{className:"text-2xl font-bold","data-testid":"text-pending-count",children:te.length})})]}),e.jsxs(Z,{children:[e.jsxs(Pe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Te,{className:"text-sm font-medium",children:"Confirmed Bookings"}),e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(Ce,{children:e.jsx("div",{className:"text-2xl font-bold","data-testid":"text-confirmed-count",children:Y.length})})]}),e.jsxs(Z,{children:[e.jsxs(Pe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Te,{className:"text-sm font-medium",children:"Cancelled Bookings"}),e.jsx(Re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(Ce,{children:e.jsx("div",{className:"text-2xl font-bold","data-testid":"text-cancelled-count",children:de.length})})]})]}),e.jsxs(Z,{children:[e.jsx(Pe,{children:e.jsx(Te,{children:"All Bookings"})}),e.jsx(Ce,{children:e.jsx("div",{className:"space-y-4",children:C.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8","data-testid":"text-no-bookings",children:"No bookings found. Create your first booking to get started."}):C.map(s=>{const F=r.find(G=>G.id===s.hallId);return e.jsxs("div",{className:"border rounded-lg p-4 space-y-3","data-testid":`card-booking-${s.id}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("h3",{className:"font-semibold","data-testid":`text-hall-name-${s.id}`,children:(F==null?void 0:F.name)||"Unknown Hall"}),re(s.status)]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Ze,{className:"w-3 h-3"}),e.jsx("span",{"data-testid":`text-customer-${s.id}`,children:s.customerName})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{size:"sm",variant:"outline",onClick:()=>{V(s),b(!0)},"data-testid":`button-print-quotation-${s.id}`,children:[e.jsx(zt,{className:"w-4 h-4 mr-1"}),"Quotation"]}),e.jsx(Le,{href:`/dashboard/bookings/${s.id}`,children:e.jsxs(O,{size:"sm",variant:"outline","data-testid":`button-view-${s.id}`,children:[e.jsx(Dt,{className:"w-4 h-4 mr-1"}),"View"]})}),(s.status==="quotation"||s.status==="confirmed")&&X&&e.jsxs(O,{size:"sm",variant:"default",onClick:()=>{f(s),M(!0)},"data-testid":`button-finalize-${s.id}`,children:[e.jsx($e,{className:"w-4 h-4 mr-1"}),"Finalize Billing"]}),s.status==="pending"&&X&&e.jsxs(e.Fragment,{children:[e.jsxs(O,{size:"sm",variant:"outline",onClick:()=>j.mutate(s.id),"data-testid":`button-confirm-${s.id}`,children:[e.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Confirm"]}),e.jsxs(O,{size:"sm",variant:"outline",onClick:()=>R(s),"data-testid":`button-edit-${s.id}`,children:[e.jsx(Et,{className:"w-4 h-4 mr-1"}),"Edit"]})]}),xe&&e.jsxs(O,{size:"sm",variant:"outline",onClick:()=>R(s),"data-testid":`button-edit-payment-${s.id}`,children:[e.jsx($e,{className:"w-4 h-4 mr-1"}),"Update Payment"]}),s.status!=="cancelled"&&X&&e.jsxs(O,{size:"sm",variant:"destructive",onClick:()=>W(s),"data-testid":`button-cancel-${s.id}`,children:[e.jsx(Re,{className:"w-4 h-4 mr-1"}),"Cancel"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Start Time"}),e.jsx("p",{className:"font-medium","data-testid":`text-start-time-${s.id}`,children:s.bookingStartTime?U(new Date(s.bookingStartTime),"PPp"):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"End Time"}),e.jsx("p",{className:"font-medium","data-testid":`text-end-time-${s.id}`,children:s.bookingEndTime?U(new Date(s.bookingEndTime),"PPp"):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Total Amount"}),e.jsx("p",{className:"font-medium","data-testid":`text-total-${s.id}`,children:v(parseFloat(s.totalAmount||"0"))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Advance Paid"}),e.jsx("p",{className:"font-medium","data-testid":`text-advance-${s.id}`,children:v(parseFloat(s.advancePaid||"0"))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Balance Due"}),e.jsx("p",{className:"font-medium","data-testid":`text-balance-${s.id}`,children:v(parseFloat(s.balanceDue||"0"))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Payment Method"}),e.jsx("p",{className:"font-medium","data-testid":`text-payment-method-${s.id}`,children:ne(s.paymentMethod)})]})]}),s.specialRequests&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:"Special Requests"}),e.jsx("p",{className:"font-medium","data-testid":`text-special-requests-${s.id}`,children:s.specialRequests})]}),s.cancellationReason&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:"Cancellation Reason"}),e.jsx("p",{className:"font-medium text-destructive","data-testid":`text-cancel-reason-${s.id}`,children:s.cancellationReason})]})]},s.id)})})})]}),e.jsx(ls,{open:m,onOpenChange:o,onSuccess:()=>{n.invalidateQueries({queryKey:["/api/hotels",t==null?void 0:t.hotelId,"hall-bookings"]})}}),e.jsx(cs,{open:q,onOpenChange:M,booking:g,onSuccess:()=>{n.invalidateQueries({queryKey:["/api/hotels",t==null?void 0:t.hotelId,"hall-bookings"]})}}),N&&e.jsx(ds,{booking:N,open:u,onOpenChange:b}),e.jsx(ye,{open:i,onOpenChange:x,children:e.jsxs(Ne,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Be,{children:e.jsx(Fe,{children:xe?"Update Payment Details":"Edit Booking"})}),e.jsx(Ge,{...T,children:e.jsxs("form",{onSubmit:T.handleSubmit(s=>l.mutate(s)),className:"space-y-4",children:[!xe&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(I,{control:T.control,name:"customerName",render:({field:s})=>e.jsxs(A,{children:[e.jsx(D,{children:"Customer Name"}),e.jsx(E,{children:e.jsx($,{...s,placeholder:"Enter customer name","data-testid":"input-edit-customer-name"})}),e.jsx(B,{})]})}),e.jsx(I,{control:T.control,name:"customerPhone",render:({field:s})=>e.jsxs(A,{children:[e.jsx(D,{children:"Phone Number"}),e.jsx(E,{children:e.jsx($,{...s,placeholder:"Enter phone number","data-testid":"input-edit-customer-phone"})}),e.jsx(B,{})]})})]}),e.jsx(I,{control:T.control,name:"customerEmail",render:({field:s})=>e.jsxs(A,{children:[e.jsx(D,{children:"Email"}),e.jsx(E,{children:e.jsx($,{...s,type:"email",placeholder:"Enter email","data-testid":"input-edit-customer-email"})}),e.jsx(B,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(I,{control:T.control,name:"numberOfPeople",render:({field:s})=>e.jsxs(A,{children:[e.jsx(D,{children:"Number of People"}),e.jsx(E,{children:e.jsx($,{...s,type:"number",placeholder:"0","data-testid":"input-edit-num-people"})}),e.jsx(B,{})]})}),e.jsx(I,{control:T.control,name:"hallBasePrice",render:({field:s})=>e.jsxs(A,{children:[e.jsx(D,{children:"Hall Base Price"}),e.jsx(E,{children:e.jsx($,{...s,type:"number",step:"0.01",readOnly:!0,className:"bg-muted","data-testid":"input-edit-base-price"})}),e.jsx(B,{})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(I,{control:T.control,name:"totalAmount",render:({field:s})=>e.jsxs(A,{children:[e.jsx(D,{children:"Total Amount (Editable)"}),e.jsx(E,{children:e.jsx($,{...s,type:"number",step:"0.01",placeholder:"0.00","data-testid":"input-edit-total",onChange:F=>{s.onChange(F),ee(F.target.value)}})}),e.jsx(B,{})]})}),e.jsx(I,{control:T.control,name:"paymentMethod",render:({field:s})=>e.jsxs(A,{children:[e.jsx(D,{children:"Payment Method"}),e.jsxs(fe,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(E,{children:e.jsx(je,{"data-testid":"select-edit-payment-method",children:e.jsx(ge,{placeholder:"Select payment method"})})}),e.jsxs(ve,{children:[e.jsx(K,{value:"cash","data-testid":"option-edit-payment-cash",children:"Cash"}),e.jsx(K,{value:"card","data-testid":"option-edit-payment-card",children:"Card"}),e.jsx(K,{value:"bank_transfer","data-testid":"option-edit-payment-bank",children:"Bank Transfer"})]})]}),e.jsx(B,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(I,{control:T.control,name:"advancePaid",render:({field:s})=>e.jsxs(A,{children:[e.jsx(D,{children:"Advance Paid"}),e.jsx(E,{children:e.jsx($,{...s,type:"number",step:"0.01",placeholder:"0.00","data-testid":"input-edit-advance",onChange:F=>{s.onChange(F),L(F.target.value)}})}),e.jsx(B,{})]})}),e.jsx(I,{control:T.control,name:"balanceDue",render:({field:s})=>e.jsxs(A,{children:[e.jsx(D,{children:"Balance Due (Auto-calculated)"}),e.jsx(E,{children:e.jsx($,{...s,type:"number",step:"0.01",placeholder:"0.00",readOnly:!0,className:"bg-muted","data-testid":"input-edit-balance"})}),e.jsx(B,{})]})})]}),e.jsx(I,{control:T.control,name:"specialRequests",render:({field:s})=>e.jsxs(A,{children:[e.jsx(D,{children:"Special Requests"}),e.jsx(E,{children:e.jsx(Ee,{...s,placeholder:"Enter any special requests","data-testid":"input-edit-special-requests"})}),e.jsx(B,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(O,{type:"button",variant:"outline",onClick:()=>x(!1),"data-testid":"button-cancel-edit",children:"Cancel"}),e.jsx(O,{type:"submit",disabled:l.isPending,"data-testid":"button-submit-edit",children:l.isPending?"Updating...":"Update Booking"})]})]})})]})}),e.jsx(ye,{open:S,onOpenChange:P,children:e.jsxs(Ne,{children:[e.jsx(Be,{children:e.jsx(Fe,{children:"Cancel Booking"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Are you sure you want to cancel this booking? Please provide a reason."}),e.jsx(Ee,{value:p,onChange:s=>w(s.target.value),placeholder:"Enter cancellation reason","data-testid":"input-cancel-reason"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(O,{variant:"outline",onClick:()=>P(!1),"data-testid":"button-cancel-cancel",children:"Close"}),e.jsx(O,{variant:"destructive",onClick:()=>c.mutate({bookingId:g.id,reason:p}),disabled:!p.trim()||c.isPending,"data-testid":"button-submit-cancel",children:c.isPending?"Cancelling...":"Cancel Booking"})]})]})]})})]})})}export{As as default};
