import{r as p,b as P,l as j,d as O,j as e,C as i,a as c,s as o,I as g,B as f}from"./index-CuDmVYun.js";import{D as A,i as y,o as v,q as D}from"./dashboard-layout-RBv1DXX2.js";import{D as M}from"./data-table-B69p7Klv.js";import{S as K,a as Q,b as U,c as V,d as n}from"./select-7c0Tajxe.js";import{T as z}from"./textarea-CpuNoaOI.js";import{D as _,a as $,b as H,c as J}from"./dialog-CYNkLpdV.js";import{B as X}from"./badge-DMaRL5Qw.js";import{t as m}from"./index-hq1wgpuD.js";import"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";function ce(){const[N,l]=p.useState(!1),[s,r]=p.useState({leaveType:"",startDate:"",endDate:"",reason:""}),b=P(),{data:d=[],isLoading:q}=j({queryKey:["/api/hotels/current/leave-requests/my-requests"],refetchInterval:3e3}),{data:S=[]}=j({queryKey:["/api/leave-balances"],refetchInterval:3e3}),x=O({mutationFn:async t=>{const a=await fetch("/api/hotels/current/leave-requests",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(!a.ok){const h=await a.json();throw new Error(h.message||"Failed to create leave request")}return a.json()},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/hotels/current/leave-requests/my-requests"]}),l(!1),r({leaveType:"",startDate:"",endDate:"",reason:""}),m.success("Leave request submitted successfully")},onError:t=>{m.error(t.message)}}),w=()=>{if(!s.leaveType||!s.startDate||!s.endDate){m.error("Please fill in all required fields");return}if(new Date(s.endDate)<new Date(s.startDate)){m.error("End date must be after start date");return}x.mutate(s)},C=t=>{switch(t){case"approved":return e.jsx(v,{className:"h-4 w-4 text-green-500"});case"rejected":return e.jsx(D,{className:"h-4 w-4 text-red-500"});default:return e.jsx(y,{className:"h-4 w-4 text-orange-500"})}},T=t=>{switch(t){case"approved":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-orange-100 text-orange-800 border-orange-200"}},u=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),R=(t,a)=>{const h=new Date(t),B=new Date(a),E=Math.abs(B.getTime()-h.getTime());return Math.ceil(E/(1e3*60*60*24))+1},L=[{key:"leaveType",label:"Type",sortable:!0,render:t=>e.jsx("span",{className:"font-medium capitalize",children:t==null?void 0:t.replace(/_/g," ")})},{key:"startDate",label:"Start Date",sortable:!0,render:t=>u(t)},{key:"endDate",label:"End Date",sortable:!0,render:t=>u(t)},{key:"duration",label:"Duration",render:(t,a)=>e.jsxs("span",{className:"text-sm text-muted-foreground",children:[R(a.startDate,a.endDate)," day(s)"]})},{key:"status",label:"Status",render:t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[C(t),e.jsx(X,{variant:"outline",className:T(t),children:(t==null?void 0:t.charAt(0).toUpperCase())+(t==null?void 0:t.slice(1))})]})},{key:"reason",label:"Reason",render:t=>e.jsx("span",{className:"text-sm text-muted-foreground max-w-xs truncate",children:t||"No reason provided"})},{key:"managerNotes",label:"Manager Notes",render:t=>e.jsx("span",{className:"text-sm text-muted-foreground max-w-xs truncate",children:t||"-"})},{key:"createdAt",label:"Submitted",sortable:!0,render:t=>u(t)}],k=d.filter(t=>t.status==="pending").length,F=d.filter(t=>t.status==="approved").length,I=d.filter(t=>t.status==="rejected").length;return e.jsx(A,{title:"Leave Requests",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:S.map(t=>e.jsx(i,{"data-testid":`balance-card-${t.leaveType}`,children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-muted-foreground capitalize",children:[t.leaveType.replace(/_/g," ")," Leave Balance"]}),e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsx("p",{className:"text-3xl font-bold","data-testid":`balance-remaining-${t.leaveType}`,children:parseFloat(t.remainingDays)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["/ ",parseFloat(t.totalDays)," days"]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Used: ",parseFloat(t.usedDays)," days"]})]})})},t.id))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(i,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold",children:k})]}),e.jsx(y,{className:"h-8 w-8 text-orange-500"})]})})}),e.jsx(i,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold",children:F})]}),e.jsx(v,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(i,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold",children:I})]}),e.jsx(D,{className:"h-8 w-8 text-red-500"})]})})})]}),e.jsx(M,{title:"My Leave Requests",data:d,columns:L,isLoading:q,onAdd:()=>l(!0),addButtonLabel:"Request Leave",searchPlaceholder:"Search leave requests..."}),e.jsx(_,{open:N,onOpenChange:l,children:e.jsxs($,{className:"max-w-md",children:[e.jsx(H,{children:e.jsx(J,{children:"Request Leave"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"leaveType",children:"Leave Type *"}),e.jsxs(K,{value:s.leaveType,onValueChange:t=>r({...s,leaveType:t}),children:[e.jsx(Q,{children:e.jsx(U,{placeholder:"Select leave type"})}),e.jsxs(V,{children:[e.jsx(n,{value:"sick",children:"Sick Leave"}),e.jsx(n,{value:"vacation",children:"Vacation"}),e.jsx(n,{value:"personal",children:"Personal Leave"}),e.jsx(n,{value:"emergency",children:"Emergency Leave"}),e.jsx(n,{value:"family",children:"Family Leave"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"startDate",children:"Start Date *"}),e.jsx(g,{id:"startDate",type:"date",value:s.startDate,onChange:t=>r({...s,startDate:t.target.value}),min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"endDate",children:"End Date *"}),e.jsx(g,{id:"endDate",type:"date",value:s.endDate,onChange:t=>r({...s,endDate:t.target.value}),min:s.startDate||new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"reason",children:"Reason"}),e.jsx(z,{id:"reason",value:s.reason,onChange:t=>r({...s,reason:t.target.value}),placeholder:"Please provide a reason for your leave request",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(f,{variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsx(f,{onClick:w,disabled:x.isPending,children:x.isPending?"Submitting...":"Submit Request"})]})]})]})})]})})}export{ce as default};
