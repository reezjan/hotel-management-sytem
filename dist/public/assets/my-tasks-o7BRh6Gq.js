import{q as g,u as j,b as y,l as f,d as N,j as e,C as i,a as d,m as b,n as v,B as l,k as C}from"./index-CuDmVYun.js";import{D as T,i as w,I as k}from"./dashboard-layout-RBv1DXX2.js";import{C as M}from"./circle-alert-CPwmOhkC.js";import{f as $}from"./format-BOBWS5Wu.js";import"./users-DXv82DeH.js";function _(){const{user:r}=g(),{toast:n}=j(),c=y(),{data:o=[],isLoading:x}=f({queryKey:["/api/hotels/current/security/tasks"],refetchInterval:3e3}),a=N({mutationFn:async({taskId:s,status:h})=>await C("PATCH",`/api/tasks/${s}/status`,{status:h}),onSuccess:()=>{c.invalidateQueries({queryKey:["/api/hotels/current/security/tasks"]}),n({title:"Task status updated successfully"})},onError:s=>{n({title:"Failed to update task",description:s.message||"An error occurred",variant:"destructive"})}}),t=o.filter(s=>s.assignedTo===(r==null?void 0:r.id)),u=t.filter(s=>s.status==="pending"),m=t.filter(s=>s.status==="in_progress"),p=t.filter(s=>s.status==="completed");return e.jsx(T,{title:"My Tasks",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(i,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold",children:u.length})]}),e.jsx(w,{className:"h-10 w-10 text-orange-500"})]})})}),e.jsx(i,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"In Progress"}),e.jsx("p",{className:"text-3xl font-bold",children:m.length})]}),e.jsx(M,{className:"h-10 w-10 text-blue-500"})]})})}),e.jsx(i,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold",children:p.length})]}),e.jsx(k,{className:"h-10 w-10 text-green-500"})]})})})]}),e.jsxs(i,{children:[e.jsx(b,{children:e.jsx(v,{children:"My Assigned Tasks"})}),e.jsx(d,{children:x?e.jsx("div",{className:"text-center py-8","data-testid":"loading-tasks",children:"Loading tasks..."}):t.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground","data-testid":"no-tasks",children:"No tasks assigned yet."}):e.jsx("div",{className:"space-y-4",children:t.map(s=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors","data-testid":`task-${s.id}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h4",{className:"font-medium","data-testid":`task-title-${s.id}`,children:s.title}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${s.priority==="high"?"bg-red-100 text-red-800":s.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:s.priority}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="in_progress"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,"data-testid":`task-status-${s.id}`,children:s.status.replace("_"," ")})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.description}),s.dueDate&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Due: ",$(new Date(s.dueDate),"MMM dd, yyyy HH:mm")]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[s.status==="pending"&&e.jsx(l,{size:"sm",onClick:()=>a.mutate({taskId:s.id,status:"in_progress"}),disabled:a.isPending,"data-testid":`button-start-${s.id}`,children:"Start"}),s.status==="in_progress"&&e.jsx(l,{size:"sm",variant:"outline",onClick:()=>a.mutate({taskId:s.id,status:"completed"}),disabled:a.isPending,"data-testid":`button-complete-${s.id}`,children:"Complete"})]})]})},s.id))})})]})]})})}export{_ as default};
