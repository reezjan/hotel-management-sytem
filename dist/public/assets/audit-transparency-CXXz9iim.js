import{o as Q,r as E,l as m,j as e,B as R,C as i,m as n,n as d,a as c,y as h,p as z}from"./index-CuDmVYun.js";import{T as G,a as V,b as p,c as f}from"./tabs-CX8s-N0D.js";import{B as u}from"./badge-DMaRL5Qw.js";import{C as J}from"./calendar-eJamnjJO.js";import{P as W,a as X,b as Y}from"./popover-B3_UkTKl.js";import{u as B}from"./use-realtime-query-CGmARpos.js";import{A as Z,C as ee,H as te,D as se,S as ae,T as M,P as K,U as q,F as re}from"./users-DXv82DeH.js";import{f as H}from"./format-BOBWS5Wu.js";import"./index-D12ZMnos.js";import"./addWeeks-Pc006p7j.js";import"./startOfMonth-CkZi6Jlw.js";import"./use-websocket-CCUHb1Px.js";function je(){var P,C,A,I,L,D,F,k;const[,U]=Q(),[a,_]=E.useState({from:void 0,to:void 0}),{data:b=[]}=m({queryKey:["/api/hotels/current/transactions"]}),{data:w=[]}=m({queryKey:["/api/hotels/current/maintenance-requests"]});B({queryKey:["/api/hotels/current/transactions"],events:["transaction:created","transaction:updated"]}),B({queryKey:["/api/hotels/current/maintenance-requests"],events:["maintenance:updated"]});const $=a.from&&a.to?b.filter(t=>{const s=new Date(t.createdAt);return s>=a.from&&s<=a.to}):b,S=a.from&&a.to?w.filter(t=>{const s=new Date(t.createdAt);return s>=a.from&&s<=a.to}):w,j=(t,s,r)=>{if(!s||!r)return t;const l=new URLSearchParams({startDate:s.toISOString(),endDate:r.toISOString()});return`${t}?${l.toString()}`},{data:y=[]}=m({queryKey:["/api/audit-logs",(P=a.from)==null?void 0:P.toISOString(),(C=a.to)==null?void 0:C.toISOString()],queryFn:async()=>{const t=j("/api/audit-logs",a.from,a.to),s=await fetch(t,{credentials:"include"});return s.ok?s.json():[]},refetchInterval:5e3}),{data:N=[]}=m({queryKey:["/api/price-change-logs",(A=a.from)==null?void 0:A.toISOString(),(I=a.to)==null?void 0:I.toISOString()],queryFn:async()=>{const t=j("/api/price-change-logs",a.from,a.to),s=await fetch(t,{credentials:"include"});return s.ok?s.json():[]},refetchInterval:1e4}),{data:T=[]}=m({queryKey:["/api/tax-change-logs"],queryFn:async()=>{const t=await fetch("/api/tax-change-logs",{credentials:"include"});return t.ok?t.json():[]},refetchInterval:3e4}),{data:g=[]}=m({queryKey:["/api/inventory-movement-logs",(L=a.from)==null?void 0:L.toISOString(),(D=a.to)==null?void 0:D.toISOString()],queryFn:async()=>{const t=j("/api/inventory-movement-logs",a.from,a.to),s=await fetch(t,{credentials:"include"});return s.ok?s.json():[]},refetchInterval:1e4}),{data:v=[]}=m({queryKey:["/api/staff-activity-summary",(F=a.from)==null?void 0:F.toISOString(),(k=a.to)==null?void 0:k.toISOString()],queryFn:async()=>{const t=j("/api/staff-activity-summary",a.from,a.to),s=await fetch(t,{credentials:"include"});return s.ok?s.json():[]},refetchInterval:1e4});return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(R,{variant:"outline",size:"icon",onClick:()=>U("/owner"),"data-testid":"button-back",children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"heading-audit-transparency",children:"Audit & Transparency"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete visibility into all hotel operations and changes"})]})]}),e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsxs(R,{variant:"outline","data-testid":"button-date-range",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),a.from&&a.to?`${H(a.from,"PPP")} - ${H(a.to,"PPP")}`:"Select date range (optional)"]})}),e.jsx(Y,{className:"w-auto p-0",align:"end",children:e.jsx(J,{mode:"range",selected:{from:a.from,to:a.to},onSelect:t=>_({from:t==null?void 0:t.from,to:t==null?void 0:t.to}),numberOfMonths:2})})]})]}),e.jsxs(G,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(V,{children:[e.jsxs(p,{value:"overview","data-testid":"tab-overview",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Overview"]}),e.jsxs(p,{value:"financial","data-testid":"tab-financial",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Financial Activity"]}),e.jsxs(p,{value:"maintenance","data-testid":"tab-maintenance",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Maintenance Approvals"]}),e.jsxs(p,{value:"price-changes","data-testid":"tab-price-changes",children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Price Changes"]}),e.jsxs(p,{value:"inventory","data-testid":"tab-inventory",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Inventory Movements"]}),e.jsxs(p,{value:"staff","data-testid":"tab-staff",children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Staff Activity"]})]}),e.jsxs(f,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(i,{"data-testid":"card-total-logs",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Total Audit Logs"}),e.jsx(re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold","data-testid":"text-audit-count",children:y.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"In selected period"})]})]}),e.jsxs(i,{"data-testid":"card-price-changes",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Price Changes"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold","data-testid":"text-price-changes",children:N.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Items updated"})]})]}),e.jsxs(i,{"data-testid":"card-inventory-movements",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Inventory Movements"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold","data-testid":"text-inventory-count",children:g.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Transactions recorded"})]})]}),e.jsxs(i,{"data-testid":"card-active-staff",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Active Staff"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold","data-testid":"text-staff-count",children:new Set(v.map(t=>t.userId)).size}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Performed actions"})]})]})]}),e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(d,{children:"Recent Audit Logs"}),e.jsx(h,{children:"Latest system activities and changes"})]}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[y.slice(0,10).map(t=>e.jsxs("div",{className:"flex items-start justify-between border-b pb-4","data-testid":`log-${t.id}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm font-medium","data-testid":`text-log-action-${t.id}`,children:[t.action," - ",t.resourceType]}),e.jsx("p",{className:"text-xs text-muted-foreground","data-testid":`text-log-time-${t.id}`,children:new Date(t.createdAt).toLocaleString()})]}),e.jsx(u,{variant:t.success?"default":"destructive","data-testid":`badge-log-status-${t.id}`,children:t.success?"Success":"Failed"})]},t.id)),y.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8","data-testid":"text-no-logs",children:"No audit logs found in the selected period."})]})})]})]}),e.jsx(f,{value:"financial",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(d,{children:"Financial Transaction History"}),e.jsx(h,{children:"Complete audit trail of all financial transactions with creator information"})]}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[$.map(t=>{var s,r,l,o,x,O;return e.jsxs("div",{className:"flex items-start justify-between border-b pb-4","data-testid":`transaction-${t.id}`,children:[e.jsxs("div",{className:"space-y-1 flex-1",children:[e.jsx("p",{className:"text-sm font-medium","data-testid":`text-txn-purpose-${t.id}`,children:t.purpose||"Transaction"}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{"data-testid":`text-txn-type-${t.id}`,children:["Type: ",(s=t.txnType)==null?void 0:s.replace(/_/g," ")]}),e.jsxs("span",{"data-testid":`text-txn-amount-${t.id}`,children:["Amount: NPR ",parseFloat(t.amount||0).toLocaleString()]}),t.paymentMethod&&e.jsxs("span",{"data-testid":`text-payment-method-${t.id}`,children:["Method: ",t.paymentMethod]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground","data-testid":`text-created-by-${t.id}`,children:["Created by: ",((r=t.creator)==null?void 0:r.username)||"Unknown"," (",((o=(l=t.creator)==null?void 0:l.role)==null?void 0:o.replace(/_/g," "))||"N/A",") on"," ",new Date(t.createdAt).toLocaleString()]}),t.reference&&e.jsxs("p",{className:"text-xs text-muted-foreground","data-testid":`text-reference-${t.id}`,children:["Reference: ",t.reference]})]}),e.jsx(u,{variant:t.txnType==="revenue"||(x=t.txnType)!=null&&x.includes("_in")?"default":t.txnType==="expense"||(O=t.txnType)!=null&&O.includes("_out")?"destructive":"secondary","data-testid":`badge-txn-type-${t.id}`,children:z(parseFloat(t.amount||0))})]},t.id)}),$.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8","data-testid":"text-no-transactions",children:"No financial transactions found."})]})})]})}),e.jsx(f,{value:"maintenance",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(d,{children:"Maintenance Request History"}),e.jsx(h,{children:"Track all maintenance requests with approval status and history"})]}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[S.map(t=>{var s,r,l,o,x;return e.jsxs("div",{className:"flex items-start justify-between border-b pb-4","data-testid":`maintenance-${t.id}`,children:[e.jsxs("div",{className:"space-y-1 flex-1",children:[e.jsx("p",{className:"text-sm font-medium","data-testid":`text-request-title-${t.id}`,children:t.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Location: ",t.location||"N/A"]}),e.jsxs("p",{className:"text-xs text-muted-foreground","data-testid":`text-reported-by-${t.id}`,children:["Reported by: ",((s=t.reportedBy)==null?void 0:s.username)||"Unknown"," (",((o=(l=(r=t.reportedBy)==null?void 0:r.role)==null?void 0:l.name)==null?void 0:o.replace(/_/g," "))||"N/A",")"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Priority: ",e.jsx(u,{variant:t.priority==="high"?"destructive":t.priority==="medium"?"default":"secondary",children:t.priority})]}),e.jsxs("p",{className:"text-xs text-muted-foreground","data-testid":`text-request-date-${t.id}`,children:["Submitted: ",new Date(t.createdAt).toLocaleString()]})]}),e.jsx(u,{variant:t.status==="approved"?"default":t.status==="resolved"?"secondary":t.status==="declined"?"destructive":"outline","data-testid":`badge-status-${t.id}`,children:((x=t.status)==null?void 0:x.toUpperCase())||"PENDING"})]},t.id)}),S.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8","data-testid":"text-no-maintenance",children:"No maintenance requests found."})]})})]})}),e.jsxs(f,{value:"price-changes",className:"space-y-4",children:[e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(d,{children:"Price Change History"}),e.jsx(h,{children:"Track all pricing modifications with who made them"})]}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[N.map(t=>{var s,r;return e.jsxs("div",{className:"flex items-start justify-between border-b pb-4","data-testid":`price-change-${t.id}`,children:[e.jsxs("div",{className:"space-y-1 flex-1",children:[e.jsxs("p",{className:"text-sm font-medium","data-testid":`text-item-name-${t.id}`,children:[t.itemName," (",t.itemType,")"]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{"data-testid":`text-old-price-${t.id}`,children:["Old: NPR ",parseFloat(t.previousPrice||0).toLocaleString()]}),e.jsx("span",{children:"→"}),e.jsxs("span",{"data-testid":`text-new-price-${t.id}`,children:["New: NPR ",parseFloat(t.newPrice||0).toLocaleString()]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground","data-testid":`text-changed-by-${t.id}`,children:["Changed by: ",(s=t.changedBy)==null?void 0:s.username," (",(r=t.changedBy)==null?void 0:r.role,") on"," ",new Date(t.createdAt).toLocaleString()]})]}),e.jsx(u,{variant:parseFloat(t.newPrice)>parseFloat(t.previousPrice)?"default":"secondary","data-testid":`badge-price-trend-${t.id}`,children:parseFloat(t.newPrice)>parseFloat(t.previousPrice)?"Increase":"Decrease"})]},t.id)}),N.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8","data-testid":"text-no-price-changes",children:"No price changes recorded."})]})})]}),T.length>0&&e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(d,{children:"Tax Configuration Changes"}),e.jsx(h,{children:"History of tax rate modifications"})]}),e.jsx(c,{children:e.jsx("div",{className:"space-y-4",children:T.map(t=>{var s;return e.jsx("div",{className:"flex items-start justify-between border-b pb-4","data-testid":`tax-change-${t.id}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium","data-testid":`text-tax-type-${t.id}`,children:t.taxType}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{"data-testid":`text-old-tax-${t.id}`,children:["Old: ",t.previousPercent,"%"]}),e.jsx("span",{children:"→"}),e.jsxs("span",{"data-testid":`text-new-tax-${t.id}`,children:["New: ",t.newPercent,"%"]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground","data-testid":`text-tax-changed-by-${t.id}`,children:["Changed by: ",(s=t.changedBy)==null?void 0:s.username," on ",new Date(t.createdAt).toLocaleString()]})]})},t.id)})})})]})]}),e.jsx(f,{value:"inventory",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(d,{children:"Inventory Movement Tracking"}),e.jsx(h,{children:"Detailed logs of all stock movements with responsible persons"})]}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[g.map(t=>{var s,r,l,o,x;return e.jsxs("div",{className:"flex items-start justify-between border-b pb-4","data-testid":`inventory-movement-${t.id}`,children:[e.jsxs("div",{className:"space-y-1 flex-1",children:[e.jsxs("p",{className:"text-sm font-medium","data-testid":`text-item-${t.id}`,children:[(s=t.item)==null?void 0:s.name," (",(r=t.item)==null?void 0:r.sku,")"]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{"data-testid":`text-qty-${t.id}`,children:["Qty: ",t.qtyPackage," ",(l=t.item)==null?void 0:l.unit]}),t.department&&e.jsxs("span",{"data-testid":`text-dept-${t.id}`,children:["Dept: ",t.department]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground","data-testid":`text-recorded-by-${t.id}`,children:["Recorded by: ",(o=t.recordedBy)==null?void 0:o.username," (",(x=t.recordedBy)==null?void 0:x.role,")",t.issuedTo&&` | Issued to: ${t.issuedTo.username} (${t.issuedTo.role})`]}),t.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground","data-testid":`text-notes-${t.id}`,children:["Notes: ",t.notes]}),e.jsx("p",{className:"text-xs text-muted-foreground","data-testid":`text-time-${t.id}`,children:new Date(t.createdAt).toLocaleString()})]}),e.jsx(u,{"data-testid":`badge-transaction-type-${t.id}`,children:t.transactionType})]},t.id)}),g.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8","data-testid":"text-no-inventory",children:"No inventory movements recorded."})]})})]})}),e.jsx(f,{value:"staff",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(d,{children:"Staff Activity Summary"}),e.jsx(h,{children:"Overview of actions performed by each staff member"})]}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[v.map((t,s)=>e.jsxs("div",{className:"flex items-start justify-between border-b pb-4","data-testid":`staff-activity-${s}`,children:[e.jsxs("div",{className:"space-y-1 flex-1",children:[e.jsxs("p",{className:"text-sm font-medium","data-testid":`text-staff-${s}`,children:[t.username," (",t.role,")"]}),e.jsxs("p",{className:"text-xs text-muted-foreground","data-testid":`text-activity-${s}`,children:[t.action," on ",t.resourceType]}),e.jsxs("p",{className:"text-xs text-muted-foreground","data-testid":`text-last-${s}`,children:["Last activity: ",new Date(t.lastActivity).toLocaleString()]})]}),e.jsxs(u,{"data-testid":`badge-count-${s}`,children:[t.count," times"]})]},s)),v.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8","data-testid":"text-no-staff-activity",children:"No staff activity recorded."})]})})]})})]})]})}export{je as default};
