import{q as P,u as D,b as L,r as y,l as A,d as I,j as e,C as l,a as c,m as f,n as b,y as N,B as w,s as n,I as h,k as $}from"./index-CuDmVYun.js";import{D as E,T as p,a as H}from"./dashboard-layout-RBv1DXX2.js";import{T as k}from"./textarea-CpuNoaOI.js";import{S as B,a as Q,b as V,c as K,d as j}from"./select-7c0Tajxe.js";import{f as O}from"./format-BOBWS5Wu.js";import"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";function ee(){const{user:o}=P(),{toast:r}=D(),C=L(),[m,g]=y.useState(!1),[s,i]=y.useState({title:"",location:"",description:"",priority:"medium",photo:""}),{data:S=[],isLoading:M}=A({queryKey:["/api/hotels/current/maintenance-requests"],refetchInterval:3e3}),u=I({mutationFn:async t=>await $("POST","/api/hotels/current/maintenance-requests",t),onSuccess:()=>{C.invalidateQueries({queryKey:["/api/hotels/current/maintenance-requests"]}),r({title:"Maintenance request sent to Security Head successfully"}),i({title:"",location:"",description:"",priority:"medium",photo:""}),g(!1)},onError:t=>{r({title:"Failed to send maintenance request",description:t.message||"An error occurred",variant:"destructive"})}}),R=t=>{if(t.preventDefault(),!s.title||!s.location){r({title:"Title and location are required",variant:"destructive"});return}if(!s.photo){r({title:"Photo is required",variant:"destructive"});return}u.mutate(s)},q=t=>{var v;const a=(v=t.target.files)==null?void 0:v[0];if(a){const x=new FileReader;x.onloadend=()=>{i({...s,photo:x.result})},x.readAsDataURL(a)}},d=S.filter(t=>{var a;return((a=t.reportedBy)==null?void 0:a.id)===(o==null?void 0:o.id)}),F=d.filter(t=>t.status==="pending"),T=d.filter(t=>t.status==="resolved");return e.jsx(E,{title:"Maintenance Reports",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending Requests"}),e.jsx("p",{className:"text-3xl font-bold",children:F.length})]}),e.jsx(p,{className:"h-10 w-10 text-orange-500"})]})})}),e.jsx(l,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Resolved Requests"}),e.jsx("p",{className:"text-3xl font-bold",children:T.length})]}),e.jsx(p,{className:"h-10 w-10 text-green-500"})]})})})]}),e.jsxs(l,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(b,{children:"Submit Maintenance Request"}),e.jsx(N,{children:"Report issues to Security Head"})]}),e.jsxs(w,{onClick:()=>g(!m),size:"sm","data-testid":"button-toggle-form",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),m?"Cancel":"New Request"]})]})}),m&&e.jsx(c,{children:e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"title",children:"Issue Title *"}),e.jsx(h,{id:"title","data-testid":"input-maintenance-title",value:s.title,onChange:t=>i({...s,title:t.target.value}),placeholder:"e.g., CCTV Camera Malfunction",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"location",children:"Location *"}),e.jsx(h,{id:"location","data-testid":"input-maintenance-location",value:s.location,onChange:t=>i({...s,location:t.target.value}),placeholder:"e.g., Main Entrance",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"priority",children:"Priority"}),e.jsxs(B,{value:s.priority,onValueChange:t=>i({...s,priority:t}),children:[e.jsx(Q,{"data-testid":"select-maintenance-priority",children:e.jsx(V,{})}),e.jsxs(K,{children:[e.jsx(j,{value:"low",children:"Low"}),e.jsx(j,{value:"medium",children:"Medium"}),e.jsx(j,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"description",children:"Description"}),e.jsx(k,{id:"description","data-testid":"textarea-maintenance-description",value:s.description,onChange:t=>i({...s,description:t.target.value}),placeholder:"Detailed description of the issue",rows:3})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"photo",children:"Photo *"}),e.jsx(h,{id:"photo",type:"file",accept:"image/*","data-testid":"input-maintenance-photo",onChange:q,required:!0}),s.photo&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.photo,alt:"Preview",className:"max-w-xs rounded border"})})]}),e.jsx(w,{type:"submit",disabled:u.isPending,"data-testid":"button-submit-maintenance",children:u.isPending?"Submitting...":"Submit Request"})]})})]}),e.jsxs(l,{children:[e.jsxs(f,{children:[e.jsx(b,{children:"My Maintenance Requests"}),e.jsx(N,{children:"Track your submitted requests"})]}),e.jsx(c,{children:M?e.jsx("div",{className:"text-center py-8","data-testid":"loading-maintenance",children:"Loading maintenance requests..."}):d.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground","data-testid":"no-maintenance",children:"No maintenance requests yet."}):e.jsx("div",{className:"space-y-3",children:d.map(t=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors","data-testid":`maintenance-${t.id}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(p,{className:"h-4 w-4 text-orange-500"}),e.jsx("h4",{className:"font-medium","data-testid":`maintenance-title-${t.id}`,children:t.title}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${t.priority==="high"?"bg-red-100 text-red-800":t.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:t.priority}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${t.status==="resolved"?"bg-green-100 text-green-800":t.status==="in_progress"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,"data-testid":`maintenance-status-${t.id}`,children:t.status.replace("_"," ")})]}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Location: ",t.location]}),e.jsx("span",{children:O(new Date(t.createdAt),"MMM dd, yyyy")})]})]})})},t.id))})})]})]})})}export{ee as default};
