import{l as i,j as e,C as l,m as p,n as j,a as o}from"./index-CuDmVYun.js";import{D as N,i as v,I as y,Q as k}from"./dashboard-layout-RBv1DXX2.js";import{B as u}from"./badge-DMaRL5Qw.js";import"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";function S(){const{data:f=[],isLoading:x}=i({queryKey:["/api/hotels/current/users"],queryFn:async()=>{const s=await fetch("/api/hotels/current/users",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch staff");return s.json()},refetchInterval:5e3,refetchIntervalInBackground:!0}),{data:m=[]}=i({queryKey:["/api/hotels/current/tasks"],queryFn:async()=>{const s=await fetch("/api/hotels/current/tasks",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch tasks");return s.json()},refetchInterval:5e3,refetchIntervalInBackground:!0}),{data:n=[]}=i({queryKey:["/api/attendance/daily"]}),d=f.filter(s=>{var a;return((a=s.role)==null?void 0:a.name)==="housekeeping_staff"}),c=s=>m.filter(a=>a.assignedTo===s),h=s=>{const a=c(s);return a.find(r=>r.status==="performing")||a.find(r=>r.status==="pending")};return e.jsx(N,{title:"Staff Tracking",children:e.jsx("div",{className:"space-y-6",children:e.jsxs(l,{children:[e.jsx(p,{children:e.jsx(j,{children:"Staff Activity Overview"})}),e.jsx(o,{children:x?e.jsx("p",{className:"text-muted-foreground",children:"Loading..."}):d.length===0?e.jsx("p",{className:"text-muted-foreground","data-testid":"no-staff",children:"No housekeeping staff found"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map((s,a)=>{const r=h(s.id),g=c(s.id).filter(t=>t.status==="completed").length;return e.jsx(l,{"data-testid":`staff-card-${a}`,children:e.jsxs(o,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground",children:s.username}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.phone})]}),e.jsx(u,{className:n.some(t=>t.userId===s.id&&t.status==="active")?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",variant:"secondary",children:n.some(t=>t.userId===s.id&&t.status==="active")?"On Duty":"Off Duty"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(v,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsxs("span",{className:"text-muted-foreground",children:["Last Active: ",s.lastLogin?new Date(s.lastLogin).toLocaleTimeString("en-GB",{timeZone:"Asia/Kathmandu"}):"Never"]})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(y,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsxs("span",{className:"text-muted-foreground",children:["Completed: ",g," tasks"]})]}),r&&e.jsx("div",{className:"mt-3 p-2 bg-blue-50 rounded border border-blue-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(k,{className:"h-4 w-4 mr-2 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Current Task"}),e.jsx("p",{className:"text-xs text-blue-700",children:r.title}),e.jsx(u,{className:"mt-1 bg-blue-100 text-blue-800 text-xs",variant:"secondary",children:r.status})]})]})}),!r&&n.some(t=>t.userId===s.id&&t.status==="active")&&e.jsx("div",{className:"mt-3 p-2 bg-gray-50 rounded border border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-600",children:"No active tasks"})})]})]})},s.id)})})})]})})})}export{S as default};
