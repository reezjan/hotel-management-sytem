import{q as ks,u as Cs,b as ws,r as g,l as L,d as he,j as e,s as Ce,I as y,p,B as d,k as T,o as Zs,v as Js,c as ht,C as me,m as ye,n as ke,a as ue,a2 as gs,F as xt,e as P,f as D,g as I,h as S,av as Mt,w as Xs}from"./index-CuDmVYun.js";import{D as ea,B as pt,U as gt,ah as fs,ai as ta,aj as js,ak as Rt,n as vs,s as sa,C as At,v as bs,a7 as aa,G as ft,al as qt,M as Ns,i as na}from"./dashboard-layout-RBv1DXX2.js";import{S as jt}from"./stats-card-CKM6aMdl.js";import{B as Re}from"./badge-DMaRL5Qw.js";import{T as vt}from"./textarea-CpuNoaOI.js";import{D as ee,a as te,b as se,c as ae}from"./dialog-CYNkLpdV.js";import{S as we,a as Pe,b as De,c as Ie,d as H}from"./select-7c0Tajxe.js";import{C as ia}from"./calendar-eJamnjJO.js";import{u as ra}from"./use-websocket-CCUHb1Px.js";import{u as He}from"./use-realtime-query-CGmARpos.js";import{U as Et,D as Lt,C as ys}from"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";import"./format-BOBWS5Wu.js";import"./addWeeks-Pc006p7j.js";import"./startOfMonth-CkZi6Jlw.js";function ca({open:a,onOpenChange:j,reservationId:C,roomId:Se}){const{user:G}=ks(),{toast:ne}=Cs(),Ue=ws(),[xe,_e]=g.useState(""),[U,Ke]=g.useState(""),[X,We]=g.useState(""),[Y,Ye]=g.useState(""),[ie,Ze]=g.useState(""),[Oe,Je]=g.useState(""),[pe,Z]=g.useState(0),[ge,A]=g.useState(""),{data:re=[]}=L({queryKey:["/api/services"],enabled:!!(G!=null&&G.hotelId)&&a});L({queryKey:["/api/hotels",G==null?void 0:G.hotelId,"rooms"],enabled:!!(G!=null&&G.hotelId)&&a});const{data:r=[]}=L({queryKey:["/api/hotels/current/reservations"],enabled:!!(G!=null&&G.hotelId)&&a}),x=re.find(o=>o.id===xe);r.find(o=>o.id===C);const Kt=!0,W=o=>{const f=(o==null?void 0:o.toLowerCase())||"";return f.includes("airport")||f.includes("transfer")||f.includes("tour guide")||f.includes("business center")?"fixed":f.includes("spa")||f.includes("jacuzzi")||f.includes("massage")||f.includes("sauna")||f.includes("beauty salon")?"hours":f.includes("laundry")?"kg":f.includes("gym")||f.includes("fitness")||f.includes("car rental")||f.includes("conference room")?"days":f.includes("other")?"custom":"quantity"},Te=o=>{const f=W(o);return f==="kg"?"kg":f==="hours"?"hour":f==="days"?"day":f==="fixed"?"service":"unit"};g.useEffect(()=>{if(x){const o=Number(x.priceInhouse||0),f=W(x.kind);let K=0;switch(f){case"kg":K=o*(Number(X)||0);break;case"hours":K=o*(Number(Y)||0);break;case"days":K=o*(Number(ie)||0);break;case"fixed":K=o;break;case"custom":K=o*(Number(U)||1);break;case"quantity":default:K=o*(Number(U)||0);break}Z(K)}else Z(0)},[x,U,X,Y,ie,Kt]);const fe=he({mutationFn:async o=>await T("POST","/api/hotels/current/room-service-charges",o),onSuccess:()=>{Ue.invalidateQueries({queryKey:["/api/hotels/current/room-service-charges"]}),Ue.invalidateQueries({queryKey:["/api/hotels/current/reservations"]}),ne({title:"Service charge added successfully"}),j(!1),w()},onError:o=>{ne({title:"Failed to add service charge",description:o.message,variant:"destructive"})}}),w=()=>{_e(""),Ke(""),We(""),Ye(""),Ze(""),Je(""),Z(0),A("")},je=re.filter(o=>{var K,ve;if(!ge.trim())return!0;const f=ge.toLowerCase();return((K=o.name)==null?void 0:K.toLowerCase().includes(f))||((ve=o.kind)==null?void 0:ve.toLowerCase().includes(f))}),Xe=()=>{if(!x||!C){ne({title:"Missing required fields",description:"Please select a service",variant:"destructive"});return}const o=W(x.kind);let f="";switch(o){case"kg":if(!X){ne({title:"Missing weight",description:"Please enter weight in kg",variant:"destructive"});return}f=X;break;case"hours":if(!Y){ne({title:"Missing hours",description:"Please enter number of hours",variant:"destructive"});return}f=Y;break;case"days":if(!ie){ne({title:"Missing days",description:"Please enter number of days",variant:"destructive"});return}f=ie;break;case"fixed":f="1";break;case"custom":f=U||"1";break;default:if(!U){ne({title:"Missing quantity",description:"Please enter quantity",variant:"destructive"});return}f=U}const K=Number(x.priceInhouse||0),ve=Te(x.kind);fe.mutate({reservationId:C,serviceId:x.id,serviceName:x.name,serviceKind:x.kind,quantity:f,unit:ve,unitPrice:K.toFixed(2),totalCharge:pe.toFixed(2),notes:Oe||null})};return e.jsx(ee,{open:a,onOpenChange:j,children:e.jsxs(te,{className:"max-w-md",children:[e.jsx(se,{children:e.jsx(ae,{children:"Add Room Service Charge"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Ce,{htmlFor:"service",children:"Service *"}),e.jsxs(we,{value:xe,onValueChange:_e,children:[e.jsx(Pe,{id:"service","data-testid":"select-service",children:e.jsx(De,{placeholder:"Select service"})}),e.jsxs(Ie,{children:[e.jsx("div",{className:"px-2 pb-2 sticky top-0 bg-background z-10",children:e.jsx(y,{placeholder:"Search services...",value:ge,onChange:o=>A(o.target.value),className:"h-8 text-sm",onClick:o=>o.stopPropagation(),onKeyDown:o=>o.stopPropagation()})}),je.length>0?je.map(o=>e.jsxs(H,{value:o.id,children:[o.name," (",o.kind,")"]},o.id)):e.jsx("div",{className:"px-2 py-6 text-center text-sm text-muted-foreground",children:"No services found"})]})]})]}),x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 bg-muted rounded-md",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Service Type:"}),e.jsx("span",{className:"font-medium",children:x.kind})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Rate (","In-House","):"]}),e.jsxs("span",{className:"font-medium",children:[p(x.priceInhouse)," / ",Te(x.kind)]})]})]})}),W(x.kind)==="kg"&&e.jsxs("div",{children:[e.jsx(Ce,{htmlFor:"weight",children:"Weight (kg) *"}),e.jsx(y,{id:"weight",type:"number",step:"0.01",min:"0",value:X,onChange:o=>We(o.target.value),placeholder:"Enter weight in kg","data-testid":"input-weight"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Charged at ",p(x.priceInhouse)," per kg"]})]}),W(x.kind)==="hours"&&e.jsxs("div",{children:[e.jsx(Ce,{htmlFor:"hours",children:"Hours *"}),e.jsx(y,{id:"hours",type:"number",step:"0.5",min:"0.5",value:Y,onChange:o=>Ye(o.target.value),placeholder:"Enter number of hours","data-testid":"input-hours"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Charged at ",p(x.priceInhouse)," per hour"]})]}),W(x.kind)==="days"&&e.jsxs("div",{children:[e.jsx(Ce,{htmlFor:"days",children:"Days *"}),e.jsx(y,{id:"days",type:"number",min:"1",value:ie,onChange:o=>Ze(o.target.value),placeholder:"Enter number of days","data-testid":"input-days"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Charged at ",p(x.priceInhouse)," per day"]})]}),W(x.kind)==="fixed"&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-950 rounded-md border border-blue-200 dark:border-blue-800",children:e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:"This is a fixed-price service. The full amount will be charged."})}),W(x.kind)==="custom"&&e.jsxs("div",{children:[e.jsx(Ce,{htmlFor:"quantity",children:"Quantity (Optional)"}),e.jsx(y,{id:"quantity",type:"number",min:"1",value:U,onChange:o=>Ke(o.target.value),placeholder:"Enter quantity (default: 1)","data-testid":"input-quantity"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Charged at ",p(x.priceInhouse)," per unit"]})]}),W(x.kind)==="quantity"&&e.jsxs("div",{children:[e.jsx(Ce,{htmlFor:"quantity",children:"Quantity *"}),e.jsx(y,{id:"quantity",type:"number",min:"1",value:U,onChange:o=>Ke(o.target.value),placeholder:"Enter quantity","data-testid":"input-quantity"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Charged at ",p(x.priceInhouse)," per unit"]})]}),pe>0&&e.jsx("div",{className:"p-3 bg-primary/10 rounded-md",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Charge:"}),e.jsx("span",{className:"text-lg font-bold",children:p(pe)})]})}),e.jsxs("div",{children:[e.jsx(Ce,{htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(vt,{id:"notes",value:Oe,onChange:o=>Je(o.target.value),placeholder:"Any additional notes...",rows:2,"data-testid":"textarea-notes"})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx(d,{onClick:Xe,disabled:!x||fe.isPending,className:"flex-1","data-testid":"button-add-charge",children:fe.isPending?"Adding...":"Add Charge"}),e.jsx(d,{variant:"secondary",onClick:()=>{j(!1),w()},className:"flex-1","data-testid":"button-cancel",children:"Cancel"})]})]})]})})}function Pa(){var Zt,Jt,Xt,es,ts,ss,as,ns,is,rs;const{user:a}=ks(),{toast:j}=Cs(),C=ws(),Se=ra(),[,G]=Zs(),{confirm:ne}=Js(),[Ue,xe]=g.useState(!1),[_e,U]=g.useState(!1),[Ke,X]=g.useState(!1),[We,Y]=g.useState(!1),[Ye,ie]=g.useState(!1),[Ze,Oe]=g.useState(!1),[Je,pe]=g.useState(!1);g.useState(new Date);const[Z,ge]=g.useState(""),[A,re]=g.useState(""),[r,x]=g.useState(null),[Kt,W]=g.useState(""),[Te,fe]=g.useState(""),[w,je]=g.useState(null),[Xe,o]=g.useState(!1),[f,K]=g.useState(""),[ve,bt]=g.useState("all"),[_,Ae]=g.useState([]),[be,et]=g.useState("walkin"),[Nt,tt]=g.useState(""),[Ps,st]=g.useState(!1),[at,nt]=g.useState(void 0),[it,rt]=g.useState(""),[ct,yt]=g.useState(null),[Ds,kt]=g.useState(!1),[Ge,Gt]=g.useState(new Date),[J,Is]=g.useState(null),[Ss,Ve]=g.useState(!1),[Os,lt]=g.useState(""),{data:V}=L({queryKey:["/api/hotels/current"],refetchInterval:3e3,enabled:!!(a!=null&&a.hotelId)}),{data:Vt=[]}=L({queryKey:["/api/hotels/current/guests"],refetchInterval:3e3,enabled:!!(a!=null&&a.hotelId)}),{data:M=[]}=L({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"rooms"],refetchInterval:3e3,enabled:!!(a!=null&&a.hotelId)}),{data:Be=[]}=L({queryKey:["/api/users",a==null?void 0:a.id,"tasks"],refetchInterval:3e3,enabled:!!(a!=null&&a.id)}),{data:Bt=[]}=L({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"room-service-orders"],refetchInterval:3e3,enabled:!!(a!=null&&a.hotelId)}),{data:$e=[]}=L({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"meal-plans"],refetchInterval:3e3,enabled:!!(a!=null&&a.hotelId)});L({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"vouchers"],refetchInterval:3e3,enabled:!!(a!=null&&a.hotelId)});const{data:Ts=[]}=L({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"menu-items"],refetchInterval:3e3,enabled:!!(a!=null&&a.hotelId)}),{data:$s=[]}=L({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"menu-categories"],refetchInterval:3e3,enabled:!!(a!=null&&a.hotelId)}),{data:Fs=[]}=L({queryKey:["/api/hotels/current/taxes"],refetchInterval:3e3,enabled:!!(a!=null&&a.hotelId)}),{data:Ms=[]}=L({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3,enabled:!!(a!=null&&a.hotelId)}),{data:Fe=[]}=L({queryKey:["/api/hotels/current/reservations"],refetchInterval:3e3,enabled:!!(a!=null&&a.hotelId)});L({queryKey:["/api/services"],refetchInterval:3e3,enabled:!!(a!=null&&a.hotelId)});const{data:Rs=[]}=L({queryKey:["/api/hotels/current/room-service-charges"],refetchInterval:3e3,enabled:!!(a!=null&&a.hotelId)}),O=ht({defaultValues:{guestName:"",guestEmail:"",guestPhone:"",idNumber:"",nationality:"",checkInDate:"",checkOutDate:"",roomId:"",advancePayment:"",mealPlanId:"",numberOfPersons:""}}),Me=ht({defaultValues:{title:"",location:"",description:"",priority:"medium"}});He({queryKey:["/api/services"],refetchInterval:3e3,events:["service:created","service:updated"]}),He({queryKey:["/api/hotels/current/rooms"],refetchInterval:3e3,events:["room:updated"]}),He({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3,events:["transaction:created","transaction:updated"]}),He({queryKey:["/api/hotels/current/guests"],refetchInterval:3e3,events:["guest:created","guest:updated"]}),He({queryKey:["/api/hotels/current/room-service-charges"],refetchInterval:3e3,events:["room-service-charge:created","room-service-charge:deleted"]});const qe=ht({defaultValues:{amount:"",purpose:"",paymentMethod:"cash"}}),b=ht({defaultValues:{guestName:"",guestEmail:"",guestPhone:"",checkInDate:"",checkOutDate:"",roomId:"",numberOfPersons:"",mealPlanId:"",specialRequests:""}});g.useEffect(()=>{if(!(a!=null&&a.hotelId))return;const t=Se.on("room:updated",l=>{C.invalidateQueries({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"rooms"]}),j({title:"Room Updated",description:`Room ${l.roomNumber} status has been updated`})}),s=Se.on("guest:created",l=>{C.invalidateQueries({queryKey:["/api/hotels/current/guests"]}),j({title:"New Guest",description:`${l.name} has been added`})}),n=Se.on("guest:updated",l=>{C.invalidateQueries({queryKey:["/api/hotels/current/guests"]})}),i=Se.on("maintenance:updated",l=>{C.invalidateQueries({queryKey:["/api/hotels/current/maintenance-requests"]}),j({title:"Maintenance Update",description:`Request "${l.title}" has been updated`})}),u=Se.on("transaction:created",l=>{C.invalidateQueries({queryKey:["/api/hotels/current/transactions"]})});return()=>{t(),s(),n(),i(),u()}},[a==null?void 0:a.hotelId,Se,C,j]);const Ct=he({mutationFn:async({taskId:t,status:s})=>{await T("PUT",`/api/tasks/${t}`,{status:s})},onSuccess:()=>{C.invalidateQueries({queryKey:["/api/users",a==null?void 0:a.id,"tasks"]}),j({title:"Task updated successfully"})}}),wt=he({mutationFn:async t=>{const s=$e.find(m=>m.id===t.mealPlanId),n=M.find(m=>m.id===t.roomId),i=n==null?void 0:n.roomType;if(!i)throw new Error("Room type information is missing. Please ensure the room is properly configured.");const u=t.guestType==="inhouse"?i.priceInhouse:i.priceWalkin,l=u?Number(u):0;if(l<=0)throw new Error(`Room price is not configured for ${t.guestType} guests. Please configure room pricing first.`);await T("PUT",`/api/rooms/${t.roomId}`,{isOccupied:!0,occupantDetails:{name:t.guestName,email:t.guestEmail,phone:t.guestPhone,idNumber:t.idNumber,nationality:t.nationality,checkInDate:t.checkInDate,checkOutDate:t.checkOutDate,guestType:t.guestType||"walkin",officeName:t.officeName||null,roomTypeId:(i==null?void 0:i.id)||null,roomTypeName:(i==null?void 0:i.name)||null,roomPrice:l,mealPlan:s?{planId:s.id,planType:s.planType,planName:s.planName,pricePerPerson:s.pricePerPerson,numberOfPersons:Number(t.numberOfPersons)||0,totalCost:Number(s.pricePerPerson)*(Number(t.numberOfPersons)||0)}:null}}),t.advancePayment&&Number(t.advancePayment)>0&&await T("POST","/api/transactions",{hotelId:a==null?void 0:a.hotelId,txnType:Z==="cash"?"cash_in":Z==="pos"?"pos_in":"fonepay_in",amount:String(Number(t.advancePayment)),paymentMethod:Z,purpose:"room_advance_payment",reference:`Room ${r==null?void 0:r.roomNumber} - ${t.guestName}`,details:{roomId:t.roomId,roomNumber:r==null?void 0:r.roomNumber,guestName:t.guestName,checkInDate:t.checkInDate},createdBy:a==null?void 0:a.id})},onSuccess:()=>{C.invalidateQueries({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"rooms"]}),C.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),j({title:"Guest checked in successfully"}),O.reset(),xe(!1),x(null),ge(""),et("walkin"),yt(null),rt(""),tt("")},onError:t=>{j({title:"Check-in failed",description:t.message||"Failed to check in guest",variant:"destructive"})}}),Pt=he({mutationFn:async t=>{await T("POST","/api/maintenance-requests",{hotelId:a==null?void 0:a.hotelId,reportedBy:a==null?void 0:a.id,title:t.title,location:t.location,description:t.description,priority:t.priority,status:"pending"})},onSuccess:()=>{j({title:"Maintenance request sent to manager successfully"}),Me.reset(),ie(!1)}}),Dt=he({mutationFn:async t=>{await T("POST","/api/transactions",{hotelId:a==null?void 0:a.hotelId,txnType:"cash_deposit_request",amount:String(Number(t.amount)),paymentMethod:t.paymentMethod,purpose:t.purpose||"Cash Deposit Request",reference:`Cash deposit by ${a==null?void 0:a.username}`,createdBy:a==null?void 0:a.id})},onSuccess:()=>{C.invalidateQueries({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"transactions"]}),j({title:"Cash deposit request sent to finance successfully"}),qe.reset(),Oe(!1)}}),It=he({mutationFn:async t=>{const s=M.find(n=>n.id===t.roomId);if(!s||!s.occupantDetails)throw new Error("Room not found or not occupied");await T("PUT",`/api/rooms/${t.roomId}`,{occupantDetails:{...s.occupantDetails,checkOutDate:t.newCheckoutDate.toISOString()}})},onSuccess:()=>{C.invalidateQueries({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"rooms"]}),j({title:"Checkout date extended successfully"}),st(!1),x(null),nt(void 0)},onError:t=>{j({title:"Failed to extend stay",description:t.message||"Could not update checkout date",variant:"destructive"})}}),As=async()=>{if(!Te.trim()){j({title:"Please enter a voucher code",variant:"destructive"});return}o(!0);try{const s=await(await fetch("/api/vouchers/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:Te}),credentials:"include"})).json();s.valid?(je(s.voucher),j({title:"Voucher applied successfully!"})):(je(null),j({title:"Invalid voucher",description:s.message||"Voucher code is invalid",variant:"destructive"}))}catch{j({title:"Error validating voucher",variant:"destructive"})}finally{o(!1)}},St=he({mutationFn:async t=>{var i,u,l,m,v,k,c,h,$,B,F,q,Q,le,R,z,Ee,Le,Qe,ze,ot;if(!A||!["cash","pos","fonepay"].includes(A))throw new Error("Please select a payment method (Cash, POS, or Fonepay) before checking out");const s=M.find(oe=>oe.id===t.roomId),n=(s==null?void 0:s.currentReservationId)||((i=s==null?void 0:s.occupantDetails)==null?void 0:i.reservationId);if(n){await T("POST","/api/transactions",{hotelId:a==null?void 0:a.hotelId,txnType:A==="cash"?"cash_in":A==="pos"?"pos_in":"fonepay_in",amount:String(t.finalAmount),paymentMethod:A,purpose:"room_checkout_payment",reference:`Checkout - Room ${t.roomNumber} - ${t.guestName}${t.voucherId?" (Voucher Applied)":""}`,details:{roomNumber:t.roomNumber,guestName:t.guestName,checkInDate:(u=r==null?void 0:r.occupantDetails)==null?void 0:u.checkInDate,checkOutDate:(l=r==null?void 0:r.occupantDetails)==null?void 0:l.checkOutDate,numberOfNights:((m=t.billingDetails)==null?void 0:m.numberOfNights)||1,subtotal:((v=t.billingDetails)==null?void 0:v.subtotal)||0,roomCharges:((k=t.billingDetails)==null?void 0:k.totalRoomCharges)||0,mealPlanCharges:((c=t.billingDetails)==null?void 0:c.totalMealPlanCharges)||0,foodCharges:((h=t.billingDetails)==null?void 0:h.totalFoodCharges)||0,taxBreakdown:(($=t.billingDetails)==null?void 0:$.taxBreakdown)||{},totalTax:((B=t.billingDetails)==null?void 0:B.totalTax)||0,discountAmount:t.discountAmount,voucherCode:(w==null?void 0:w.code)||null,grandTotal:t.finalAmount,paymentMethod:A,reservationId:n},createdBy:a==null?void 0:a.id}),await T("PATCH",`/api/reservations/${n}`,{paidAmount:String(t.finalAmount)});try{await T("POST",`/api/reservations/${n}/check-out`,{})}catch(oe){if(oe.message&&oe.message.includes("outstanding balance"))if(((F=a==null?void 0:a.role)==null?void 0:F.name)==="manager"||((q=a==null?void 0:a.role)==null?void 0:q.name)==="owner")await ne({title:"Manager Override Required",description:`${oe.message}

As a manager, do you want to override and check out anyway?`,confirmText:"Override & Check Out",cancelText:"Cancel",variant:"destructive",onConfirm:async()=>{await T("POST",`/api/reservations/${n}/check-out`,{overrideBalance:!0,overrideReason:"Manager override from front desk"})},onCancel:()=>{throw new Error("Checkout cancelled - payment required")}});else throw oe;else throw oe}t.voucherId&&await T("POST","/api/vouchers/redeem",{voucherId:t.voucherId})}else await T("PUT",`/api/rooms/${t.roomId}`,{isOccupied:!1,occupantDetails:null}),t.finalAmount>0&&await T("POST","/api/transactions",{hotelId:a==null?void 0:a.hotelId,txnType:A==="cash"?"cash_in":A==="pos"?"pos_in":"fonepay_in",amount:String(t.finalAmount),paymentMethod:A,purpose:"room_checkout_payment",reference:`Checkout - Room ${t.roomNumber} - ${t.guestName}${t.voucherId?" (Voucher Applied)":""}`,details:{roomNumber:t.roomNumber,guestName:t.guestName,checkInDate:(Q=r==null?void 0:r.occupantDetails)==null?void 0:Q.checkInDate,checkOutDate:(le=r==null?void 0:r.occupantDetails)==null?void 0:le.checkOutDate,numberOfNights:((R=t.billingDetails)==null?void 0:R.numberOfNights)||1,subtotal:((z=t.billingDetails)==null?void 0:z.subtotal)||0,roomCharges:((Ee=t.billingDetails)==null?void 0:Ee.totalRoomCharges)||0,mealPlanCharges:((Le=t.billingDetails)==null?void 0:Le.totalMealPlanCharges)||0,foodCharges:((Qe=t.billingDetails)==null?void 0:Qe.totalFoodCharges)||0,taxBreakdown:((ze=t.billingDetails)==null?void 0:ze.taxBreakdown)||{},totalTax:((ot=t.billingDetails)==null?void 0:ot.totalTax)||0,discountAmount:t.discountAmount,voucherCode:(w==null?void 0:w.code)||null,grandTotal:t.finalAmount,paymentMethod:A},createdBy:a==null?void 0:a.id}),t.voucherId&&await T("POST","/api/vouchers/redeem",{voucherId:t.voucherId})},onSuccess:()=>{C.invalidateQueries({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"rooms"]}),C.invalidateQueries({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"vouchers"]}),C.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),C.invalidateQueries({queryKey:["/api/hotels/current/reservations"]}),j({title:"Guest checked out successfully"}),r&&Ft(r,"checkout"),U(!1),x(null),W(""),fe(""),je(null),re("")},onError:t=>{j({title:"Checkout failed",description:t.message||"Failed to check out guest",variant:"destructive"})}}),Ot=he({mutationFn:async t=>{var c;const s=M.find(h=>h.id===t.roomId),n=(c=s==null?void 0:s.roomType)!=null&&c.priceWalkin?Number(s.roomType.priceWalkin):0,i=$e.find(h=>h.id===t.mealPlanId),u=i&&t.numberOfPersons?Number(i.pricePerPerson)*Number(t.numberOfPersons):0,l=new Date(t.checkInDate),m=new Date(t.checkOutDate),v=Math.max(1,Math.ceil((m.getTime()-l.getTime())/(1e3*3600*24))),k=(n+u)*v;await T("POST","/api/reservations",{hotelId:a==null?void 0:a.hotelId,guestName:t.guestName,guestEmail:t.guestEmail,guestPhone:t.guestPhone,roomId:t.roomId,checkInDate:l,checkOutDate:m,numberOfPersons:Number(t.numberOfPersons),mealPlanId:t.mealPlanId||null,roomPrice:String(n),mealPlanPrice:String(u),totalPrice:String(k),specialRequests:t.specialRequests,status:"confirmed",createdBy:a==null?void 0:a.id})},onSuccess:()=>{C.invalidateQueries({queryKey:["/api/hotels/current/reservations"]}),j({title:"Reservation created successfully"}),b.reset(),X(!1),Ws()},onError:t=>{j({title:"Failed to create reservation",description:t.message||"Please try again",variant:"destructive"})}}),Qt=M.filter(t=>!t.isOccupied),ce=M.filter(t=>t.isOccupied);Be.filter(t=>t.status==="pending"),Be.filter(t=>t.status==="performing"),Be.filter(t=>t.status==="completed");const qs=ce.filter(t=>{var i;const s=new Date().toDateString(),n=(i=t.occupantDetails)==null?void 0:i.checkInDate;return n&&new Date(n).toDateString()===s}),Es=ce.filter(t=>{var i;const s=new Date().toDateString(),n=(i=t.occupantDetails)==null?void 0:i.checkOutDate;return n&&new Date(n).toDateString()===s}),zt=(t,s)=>{Ct.mutate({taskId:t.id,status:s})},Tt=t=>{var os,ds,ms,us,hs,xs,ps;const s=(os=t.occupantDetails)!=null&&os.roomPrice?Number(t.occupantDetails.roomPrice):0,n=(ds=t.occupantDetails)!=null&&ds.checkInDate?new Date(t.occupantDetails.checkInDate):null,i=new Date;let u=1;if(n){const N=new Date(n);N.setHours(0,0,0,0);const E=new Date(i);E.setHours(0,0,0,0);const de=Math.floor((E.getTime()-N.getTime())/(1e3*3600*24));u=Math.max(1,de);const Ne=i.getHours(),dt=i.getMinutes(),mt=Ne*60+dt,ut=14*60;mt>ut&&(u+=1)}const l=s*u,m=((us=(ms=t.occupantDetails)==null?void 0:ms.mealPlan)==null?void 0:us.totalCost)||0,v=parseFloat(m.toString())*u,c=(((hs=t.occupantDetails)==null?void 0:hs.foodCharges)||[]).reduce((N,E)=>N+parseFloat(E.totalAmount||0),0),h=t.currentReservationId||((xs=t.occupantDetails)==null?void 0:xs.reservationId),$=h?Rs.filter(N=>N.reservationId===h):[],B=$.reduce((N,E)=>N+parseFloat(E.totalCharge||0),0),F=l+v+c+B;let q=0,Q=F;w&&(w.discountType==="percentage"?(q=Math.round(F*(parseFloat(w.discountAmount)/100)*100)/100,Q=Math.round((F-q)*100)/100):w.discountType==="fixed"&&(q=Math.min(parseFloat(w.discountAmount),F),Q=Math.round((F-q)*100)/100));const le=Fs.filter(N=>N.isActive),R=["vat","service_tax","luxury_tax"],z=le.sort((N,E)=>{const de=R.indexOf(N.taxType),Ne=R.indexOf(E.taxType);return(de===-1?999:de)-(Ne===-1?999:Ne)});let Ee=Q;const Le={};z.forEach(N=>{const E=parseFloat(N.percent)/100,de=Math.round(Ee*E*100)/100,Ne=N.taxType==="vat"?"VAT":N.taxType==="service_tax"?"Service Tax":N.taxType==="luxury_tax"?"Luxury Tax":N.taxType;Le[Ne]={rate:parseFloat(N.percent),amount:de},Ee=Math.round((Ee+de)*100)/100});const Qe=Object.values(Le).reduce((N,E)=>N+E.amount,0);let ze=Math.round((Q+Qe)*100)/100;const ot=t.id,oe=((ps=t.occupantDetails)==null?void 0:ps.name)||"",cs=t.roomNumber||"",ls=Ms.filter(N=>{var dt,mt,ut;const E=N.purpose==="room_advance_payment";if((dt=N.details)!=null&&dt.roomId)return E&&N.details.roomId===ot;const de=(mt=N.reference)==null?void 0:mt.includes(`Room ${cs}`),Ne=(ut=N.reference)==null?void 0:ut.includes(oe);return E&&de&&Ne}).reduce((N,E)=>N+(parseFloat(E.amount)||0),0),Ys=Math.max(0,Math.round((ze-ls)*100)/100);return{subtotal:F,discountedSubtotal:Q,taxBreakdown:Le,totalTax:Qe,discountAmount:q,advancePayment:ls,grandTotal:ze,finalAmount:Ys,numberOfNights:u,totalRoomCharges:l,mealPlanCostPerNight:parseFloat(m.toString()),totalMealPlanCharges:parseFloat(v.toString()),totalFoodCharges:c,totalServiceCharges:B,serviceCharges:$}},Ls=t=>{x(t),et("walkin"),tt(""),xe(!0)},Ks=t=>{x(t),fe(""),je(null),re(""),U(!0)},Gs=t=>{var n;x(t);const s=(n=t.occupantDetails)!=null&&n.checkOutDate?new Date(t.occupantDetails.checkOutDate):new Date;nt(s),st(!0)},Vs=he({mutationFn:async t=>{await T("POST",`/api/reservations/${t}/check-in`,{})},onSuccess:()=>{C.invalidateQueries({queryKey:["/api/hotels/current/reservations"]}),C.invalidateQueries({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"rooms"]}),j({title:"Guest checked in successfully from reservation"})},onError:t=>{j({title:"Check-in failed",description:t.message||"Failed to check in guest from reservation",variant:"destructive"})}}),Ht=t=>{Vs.mutate(t.id)},$t=Fe.filter(t=>{const s=new Date(t.checkInDate),n=new Date;return n.setHours(0,0,0,0),s.setHours(0,0,0,0),s.getTime()===n.getTime()&&t.status==="confirmed"}),Ut=Fe.filter(t=>{const s=new Date(t.checkInDate),n=new Date;return n.setHours(0,0,0,0),s.setHours(0,0,0,0),s.getTime()>n.getTime()&&t.status==="confirmed"}).slice(0,5),Bs=t=>{if(!Z&&t.advancePayment&&Number(t.advancePayment)>0){j({title:"Error",description:"Please select payment method for advance payment",variant:"destructive"});return}if(be==="inhouse"&&!Nt.trim()){j({title:"Error",description:"Office name is required for in-house guests",variant:"destructive"});return}wt.mutate({...t,roomId:r==null?void 0:r.id,guestType:be,officeName:be==="inhouse"?Nt:null})},Qs=t=>{Ot.mutate(t)},zs=t=>{Pt.mutate(t)},Hs=t=>{Dt.mutate(t)},_t=Ts.filter(t=>{var i;const s=!f||((i=t.name)==null?void 0:i.toLowerCase().includes(f.toLowerCase())),n=ve==="all"||t.categoryId===ve;return s&&n&&t.active}),Us=t=>{const s=_.find(n=>n.item.id===t.id);Ae(s?_.map(n=>n.item.id===t.id?{...n,quantity:n.quantity+1}:n):[..._,{item:t,quantity:1}])},Wt=t=>{Ae(_.filter(s=>s.item.id!==t))},Yt=(t,s)=>{s<=0?Wt(t):Ae(_.map(n=>n.item.id===t?{...n,quantity:s}:n))},_s=async()=>{if(!r||_.length===0){j({title:"Error",description:"Please select a room and add items",variant:"destructive"});return}try{const t=_.reduce((l,{item:m,quantity:v})=>l+Number(m.price)*v,0),s=_.map(({item:l,quantity:m})=>`${l.name} x ${m} - ${p(Number(l.price)*m)}`).join(`
`),n=r.occupantDetails||{},i=n.foodCharges||[],u={items:_.map(({item:l,quantity:m})=>({name:l.name,quantity:m,price:Number(l.price),total:Number(l.price)*m})),totalAmount:t,orderedAt:new Date().toISOString(),orderedBy:a==null?void 0:a.username};await T("PUT",`/api/rooms/${r.id}`,{occupantDetails:{...n,foodCharges:[...i,u]}}),await T("POST","/api/room-service-orders",{hotelId:a==null?void 0:a.hotelId,roomId:r.id,requestedBy:a==null?void 0:a.id,status:"completed",specialInstructions:`Food Order:
${s}
Total: ${p(t)}`}),j({title:"Food order added to room bill successfully"}),Ae([]),K(""),bt("all"),pe(!1),x(null),C.invalidateQueries({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"room-service-orders"]}),C.invalidateQueries({queryKey:["/api/hotels",a==null?void 0:a.hotelId,"rooms"]})}catch{j({title:"Error",description:"Failed to submit food order",variant:"destructive"})}},Ft=(t,s)=>{var F,q,Q,le;const n=t.occupantDetails,i=n==null?void 0:n.mealPlan,u=(F=M.find(R=>R.id===t.id))==null?void 0:F.roomType,l=(V==null?void 0:V.name)||"HOTEL MANAGEMENT",m=(V==null?void 0:V.address)||"",v=(V==null?void 0:V.phone)||"",k=(V==null?void 0:V.zip)||"",c=(V==null?void 0:V.vatNo)||"",h=s==="checkout"?Tt(t):null;let $=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>${s==="checkin"?"Check-in":s==="checkout"?"Check-out":"Bill"} Receipt</title>
          <style>
            @media print {
              @page { margin: 0; size: 80mm auto; }
              body { margin: 0; padding: 0; }
            }
            body {
              font-family: 'Courier New', monospace;
              font-size: 12px;
              line-height: 1.4;
              max-width: 300px;
              margin: 0 auto;
              padding: 10px;
            }
            .center { text-align: center; }
            .bold { font-weight: bold; }
            .line { border-top: 1px dashed #000; margin: 5px 0; }
            .double-line { border-top: 2px solid #000; margin: 5px 0; }
            .item-row { display: flex; justify-content: space-between; margin: 3px 0; }
            .total { font-size: 14px; font-weight: bold; }
          </style>
        </head>
        <body>
          <div class="center bold" style="font-size: 16px;">${l.toUpperCase()}</div>
          ${m?`<div class="center">${m}</div>`:""}
          ${k?`<div class="center">Zip: ${k}</div>`:""}
          ${v?`<div class="center">Phone: ${v}</div>`:""}
          ${c?`<div class="center">VAT No: ${c}</div>`:""}
          <div class="center">================================</div>
          <div class="center bold">${s==="checkin"?"CHECK-IN RECEIPT":s==="checkout"?"CHECK-OUT RECEIPT":"BILL"}</div>
          <div class="center">================================</div>
          <br>
          <div>Date: ${new Date().toLocaleDateString()}</div>
          <div>Time: ${new Date().toLocaleTimeString()}</div>
          <div>Receipt #: ${Date.now().toString().slice(-8)}</div>
          <div class="line"></div>
          <div class="bold">GUEST DETAILS</div>
          <div>Name: ${(n==null?void 0:n.name)||"N/A"}</div>
          <div>Room: ${t.roomNumber}${u?` (${u.name})`:""}</div>
          <div>Number of People: ${((q=n==null?void 0:n.mealPlan)==null?void 0:q.numberOfPersons)||1}</div>
          ${n!=null&&n.phone?`<div>Phone: ${n.phone}</div>`:""}
          ${n!=null&&n.email?`<div>Email: ${n.email}</div>`:""}
          ${n!=null&&n.nationality?`<div>Nationality: ${n.nationality}</div>`:""}
          ${n!=null&&n.idNumber?`<div>ID: ${n.idNumber}</div>`:""}
          ${n!=null&&n.guestType?`<div>Type: ${n.guestType==="inhouse"?"In-House":"Walk-in"}</div>`:""}
          ${n!=null&&n.officeName?`<div>Office: ${n.officeName}</div>`:""}
          <div class="line"></div>
          ${s==="checkin"?`
            <div class="bold">CHECK-IN INFORMATION</div>
            <div>Check-in: ${n!=null&&n.checkInDate?new Date(n.checkInDate).toLocaleDateString():"N/A"}</div>
            <div>Check-out: ${n!=null&&n.checkOutDate?new Date(n.checkOutDate).toLocaleDateString():"N/A"}</div>
            ${i?`
              <div class="line"></div>
              <div class="bold">MEAL PLAN</div>
              <div>${i.planName} (${i.planType})</div>
              <div>${i.numberOfPersons} person(s) x ${p(Number(i.pricePerPerson))}</div>
              <div class="bold">Total: ${p(i.totalCost)}</div>
            `:""}
          `:s==="checkout"&&h?`
            <div class="bold">CHECK-OUT INFORMATION</div>
            <div>Check-in: ${n!=null&&n.checkInDate?new Date(n.checkInDate).toLocaleDateString():"N/A"}</div>
            <div>Check-out: ${new Date().toLocaleDateString()}</div>
            <div>Duration: ${h.numberOfNights} ${h.numberOfNights===1?"night":"nights"}</div>
            <div class="line"></div>
            <div class="bold">CHARGES SUMMARY</div>
            ${h.totalRoomCharges>0?`
              <div class="item-row">
                <span>Room (${h.numberOfNights}x${p(Number((n==null?void 0:n.roomPrice)||0))}):</span>
                <span>${p(h.totalRoomCharges)}</span>
              </div>
            `:""}
            ${h.totalMealPlanCharges>0?`
              <div class="item-row">
                <span>Meal Plan (${h.numberOfNights}x${p(h.mealPlanCostPerNight)}):</span>
                <span>${p(h.totalMealPlanCharges)}</span>
              </div>
            `:""}
            ${h.totalFoodCharges>0&&((Q=n==null?void 0:n.foodCharges)==null?void 0:Q.length)>0?`
              <div class="bold" style="margin-top: 5px;">Food & Beverage:</div>
              ${n.foodCharges.map(R=>R.items.map(z=>`
                  <div class="item-row" style="font-size: 11px; padding-left: 10px;">
                    <span>${z.name} x ${z.quantity}</span>
                    <span>${p(z.total)}</span>
                  </div>
                `).join("")).join("")}
              <div class="item-row" style="padding-left: 10px;">
                <span class="bold">F&B Subtotal:</span>
                <span class="bold">${p(h.totalFoodCharges)}</span>
              </div>
            `:""}
            ${h.totalServiceCharges>0&&((le=h.serviceCharges)==null?void 0:le.length)>0?`
              <div class="bold" style="margin-top: 5px;">Room Service Charges:</div>
              ${h.serviceCharges.map(R=>`
                <div class="item-row" style="font-size: 11px; padding-left: 10px;">
                  <span>${R.serviceName} (${R.quantity} ${R.unit})</span>
                  <span>${p(parseFloat(R.totalCharge))}</span>
                </div>
              `).join("")}
              <div class="item-row" style="padding-left: 10px;">
                <span class="bold">Service Subtotal:</span>
                <span class="bold">${p(h.totalServiceCharges)}</span>
              </div>
            `:""}
            <div class="line"></div>
            <div class="item-row">
              <span>Subtotal:</span>
              <span>${p(h.subtotal)}</span>
            </div>
            ${h.discountAmount>0?`
              <div class="item-row">
                <span>Discount ${w?`(${w.code})`:""}:</span>
                <span>-${p(h.discountAmount)}</span>
              </div>
              <div class="item-row bold">
                <span>Discounted Subtotal:</span>
                <span>${p(h.discountedSubtotal)}</span>
              </div>
            `:""}
            ${Object.entries(h.taxBreakdown).map(([R,z])=>`
              <div class="item-row">
                <span>${R} (${z.rate}%):</span>
                <span>${p(z.amount)}</span>
              </div>
            `).join("")}
            ${h.totalTax>0?`
              <div class="item-row">
                <span>Total Tax:</span>
                <span>${p(h.totalTax)}</span>
              </div>
            `:""}
            <div class="double-line"></div>
            <div class="item-row total">
              <span>GRAND TOTAL:</span>
              <span>${p(h.grandTotal)}</span>
            </div>
          `:""}
          <div class="double-line"></div>
          <div class="center">Served by: ${a==null?void 0:a.username}</div>
          <div class="center">================================</div>
          <div class="center bold">THANK YOU FOR YOUR STAY!</div>
          <div class="center">================================</div>
          <br>
        </body>
      </html>
    `;const B=window.open("","_blank");B&&(B.document.write($),B.document.close(),B.print())},Ws=()=>{const t=`
      ========================================
                GRAND PLAZA HOTEL
            Reservation Confirmation
      ========================================
      Confirmation Date: ${new Date().toLocaleDateString()}
      Time: ${new Date().toLocaleTimeString()}
      ========================================
      Your reservation has been confirmed.
      Thank you for choosing our hotel!
      ========================================
    `,s=window.open("","_blank");s&&(s.document.write(`
        <html>
          <head>
            <title>Reservation Confirmation</title>
            <style>
              body { font-family: monospace; white-space: pre-line; }
            </style>
          </head>
          <body>${t}</body>
        </html>
      `),s.document.close(),s.print(),s.close())};return e.jsx(ea,{title:"Front Desk Dashboard",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(jt,{title:"Available Rooms",value:Qt.length,icon:e.jsx(pt,{}),iconColor:"text-green-500"}),e.jsx(jt,{title:"Occupied Rooms",value:ce.length,icon:e.jsx(gt,{}),iconColor:"text-blue-500",trend:{value:M.length>0?Math.round(ce.length/M.length*100):0,label:"occupancy",isPositive:!0}}),e.jsx(jt,{title:"Today's Check-ins",value:qs.length,icon:e.jsx(fs,{}),iconColor:"text-orange-500"}),e.jsx(jt,{title:"Today's Check-outs",value:Es.length,icon:e.jsx(ta,{}),iconColor:"text-red-500"})]}),e.jsxs(me,{children:[e.jsx(ye,{className:"pb-3",children:e.jsx(ke,{children:"Front Desk Operations"})}),e.jsxs(ue,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(Et,{className:"h-4 w-4"}),"Guest Services"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs(d,{variant:"outline",className:"h-24 flex flex-col items-center justify-center gap-2 bg-blue-50 hover:bg-blue-100 border-blue-200 dark:bg-blue-950/20 dark:border-blue-900 dark:hover:bg-blue-950/30",onClick:()=>xe(!0),"data-testid":"button-check-in",children:[e.jsx(gt,{className:"h-7 w-7 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Check-in Guest"})]}),e.jsxs(d,{variant:"outline",className:"h-24 flex flex-col items-center justify-center gap-2 bg-green-50 hover:bg-green-100 border-green-200 dark:bg-green-950/20 dark:border-green-900 dark:hover:bg-green-950/30",onClick:()=>X(!0),"data-testid":"button-new-reservation",children:[e.jsx(fs,{className:"h-7 w-7 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-900 dark:text-green-100",children:"New Booking"})]}),e.jsxs(d,{variant:"outline",className:"h-24 flex flex-col items-center justify-center gap-2 bg-purple-50 hover:bg-purple-100 border-purple-200 dark:bg-purple-950/20 dark:border-purple-900 dark:hover:bg-purple-950/30",onClick:()=>kt(!0),"data-testid":"button-view-reservations",children:[e.jsx(js,{className:"h-7 w-7 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-purple-900 dark:text-purple-100",children:"All Bookings"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(Rt,{className:"h-4 w-4"}),"Service & Support"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs(d,{variant:"outline",className:"h-24 flex flex-col items-center justify-center gap-2 bg-orange-50 hover:bg-orange-100 border-orange-200 dark:bg-orange-950/20 dark:border-orange-900 dark:hover:bg-orange-950/30",onClick:()=>pe(!0),"data-testid":"button-food-order",children:[e.jsx(vs,{className:"h-7 w-7 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-orange-900 dark:text-orange-100",children:"Food Order"})]}),e.jsxs(d,{variant:"outline",className:"h-24 flex flex-col items-center justify-center gap-2 bg-teal-50 hover:bg-teal-100 border-teal-200 dark:bg-teal-950/20 dark:border-teal-900 dark:hover:bg-teal-950/30",onClick:()=>{ce.length===0?j({title:"No occupied rooms",description:"There are no occupied rooms to add service charges to",variant:"destructive"}):Y(!0)},"data-testid":"button-room-service",children:[e.jsx(Rt,{className:"h-7 w-7 text-teal-600"}),e.jsx("span",{className:"text-sm font-medium text-teal-900 dark:text-teal-100",children:"Room Service"})]}),e.jsxs(d,{variant:"outline",className:"h-24 flex flex-col items-center justify-center gap-2 bg-red-50 hover:bg-red-100 border-red-200 dark:bg-red-950/20 dark:border-red-900 dark:hover:bg-red-950/30",onClick:()=>G("/front-desk/maintenance-requests"),"data-testid":"button-maintenance-request",children:[e.jsx(sa,{className:"h-7 w-7 text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-900 dark:text-red-100",children:"Maintenance"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(At,{className:"h-4 w-4"}),"Finance & Admin"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs(d,{variant:"outline",className:"h-24 flex flex-col items-center justify-center gap-2 bg-emerald-50 hover:bg-emerald-100 border-emerald-200 dark:bg-emerald-950/20 dark:border-emerald-900 dark:hover:bg-emerald-950/30",onClick:()=>Oe(!0),"data-testid":"button-cash-deposit",children:[e.jsx(Lt,{className:"h-7 w-7 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-emerald-900 dark:text-emerald-100",children:"Cash Deposit"})]}),e.jsxs(d,{variant:"outline",className:"h-24 flex flex-col items-center justify-center gap-2 bg-indigo-50 hover:bg-indigo-100 border-indigo-200 dark:bg-indigo-950/20 dark:border-indigo-900 dark:hover:bg-indigo-950/30",onClick:()=>G("/hall-bookings"),"data-testid":"button-hall-bookings",children:[e.jsx(bs,{className:"h-7 w-7 text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-indigo-900 dark:text-indigo-100",children:"Hall Bookings"})]}),e.jsxs(d,{variant:"outline",className:"h-24 flex flex-col items-center justify-center gap-2 bg-slate-50 hover:bg-slate-100 border-slate-200 dark:bg-slate-950/20 dark:border-slate-700 dark:hover:bg-slate-950/30",onClick:()=>{const t=M.find(s=>s.isOccupied);t?Ft(t,"bill"):j({title:"No occupied rooms to print",variant:"destructive"})},"data-testid":"button-print-reports",children:[e.jsx(aa,{className:"h-7 w-7 text-slate-600"}),e.jsx("span",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:"Print Bill"})]})]})]})]})]}),$t.length>0&&e.jsxs(me,{children:[e.jsx(ye,{children:e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-5 w-5"}),"Today's Expected Arrivals (",$t.length,")"]})}),e.jsx(ue,{children:e.jsx("div",{className:"space-y-3",children:$t.map(t=>{const s=M.find(n=>n.id===t.roomId);return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-blue-50 dark:bg-blue-950/20","data-testid":`reservation-today-${t.id}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-lg","data-testid":"text-guest-name",children:t.guestName}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ft,{className:"h-3 w-3"}),t.guestPhone]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pt,{className:"h-3 w-3"}),"Room ",(s==null?void 0:s.roomNumber)||"N/A"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:[t.numberOfPersons," ",t.numberOfPersons===1?"person":"persons"]}),e.jsxs("span",{children:["Check-out: ",new Date(t.checkOutDate).toLocaleDateString()]})]})]})]}),e.jsxs(d,{onClick:()=>Ht(t),size:"sm",className:"ml-4","data-testid":"button-quick-checkin",children:[e.jsx(gt,{className:"h-4 w-4 mr-1"}),"Quick Check-in"]})]},t.id)})})})]}),Ut.length>0&&e.jsxs(me,{children:[e.jsx(ye,{children:e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"h-5 w-5"}),"Upcoming Reservations"]})}),e.jsx(ue,{children:e.jsx("div",{className:"space-y-2",children:Ut.map(t=>{const s=M.find(n=>n.id===t.roomId);return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors","data-testid":`reservation-upcoming-${t.id}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium","data-testid":"text-guest-name",children:t.guestName}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{className:"mr-4",children:["Room ",(s==null?void 0:s.roomNumber)||"N/A"]}),e.jsxs("span",{className:"mr-4",children:["Check-in: ",new Date(t.checkInDate).toLocaleDateString()]}),e.jsxs("span",{children:[t.numberOfPersons," ",t.numberOfPersons===1?"person":"persons"]})]})]}),e.jsxs(Re,{variant:"outline",className:"ml-4",children:[Math.ceil((new Date(t.checkInDate).getTime()-new Date().getTime())/(1e3*60*60*24))," days"]})]},t.id)})})})]}),e.jsxs(me,{children:[e.jsx(ye,{children:e.jsx(ke,{children:"Room Status Overview"})}),e.jsx(ue,{children:e.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-3 md:gap-4",children:M.slice(0,12).map((t,s)=>{var n,i;return e.jsxs("div",{className:`p-2 sm:p-3 md:p-4 border-2 rounded-lg text-center ${t.isOccupied?"border-red-300 bg-red-50 dark:border-red-700 dark:bg-red-900/20":"border-green-300 bg-green-50 dark:border-green-700 dark:bg-green-900/20"}`,"data-testid":`room-status-${s}`,children:[e.jsx(pt,{className:`h-5 w-5 sm:h-6 sm:w-6 mx-auto mb-1 sm:mb-2 ${t.isOccupied?"text-red-600":"text-green-600"}`}),e.jsx("h3",{className:"font-medium text-sm sm:text-base text-foreground",children:t.roomNumber}),e.jsx("p",{className:"text-xs text-muted-foreground mb-1 sm:mb-2",children:((n=t.roomType)==null?void 0:n.name)||"Standard"}),e.jsx(Re,{variant:"secondary",className:t.isOccupied?"bg-red-100 text-red-800":"bg-green-100 text-green-800",children:t.isOccupied?"Occupied":"Available"}),t.isOccupied&&t.occupantDetails?e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("p",{className:"text-xs text-foreground font-medium",children:((i=t.occupantDetails)==null?void 0:i.name)||"Guest"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsxs(d,{size:"sm",variant:"outline",onClick:async()=>{var l,m,v,k;let u=Fe.find(c=>c.roomId===t.id&&c.status==="checked_in");if(u)lt(u.id),Ve(!0);else try{const c=t.occupantDetails,$=await(await T("POST","/api/reservations",{hotelId:a==null?void 0:a.hotelId,guestName:(c==null?void 0:c.name)||"Guest",guestEmail:(c==null?void 0:c.email)||"",guestPhone:(c==null?void 0:c.phone)||"",roomId:t.id,checkInDate:(c==null?void 0:c.checkInDate)||new Date().toISOString(),checkOutDate:(c==null?void 0:c.checkOutDate)||new Date(Date.now()+864e5).toISOString(),numberOfPersons:((l=c==null?void 0:c.mealPlan)==null?void 0:l.numberOfPersons)||1,mealPlanId:((m=c==null?void 0:c.mealPlan)==null?void 0:m.planId)||null,roomPrice:String((c==null?void 0:c.roomPrice)||0),mealPlanPrice:String(((v=c==null?void 0:c.mealPlan)==null?void 0:v.totalCost)||0),totalPrice:String(parseFloat((c==null?void 0:c.roomPrice)||0)+parseFloat(((k=c==null?void 0:c.mealPlan)==null?void 0:k.totalCost)||0)),guestType:(c==null?void 0:c.guestType)||"walkin",status:"checked_in",createdBy:a==null?void 0:a.id})).json();lt($.id),C.invalidateQueries({queryKey:["/api/hotels/current/reservations"]}),Ve(!0)}catch(c){j({title:"Error creating reservation",description:c.message||"Failed to create reservation for service",variant:"destructive"})}},className:"h-6 text-xs px-2","data-testid":`button-service-${s}`,children:[e.jsx(Rt,{className:"h-3 w-3 mr-1"}),"Service"]}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Ks(t),className:"h-6 text-xs px-2","data-testid":`button-checkout-${s}`,children:"Check Out"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Gs(t),className:"h-6 text-xs px-2","data-testid":`button-extend-${s}`,children:"Extend"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Ft(t,"checkout"),className:"h-6 text-xs px-2","data-testid":`button-print-${s}`,children:"Print"})]})]}):t.isOccupied?null:e.jsx(d,{size:"sm",className:"mt-2 h-6 text-xs",onClick:()=>Ls(t),"data-testid":`button-checkin-${s}`,children:"Check In"})]},t.id)})})})]}),e.jsxs(me,{children:[e.jsx(ye,{children:e.jsx(ke,{children:"My Tasks"})}),e.jsx(ue,{children:e.jsx("div",{className:"space-y-3",children:Be.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4","data-testid":"no-tasks-message",children:"No tasks assigned"}):Be.slice(0,5).map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg","data-testid":`task-item-${s}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-foreground",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(Re,{className:gs(t.status||"pending"),variant:"secondary",children:t.status}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A"})]})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[t.status==="pending"&&e.jsx(d,{size:"sm",onClick:()=>zt(t,"performing"),disabled:Ct.isPending,"data-testid":`button-start-task-${s}`,children:"Start"}),t.status==="performing"&&e.jsx(d,{size:"sm",onClick:()=>zt(t,"completed"),disabled:Ct.isPending,"data-testid":`button-complete-task-${s}`,children:"Complete"})]})]},t.id))})})]}),e.jsxs(me,{children:[e.jsx(ye,{children:e.jsx(ke,{children:"Room Service Orders"})}),e.jsx(ue,{children:e.jsx("div",{className:"space-y-3",children:Bt.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4","data-testid":"no-room-service-message",children:"No room service orders"}):Bt.slice(0,5).map((t,s)=>{var n;return e.jsx("div",{className:"flex items-center justify-between p-3 border rounded-lg","data-testid":`room-service-item-${s}`,children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium text-foreground",children:["Room ",((n=M.find(i=>i.id===t.roomId))==null?void 0:n.roomNumber)||"Unknown"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.specialInstructions}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(Re,{className:gs(t.status||"pending"),variant:"secondary",children:t.status}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A"})]})]})},t.id)})})})]}),e.jsx(ee,{open:Ue,onOpenChange:xe,children:e.jsxs(te,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(se,{children:e.jsxs(ae,{children:["Check-in Guest - Room ",r==null?void 0:r.roomNumber]})}),e.jsxs("div",{className:"space-y-3 border-b pb-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"Search Existing Guest"}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>{yt(null),rt(""),O.reset()},"data-testid":"button-clear-guest",children:"Clear"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ns,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(y,{placeholder:"Search by name or phone...",value:it,onChange:t=>rt(t.target.value),className:"pl-10","data-testid":"input-search-guest"})]}),it&&e.jsx("div",{className:"max-h-40 overflow-y-auto border rounded-md",children:Vt.filter(t=>{const s=it.toLowerCase();return t.firstName.toLowerCase().includes(s)||t.lastName.toLowerCase().includes(s)||t.phone.toLowerCase().includes(s)}).length===0?e.jsx("div",{className:"p-3 text-sm text-muted-foreground text-center",children:"No guests found. Enter details below to check in a new guest."}):Vt.filter(t=>{const s=it.toLowerCase();return t.firstName.toLowerCase().includes(s)||t.lastName.toLowerCase().includes(s)||t.phone.toLowerCase().includes(s)}).map(t=>e.jsxs("button",{type:"button",onClick:()=>{yt(t),rt(""),O.setValue("guestName",`${t.firstName} ${t.lastName}`),O.setValue("guestEmail",t.email||""),O.setValue("guestPhone",t.phone||""),O.setValue("idNumber",t.idNumber||""),O.setValue("nationality",t.nationality||""),j({title:`Selected guest: ${t.firstName} ${t.lastName}`})},className:"w-full p-3 text-left hover:bg-accent transition-colors border-b last:border-b-0","data-testid":`button-select-guest-${t.id}`,children:[e.jsxs("div",{className:"font-medium",children:[t.firstName," ",t.lastName]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.phone}),t.email&&e.jsx("div",{className:"text-xs text-muted-foreground",children:t.email})]},t.id))}),ct&&e.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-green-900 dark:text-green-100",children:["✓ Guest Selected: ",ct.firstName," ",ct.lastName]}),e.jsx("p",{className:"text-xs text-green-700 dark:text-green-300",children:ct.phone})]})})})]}),e.jsx(xt,{...O,children:e.jsxs("form",{onSubmit:O.handleSubmit(Bs),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:O.control,name:"guestName",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Guest Name *"}),e.jsx(S,{children:e.jsx(y,{...t,placeholder:"Full name","data-testid":"input-guest-name"})})]})}),e.jsx(P,{control:O.control,name:"guestEmail",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Email"}),e.jsx(S,{children:e.jsx(y,{...t,type:"email",placeholder:"email@example.com","data-testid":"input-guest-email"})})]})}),e.jsx(P,{control:O.control,name:"guestPhone",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Phone Number"}),e.jsx(S,{children:e.jsx(y,{...t,placeholder:"Phone number","data-testid":"input-guest-phone"})})]})}),e.jsx(P,{control:O.control,name:"idNumber",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"ID Number"}),e.jsx(S,{children:e.jsx(y,{...t,placeholder:"Passport/ID number","data-testid":"input-id-number"})})]})}),e.jsx(P,{control:O.control,name:"nationality",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Nationality"}),e.jsx(S,{children:e.jsx(y,{...t,placeholder:"Country of origin","data-testid":"input-nationality"})})]})})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsx("h4",{className:"font-medium",children:"Guest Type"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(d,{type:"button",variant:be==="walkin"?"default":"outline",onClick:()=>{et("walkin"),tt("")},className:"flex-1","data-testid":"button-guest-type-walkin",children:"Walk-in"}),e.jsx(d,{type:"button",variant:be==="inhouse"?"default":"outline",onClick:()=>et("inhouse"),className:"flex-1","data-testid":"button-guest-type-inhouse",children:"In-House"})]}),be==="inhouse"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Office Name *"}),e.jsx(y,{value:Nt,onChange:t=>tt(t.target.value),placeholder:"Enter office/company name","data-testid":"input-office-name"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:r&&r.roomType&&e.jsxs("div",{className:"flex justify-between p-2 bg-muted rounded",children:[e.jsxs("span",{children:["Room Rate (",be==="inhouse"?"In-House":"Walk-in","):"]}),e.jsxs("span",{className:"font-semibold",children:["NPR ",parseFloat(be==="inhouse"?r.roomType.priceInhouse||"0":r.roomType.priceWalkin||"0").toFixed(2)]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:O.control,name:"mealPlanId",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Meal Plan (Optional)"}),e.jsx(S,{children:e.jsxs("select",{...t,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50","data-testid":"select-meal-plan",children:[e.jsx("option",{value:"",children:"No meal plan"}),$e.map(s=>e.jsxs("option",{value:s.id,children:[s.planType," - ",s.planName," (NPR ",parseFloat(s.pricePerPerson).toFixed(2),"/person)"]},s.id))]})})]})}),O.watch("mealPlanId")&&e.jsx(P,{control:O.control,name:"numberOfPersons",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Number of Persons"}),e.jsx(S,{children:e.jsx(y,{...t,type:"number",min:"1",placeholder:"1","data-testid":"input-number-of-persons"})})]})}),e.jsx(P,{control:O.control,name:"checkInDate",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Check-in Date"}),e.jsx(S,{children:e.jsx(y,{...t,type:"date","data-testid":"input-checkin-date"})})]})}),e.jsx(P,{control:O.control,name:"checkOutDate",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Check-out Date"}),e.jsx(S,{children:e.jsx(y,{...t,type:"date","data-testid":"input-checkout-date"})})]})})]}),e.jsx(P,{control:O.control,name:"advancePayment",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Advance Payment (Optional)"}),e.jsx(S,{children:e.jsx(y,{...t,type:"number",placeholder:"0","data-testid":"input-advance-payment"})})]})}),O.watch("advancePayment")&&Number(O.watch("advancePayment"))>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Payment Method"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(d,{type:"button",variant:Z==="cash"?"default":"outline",onClick:()=>ge("cash"),"data-testid":"button-payment-cash",children:[e.jsx(Lt,{className:"h-4 w-4 mr-2"}),"Cash"]}),e.jsxs(d,{type:"button",variant:Z==="pos"?"default":"outline",onClick:()=>ge("pos"),"data-testid":"button-payment-pos",children:[e.jsx(At,{className:"h-4 w-4 mr-2"}),"POS"]}),e.jsxs(d,{type:"button",variant:Z==="fonepay"?"default":"outline",onClick:()=>ge("fonepay"),"data-testid":"button-payment-fonepay",children:[e.jsx(ft,{className:"h-4 w-4 mr-2"}),"Fonepay"]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(d,{type:"submit",className:"flex-1",disabled:wt.isPending,"data-testid":"button-confirm-checkin",children:wt.isPending?"Checking In...":"Check In & Print Receipt"}),e.jsx(d,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>xe(!1),"data-testid":"button-cancel-checkin",children:"Cancel"})]})]})})]})}),e.jsx(ee,{open:_e,onOpenChange:U,children:e.jsxs(te,{className:"w-full max-w-[95vw] sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(se,{children:e.jsx(ae,{className:"text-xl sm:text-2xl",children:"Guest Check-out"})}),r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(me,{children:[e.jsx(ye,{children:e.jsx(ke,{className:"text-lg",children:"Room & Guest Information"})}),e.jsxs(ue,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Room Number"}),e.jsx("p",{className:"font-semibold",children:r.roomNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Room Type"}),e.jsx("p",{className:"font-semibold",children:((Zt=r.occupantDetails)==null?void 0:Zt.roomTypeName)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Room Price"}),e.jsx("p",{className:"font-semibold",children:p(Number(((Jt=r.occupantDetails)==null?void 0:Jt.roomPrice)||0))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Guest Name"}),e.jsx("p",{className:"font-semibold",children:((Xt=r.occupantDetails)==null?void 0:Xt.name)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Number of People"}),e.jsx("p",{className:"font-semibold",children:((ts=(es=r.occupantDetails)==null?void 0:es.mealPlan)==null?void 0:ts.numberOfPersons)||1})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Check-in Date"}),e.jsx("p",{className:"font-semibold",children:(ss=r.occupantDetails)!=null&&ss.checkInDate?Mt(r.occupantDetails.checkInDate):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Check-out Date"}),e.jsx("p",{className:"font-semibold",children:(as=r.occupantDetails)!=null&&as.checkOutDate?Mt(r.occupantDetails.checkOutDate):"N/A"})]})]}),((ns=r.occupantDetails)==null?void 0:ns.mealPlan)&&e.jsxs("div",{className:"mt-4 p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Meal Plan"}),e.jsxs("p",{className:"text-sm",children:[r.occupantDetails.mealPlan.planType," - ",r.occupantDetails.mealPlan.planName]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.occupantDetails.mealPlan.numberOfPersons," person(s) × NPR ",parseFloat(r.occupantDetails.mealPlan.pricePerPerson).toFixed(2)," = NPR ",parseFloat(r.occupantDetails.mealPlan.totalCost).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Apply Discount Voucher (Optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{value:Te,onChange:t=>fe(t.target.value.toUpperCase()),placeholder:"Enter voucher code",className:"flex-1","data-testid":"input-voucher-code"}),e.jsx(d,{type:"button",variant:"outline",onClick:As,disabled:Xe||!Te.trim(),"data-testid":"button-validate-voucher",children:Xe?"Validating...":"Apply"})]}),w&&e.jsx("div",{className:"mt-2 p-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-400",children:['✓ Voucher "',w.code,'" applied: ',w.discountType==="percentage"?`${w.discountAmount}%`:`NPR ${parseFloat(w.discountAmount).toFixed(2)}`," off"]})})]}),(()=>{var n,i,u;const t=Tt(r),s=((n=r.occupantDetails)==null?void 0:n.roomPrice)||0;return e.jsxs(me,{children:[e.jsx(ye,{children:e.jsx(ke,{className:"text-lg",children:"Payment Summary"})}),e.jsxs(ue,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("span",{className:"text-sm sm:text-base",children:["Room Charges (",t.numberOfNights," ",t.numberOfNights===1?"night":"nights"," × NPR ",parseFloat(s.toString()).toFixed(2),")"]}),e.jsxs("span",{className:"font-medium text-sm sm:text-base shrink-0","data-testid":"checkout-room-price",children:["NPR ",t.totalRoomCharges.toFixed(2)]})]}),t.totalMealPlanCharges>0&&e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("span",{className:"text-sm sm:text-base",children:["Meal Plan Charges (",t.numberOfNights," ",t.numberOfNights===1?"night":"nights"," × NPR ",t.mealPlanCostPerNight.toFixed(2),")"]}),e.jsxs("span",{className:"font-medium text-sm sm:text-base shrink-0","data-testid":"checkout-meal-price",children:["NPR ",t.totalMealPlanCharges.toFixed(2)]})]}),t.totalFoodCharges>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-sm",children:"Food & Beverage:"}),(u=(i=r.occupantDetails)==null?void 0:i.foodCharges)==null?void 0:u.map((l,m)=>e.jsx("div",{className:"pl-4 space-y-0.5",children:l.items.map((v,k)=>e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:[v.name," × ",v.quantity]}),e.jsxs("span",{children:["NPR ",v.total.toFixed(2)]})]},k))},m)),e.jsxs("div",{className:"flex justify-between font-medium text-sm pl-4 pt-1 border-t",children:[e.jsx("span",{children:"F&B Subtotal:"}),e.jsxs("span",{"data-testid":"checkout-food-price",children:["NPR ",t.totalFoodCharges.toFixed(2)]})]})]}),t.totalServiceCharges>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-sm",children:"Room Service Charges:"}),t.serviceCharges.map((l,m)=>e.jsxs("div",{className:"pl-4 flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:[l.serviceName," (",l.quantity," ",l.unit,")"]}),e.jsxs("span",{children:["NPR ",parseFloat(l.totalCharge).toFixed(2)]})]},m)),e.jsxs("div",{className:"flex justify-between font-medium text-sm pl-4 pt-1 border-t",children:[e.jsx("span",{children:"Service Subtotal:"}),e.jsxs("span",{"data-testid":"checkout-service-price",children:["NPR ",t.totalServiceCharges.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex justify-between pt-1 border-t",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{"data-testid":"checkout-subtotal",children:["NPR ",t.subtotal.toFixed(2)]})]}),t.discountAmount>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsxs("span",{children:["Discount ",w?`(${w.code})`:""]}),e.jsxs("span",{"data-testid":"checkout-discount",children:["- NPR ",t.discountAmount.toFixed(2)]})]}),t.discountAmount>0&&e.jsxs("div",{className:"flex justify-between pt-1 border-t font-medium",children:[e.jsx("span",{children:"Discounted Subtotal"}),e.jsxs("span",{"data-testid":"checkout-discounted-subtotal",children:["NPR ",t.discountedSubtotal.toFixed(2)]})]}),Object.keys(t.taxBreakdown).map(l=>{const m=t.taxBreakdown[l];return e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[l," (",m.rate,"%):"]}),e.jsxs("span",{"data-testid":`checkout-tax-${l.toLowerCase().replace(/\s+/g,"-")}`,children:["NPR ",m.amount.toFixed(2)]})]},l)}),t.totalTax>0&&e.jsxs("div",{className:"flex justify-between pt-1 border-t font-medium",children:[e.jsx("span",{children:"Total Tax"}),e.jsxs("span",{"data-testid":"checkout-total-tax",children:["NPR ",t.totalTax.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total Amount"}),e.jsxs("span",{"data-testid":"checkout-total",children:["NPR ",t.grandTotal.toFixed(2)]})]}),t.advancePayment>0&&e.jsxs("div",{className:"flex justify-between text-blue-600",children:[e.jsx("span",{children:"Advance Payment Paid"}),e.jsxs("span",{"data-testid":"checkout-advance-payment",children:["- NPR ",t.advancePayment.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-xl pt-2 border-t border-2",children:[e.jsx("span",{children:"Amount to Pay"}),e.jsxs("span",{className:"text-primary","data-testid":"checkout-final-amount",children:["NPR ",t.finalAmount.toFixed(2)]})]})]})]})})(),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Payment Method"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(d,{type:"button",variant:A==="cash"?"default":"outline",onClick:()=>re("cash"),className:"flex-1","data-testid":"button-checkout-payment-cash",children:[e.jsx(Lt,{className:"h-4 w-4 mr-2"}),"Cash"]}),e.jsxs(d,{type:"button",variant:A==="pos"?"default":"outline",onClick:()=>re("pos"),className:"flex-1","data-testid":"button-checkout-payment-pos",children:[e.jsx(At,{className:"h-4 w-4 mr-2"}),"POS"]}),e.jsxs(d,{type:"button",variant:A==="fonepay"?"default":"outline",onClick:()=>re("fonepay"),className:"flex-1","data-testid":"button-checkout-payment-fonepay",children:[e.jsx(ft,{className:"h-4 w-4 mr-2"}),"Fonepay"]})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx(d,{className:"flex-1",disabled:!A||St.isPending,onClick:()=>{var s;const t=Tt(r);St.mutate({roomId:r.id,roomNumber:r.roomNumber,guestName:((s=r.occupantDetails)==null?void 0:s.name)||"Guest",totalAmount:t.subtotal+t.totalTax,discountAmount:t.discountAmount,finalAmount:t.finalAmount,voucherId:(w==null?void 0:w.id)||void 0,billingDetails:t})},"data-testid":"button-confirm-checkout",children:St.isPending?"Processing...":"Complete Check-out & Print Receipt"}),e.jsx(d,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>{U(!1),x(null),W(""),fe(""),je(null),re("")},"data-testid":"button-cancel-checkout",children:"Cancel"})]})]})]})]})}),e.jsx(ee,{open:Ps,onOpenChange:st,children:e.jsxs(te,{className:"max-w-md",children:[e.jsx(se,{children:e.jsx(ae,{children:"Extend Guest Stay"})}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Room:"}),e.jsx("span",{className:"text-sm",children:r.roomNumber})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Guest:"}),e.jsx("span",{className:"text-sm",children:((is=r.occupantDetails)==null?void 0:is.name)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Current Checkout:"}),e.jsx("span",{className:"text-sm",children:(rs=r.occupantDetails)!=null&&rs.checkOutDate?Mt(r.occupantDetails.checkOutDate):"N/A"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"New Checkout Date"}),e.jsx(ia,{mode:"single",selected:at,onSelect:nt,disabled:t=>{var n;const s=(n=r.occupantDetails)!=null&&n.checkInDate?new Date(r.occupantDetails.checkInDate):new Date;return t<=s},className:"rounded-md border","data-testid":"calendar-extend-checkout"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(d,{className:"flex-1",disabled:!at||It.isPending,onClick:()=>{at&&r&&It.mutate({roomId:r.id,newCheckoutDate:at})},"data-testid":"button-confirm-extend",children:It.isPending?"Updating...":"Confirm Extension"}),e.jsx(d,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>{st(!1),x(null),nt(void 0)},"data-testid":"button-cancel-extend",children:"Cancel"})]})]})]})}),e.jsx(ee,{open:Ke,onOpenChange:X,children:e.jsxs(te,{className:"max-w-2xl",children:[e.jsx(se,{children:e.jsx(ae,{children:"Create New Reservation"})}),e.jsx(xt,{...b,children:e.jsxs("form",{onSubmit:b.handleSubmit(Qs),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{control:b.control,name:"guestName",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Guest Name *"}),e.jsx(S,{children:e.jsx(y,{...t,placeholder:"Full name","data-testid":"input-reservation-name"})})]})}),e.jsx(P,{control:b.control,name:"guestEmail",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Email"}),e.jsx(S,{children:e.jsx(y,{...t,type:"email",placeholder:"email@example.com","data-testid":"input-reservation-email"})})]})}),e.jsx(P,{control:b.control,name:"guestPhone",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Phone Number *"}),e.jsx(S,{children:e.jsx(y,{...t,placeholder:"Phone number","data-testid":"input-reservation-phone"})})]})}),e.jsx(P,{control:b.control,name:"roomId",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Room *"}),e.jsxs(we,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(S,{children:e.jsx(Pe,{"data-testid":"select-reservation-room",children:e.jsx(De,{placeholder:"Select room"})})}),e.jsx(Ie,{children:Qt.map(s=>{var n;return e.jsxs(H,{value:s.id,children:[s.roomNumber," - ",((n=s.roomType)==null?void 0:n.name)||"Standard"]},s.id)})})]})]})}),e.jsx(P,{control:b.control,name:"checkInDate",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Check-in Date *"}),e.jsx(S,{children:e.jsx(y,{...t,type:"date","data-testid":"input-reservation-checkin"})})]})}),e.jsx(P,{control:b.control,name:"checkOutDate",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Check-out Date *"}),e.jsx(S,{children:e.jsx(y,{...t,type:"date","data-testid":"input-reservation-checkout"})})]})}),e.jsx(P,{control:b.control,name:"numberOfPersons",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Number of Persons *"}),e.jsx(S,{children:e.jsx(y,{...t,type:"number",min:"1",placeholder:"1","data-testid":"input-reservation-persons"})})]})}),e.jsx(P,{control:b.control,name:"mealPlanId",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Meal Plan"}),e.jsxs(we,{onValueChange:t.onChange,value:t.value,children:[e.jsx(S,{children:e.jsx(Pe,{"data-testid":"select-reservation-meal-plan",children:e.jsx(De,{placeholder:"Select meal plan (optional)"})})}),e.jsx(Ie,{children:$e.map(s=>e.jsxs(H,{value:s.id,children:[s.planName," - ",p(Number(s.pricePerPerson)),"/person/day"]},s.id))})]})]})})]}),b.watch("roomId")&&b.watch("checkInDate")&&b.watch("checkOutDate")&&e.jsx(me,{className:"bg-muted",children:e.jsx(ue,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("div",{className:"flex justify-between font-medium",children:e.jsx("span",{children:"Pricing Summary:"})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Room:"}),e.jsx("span",{children:(()=>{var s;const t=M.find(n=>n.id===b.watch("roomId"));return((s=t==null?void 0:t.roomType)==null?void 0:s.name)||"N/A"})()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Room Price/Night:"}),e.jsx("span",{children:(()=>{var n;const t=M.find(i=>i.id===b.watch("roomId")),s=(n=t==null?void 0:t.roomType)==null?void 0:n.priceWalkin;return s?p(Number(s)):"N/A"})()})]}),b.watch("mealPlanId")&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Meal Plan (",b.watch("numberOfPersons")||0," persons):"]}),e.jsx("span",{children:(()=>{const t=$e.find(n=>n.id===b.watch("mealPlanId")),s=Number(b.watch("numberOfPersons"))||0;return t?`${p(Number(t.pricePerPerson))} × ${s} = ${p(Number(t.pricePerPerson)*s)}/night`:"N/A"})()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Number of Nights:"}),e.jsx("span",{children:(()=>{const t=b.watch("checkInDate"),s=b.watch("checkOutDate");if(t&&s){const n=Math.ceil((new Date(s).getTime()-new Date(t).getTime())/864e5);return n>0?n:0}return 0})()})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-base pt-2 border-t",children:[e.jsx("span",{children:"Estimated Total:"}),e.jsx("span",{children:(()=>{var k;const t=M.find(c=>c.id===b.watch("roomId")),s=(k=t==null?void 0:t.roomType)!=null&&k.priceWalkin?Number(t.roomType.priceWalkin):0,n=$e.find(c=>c.id===b.watch("mealPlanId")),i=n&&b.watch("numberOfPersons")?Number(n.pricePerPerson)*Number(b.watch("numberOfPersons")):0,u=b.watch("checkInDate"),l=b.watch("checkOutDate");let m=0;u&&l&&(m=Math.max(0,Math.ceil((new Date(l).getTime()-new Date(u).getTime())/(1e3*3600*24))));const v=(s+i)*m;return p(v)})()})]})]})})}),e.jsx(P,{control:b.control,name:"specialRequests",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Special Requests"}),e.jsx(S,{children:e.jsx(vt,{...t,placeholder:"Any special requests or notes...",rows:3,"data-testid":"textarea-special-requests"})})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(d,{type:"submit",className:"flex-1",disabled:Ot.isPending,"data-testid":"button-create-reservation",children:Ot.isPending?"Creating...":"Create Reservation"}),e.jsx(d,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>X(!1),"data-testid":"button-cancel-reservation",children:"Cancel"})]})]})})]})}),e.jsx(ee,{open:We,onOpenChange:Y,children:e.jsxs(te,{className:"max-w-md",children:[e.jsx(se,{children:e.jsx(ae,{children:"Add Room Service Charge"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Ce,{children:"Select Room *"}),e.jsxs(we,{onValueChange:t=>{const s=ce.find(n=>n.id===t);if(s&&s.occupantDetails){const n=Fe.find(i=>i.roomId===s.id&&i.status==="checked_in");if(n)lt(n.id),Y(!1),Ve(!0);else{const i=s.occupantDetails;T("POST","/api/hotels/current/reservations",{guestName:i.name||"Guest",guestEmail:i.email||"",guestPhone:i.phone||"",roomId:s.id,checkInDate:i.checkInDate||new Date().toISOString(),checkOutDate:i.checkOutDate||new Date(Date.now()+864e5).toISOString(),numberOfPersons:i.numberOfPersons||1,roomPrice:i.roomPrice||"0",mealPlanPrice:"0",totalPrice:i.roomPrice||"0",paidAmount:i.advancePayment||"0",guestType:i.guestType||"walkin",status:"checked_in"}).then(u=>{lt(u.id),C.invalidateQueries({queryKey:["/api/hotels/current/reservations"]}),Y(!1),Ve(!0)}).catch(u=>{j({title:"Error creating reservation",description:u.message,variant:"destructive"})})}}},children:[e.jsx(Pe,{"data-testid":"select-room-for-service",children:e.jsx(De,{placeholder:"Select room"})}),e.jsx(Ie,{children:ce.map(t=>{var s;return e.jsxs(H,{value:t.id,children:["Room ",t.roomNumber," - ",((s=t.occupantDetails)==null?void 0:s.name)||"Guest"]},t.id)})})]})]}),e.jsx(d,{variant:"secondary",className:"w-full",onClick:()=>Y(!1),"data-testid":"button-cancel-room-service",children:"Cancel"})]})]})}),e.jsx(ee,{open:Ye,onOpenChange:ie,children:e.jsxs(te,{className:"max-w-md",children:[e.jsx(se,{children:e.jsx(ae,{children:"Send Maintenance Request to Manager"})}),e.jsx(xt,{...Me,children:e.jsxs("form",{onSubmit:Me.handleSubmit(zs),className:"space-y-4",children:[e.jsx(P,{control:Me.control,name:"title",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Title *"}),e.jsx(S,{children:e.jsx(y,{...t,placeholder:"Brief description","data-testid":"input-maintenance-title"})})]})}),e.jsx(P,{control:Me.control,name:"location",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Location"}),e.jsx(S,{children:e.jsx(y,{...t,placeholder:"Room/Area","data-testid":"input-maintenance-location"})})]})}),e.jsx(P,{control:Me.control,name:"description",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Description"}),e.jsx(S,{children:e.jsx(vt,{...t,placeholder:"Detailed description...",rows:3,"data-testid":"textarea-maintenance-description"})})]})}),e.jsx(P,{control:Me.control,name:"priority",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Priority"}),e.jsxs(we,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(S,{children:e.jsx(Pe,{"data-testid":"select-maintenance-priority",children:e.jsx(De,{placeholder:"Select priority"})})}),e.jsxs(Ie,{children:[e.jsx(H,{value:"low",children:"Low"}),e.jsx(H,{value:"medium",children:"Medium"}),e.jsx(H,{value:"high",children:"High"}),e.jsx(H,{value:"urgent",children:"Urgent"})]})]})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(d,{type:"submit",className:"flex-1",disabled:Pt.isPending,"data-testid":"button-submit-maintenance",children:Pt.isPending?"Sending...":"Send to Manager"}),e.jsx(d,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>ie(!1),"data-testid":"button-cancel-maintenance",children:"Cancel"})]})]})})]})}),e.jsx(ee,{open:Ze,onOpenChange:Oe,children:e.jsxs(te,{className:"max-w-md",children:[e.jsx(se,{children:e.jsx(ae,{children:"Send Cash Deposit Request to Finance"})}),e.jsx(xt,{...qe,children:e.jsxs("form",{onSubmit:qe.handleSubmit(Hs),className:"space-y-4",children:[e.jsx(P,{control:qe.control,name:"amount",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Amount *"}),e.jsx(S,{children:e.jsx(y,{...t,type:"number",step:"0.01",placeholder:"0.00","data-testid":"input-deposit-amount"})})]})}),e.jsx(P,{control:qe.control,name:"paymentMethod",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Payment Method"}),e.jsxs(we,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(S,{children:e.jsx(Pe,{"data-testid":"select-deposit-method",children:e.jsx(De,{placeholder:"Select payment method"})})}),e.jsxs(Ie,{children:[e.jsx(H,{value:"cash",children:"Cash"}),e.jsx(H,{value:"pos",children:"POS"}),e.jsx(H,{value:"fonepay",children:"Fonepay"})]})]})]})}),e.jsx(P,{control:qe.control,name:"purpose",render:({field:t})=>e.jsxs(D,{children:[e.jsx(I,{children:"Purpose"}),e.jsx(S,{children:e.jsx(vt,{...t,placeholder:"Reason for deposit...",rows:2,"data-testid":"textarea-deposit-purpose"})})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(d,{type:"submit",className:"flex-1",disabled:Dt.isPending,"data-testid":"button-submit-deposit",children:Dt.isPending?"Sending...":"Send to Finance"}),e.jsx(d,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>Oe(!1),"data-testid":"button-cancel-deposit",children:"Cancel"})]})]})})]})}),e.jsx(ee,{open:Je,onOpenChange:pe,children:e.jsxs(te,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(se,{children:e.jsx(ae,{children:"Food Order - Add to Room Bill"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Select Room"}),e.jsxs(we,{onValueChange:t=>x(ce.find(s=>s.id===t)),children:[e.jsx(Pe,{"data-testid":"select-food-order-room",children:e.jsx(De,{placeholder:"Select room"})}),e.jsx(Ie,{children:ce.map(t=>{var s;return e.jsxs(H,{value:t.id,children:["Room ",t.roomNumber," - ",((s=t.occupantDetails)==null?void 0:s.name)||"Guest"]},t.id)})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Search Food"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ns,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(y,{placeholder:"Search by name...",value:f,onChange:t=>K(t.target.value),className:"pl-8","data-testid":"input-food-search"})]})]}),e.jsxs("div",{className:"w-48",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Category"}),e.jsxs(we,{value:ve,onValueChange:bt,children:[e.jsx(Pe,{"data-testid":"select-food-category",children:e.jsx(De,{placeholder:"All categories"})}),e.jsxs(Ie,{children:[e.jsx(H,{value:"all",children:"All Categories"}),$s.map(t=>e.jsx(H,{value:t.id,children:t.name},t.id))]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 max-h-64 overflow-y-auto border rounded p-2",children:_t.length===0?e.jsx("div",{className:"col-span-2 text-center py-8 text-muted-foreground",children:"No menu items found"}):_t.map(t=>e.jsxs("div",{className:"border rounded p-3 hover:bg-accent cursor-pointer",onClick:()=>Us(t),"data-testid":`food-item-${t.id}`,children:[e.jsx("h4",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description}),e.jsx("p",{className:"text-sm font-bold mt-1",children:p(Number(t.price||0))})]},t.id))}),_.length>0&&e.jsxs("div",{className:"border rounded p-3 space-y-2",children:[e.jsx("h3",{className:"font-bold",children:"Order Items"}),_.map(({item:t,quantity:s})=>e.jsxs("div",{className:"flex items-center justify-between","data-testid":`order-item-${t.id}`,children:[e.jsx("div",{className:"flex-1",children:e.jsx("span",{className:"font-medium",children:t.name})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Yt(t.id,s-1),"data-testid":`decrease-qty-${t.id}`,children:"-"}),e.jsx("span",{className:"w-8 text-center","data-testid":`qty-${t.id}`,children:s}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Yt(t.id,s+1),"data-testid":`increase-qty-${t.id}`,children:"+"}),e.jsx("span",{className:"w-24 text-right font-bold",children:p(Number(t.price)*s)}),e.jsx(d,{size:"sm",variant:"destructive",onClick:()=>Wt(t.id),"data-testid":`remove-item-${t.id}`,children:"Remove"})]})]},t.id)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{"data-testid":"total-amount",children:p(_.reduce((t,{item:s,quantity:n})=>t+Number(s.price)*n,0))})]})})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(d,{className:"flex-1",onClick:_s,disabled:!r||_.length===0,"data-testid":"button-submit-food-order",children:"Add to Room Bill"}),e.jsx(d,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>{pe(!1),Ae([]),K(""),bt("all"),x(null)},"data-testid":"button-cancel-food-order",children:"Cancel"})]})]})]})}),e.jsx(ee,{open:Ds,onOpenChange:kt,children:e.jsxs(te,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(se,{children:e.jsx(ae,{children:"Reservations Calendar"})}),e.jsx("div",{className:"space-y-4",children:Fe.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(qt,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No reservations found"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b pb-4",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{const t=new Date(Ge);t.setMonth(t.getMonth()-1),Gt(t)},"data-testid":"button-prev-month",children:"← Previous"}),e.jsx("h3",{className:"text-lg font-semibold",children:Ge.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{const t=new Date(Ge);t.setMonth(t.getMonth()+1),Gt(t)},"data-testid":"button-next-month",children:"Next →"})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{className:"text-center font-semibold text-sm py-2",children:t},t)),(()=>{const t=Ge.getFullYear(),s=Ge.getMonth(),n=new Date(t,s,1),u=new Date(t,s+1,0).getDate(),l=n.getDay(),m=[];for(let v=0;v<l;v++)m.push(e.jsx("div",{className:"aspect-square"},`empty-${v}`));for(let v=1;v<=u;v++){const k=new Date(t,s,v,0,0,0,0),c=Fe.filter(F=>{const q=new Date(F.checkInDate),Q=new Date(F.checkOutDate),le=new Date(q.getFullYear(),q.getMonth(),q.getDate(),0,0,0,0),R=new Date(Q.getFullYear(),Q.getMonth(),Q.getDate(),0,0,0,0),z=new Date(k.getFullYear(),k.getMonth(),k.getDate(),0,0,0,0);return z.getTime()>=le.getTime()&&z.getTime()<=R.getTime()}),h=new Date;h.setHours(0,0,0,0),k.setHours(0,0,0,0);const $=k.getTime()===h.getTime(),B=J&&k.toDateString()===J.toDateString();m.push(e.jsxs("button",{onClick:()=>Is(k),className:Xs("aspect-square p-2 border rounded-lg hover:bg-muted transition-colors relative",$&&"border-blue-500 border-2",B&&"bg-blue-100 dark:bg-blue-950",c.length>0&&"bg-green-50 dark:bg-green-950/20"),"data-testid":`calendar-day-${v}`,children:[e.jsx("div",{className:"text-sm font-medium",children:v}),c.length>0&&e.jsx("div",{className:"absolute bottom-1 left-1/2 -translate-x-1/2 flex gap-0.5",children:c.slice(0,3).map((F,q)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"},q))})]},v))}return m})()]}),J&&(()=>{const t=Fe.filter(s=>{const n=new Date(s.checkInDate),i=new Date(s.checkOutDate),u=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),l=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),m=new Date(J.getFullYear(),J.getMonth(),J.getDate(),0,0,0,0);return m.getTime()>=u.getTime()&&m.getTime()<=l.getTime()});return t.length>0?e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h4",{className:"font-semibold mb-3",children:["Reservations for ",J.toLocaleDateString()," (",t.length,")"]}),e.jsx("div",{className:"space-y-3",children:t.map(s=>{var B;const n=M.find(F=>F.id===s.roomId),i=$e.find(F=>F.id===s.mealPlanId),u=new Date(s.checkInDate),l=new Date(s.checkOutDate),m=new Date(u.getFullYear(),u.getMonth(),u.getDate(),0,0,0,0),v=new Date(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0,0),k=new Date(J.getFullYear(),J.getMonth(),J.getDate(),0,0,0,0),c=k.getTime()===m.getTime(),h=k.getTime()===v.getTime(),$=Math.ceil((v.getTime()-m.getTime())/(1e3*3600*24));return e.jsx("div",{className:"p-4 border rounded-lg bg-card hover:bg-muted/50 transition-colors","data-testid":`reservation-${s.id}`,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h5",{className:"font-semibold text-lg","data-testid":"text-guest-name",children:s.guestName}),e.jsx(Re,{variant:"outline",children:s.status}),c&&e.jsx(Re,{className:"bg-green-500",children:"Check-in Day"}),h&&e.jsx(Re,{className:"bg-orange-500",children:"Check-out Day"})]})}),c&&s.status==="confirmed"&&e.jsxs(d,{size:"sm",onClick:()=>{Ht(s),kt(!1)},"data-testid":"button-quick-checkin-modal",children:[e.jsx(gt,{className:"h-4 w-4 mr-1"}),"Check-in"]})]}),e.jsxs("div",{className:"bg-muted/50 p-3 rounded-md",children:[e.jsx("h6",{className:"text-sm font-semibold mb-2 text-muted-foreground",children:"Guest Contact"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Et,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("span",{className:"text-muted-foreground",children:s.guestEmail||"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("span",{className:"text-muted-foreground",children:s.guestPhone||"N/A"})]})]})]}),e.jsxs("div",{className:"bg-muted/50 p-3 rounded-md",children:[e.jsx("h6",{className:"text-sm font-semibold mb-2 text-muted-foreground",children:"Reservation Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Room:"}),e.jsxs("span",{className:"text-muted-foreground",children:[(n==null?void 0:n.roomNumber)||"N/A"," - ",((B=n==null?void 0:n.roomType)==null?void 0:B.name)||"Standard"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Et,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Guests:"}),e.jsxs("span",{className:"text-muted-foreground",children:[s.numberOfPersons," ",s.numberOfPersons===1?"person":"persons"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Check-in:"}),e.jsx("span",{className:"text-muted-foreground",children:u.toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Check-out:"}),e.jsx("span",{className:"text-muted-foreground",children:l.toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(na,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Duration:"}),e.jsxs("span",{className:"text-muted-foreground",children:[$," ",$===1?"night":"nights"]})]}),i&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Meal Plan:"}),e.jsx("span",{className:"text-muted-foreground",children:i.planName})]})]})]}),e.jsxs("div",{className:"bg-muted/50 p-3 rounded-md",children:[e.jsx("h6",{className:"text-sm font-semibold mb-2 text-muted-foreground",children:"Pricing"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Room (",p(Number(s.roomPrice||0))," × ",$," ",$===1?"night":"nights","):"]}),e.jsx("span",{className:"font-medium",children:p(Number(s.roomPrice||0)*$)})]}),i&&s.mealPlanPrice&&Number(s.mealPlanPrice)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Meal Plan (",p(Number(s.mealPlanPrice))," × ",$," ",$===1?"night":"nights","):"]}),e.jsx("span",{className:"font-medium",children:p(Number(s.mealPlanPrice)*$)})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t font-semibold text-base",children:[e.jsx("span",{children:"Total Amount:"}),e.jsx("span",{className:"text-primary",children:p(Number(s.totalPrice||0))})]})]})]}),s.specialRequests&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-950/20 p-3 rounded-md border border-amber-200 dark:border-amber-800",children:[e.jsxs("h6",{className:"text-sm font-semibold mb-1 flex items-center gap-2",children:[e.jsx(bs,{className:"h-4 w-4"}),"Special Requests"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.specialRequests})]})]})},s.id)})})]}):e.jsxs("div",{className:"border-t pt-4 text-center text-muted-foreground",children:[e.jsx(qt,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsxs("p",{children:["No reservations on ",J.toLocaleDateString()]})]})})(),e.jsxs("div",{className:"border-t pt-4 flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 rounded"}),e.jsx("span",{children:"Today"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-50 dark:bg-green-950/20 border rounded"}),e.jsx("span",{children:"Has Reservations"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),e.jsx("span",{children:"Reservation Indicator"})]})]})]})})]})}),e.jsx(ca,{open:Ss,onOpenChange:Ve,reservationId:Os})]})})}export{Pa as default};
