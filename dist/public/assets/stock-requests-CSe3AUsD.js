import{u as v,b as h,l as c,d as l,j as e,C as j,m as y,n as g,y as k,a as f,B as u,k as m}from"./index-CuDmVYun.js";import{D as N,o as b,ad as C,i as q}from"./dashboard-layout-RBv1DXX2.js";import{B as S}from"./badge-DMaRL5Qw.js";import{u as R}from"./use-realtime-query-CGmARpos.js";import{P as w}from"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./use-websocket-CCUHb1Px.js";function $(){const{toast:a}=v(),r=h(),{data:p=[]}=c({queryKey:["/api/hotels/current/inventory-items"],refetchInterval:3e3}),{data:n=[]}=c({queryKey:["/api/hotels/current/stock-requests/pending"],refetchInterval:3e3});R({queryKey:["/api/hotels/current/stock-requests/pending"],refetchInterval:3e3,events:["stock-request:created","stock-request:updated"]});const d=l({mutationFn:async s=>await m("PATCH",`/api/hotels/current/stock-requests/${s}/approve`,{}),onSuccess:()=>{r.invalidateQueries({queryKey:["/api/hotels/current/stock-requests/pending"]}),a({title:"Success",description:"Stock request approved"})},onError:s=>{a({title:"Error",description:s.message||"Failed to approve request",variant:"destructive"})}}),o=l({mutationFn:async s=>await m("PATCH",`/api/hotels/current/stock-requests/${s}/deliver`,{}),onSuccess:()=>{r.invalidateQueries({queryKey:["/api/hotels/current/stock-requests/pending"]}),r.invalidateQueries({queryKey:["/api/hotels/current/inventory-items"]}),a({title:"Success",description:"Stock delivered and inventory updated"})},onError:s=>{a({title:"Error",description:s.message||"Failed to deliver stock",variant:"destructive"})}}),x=s=>p.find(t=>t.id===s);return e.jsx(N,{title:"Stock Requests",children:e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Stock Requests"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage pending stock requests from staff"})]}),e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsx(g,{children:"Pending Requests"}),e.jsx(k,{children:"Approve and deliver stock requests"})]}),e.jsx(f,{children:n.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(w,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No pending stock requests"})]}):e.jsx("div",{className:"space-y-3",children:n.map(s=>{const t=x(s.itemId),i=s.status==="approved";return e.jsxs("div",{className:"border rounded-lg p-4","data-testid":`request-${s.id}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-lg","data-testid":`text-item-${s.id}`,children:(t==null?void 0:t.name)||"Unknown Item"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Requested Quantity: ",e.jsxs("span",{className:"font-medium",children:[s.quantity," ",s.unit]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Available Stock: ",e.jsxs("span",{className:"font-medium",children:[(t==null?void 0:t.baseStockQty)||(t==null?void 0:t.stockQty)||0," ",(t==null?void 0:t.baseUnit)||(t==null?void 0:t.unit)||"units"]})]}),s.notes&&e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:["Notes: ",s.notes]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["Requested: ",new Date(s.createdAt).toLocaleString()]}),i&&s.approvedAt&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Approved: ",new Date(s.approvedAt).toLocaleString()]})]}),e.jsx("div",{className:"flex gap-2",children:i?e.jsxs(u,{size:"sm",onClick:()=>o.mutate(s.id),disabled:o.isPending,"data-testid":`button-deliver-${s.id}`,children:[e.jsx(C,{className:"w-4 h-4 mr-1"}),"Mark Delivered"]}):e.jsxs(u,{size:"sm",onClick:()=>d.mutate(s.id),disabled:d.isPending,"data-testid":`button-approve-${s.id}`,children:[e.jsx(b,{className:"w-4 h-4 mr-1"}),"Approve"]})})]}),i&&e.jsx("div",{className:"mt-2",children:e.jsxs(S,{variant:"outline",className:"bg-blue-50",children:[e.jsx(q,{className:"w-3 h-3 mr-1"})," Ready for Pickup"]})})]},s.id)})})})]})]})})}export{$ as default};
