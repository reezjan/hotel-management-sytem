import{v as F,r as g,b as q,l as b,d as O,j as e,C as m,a as h,s as n,I as i,B as y}from"./index-CuDmVYun.js";import{D as T,Y as N,Z as u}from"./dashboard-layout-RBv1DXX2.js";import{D as I}from"./data-table-B69p7Klv.js";import{S as L,a as P,b as K,c as M,d as B}from"./select-7c0Tajxe.js";import{D as U,a as _,b as Q,c as $}from"./dialog-CYNkLpdV.js";import{t as o}from"./index-hq1wgpuD.js";import{U as x}from"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./badge-DMaRL5Qw.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";function ae(){const{confirm:w}=F(),[S,c]=g.useState(!1),[r,t]=g.useState({username:"",email:"",phone:"",fullName:"",address:"",password:"",role:""}),p=q(),{data:C=[],isLoading:v}=b({queryKey:["/api/hotels/current/users"],refetchInterval:3e3}),d=C.filter(s=>{var a;return["waiter","kitchen_staff","bartender","barista","cashier"].includes(((a=s.role)==null?void 0:a.name)||"")}),{data:j=[]}=b({queryKey:["/api/attendance/daily"],refetchInterval:3e3}),D=[{name:"waiter",label:"Waiter"},{name:"kitchen_staff",label:"Kitchen Staff"},{name:"bartender",label:"Bartender"},{name:"barista",label:"Barista"},{name:"cashier",label:"Cashier"}],f=O({mutationFn:async s=>{const a=await fetch("/api/hotels/current/users",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!a.ok){const l=await a.json();throw new Error(l.message||"Failed to create staff member")}return a.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/hotels/current/users"]}),c(!1),t({username:"",email:"",phone:"",fullName:"",address:"",password:"",role:""}),o.success("Restaurant staff member created successfully")},onError:s=>{o.error(s.message)}}),E=()=>{if(!r.username||!r.email||!r.password||!r.role||!r.phone||!r.fullName||!r.address){o.error("Please fill in all required fields (username, email, password, role, phone, full name, and address)");return}f.mutate({...r,confirmPassword:r.password})},k=async s=>{await w({title:"Remove Staff Member",description:`Are you sure you want to remove ${s.username}?`,confirmText:"Remove",cancelText:"Cancel",variant:"destructive",onConfirm:async()=>{try{if(!(await fetch(`/api/hotels/current/users/${s.id}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Failed to delete staff member");p.invalidateQueries({queryKey:["/api/hotels/current/users"]}),o.success("Staff member removed successfully")}catch(a){o.error(a.message)}}})},A=[{key:"fullName",label:"Name",sortable:!0,render:(s,a)=>s&&s.trim()?s:a.username||"-"},{key:"username",label:"Username",sortable:!0},{key:"address",label:"Address",sortable:!0,render:s=>s||"-"},{key:"role",label:"Role",sortable:!0,render:s=>{var a;return e.jsxs("div",{className:"flex items-center space-x-2",children:[(s==null?void 0:s.name)==="waiter"&&e.jsx(x,{className:"h-4 w-4 text-blue-500"}),(s==null?void 0:s.name)==="kitchen_staff"&&e.jsx(N,{className:"h-4 w-4 text-green-500"}),(s==null?void 0:s.name)==="bartender"&&e.jsx(u,{className:"h-4 w-4 text-purple-500"}),(s==null?void 0:s.name)==="barista"&&e.jsx(u,{className:"h-4 w-4 text-orange-500"}),(s==null?void 0:s.name)==="cashier"&&e.jsx(x,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{children:(a=s==null?void 0:s.name)==null?void 0:a.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase())})]})}},{key:"id",label:"Status",render:s=>{const a=j.some(l=>l.userId===s&&l.status==="active");return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs ${a?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a?"On Duty":"Off Duty"})}},{key:"lastLogin",label:"Last Active",sortable:!0,render:s=>s?new Date(s).toLocaleString("en-GB",{timeZone:"Asia/Kathmandu"}):"Never"}],R=[{label:"Remove",action:k,variant:"destructive"}];return e.jsx(T,{title:"Restaurant Staff Management",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(m,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Staff"}),e.jsx("p",{className:"text-2xl font-bold",children:d.length})]}),e.jsx(x,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(m,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"On Duty"}),e.jsx("p",{className:"text-2xl font-bold",children:d.filter(s=>j.some(a=>a.userId===s.id&&a.status==="active")).length})]}),e.jsx("div",{className:"h-8 w-8 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx("div",{className:"h-4 w-4 rounded-full bg-green-500"})})]})})}),e.jsx(m,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Kitchen Staff"}),e.jsx("p",{className:"text-2xl font-bold",children:d.filter(s=>{var a;return["kitchen_staff","barista"].includes(((a=s.role)==null?void 0:a.name)||"")}).length})]}),e.jsx(N,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(m,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Service Staff"}),e.jsx("p",{className:"text-2xl font-bold",children:d.filter(s=>{var a;return["waiter","bartender","cashier"].includes(((a=s.role)==null?void 0:a.name)||"")}).length})]}),e.jsx(u,{className:"h-8 w-8 text-purple-500"})]})})})]}),e.jsx(I,{title:"Restaurant Staff",data:d,columns:A,actions:R,isLoading:v,onAdd:()=>c(!0),addButtonLabel:"Add Staff Member",searchPlaceholder:"Search restaurant staff..."}),e.jsx(U,{open:S,onOpenChange:c,children:e.jsxs(_,{children:[e.jsx(Q,{children:e.jsx($,{children:"Add Restaurant Staff Member"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"username",children:"Username *"}),e.jsx(i,{id:"username",value:r.username,onChange:s=>t({...r,username:s.target.value}),placeholder:"Enter username"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"email",children:"Email *"}),e.jsx(i,{id:"email",type:"email",value:r.email,onChange:s=>t({...r,email:s.target.value}),placeholder:"Enter email"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"phone",children:"Phone *"}),e.jsx(i,{id:"phone",value:r.phone,onChange:s=>t({...r,phone:s.target.value}),placeholder:"Enter phone number",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"fullName",children:"Full Name *"}),e.jsx(i,{id:"fullName",value:r.fullName,onChange:s=>t({...r,fullName:s.target.value}),placeholder:"Enter full name",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"address",children:"Address *"}),e.jsx(i,{id:"address",value:r.address,onChange:s=>t({...r,address:s.target.value}),placeholder:"Enter address",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"role",children:"Role *"}),e.jsxs(L,{value:r.role,onValueChange:s=>t({...r,role:s}),children:[e.jsx(P,{children:e.jsx(K,{placeholder:"Select role"})}),e.jsx(M,{children:D.map(s=>e.jsx(B,{value:s.name,children:s.label},s.name))})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"password",children:"Password *"}),e.jsx(i,{id:"password",type:"password",value:r.password,onChange:s=>t({...r,password:s.target.value}),placeholder:"Enter password"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(y,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(y,{onClick:E,disabled:f.isPending,children:f.isPending?"Creating...":"Create Staff"})]})]})]})})]})})}export{ae as default};
