import{u as T,b as E,r as c,l as L,d as O,j as e,s as m,B as r}from"./index-CuDmVYun.js";import{D as Q,o as $,q as z,i as I}from"./dashboard-layout-RBv1DXX2.js";import{D as K}from"./data-table-B69p7Klv.js";import{B as h}from"./badge-DMaRL5Qw.js";import{D as g,a as j,b as y,c as v,e as b}from"./dialog-CYNkLpdV.js";import{T as f}from"./textarea-CpuNoaOI.js";import"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";function Y(){const{toast:d}=T(),k=E(),[q,i]=c.useState(!1),[D,o]=c.useState(!1),[l,u]=c.useState(null),[n,p]=c.useState(""),{data:w=[],isLoading:C}=L({queryKey:["/api/hotels/current/maintenance-requests"],refetchInterval:3e3,queryFn:async()=>{const t=await fetch("/api/hotels/current/maintenance-requests",{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch maintenance requests");return t.json()}}),a=O({mutationFn:async({id:t,status:s,notes:M})=>{const x=await fetch(`/api/maintenance-requests/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:s,notes:M})});if(!x.ok)throw new Error("Failed to update request");return x.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/hotels/current/maintenance-requests"]}),d({title:"Request updated successfully"}),i(!1),o(!1),u(null),p("")},onError:t=>{d({title:t.message,variant:"destructive"})}}),N=t=>{u(t),i(!0)},A=t=>{u(t),o(!0)},R=()=>{l&&a.mutate({id:l.id,status:"approved",notes:n||void 0})},S=()=>{if(!l||!n.trim()){d({title:"Please provide a reason for declining",variant:"destructive"});return}a.mutate({id:l.id,status:"declined",notes:n})},P=t=>{const s={high:"destructive",medium:"default",low:"secondary"};return e.jsx(h,{variant:s[t],children:t})},B=t=>{const s={pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",approved:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",declined:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",in_progress:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",resolved:"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"};return e.jsx(h,{className:s[t]||"",children:t})},F=[{key:"title",label:"Issue",sortable:!0,render:(t,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t}),s.description&&e.jsx("div",{className:"text-sm text-muted-foreground truncate max-w-xs",children:s.description})]})},{key:"location",label:"Location",sortable:!0},{key:"reportedBy",label:"Reported By",render:t=>{var s;return e.jsxs("div",{children:[e.jsx("div",{children:(t==null?void 0:t.username)||"Unknown"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:((s=t==null?void 0:t.role)==null?void 0:s.name)||""})]})}},{key:"priority",label:"Priority",sortable:!0,render:t=>P(t)},{key:"status",label:"Status",sortable:!0,render:t=>B(t)},{key:"createdAt",label:"Date Reported",sortable:!0,render:t=>new Date(t).toLocaleDateString()},{key:"actions",label:"Actions",render:(t,s)=>e.jsxs("div",{className:"flex gap-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>N(s),"data-testid":`button-approve-${s.id}`,children:[e.jsx($,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>A(s),"data-testid":`button-decline-${s.id}`,children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Decline"]})]}),s.status==="approved"&&e.jsxs(h,{variant:"secondary",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),"Awaiting Assignment"]})]})}];return e.jsxs(Q,{title:"Maintenance Requests",children:[e.jsx("div",{className:"space-y-6",children:e.jsx(K,{title:"All Maintenance Requests",data:w,columns:F,isLoading:C,searchPlaceholder:"Search requests..."})}),e.jsx(g,{open:q,onOpenChange:i,children:e.jsxs(j,{children:[e.jsx(y,{children:e.jsx(v,{children:"Approve Maintenance Request"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{children:"Are you sure you want to approve this maintenance request?"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"approve-notes",children:"Notes (Optional)"}),e.jsx(f,{id:"approve-notes",value:n,onChange:t=>p(t.target.value),placeholder:"Add any approval notes or instructions...",rows:3})]})]}),e.jsxs(b,{children:[e.jsx(r,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(r,{onClick:R,disabled:a.isPending,children:a.isPending?"Approving...":"Approve"})]})]})}),e.jsx(g,{open:D,onOpenChange:o,children:e.jsxs(j,{children:[e.jsx(y,{children:e.jsx(v,{children:"Decline Maintenance Request"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{children:"Please provide a reason for declining this maintenance request:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"decline-notes",children:"Reason *"}),e.jsx(f,{id:"decline-notes",value:n,onChange:t=>p(t.target.value),placeholder:"Explain why this request is being declined...",rows:3,required:!0})]})]}),e.jsxs(b,{children:[e.jsx(r,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(r,{variant:"destructive",onClick:S,disabled:a.isPending||!n.trim(),children:a.isPending?"Declining...":"Decline"})]})]})})]})}export{Y as default};
