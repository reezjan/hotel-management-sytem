import{r as p,b as _,l as C,d as S,j as e,C as v,a as f,s as z,B as k}from"./index-CuDmVYun.js";import{D as H,i as A,o as T,q as E,x as X}from"./dashboard-layout-RBv1DXX2.js";import{D as L}from"./data-table-B69p7Klv.js";import{T as G}from"./textarea-CpuNoaOI.js";import{D as V,a as W,b as Y,c as Z}from"./dialog-CYNkLpdV.js";import{B as ee}from"./badge-DMaRL5Qw.js";import{t as m}from"./index-hq1wgpuD.js";import{u as P}from"./use-realtime-query-CGmARpos.js";import"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./use-websocket-CCUHb1Px.js";function me(){var w,R;const[t,h]=p.useState(null),[F,o]=p.useState(!1),[n,B]=p.useState("approve"),[c,d]=p.useState(""),u=_(),{data:y=[],isLoading:q}=C({queryKey:["/api/hotels/current/leave-requests/pending-approvals"],refetchInterval:3e3,queryFn:async()=>{const s=await fetch("/api/hotels/current/leave-requests/pending-approvals",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch pending leave requests");return s.json()}}),{data:x=[]}=C({queryKey:["/api/hotels/current/leave-requests"],refetchInterval:3e3,queryFn:async()=>{const s=await fetch("/api/hotels/current/leave-requests",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch leave requests");return s.json()}});P({queryKey:["/api/hotels/current/leave-requests/pending-approvals"],refetchInterval:3e3,events:["leave:created","leave:updated"]}),P({queryKey:["/api/hotels/current/leave-requests"],refetchInterval:3e3,events:["leave:created","leave:updated"]});const j=S({mutationFn:async({id:s,notes:r})=>{const a=await fetch(`/api/leave-requests/${s}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({managerNotes:r})});if(!a.ok){const i=await a.json();throw new Error(i.message||"Failed to approve leave request")}return a.json()},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/hotels/current/leave-requests/pending-approvals"]}),u.invalidateQueries({queryKey:["/api/hotels/current/leave-requests"]}),o(!1),h(null),d(""),m.success("Leave request approved successfully")},onError:s=>{m.error(s.message)}}),g=S({mutationFn:async({id:s,notes:r})=>{const a=await fetch(`/api/leave-requests/${s}/reject`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({managerNotes:r})});if(!a.ok){const i=await a.json();throw new Error(i.message||"Failed to reject leave request")}return a.json()},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/hotels/current/leave-requests/pending-approvals"]}),u.invalidateQueries({queryKey:["/api/hotels/current/leave-requests"]}),o(!1),h(null),d(""),m.success("Leave request rejected")},onError:s=>{m.error(s.message)}}),N=(s,r)=>{h(s),B(r),d(""),o(!0)},K=()=>{t&&(n==="approve"?j.mutate({id:t.id,notes:c}):g.mutate({id:t.id,notes:c}))},O=s=>{switch(s){case"approved":return e.jsx(T,{className:"h-4 w-4 text-green-500"});case"rejected":return e.jsx(E,{className:"h-4 w-4 text-red-500"});default:return e.jsx(A,{className:"h-4 w-4 text-orange-500"})}},U=s=>{switch(s){case"approved":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-orange-100 text-orange-800 border-orange-200"}},l=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),b=(s,r)=>{const a=new Date(s),i=new Date(r),J=Math.abs(i.getTime()-a.getTime());return Math.ceil(J/(1e3*60*60*24))+1},D=[{key:"requestedBy",label:"Employee",render:(s,r)=>{var a;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:((a=r.requestedByUser)==null?void 0:a.username)||"Unknown User"})]})}},{key:"leaveType",label:"Type",sortable:!0,render:s=>e.jsx("span",{className:"font-medium capitalize",children:s==null?void 0:s.replace(/_/g," ")})},{key:"startDate",label:"Start Date",sortable:!0,render:s=>l(s)},{key:"endDate",label:"End Date",sortable:!0,render:s=>l(s)},{key:"duration",label:"Duration",render:(s,r)=>e.jsxs("span",{className:"text-sm text-muted-foreground",children:[b(r.startDate,r.endDate)," day(s)"]})},{key:"reason",label:"Reason",render:s=>e.jsx("span",{className:"text-sm text-muted-foreground max-w-xs truncate",children:s||"No reason provided"})},{key:"createdAt",label:"Submitted",sortable:!0,render:s=>l(s)}],M=[...D,{key:"status",label:"Status",render:s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[O(s),e.jsx(ee,{variant:"outline",className:U(s),children:(s==null?void 0:s.charAt(0).toUpperCase())+(s==null?void 0:s.slice(1))})]})},{key:"managerNotes",label:"Notes",render:s=>e.jsx("span",{className:"text-sm text-muted-foreground max-w-xs truncate",children:s||"-"})}],Q=[{label:"Approve",action:s=>N(s,"approve"),variant:"default"},{label:"Reject",action:s=>N(s,"reject"),variant:"destructive"}],I=x.filter(s=>s.status==="approved").length,$=x.filter(s=>s.status==="rejected").length;return e.jsx(H,{title:"Leave Request Approvals",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(v,{children:e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending Approval"}),e.jsx("p",{className:"text-2xl font-bold",children:y.length})]}),e.jsx(A,{className:"h-8 w-8 text-orange-500"})]})})}),e.jsx(v,{children:e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold",children:I})]}),e.jsx(T,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(v,{children:e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold",children:$})]}),e.jsx(E,{className:"h-8 w-8 text-red-500"})]})})})]}),e.jsx(L,{title:"Pending Leave Requests",data:y,columns:D,actions:Q,isLoading:q,searchPlaceholder:"Search pending requests..."}),e.jsx(L,{title:"All Leave Requests",data:x,columns:M,isLoading:q,searchPlaceholder:"Search all requests..."}),e.jsx(V,{open:F,onOpenChange:o,children:e.jsxs(W,{className:"max-w-md",children:[e.jsx(Y,{children:e.jsxs(Z,{children:[n==="approve"?"Approve":"Reject"," Leave Request"]})}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Request Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Employee:"})," ",((w=t.requestedByUser)==null?void 0:w.username)||"Unknown"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",(R=t.leaveType)==null?void 0:R.replace(/_/g," ")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Period:"})," ",l(t.startDate)," - ",l(t.endDate)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Duration:"})," ",b(t.startDate,t.endDate)," day(s)"]}),t.reason&&e.jsxs("p",{children:[e.jsx("strong",{children:"Reason:"})," ",t.reason]})]})]}),e.jsxs("div",{children:[e.jsxs(z,{htmlFor:"managerNotes",children:["Manager Notes ",n==="reject"?"(Required)":"(Optional)"]}),e.jsx(G,{id:"managerNotes",value:c,onChange:s=>d(s.target.value),placeholder:`Add notes for the ${n} decision...`,rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(k,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(k,{onClick:K,disabled:j.isPending||g.isPending||n==="reject"&&!c.trim(),variant:n==="approve"?"default":"destructive",children:j.isPending||g.isPending?n==="approve"?"Approving...":"Rejecting...":n==="approve"?"Approve Request":"Reject Request"})]})]})]})})]})})}export{me as default};
