import{q as b,u as C,b as w,o as O,v as k,l as c,d as T,j as e,C as n,a as r,m as D,n as E,a2 as q,B as o,k as L}from"./index-CuDmVYun.js";import{D as A,p as B,i as I,L as S,t as K,k as M}from"./dashboard-layout-RBv1DXX2.js";import{B as m}from"./badge-DMaRL5Qw.js";import"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";function P(){const{user:l}=b(),{toast:i}=C(),x=w(),[,u]=O(),{confirm:h}=k(),{data:a=[]}=c({queryKey:["/api/hotels/current/kot-orders"],refetchInterval:3e3,select:s=>s.filter(t=>t.createdBy===(l==null?void 0:l.id))}),{data:j=[]}=c({queryKey:["/api/hotels/current/restaurant-tables"],refetchInterval:3e3}),d=T({mutationFn:async s=>{await L("DELETE",`/api/kot-orders/${s}`)},onSuccess:()=>{x.invalidateQueries({queryKey:["/api/hotels/current/kot-orders"]}),i({title:"Order deleted successfully"})},onError:s=>{i({title:"Error",description:s.message,variant:"destructive"})}}),p=a.filter(s=>["open","preparing"].includes(s.status)),f=a.filter(s=>["served","completed"].includes(s.status)),v=s=>{const t=j.find(y=>y.id===s);return(t==null?void 0:t.name)||"Unknown Table"},g=async(s,t)=>{if(t==="served"||t==="completed"){i({title:"Cannot delete",description:"Completed orders cannot be deleted",variant:"destructive"});return}await h({title:"Delete Order",description:"Are you sure you want to delete this order? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",variant:"destructive",onConfirm:()=>{d.mutate(s)}})},N=s=>{i({title:"Edit order in main dashboard",description:"Right-click on the table to edit orders"}),u("/waiter")};return e.jsx(A,{title:"My Orders",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(n,{children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold",children:a.length})]}),e.jsx(B,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(n,{children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold",children:p.length})]}),e.jsx(I,{className:"h-8 w-8 text-orange-500"})]})})}),e.jsx(n,{children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold",children:f.length})]}),e.jsx(S,{className:"h-8 w-8 text-green-500"})]})})})]}),e.jsxs(n,{children:[e.jsx(D,{children:e.jsx(E,{children:"All Orders"})}),e.jsx(r,{children:e.jsx("div",{className:"space-y-3",children:a.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No orders found"}):a.map(s=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between p-4 border rounded-lg hover:bg-accent/50 transition-colors gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h4",{className:"font-medium text-foreground",children:v(s.tableId)}),e.jsx(m,{className:q(s.status),variant:"secondary",children:s.status})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Order #",s.id.slice(0,8)," â€¢ ",new Date(s.createdAt).toLocaleString()]}),s.items&&s.items.length>0&&e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[s.items.length," item(s)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status!=="served"&&s.status!=="completed"&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>N(s.id),"data-testid":`button-edit-order-${s.id}`,children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>g(s.id,s.status),"data-testid":`button-delete-order-${s.id}`,disabled:d.isPending,children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Delete"]})]}),(s.status==="served"||s.status==="completed")&&e.jsx(m,{variant:"secondary",className:"text-xs",children:"Completed"})]})]},s.id))})})]})]})})}export{P as default};
