import{u as F,b as I,l as _,r as E,d as L,j as e,C as g,m as f,n as y,a as N,s as c,I as l,B as x}from"./index-CuDmVYun.js";import{D as R,e as V,f as b}from"./dashboard-layout-RBv1DXX2.js";import{S as T}from"./switch-ZsqMJgRS.js";import{u as q}from"./use-realtime-query-CGmARpos.js";import{S as B}from"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./index-dzpsPapz.js";import"./use-websocket-CCUHb1Px.js";function J(){const{toast:o}=F(),P=I(),{data:d=[]}=_({queryKey:["/api/hotels/current/taxes"],refetchInterval:3e3}),{data:n}=_({queryKey:["/api/hotels/current"],refetchInterval:3e3});q({queryKey:["/api/hotels/current/taxes"],events:["tax:updated","tax:created"]});const[a,u]=E.useState({vat:{taxType:"vat",percent:13,isActive:!1},service_tax:{taxType:"service_tax",percent:10,isActive:!1},luxury_tax:{taxType:"luxury_tax",percent:5,isActive:!1}});E.useEffect(()=>{if(d&&d.length>0){const s={...a};d.forEach(t=>{t.taxType in s&&(s[t.taxType]={id:t.id,taxType:t.taxType,percent:parseFloat(t.percent)||0,isActive:t.isActive||!1})}),u(s)}},[d]);const i=L({mutationFn:async s=>{const t=await fetch("/api/hotels/current/taxes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,percentType:"number"})});if(!t.ok){const r=await t.json();throw new Error(r.message||"Failed to update tax settings")}return t.json()},onSuccess:()=>{P.invalidateQueries({queryKey:["/api/hotels/current/taxes"]}),o({title:"Success",description:"Tax settings updated successfully"})},onError:s=>{o({title:"Error",description:s.message||"Failed to update tax settings",variant:"destructive"})}}),m=(s,t)=>{const r={...a[s],isActive:t};u(S=>({...S,[s]:r})),i.mutate(r)},h=(s,t)=>{u(r=>({...r,[s]:{...r[s],percent:t}}))},p=s=>{const t=a[s];i.mutate(t)},k=s=>{let t=s,r={subtotal:s};return["vat","service_tax","luxury_tax"].forEach(A=>{const v=a[A];if(v&&v.isActive){const w=Math.round(t*v.percent/100*100)/100;r[A]=w,t=Math.round((t+w)*100)/100}}),{total:t,breakdown:r}},C=1e3,j=k(C);return e.jsx(R,{title:"Tax Configuration",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Tax Settings"]})}),e.jsx(N,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:"VAT"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Value Added Tax"})]}),e.jsx(T,{checked:a.vat.isActive,onCheckedChange:s=>m("vat",s)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"vat-percent",children:"Tax Percentage"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{id:"vat-percent",type:"number",value:a.vat.percent,onChange:s=>h("vat",Number(s.target.value)),disabled:!a.vat.isActive,min:"0",max:"100",step:"0.1"}),e.jsx(x,{size:"sm",onClick:()=>p("vat"),disabled:i.isPending,children:e.jsx(b,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:"Service Tax"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Service charge"})]}),e.jsx(T,{checked:a.service_tax.isActive,onCheckedChange:s=>m("service_tax",s)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"service-percent",children:"Tax Percentage"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{id:"service-percent",type:"number",value:a.service_tax.percent,onChange:s=>h("service_tax",Number(s.target.value)),disabled:!a.service_tax.isActive,min:"0",max:"100",step:"0.1"}),e.jsx(x,{size:"sm",onClick:()=>p("service_tax"),disabled:i.isPending,children:e.jsx(b,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:"Luxury Tax"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Premium services"})]}),e.jsx(T,{checked:a.luxury_tax.isActive,onCheckedChange:s=>m("luxury_tax",s)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"luxury-percent",children:"Tax Percentage"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{id:"luxury-percent",type:"number",value:a.luxury_tax.percent,onChange:s=>h("luxury_tax",Number(s.target.value)),disabled:!a.luxury_tax.isActive,min:"0",max:"100",step:"0.1"}),e.jsx(x,{size:"sm",onClick:()=>p("luxury_tax"),disabled:i.isPending,children:e.jsx(b,{className:"h-4 w-4"})})]})]})]})]})})]}),e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(y,{children:"Tax Calculation Example"})}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Example calculation for NPR ",C.toLocaleString(),":"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["NPR ",j.breakdown.subtotal.toLocaleString()]})]}),Object.entries(a).map(([s,t])=>{if(!t.isActive)return null;const r=j.breakdown[s]||0;return e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[t.taxType.replace("_"," ").toUpperCase()," (",t.percent,"%):"]}),e.jsxs("span",{children:["NPR ",r.toLocaleString()]})]},s)}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["NPR ",j.total.toLocaleString()]})]})]})]})})]}),e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5"}),"Hotel Tax Information"]})}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"vat-number",children:"VAT Number"}),e.jsx(l,{id:"vat-number",placeholder:"Enter VAT registration number",defaultValue:(n==null?void 0:n.vatNo)||""})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"business-address",children:"Business Address"}),e.jsx(l,{id:"business-address",placeholder:"Enter business address",defaultValue:(n==null?void 0:n.address)||""})]})]}),e.jsx(x,{className:"mt-4",onClick:()=>{var s,t;(s=document.getElementById("vat-number"))==null||s.value,(t=document.getElementById("business-address"))==null||t.value,o({title:"Feature Coming Soon",description:"Hotel information update will be implemented"})},children:"Update Hotel Information"})]})})]})]})})}export{J as default};
