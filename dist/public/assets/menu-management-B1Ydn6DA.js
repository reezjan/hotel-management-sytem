import{v as Ie,r as m,b as be,l as O,d as f,j as e,C as p,a as j,m as we,n as ke,B as l,s as o,I as M,X as Se}from"./index-CuDmVYun.js";import{D as Me,n as X,Z,_ as G,a as Y,$ as De,a0 as Te}from"./dashboard-layout-RBv1DXX2.js";import{D as Ee}from"./data-table-B69p7Klv.js";import{S as z,a as q,b as L,c as K,d as Q}from"./select-7c0Tajxe.js";import{T as Fe}from"./textarea-CpuNoaOI.js";import{S as ee}from"./switch-ZsqMJgRS.js";import{D as $,a as B,b as V,c as J}from"./dialog-CYNkLpdV.js";import{t as r}from"./index-hq1wgpuD.js";import"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./badge-DMaRL5Qw.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";function He(){const{confirm:_}=Ie(),[se,v]=m.useState(!1),[te,y]=m.useState(!1),[ne,C]=m.useState(!1),[N,ae]=m.useState(null),[u,I]=m.useState([]),[i,h]=m.useState({name:"",description:"",price:"",categoryId:"",active:!0}),[D,H]=m.useState({name:""}),x=be(),{data:g=[],isLoading:re}=O({queryKey:["/api/hotels/current/menu-items"],refetchInterval:3e3}),{data:b=[]}=O({queryKey:["/api/hotels/current/menu-categories"],refetchInterval:3e3}),{data:w=[]}=O({queryKey:["/api/hotels/current/inventory-items"],refetchInterval:3e3}),T=f({mutationFn:async s=>{const t=await fetch("/api/hotels/current/menu-items",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...s,price:parseFloat(s.price),categoryId:s.categoryId||null})});if(!t.ok){const n=await t.json();throw new Error(n.message||"Failed to create menu item")}return t.json()},onSuccess:()=>{x.invalidateQueries({queryKey:["/api/hotels/current/menu-items"]}),v(!1),h({name:"",description:"",price:"",categoryId:"",active:!0}),r.success("Menu item created successfully")},onError:s=>{r.error(s.message)}}),R=f({mutationFn:async({itemId:s,active:t})=>{const n=await fetch(`/api/hotels/current/menu-items/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({active:t})});if(!n.ok)throw new Error("Failed to update menu item");return n.json()},onSuccess:()=>{x.invalidateQueries({queryKey:["/api/hotels/current/menu-items"]}),r.success("Menu item status updated")},onError:s=>{r.error(s.message)}}),E=f({mutationFn:async s=>{const t=await fetch("/api/hotels/current/menu-categories",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!t.ok){const n=await t.json();throw new Error(n.message||"Failed to create category")}return t.json()},onSuccess:()=>{x.invalidateQueries({queryKey:["/api/hotels/current/menu-categories"]}),y(!1),H({name:""}),r.success("Category created successfully")},onError:s=>{r.error(s.message)}}),ie=f({mutationFn:async s=>{if(!(await fetch(`/api/hotels/current/menu-categories/${s}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Failed to delete category")},onSuccess:()=>{x.invalidateQueries({queryKey:["/api/hotels/current/menu-categories"]}),r.success("Category deleted successfully")},onError:s=>{r.error(s.message)}}),ce=()=>{if(!i.name||!i.price){r.error("Please fill in name and price");return}T.mutate(i)},le=s=>{R.mutate({itemId:s.id,active:!s.active})},oe=async s=>{await _({title:"Delete Menu Item",description:`Are you sure you want to delete "${s.name}"?`,confirmText:"Delete",cancelText:"Cancel",variant:"destructive",onConfirm:async()=>{try{if(!(await fetch(`/api/hotels/current/menu-items/${s.id}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Failed to delete menu item");x.invalidateQueries({queryKey:["/api/hotels/current/menu-items"]}),r.success("Menu item deleted successfully")}catch(t){r.error(t.message)}}})},de=()=>{if(!D.name.trim()){r.error("Please enter a category name");return}E.mutate(D)},me=async s=>{await _({title:"Delete Category",description:`Are you sure you want to delete "${s.name}" category?`,confirmText:"Delete",cancelText:"Cancel",variant:"destructive",onConfirm:()=>{ie.mutate(s.id)}})},ue=s=>{var n;ae(s);const t=((n=s.recipe)==null?void 0:n.ingredients)||[];I(t),C(!0)},he=()=>{I([...u,{inventoryItemId:"",quantity:0,unit:""}])},xe=s=>{I(u.filter((t,n)=>n!==s))},k=(s,t,n)=>{const c=[...u];c[s]={...c[s],[t]:n},I(c)},ge=s=>{const t=w.find(A=>A.id===s);if(!t)return[];const n=t.measurementCategory||"weight",c=t.baseUnit||"kg",a=["mg","g","kg","oz","lb"],S=["ml","L","tsp","tbsp","cup","fl_oz"],P=["piece","dozen","pack"];let d=[];if(n==="weight"?d=a:n==="volume"?d=S:n==="count"?d=P:d=[c],t.conversionProfile&&typeof t.conversionProfile=="object"){const A=Object.keys(t.conversionProfile).filter(U=>U!=="baseUnit"&&U!=="baseToKg"&&U!=="baseToL");d=Array.from(new Set([...d,...A]))}return d},pe=s=>({mg:"mg",g:"g",kg:"kg",oz:"oz",lb:"lb",ml:"ml",L:"L",tsp:"tsp",tbsp:"tbsp",cup:"cup",fl_oz:"fl oz",piece:"piece",dozen:"dozen",pack:"pack"})[s]||s,F=f({mutationFn:async()=>{const s=await fetch(`/api/hotels/current/menu-items/${N.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({recipe:{ingredients:u.filter(t=>t.inventoryItemId&&t.quantity>0&&t.unit)}})});if(!s.ok)throw new Error("Failed to save ingredients");return s.json()},onSuccess:()=>{x.invalidateQueries({queryKey:["/api/hotels/current/menu-items"]}),C(!1),r.success("Ingredients saved successfully with unit conversions")},onError:s=>{r.error(s.message)}}),je=s=>{var n,c;const t=((c=(n=s.category)==null?void 0:n.name)==null?void 0:c.toLowerCase())||"";return t.includes("coffee")||t.includes("beverage")||t.includes("drink")||t.includes("bar")},W=s=>{const t=(s==null?void 0:s.toLowerCase())||"";return t.includes("coffee")||t.includes("beverage")?e.jsx(Z,{className:"h-4 w-4"}):t.includes("wine")||t.includes("alcohol")||t.includes("drink")?e.jsx(G,{className:"h-4 w-4"}):t.includes("dessert")||t.includes("cake")?e.jsx(Te,{className:"h-4 w-4"}):e.jsx(X,{className:"h-4 w-4"})},fe=[{key:"name",label:"Item Name",sortable:!0},{key:"category",label:"Category",render:s=>s?e.jsxs("div",{className:"flex items-center space-x-2",children:[W(s.name),e.jsx("span",{children:s.name})]}):"Uncategorized"},{key:"price",label:"Price",sortable:!0,render:s=>{const t=Number(s);return`रु${isNaN(t)?"0.00":t.toFixed(2)}`}},{key:"active",label:"Status",render:(s,t)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{checked:s,onCheckedChange:()=>le(t),disabled:R.isPending}),e.jsx("span",{className:`text-sm ${s?"text-green-600":"text-gray-600"}`,children:s?"Active":"Inactive"})]})}],ve=[{label:"Manage Ingredients",action:s=>{if(!je(s)){r.error("Ingredients can only be managed for beverage items (coffee, drinks, bar)");return}ue(s)},variant:"default"},{label:"Delete",action:oe,variant:"destructive"}],ye=g.filter(s=>s.active).length,Ce=g.length,Ne=g.length>0?g.reduce((s,t)=>s+(Number(t.price)||0),0)/g.length:0;return e.jsx(Me,{title:"Menu Management",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(p,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Items"}),e.jsx("p",{className:"text-2xl font-bold",children:Ce})]}),e.jsx(X,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(p,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Items"}),e.jsx("p",{className:"text-2xl font-bold",children:ye})]}),e.jsx("div",{className:"h-8 w-8 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx("div",{className:"h-4 w-4 rounded-full bg-green-500"})})]})})}),e.jsx(p,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Categories"}),e.jsx("p",{className:"text-2xl font-bold",children:b.length})]}),e.jsx(Z,{className:"h-8 w-8 text-purple-500"})]})})}),e.jsx(p,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg Price"}),e.jsxs("p",{className:"text-2xl font-bold",children:["रु",Ne.toFixed(0)]})]}),e.jsx(G,{className:"h-8 w-8 text-orange-500"})]})})})]}),e.jsxs(p,{children:[e.jsx(we,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ke,{children:"Menu Categories"}),e.jsxs(l,{onClick:()=>y(!0),size:"sm",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Add Category"]})]})}),e.jsx(j,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.length===0?e.jsx("p",{className:"text-muted-foreground col-span-full text-center py-8",children:"No categories yet. Create your first category to organize your menu."}):b.map(s=>e.jsx(p,{className:"relative",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[W(s.name),e.jsx("span",{className:"font-medium",children:s.name})]}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>me(s),className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:"Delete"})]})})},s.id))})})]}),e.jsx(Ee,{title:"Menu Items",data:g,columns:fe,actions:ve,isLoading:re,onAdd:()=>v(!0),addButtonLabel:"Add Menu Item",searchPlaceholder:"Search menu items..."}),e.jsx($,{open:se,onOpenChange:v,children:e.jsxs(B,{className:"max-w-md",children:[e.jsx(V,{children:e.jsx(J,{children:"Add Menu Item"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"name",children:"Item Name *"}),e.jsx(M,{id:"name",value:i.name,onChange:s=>h({...i,name:s.target.value}),placeholder:"Enter item name"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"description",children:"Description"}),e.jsx(Fe,{id:"description",value:i.description,onChange:s=>h({...i,description:s.target.value}),placeholder:"Enter item description",rows:3})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"price",children:"Price (रु) *"}),e.jsx(M,{id:"price",type:"number",step:"0.01",value:i.price,onChange:s=>h({...i,price:s.target.value}),placeholder:"Enter price"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"category",children:"Category"}),e.jsxs(z,{value:i.categoryId,onValueChange:s=>h({...i,categoryId:s}),children:[e.jsx(q,{children:e.jsx(L,{placeholder:"Select category"})}),e.jsx(K,{children:b.map(s=>e.jsx(Q,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{id:"active",checked:i.active,onCheckedChange:s=>h({...i,active:s})}),e.jsx(o,{htmlFor:"active",children:"Active (available for ordering)"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(l,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(l,{onClick:ce,disabled:T.isPending,children:T.isPending?"Creating...":"Create Item"})]})]})]})}),e.jsx($,{open:te,onOpenChange:y,children:e.jsxs(B,{className:"max-w-md",children:[e.jsx(V,{children:e.jsx(J,{children:"Add Menu Category"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"categoryName",children:"Category Name *"}),e.jsx(M,{id:"categoryName",value:D.name,onChange:s=>H({name:s.target.value}),placeholder:"e.g., Appetizers, Main Course, Beverages"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(l,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx(l,{onClick:de,disabled:E.isPending,children:E.isPending?"Creating...":"Create Category"})]})]})]})}),e.jsx($,{open:ne,onOpenChange:C,children:e.jsxs(B,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(V,{children:[e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"Manage Ingredients - ",N==null?void 0:N.name]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Set ingredients for automatic inventory deduction when this item is ordered"})]}),e.jsxs("div",{className:"space-y-4",children:[u.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:'No ingredients added yet. Click "Add Ingredient" to start.'}):e.jsx("div",{className:"space-y-3",children:u.map((s,t)=>{const n=s.inventoryItemId?ge(s.inventoryItemId):[],c=w.find(a=>a.id===s.inventoryItemId);return e.jsxs("div",{className:"flex items-end gap-3 p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(o,{children:"Inventory Item *"}),e.jsxs(z,{value:s.inventoryItemId,onValueChange:a=>{k(t,"inventoryItemId",a);const S=w.find(P=>P.id===a);S&&!s.unit&&k(t,"unit",S.baseUnit||"kg")},children:[e.jsx(q,{children:e.jsx(L,{placeholder:"Select item"})}),e.jsx(K,{children:w.map(a=>e.jsx(Q,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"w-28",children:[e.jsx(o,{children:"Quantity *"}),e.jsx(M,{type:"number",step:"0.01",value:s.quantity||"",onChange:a=>k(t,"quantity",parseFloat(a.target.value)||0),placeholder:"0.00"})]}),e.jsxs("div",{className:"w-28",children:[e.jsx(o,{children:"Unit *"}),e.jsxs(z,{value:s.unit||(c==null?void 0:c.baseUnit)||"",onValueChange:a=>k(t,"unit",a),disabled:!s.inventoryItemId,children:[e.jsx(q,{children:e.jsx(L,{placeholder:"Unit"})}),e.jsx(K,{children:n.map(a=>e.jsx(Q,{value:a,children:pe(a)},a))})]})]}),e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>xe(t),className:"text-destructive hover:text-destructive",children:e.jsx(Se,{className:"h-4 w-4"})})]},t)})}),e.jsxs(l,{variant:"outline",onClick:he,className:"w-full",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Add Ingredient"]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[e.jsx(l,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(l,{onClick:()=>F.mutate(),disabled:F.isPending,children:F.isPending?"Saving...":"Save Ingredients"})]})]})]})})]})})}export{He as default};
