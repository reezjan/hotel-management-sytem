import{r as p,b as xe,l as q,d as L,j as e,C as o,a as c,s as j,I as V,B as D}from"./index-CuDmVYun.js";import{D as me,i as P,o as E,q as F,x as he}from"./dashboard-layout-RBv1DXX2.js";import{D as O}from"./data-table-B69p7Klv.js";import{S as je,a as ge,b as ve,c as ye,d as g}from"./select-7c0Tajxe.js";import{T as _}from"./textarea-CpuNoaOI.js";import{D as z,a as J,b as H,c as X}from"./dialog-CYNkLpdV.js";import{B as I}from"./badge-DMaRL5Qw.js";import{T as fe,a as be,b as G,c as W}from"./tabs-CX8s-N0D.js";import{t as i}from"./index-hq1wgpuD.js";import"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";import"./index-D12ZMnos.js";import"./index-dzpsPapz.js";function Oe(){var $,Q;const[Y,v]=p.useState(!1),[a,x]=p.useState({leaveType:"",startDate:"",endDate:"",reason:""}),[n,w]=p.useState(null),[Z,m]=p.useState(!1),[d,ee]=p.useState("approve"),[y,f]=p.useState(""),u=xe(),{data:b=[],isLoading:S}=q({queryKey:["/api/hotels/current/leave-requests/my-requests"],refetchInterval:3e3}),{data:te=[]}=q({queryKey:["/api/leave-balances"],refetchInterval:3e3}),{data:N=[]}=q({queryKey:["/api/hotels/current/leave-requests/pending-approvals"],refetchInterval:3e3}),{data:T=[]}=q({queryKey:["/api/hotels/current/leave-requests"],refetchInterval:3e3}),R=L({mutationFn:async t=>{const s=await fetch("/api/hotels/current/leave-requests",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(!s.ok){const r=await s.json();throw new Error(r.message||"Failed to create leave request")}return s.json()},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/hotels/current/leave-requests/my-requests"]}),u.invalidateQueries({queryKey:["/api/leave-balances"]}),v(!1),x({leaveType:"",startDate:"",endDate:"",reason:""}),i.success("Leave request submitted successfully")},onError:t=>{i.error(t.message)}}),C=L({mutationFn:async({id:t,notes:s})=>{const r=await fetch(`/api/leave-requests/${t}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({managerNotes:s})});if(!r.ok){const h=await r.json();throw new Error(h.message||"Failed to approve leave request")}return r.json()},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/hotels/current/leave-requests/pending-approvals"]}),u.invalidateQueries({queryKey:["/api/hotels/current/leave-requests"]}),m(!1),w(null),f(""),i.success("Leave request approved successfully")},onError:t=>{i.error(t.message)}}),k=L({mutationFn:async({id:t,notes:s})=>{const r=await fetch(`/api/leave-requests/${t}/reject`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({managerNotes:s})});if(!r.ok){const h=await r.json();throw new Error(h.message||"Failed to reject leave request")}return r.json()},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/hotels/current/leave-requests/pending-approvals"]}),u.invalidateQueries({queryKey:["/api/hotels/current/leave-requests"]}),m(!1),w(null),f(""),i.success("Leave request rejected")},onError:t=>{i.error(t.message)}}),se=()=>{if(!a.leaveType||!a.startDate||!a.endDate){i.error("Please fill in all required fields");return}if(new Date(a.endDate)<new Date(a.startDate)){i.error("End date must be after start date");return}R.mutate(a)},M=(t,s)=>{w(t),ee(s),f(""),m(!0)},ae=()=>{n&&(d==="approve"?C.mutate({id:n.id,notes:y}):k.mutate({id:n.id,notes:y}))},B=t=>{switch(t){case"approved":return e.jsx(E,{className:"h-4 w-4 text-green-500"});case"rejected":return e.jsx(F,{className:"h-4 w-4 text-red-500"});default:return e.jsx(P,{className:"h-4 w-4 text-orange-500"})}},K=t=>{switch(t){case"approved":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-orange-100 text-orange-800 border-orange-200"}},l=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),A=(t,s)=>{const r=new Date(t),h=new Date(s),pe=Math.abs(h.getTime()-r.getTime());return Math.ceil(pe/(1e3*60*60*24))+1},re=[{key:"leaveType",label:"Type",sortable:!0,render:t=>e.jsx("span",{className:"font-medium capitalize","data-testid":`text-type-${t}`,children:t==null?void 0:t.replace(/_/g," ")})},{key:"startDate",label:"Start Date",sortable:!0,render:t=>e.jsx("span",{"data-testid":"text-startdate",children:l(t)})},{key:"endDate",label:"End Date",sortable:!0,render:t=>e.jsx("span",{"data-testid":"text-enddate",children:l(t)})},{key:"duration",label:"Duration",render:(t,s)=>e.jsxs("span",{className:"text-sm text-muted-foreground","data-testid":"text-duration",children:[A(s.startDate,s.endDate)," day(s)"]})},{key:"status",label:"Status",render:t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[B(t),e.jsx(I,{variant:"outline",className:K(t),"data-testid":`badge-status-${t}`,children:(t==null?void 0:t.charAt(0).toUpperCase())+(t==null?void 0:t.slice(1))})]})},{key:"reason",label:"Reason",render:t=>e.jsx("span",{className:"text-sm text-muted-foreground max-w-xs truncate","data-testid":"text-reason",children:t||"No reason provided"})},{key:"managerNotes",label:"Manager Notes",render:t=>e.jsx("span",{className:"text-sm text-muted-foreground max-w-xs truncate","data-testid":"text-managernotes",children:t||"-"})},{key:"createdAt",label:"Submitted",sortable:!0,render:t=>e.jsx("span",{"data-testid":"text-submitted",children:l(t)})}],U=[{key:"requestedBy",label:"Employee",render:(t,s)=>{var r;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{"data-testid":`text-employee-${s.id}`,children:((r=s.requestedByUser)==null?void 0:r.username)||"Unknown User"})]})}},{key:"leaveType",label:"Type",sortable:!0,render:t=>e.jsx("span",{className:"font-medium capitalize","data-testid":`text-leavetype-${t}`,children:t==null?void 0:t.replace(/_/g," ")})},{key:"startDate",label:"Start Date",sortable:!0,render:t=>e.jsx("span",{"data-testid":"text-startdate-approval",children:l(t)})},{key:"endDate",label:"End Date",sortable:!0,render:t=>e.jsx("span",{"data-testid":"text-enddate-approval",children:l(t)})},{key:"duration",label:"Duration",render:(t,s)=>e.jsxs("span",{className:"text-sm text-muted-foreground","data-testid":"text-duration-approval",children:[A(s.startDate,s.endDate)," day(s)"]})},{key:"reason",label:"Reason",render:t=>e.jsx("span",{className:"text-sm text-muted-foreground max-w-xs truncate","data-testid":"text-reason-approval",children:t||"No reason provided"})},{key:"createdAt",label:"Submitted",sortable:!0,render:t=>e.jsx("span",{"data-testid":"text-submitted-approval",children:l(t)})}],ne=[...U,{key:"status",label:"Status",render:t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[B(t),e.jsx(I,{variant:"outline",className:K(t),"data-testid":`badge-subordinate-status-${t}`,children:(t==null?void 0:t.charAt(0).toUpperCase())+(t==null?void 0:t.slice(1))})]})},{key:"managerNotes",label:"Notes",render:t=>e.jsx("span",{className:"text-sm text-muted-foreground max-w-xs truncate","data-testid":"text-notes-subordinate",children:t||"-"})}],de=[{label:"Approve",action:t=>M(t,"approve"),variant:"default",testId:"button-approve"},{label:"Reject",action:t=>M(t,"reject"),variant:"destructive",testId:"button-reject"}],le=b.filter(t=>t.status==="pending").length,ie=b.filter(t=>t.status==="approved").length,oe=b.filter(t=>t.status==="rejected").length,ce=T.filter(t=>t.status==="approved").length,ue=T.filter(t=>t.status==="rejected").length;return e.jsx(me,{title:"Leave Requests",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(fe,{defaultValue:"my-requests",className:"w-full",children:[e.jsxs(be,{className:"grid w-full grid-cols-2","data-testid":"tabs-leave-requests",children:[e.jsx(G,{value:"my-requests","data-testid":"tab-my-requests",children:"My Leave Requests"}),e.jsxs(G,{value:"team-approvals","data-testid":"tab-team-approvals",children:["Team Approvals",N.length>0&&e.jsx(I,{className:"ml-2 bg-orange-500","data-testid":"badge-pending-count",children:N.length})]})]}),e.jsxs(W,{value:"my-requests",className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:te.map(t=>e.jsx(o,{"data-testid":`balance-card-${t.leaveType}`,children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-muted-foreground capitalize",children:[t.leaveType.replace(/_/g," ")," Leave Balance"]}),e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsx("p",{className:"text-3xl font-bold","data-testid":`balance-remaining-${t.leaveType}`,children:parseFloat(t.remainingDays)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["/ ",parseFloat(t.totalDays)," days"]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Used: ",parseFloat(t.usedDays)," days"]})]})})},t.id))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(o,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold","data-testid":"text-pending",children:le})]}),e.jsx(P,{className:"h-8 w-8 text-orange-500"})]})})}),e.jsx(o,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold","data-testid":"text-approved",children:ie})]}),e.jsx(E,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(o,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold","data-testid":"text-rejected",children:oe})]}),e.jsx(F,{className:"h-8 w-8 text-red-500"})]})})})]}),e.jsx(O,{title:"My Leave Requests",data:b,columns:re,isLoading:S,onAdd:()=>v(!0),addButtonLabel:"Request Leave",searchPlaceholder:"Search leave requests..."})]}),e.jsxs(W,{value:"team-approvals",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(o,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending Approval"}),e.jsx("p",{className:"text-2xl font-bold","data-testid":"text-pending-approval",children:N.length})]}),e.jsx(P,{className:"h-8 w-8 text-orange-500"})]})})}),e.jsx(o,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold","data-testid":"text-approved-subordinate",children:ce})]}),e.jsx(E,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(o,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold","data-testid":"text-rejected-subordinate",children:ue})]}),e.jsx(F,{className:"h-8 w-8 text-red-500"})]})})})]}),e.jsx(O,{title:"Pending Leave Requests",data:N,columns:U,actions:de,isLoading:S,searchPlaceholder:"Search pending requests..."}),e.jsx(O,{title:"All Team Leave Requests",data:T,columns:ne,isLoading:S,searchPlaceholder:"Search all requests..."})]})]}),e.jsx(z,{open:Y,onOpenChange:v,children:e.jsxs(J,{className:"max-w-md",children:[e.jsx(H,{children:e.jsx(X,{children:"Request Leave"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"leaveType",children:"Leave Type *"}),e.jsxs(je,{value:a.leaveType,onValueChange:t=>x({...a,leaveType:t}),children:[e.jsx(ge,{"data-testid":"select-leavetype",children:e.jsx(ve,{placeholder:"Select leave type"})}),e.jsxs(ye,{children:[e.jsx(g,{value:"sick",children:"Sick Leave"}),e.jsx(g,{value:"vacation",children:"Vacation"}),e.jsx(g,{value:"personal",children:"Personal Leave"}),e.jsx(g,{value:"emergency",children:"Emergency Leave"}),e.jsx(g,{value:"family",children:"Family Leave"})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"startDate",children:"Start Date *"}),e.jsx(V,{id:"startDate",type:"date",value:a.startDate,onChange:t=>x({...a,startDate:t.target.value}),min:new Date().toISOString().split("T")[0],"data-testid":"input-startdate"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"endDate",children:"End Date *"}),e.jsx(V,{id:"endDate",type:"date",value:a.endDate,onChange:t=>x({...a,endDate:t.target.value}),min:a.startDate||new Date().toISOString().split("T")[0],"data-testid":"input-enddate"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"reason",children:"Reason"}),e.jsx(_,{id:"reason",value:a.reason,onChange:t=>x({...a,reason:t.target.value}),placeholder:"Please provide a reason for your leave request",rows:3,"data-testid":"textarea-reason"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(D,{variant:"outline",onClick:()=>v(!1),"data-testid":"button-cancel",children:"Cancel"}),e.jsx(D,{onClick:se,disabled:R.isPending,"data-testid":"button-submit",children:R.isPending?"Submitting...":"Submit Request"})]})]})]})}),e.jsx(z,{open:Z,onOpenChange:m,children:e.jsxs(J,{className:"max-w-md",children:[e.jsx(H,{children:e.jsxs(X,{children:[d==="approve"?"Approve":"Reject"," Leave Request"]})}),n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Request Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Employee:"})," ",(($=n.requestedByUser)==null?void 0:$.username)||"Unknown"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",(Q=n.leaveType)==null?void 0:Q.replace(/_/g," ")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Period:"})," ",l(n.startDate)," - ",l(n.endDate)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Duration:"})," ",A(n.startDate,n.endDate)," day(s)"]}),n.reason&&e.jsxs("p",{children:[e.jsx("strong",{children:"Reason:"})," ",n.reason]})]})]}),e.jsxs("div",{children:[e.jsxs(j,{htmlFor:"managerNotes",children:["Manager Notes ",d==="reject"?"(Required)":"(Optional)"]}),e.jsx(_,{id:"managerNotes",value:y,onChange:t=>f(t.target.value),placeholder:`Add notes for the ${d} decision...`,rows:3,"data-testid":"textarea-managernotes"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(D,{variant:"outline",onClick:()=>m(!1),"data-testid":"button-cancel-action",children:"Cancel"}),e.jsx(D,{onClick:ae,disabled:C.isPending||k.isPending||d==="reject"&&!y.trim(),variant:d==="approve"?"default":"destructive","data-testid":"button-confirm-action",children:C.isPending||k.isPending?d==="approve"?"Approving...":"Rejecting...":d==="approve"?"Approve Request":"Reject Request"})]})]})]})})]})})}export{Oe as default};
