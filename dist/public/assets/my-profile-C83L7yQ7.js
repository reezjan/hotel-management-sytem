import{q as T,u as D,r as d,c as q,j as s,C as x,m as h,n as u,y as p,a as w,F as B,e as j,f as g,g as f,h as N,I as y,B as r,i as P,z as n,t as R}from"./index-CuDmVYun.js";import{D as V,x as Y,S as A,an as H,am as J,ar as b,aa as v,X}from"./dashboard-layout-RBv1DXX2.js";import{S as _}from"./separator-e5QVHWOR.js";import"./users-DXv82DeH.js";import"./circle-alert-CPwmOhkC.js";const G=n.object({oldPassword:n.string().min(1,"Current password is required"),newPassword:n.string().min(6,"Password must be at least 6 characters"),confirmPassword:n.string().min(6,"Password must be at least 6 characters")}).refine(e=>e.newPassword===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function ss(){var k,E;const{user:e,logoutMutation:i}=T(),{toast:C}=D(),[S,F]=d.useState(!1),[l,M]=d.useState(!1),[c,L]=d.useState(!1),[m,O]=d.useState(!1),t=q({resolver:R(G),defaultValues:{oldPassword:"",newPassword:"",confirmPassword:""}}),I=async a=>{F(!0);try{const o=await fetch("/api/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({oldPassword:a.oldPassword,newPassword:a.newPassword})});if(!o.ok){const z=await o.json();throw new Error(z.message||"Failed to change password")}C({title:"Password Changed Successfully",description:"Your password has been updated successfully."}),t.reset()}catch(o){C({title:"Password Change Failed",description:o.message||"Please check your current password and try again.",variant:"destructive"})}finally{F(!1)}},U=()=>{i.mutate()};return s.jsx(V,{title:"My Profile",children:s.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold tracking-tight","data-testid":"heading-my-profile",children:"My Profile"}),s.jsx("p",{className:"text-muted-foreground",children:"View your profile information and manage your account settings."})]}),s.jsxs(x,{"data-testid":"card-user-information",children:[s.jsxs(h,{children:[s.jsx(u,{children:"User Information"}),s.jsx(p,{children:"Your account details"})]}),s.jsx(w,{className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"bg-primary/10 p-2 rounded-lg",children:s.jsx(Y,{className:"h-5 w-5 text-primary"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Username"}),s.jsx("p",{className:"font-medium","data-testid":"text-username",children:e==null?void 0:e.username})]})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"bg-primary/10 p-2 rounded-lg",children:s.jsx(A,{className:"h-5 w-5 text-primary"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Role"}),s.jsx("p",{className:"font-medium","data-testid":"text-role",children:(E=(k=e==null?void 0:e.role)==null?void 0:k.name)==null?void 0:E.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())})]})]}),(e==null?void 0:e.email)&&s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"bg-primary/10 p-2 rounded-lg",children:s.jsx(H,{className:"h-5 w-5 text-primary"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Email"}),s.jsx("p",{className:"font-medium","data-testid":"text-email",children:e.email})]})]}),(e==null?void 0:e.phone)&&s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"bg-primary/10 p-2 rounded-lg",children:s.jsx(J,{className:"h-5 w-5 text-primary"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Phone"}),s.jsx("p",{className:"font-medium","data-testid":"text-phone",children:e.phone})]})]})]})})]}),s.jsxs(x,{"data-testid":"card-change-password",children:[s.jsxs(h,{children:[s.jsx(u,{children:"Change Password"}),s.jsx(p,{children:"Update your password to keep your account secure"})]}),s.jsx(w,{children:s.jsx(B,{...t,children:s.jsxs("form",{onSubmit:t.handleSubmit(I),className:"space-y-4",children:[s.jsx(j,{control:t.control,name:"oldPassword",render:({field:a})=>s.jsxs(g,{children:[s.jsx(f,{children:"Current Password"}),s.jsx(N,{children:s.jsxs("div",{className:"relative",children:[s.jsx(y,{...a,type:l?"text":"password",placeholder:"Enter current password","data-testid":"input-old-password"}),s.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>M(!l),"data-testid":"button-toggle-old-password",children:l?s.jsx(b,{className:"h-4 w-4 text-muted-foreground"}):s.jsx(v,{className:"h-4 w-4 text-muted-foreground"})})]})}),s.jsx(P,{})]})}),s.jsx(j,{control:t.control,name:"newPassword",render:({field:a})=>s.jsxs(g,{children:[s.jsx(f,{children:"New Password"}),s.jsx(N,{children:s.jsxs("div",{className:"relative",children:[s.jsx(y,{...a,type:c?"text":"password",placeholder:"Enter new password","data-testid":"input-new-password"}),s.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>L(!c),"data-testid":"button-toggle-new-password",children:c?s.jsx(b,{className:"h-4 w-4 text-muted-foreground"}):s.jsx(v,{className:"h-4 w-4 text-muted-foreground"})})]})}),s.jsx(P,{})]})}),s.jsx(j,{control:t.control,name:"confirmPassword",render:({field:a})=>s.jsxs(g,{children:[s.jsx(f,{children:"Confirm Password"}),s.jsx(N,{children:s.jsxs("div",{className:"relative",children:[s.jsx(y,{...a,type:m?"text":"password",placeholder:"Confirm new password","data-testid":"input-confirm-password"}),s.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>O(!m),"data-testid":"button-toggle-confirm-password",children:m?s.jsx(b,{className:"h-4 w-4 text-muted-foreground"}):s.jsx(v,{className:"h-4 w-4 text-muted-foreground"})})]})}),s.jsx(P,{})]})}),s.jsx(r,{type:"submit",disabled:S,"data-testid":"button-change-password",children:S?"Changing Password...":"Change Password"})]})})})]}),s.jsxs(x,{"data-testid":"card-logout",children:[s.jsxs(h,{children:[s.jsx(u,{children:"Session Management"}),s.jsx(p,{children:"Manage your account session"})]}),s.jsxs(w,{children:[s.jsx(_,{className:"mb-4"}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:"Logout"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Sign out from your account"})]}),s.jsxs(r,{variant:"destructive",onClick:U,disabled:i.isPending,"data-testid":"button-logout-profile",children:[s.jsx(X,{className:"mr-2 h-4 w-4"}),i.isPending?"Logging out...":"Logout"]})]})]})]})]})})}export{ss as default};
