import{r as R,l as m,j as t,C as h,m as x,n as b,a as p,x as y,w as k}from"./index-Dk6nXF67.js";import{D as F,U as j}from"./dashboard-layout-BUO8e75G.js";import{D as C}from"./data-table-BEvwFoVx.js";import{S as d}from"./stats-card-DnI6mJO0.js";import{B as N}from"./badge-P46XOlcm.js";import{U as q,c as E,C as D}from"./users-Dxbor6Q1.js";import{s as _,e as K}from"./startOfMonth-CkZi6Jlw.js";import{p as S}from"./parseISO-HR8HH9Sh.js";import{f as A}from"./format-BOBWS5Wu.js";import"./circle-alert-BbQxKC8I.js";function ee(){const[c,P]=R.useState(new Date),{data:n=[],isLoading:I}=m({queryKey:["/api/hotels/current/users"],refetchInterval:3e3}),{data:f=[],isLoading:$}=m({queryKey:["/api/attendance/daily"],refetchInterval:3e3}),{data:v=[],isLoading:T}=m({queryKey:["/api/hotels/current/attendance"],queryFn:async()=>{const e=await fetch("/api/hotels/current/attendance",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch attendance");return e.json()},refetchInterval:3e3}),i=f.filter(e=>e.status==="active").map(e=>e.userId),M=n.filter(e=>i.includes(e.id));n.filter(e=>!i.includes(e.id));const U=_(c),w=K(c),l=v.filter(e=>{if(!e.clockInTime)return!1;const a=S(e.clockInTime);return a>=U&&a<=w}),g=l.reduce((e,a)=>e+(Number(a.totalHours)||0),0),H=l.length>0?g/l.length:0,L=[{key:"clockInTime",label:"Date",sortable:!0,render:e=>e?A(S(e),"MMM dd, yyyy"):"N/A"},{key:"fullName",label:"Name",sortable:!0,render:(e,a)=>{const r=n.find(s=>s.id===a.userId);return(r==null?void 0:r.fullName)||"N/A"}},{key:"username",label:"Username",sortable:!0,render:(e,a)=>{const r=n.find(s=>s.id===a.userId);return(r==null?void 0:r.username)||"Unknown"}},{key:"role",label:"Role",sortable:!0,render:(e,a)=>{var s,o;const r=n.find(u=>u.id===a.userId);return((o=(s=r==null?void 0:r.role)==null?void 0:s.name)==null?void 0:o.replace(/_/g," ").replace(/\b\w/g,u=>u.toUpperCase()))||"N/A"}},{key:"clockInTime",label:"Clock In",sortable:!0,render:e=>e?y(e):"N/A"},{key:"clockOutTime",label:"Clock Out",sortable:!0,render:e=>e?y(e):"Still on duty"},{key:"totalHours",label:"Total Hours",sortable:!0,render:e=>{const a=Number(e)||0;return a>0?`${a.toFixed(2)} hrs`:"N/A"}},{key:"status",label:"Status",render:e=>t.jsx(N,{variant:e==="active"?"default":"secondary",className:k(e==="active"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100"),children:e==="active"?"Active":"Completed"})}],O=[{key:"fullName",label:"Name",sortable:!0},{key:"username",label:"Username",sortable:!0},{key:"role",label:"Role",sortable:!0,render:e=>{var a;return(a=e==null?void 0:e.name)==null?void 0:a.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase())}},{key:"id",label:"Duty Status",render:(e,a)=>{const r=i.includes(a.id),s=f.find(o=>o.userId===a.id&&o.status==="active");return t.jsxs("div",{className:"space-y-1",children:[t.jsx(N,{variant:r?"default":"secondary",className:k(r?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100"),children:r?"On Duty":"Off Duty"}),s&&t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Since ",y(s.clockInTime)]})]})}}];return t.jsx(F,{title:"Attendance Reports",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(d,{title:"Total Staff",value:n.length,icon:t.jsx(q,{}),iconColor:"text-blue-500","data-testid":"stats-total-staff"}),t.jsx(d,{title:"On Duty",value:M.length,icon:t.jsx(j,{}),iconColor:"text-green-500","data-testid":"stats-on-duty"}),t.jsx(d,{title:"Total Hours (This Month)",value:`${g.toFixed(1)} hrs`,icon:t.jsx(E,{}),iconColor:"text-purple-500","data-testid":"stats-total-hours"}),t.jsx(d,{title:"Avg Hours/Day",value:`${H.toFixed(1)} hrs`,icon:t.jsx(D,{}),iconColor:"text-orange-500","data-testid":"stats-avg-hours"})]}),t.jsxs(h,{children:[t.jsx(x,{children:t.jsxs(b,{className:"flex items-center gap-2",children:[t.jsx(j,{className:"w-5 h-5"}),"Current Duty Status"]})}),t.jsx(p,{children:t.jsx(C,{title:"Staff Duty Status",data:n,columns:O,searchPlaceholder:"Search staff...",isLoading:I,"data-testid":"table-current-duty"})})]}),t.jsxs(h,{children:[t.jsx(x,{children:t.jsxs(b,{className:"flex items-center gap-2",children:[t.jsx(D,{className:"w-5 h-5"}),"Attendance Records - ",A(c,"MMMM yyyy")]})}),t.jsx(p,{children:t.jsx(C,{title:"Attendance History",data:l,columns:L,searchPlaceholder:"Search attendance records...",isLoading:T,"data-testid":"table-attendance-records"})})]})]})})}export{ee as default};
