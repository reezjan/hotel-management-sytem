import{q as We,u as Xe,b as Ye,o as Ze,r as v,c as V,l as _,d as D,j as e,p as a,C as E,m as F,n as S,a as T,B as f,F as $,e as l,f as d,g as i,h as o,I as u,k as q}from"./index-Dk6nXF67.js";import{D as ve,$ as et,b as tt,w as st,C as ke}from"./dashboard-layout-BUO8e75G.js";import{S as L}from"./stats-card-DnI6mJO0.js";import{D as K}from"./data-table-BEvwFoVx.js";import{B as M}from"./badge-P46XOlcm.js";import{D as U,a as Q,b as z,c as J}from"./dialog-mWSLCdZX.js";import{T as G}from"./textarea-BAi4nzW_.js";import{S as H,a as W,b as X,c as Y,d as c}from"./select-Gj2YppMn.js";import{u as pe}from"./use-realtime-query-2TJdEol3.js";import{D as we,T as Ce,b as Pe,R as Z,e as De}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";import"./use-websocket-ChOW8gRL.js";function Nt(){const{user:n}=We(),{toast:x}=Xe(),k=Ye();Ze();const[qe,ee]=v.useState(!1),[Ee,B]=v.useState(!1),[Fe,R]=v.useState(!1),[Se,I]=v.useState(!1),[nt,te]=v.useState(null),[y,je]=v.useState(null),[be,se]=v.useState(null),w=V({defaultValues:{amount:"",bankName:"",notes:""}}),p=V({defaultValues:{vendorId:"",amount:"",paymentMethod:"",chequeNumber:"",bankName:"",notes:""}}),N=V({defaultValues:{name:"",phone:"",email:"",address:""}}),j=V({defaultValues:{category:"utilities",amount:"",paymentMethod:"cash",chequeNumber:"",bankName:"",description:"",billInvoiceNumber:""}}),{data:h=[],isLoading:Te}=_({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3,enabled:!!(n!=null&&n.hotelId)});pe({queryKey:["/api/hotels/current/transactions"],events:["transaction:created","transaction:updated"]}),pe({queryKey:["/api/hotels/current/users"],events:["user:created","user:updated"]}),pe({queryKey:["/api/hotels/current/maintenance-requests"],events:["maintenance:updated","maintenance:created"]});const{data:Me=[],isLoading:Be}=_({queryKey:["/api/hotels/current/maintenance-requests"],refetchInterval:3e3,enabled:!!(n!=null&&n.hotelId)}),{data:ne=[],isLoading:Re}=_({queryKey:["/api/hotels/current/vendors"],refetchInterval:3e3,enabled:!!(n!=null&&n.hotelId)});_({queryKey:["/api/hotels/current/users"],refetchInterval:3e3,enabled:!!(n!=null&&n.hotelId)});const ae=h.filter(t=>t.txnType==="cash_deposit_request").filter(t=>{var s,r;return!((s=t.reference)!=null&&s.includes("APPROVED"))&&!((r=t.reference)!=null&&r.includes("REJECTED"))}),fe=D({mutationFn:async t=>{const s=h.find(m=>m.id===t);if(!s)throw new Error("Transaction not found");const r=s.details||{};await q("PUT",`/api/transactions/${t}`,{reference:`${s.reference||""} - APPROVED by ${n==null?void 0:n.username}`,details:{...r,approvedBy:n==null?void 0:n.username,approvedAt:new Date().toISOString()}})},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),x({title:"Cash deposit request approved successfully"})},onError:()=>{x({title:"Error",description:"Failed to approve cash deposit request",variant:"destructive"})}}),ge=D({mutationFn:async t=>{const s=h.find(m=>m.id===t);if(!s)throw new Error("Transaction not found");const r=s.details||{};await q("PUT",`/api/transactions/${t}`,{reference:`${s.reference||""} - REJECTED by ${n==null?void 0:n.username}`,details:{...r,rejectedBy:n==null?void 0:n.username,rejectedAt:new Date().toISOString()}})},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),x({title:"Cash deposit request rejected"})},onError:()=>{x({title:"Error",description:"Failed to reject cash deposit request",variant:"destructive"})}}),re=D({mutationFn:async t=>{const s=parseFloat(t.amount);if(isNaN(s)||s<=0)throw new Error("Please enter a valid amount");if(!t.bankName||t.bankName.trim()==="")throw new Error("Bank name is required");await q("POST","/api/transactions",{hotelId:n==null?void 0:n.hotelId,txnType:"bank_deposit",amount:s.toFixed(2),paymentMethod:"cash",purpose:"Cash deposited to bank",reference:`Deposited by ${n==null?void 0:n.username}`,details:{bankName:t.bankName.trim(),notes:t.notes||"",depositedBy:n==null?void 0:n.username,depositedAt:new Date().toISOString()},createdBy:n==null?void 0:n.id})},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),x({title:"Success",description:"Cash deposited to bank successfully"}),w.reset(),ee(!1)},onError:t=>{x({title:"Error",description:t.message||"Failed to deposit cash to bank",variant:"destructive"})}}),ie=D({mutationFn:async t=>{const s=parseFloat(t.amount);if(isNaN(s)||s<=0)throw new Error("Please enter a valid amount");if(!t.vendorId)throw new Error("Please select a vendor");if(!t.paymentMethod)throw new Error("Please select a payment method");if(t.paymentMethod==="cheque"){if(!t.chequeNumber||t.chequeNumber.trim()==="")throw new Error("Cheque number is required");if(!t.bankName||t.bankName.trim()==="")throw new Error("Bank name is required for cheque payment")}const r=ne.find(g=>g.id===t.vendorId),m={vendorId:t.vendorId,vendorName:(r==null?void 0:r.name)||"Unknown",notes:t.notes||"",paidBy:n==null?void 0:n.username};t.paymentMethod==="cheque"&&(m.chequeNumber=t.chequeNumber.trim(),m.bankName=t.bankName.trim()),await q("POST","/api/transactions",{hotelId:n==null?void 0:n.hotelId,txnType:"vendor_payment",amount:s.toFixed(2),paymentMethod:t.paymentMethod,purpose:`Payment to ${(r==null?void 0:r.name)||"vendor"}`,reference:`Paid by ${n==null?void 0:n.username}`,details:m,createdBy:n==null?void 0:n.id})},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),x({title:"Success",description:"Vendor payment processed successfully"}),p.reset(),B(!1),te(null)},onError:t=>{x({title:"Error",description:t.message||"Failed to process vendor payment",variant:"destructive"})}}),le=D({mutationFn:async t=>{if(!t.name||t.name.trim()==="")throw new Error("Vendor name is required");const s={};t.phone&&(s.phone=t.phone.trim()),t.email&&(s.email=t.email.trim()),t.address&&(s.address=t.address.trim()),await q("POST","/api/hotels/current/vendors",{hotelId:n==null?void 0:n.hotelId,name:t.name.trim(),contact:s})},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/hotels/current/vendors"]}),x({title:"Success",description:"Vendor added successfully"}),N.reset(),R(!1)},onError:t=>{x({title:"Error",description:t.message||"Failed to add vendor",variant:"destructive"})}}),Ie=t=>{var r;const s=(r=t.target.files)==null?void 0:r[0];if(s){if(!["image/jpeg","image/jpg","image/png","application/pdf"].includes(s.type)){x({title:"Invalid file type",description:"Only JPEG, JPG, PNG images and PDF files are allowed",variant:"destructive"});return}if(s.size>10*1024*1024){x({title:"File too large",description:"File size must be less than 10MB",variant:"destructive"});return}if(je(s),s.type.startsWith("image/")){const g=new FileReader;g.onloadend=()=>{se(g.result)},g.readAsDataURL(s)}else se(null)}},de=D({mutationFn:async t=>{const s=parseFloat(t.amount);if(isNaN(s)||s<=0)throw new Error("Please enter a valid amount");if(!t.billInvoiceNumber||t.billInvoiceNumber.trim()==="")throw new Error("Bill invoice number is required");if(!y)throw new Error("Bill photo or PDF is required");if(t.paymentMethod==="cheque"){if(!t.chequeNumber||t.chequeNumber.trim()==="")throw new Error("Cheque number is required");if(!t.bankName||t.bankName.trim()==="")throw new Error("Bank name is required for cheque payment")}const r=new FormData;r.append("billDocument",y);const m=await fetch("/api/upload/bill-document",{method:"POST",body:r,credentials:"include"});if(!m.ok){const He=await m.json();throw new Error(He.message||"Failed to upload bill document")}const g=await m.json(),ue={};t.paymentMethod==="cheque"&&(ue.chequeNumber=t.chequeNumber.trim(),ue.bankName=t.bankName.trim());const he={hotelId:n==null?void 0:n.hotelId,txnType:"cash_out",amount:s.toFixed(2),paymentMethod:t.paymentMethod,purpose:`${t.category} - ${t.description}`,reference:t.category,details:ue,billInvoiceNumber:t.billInvoiceNumber.trim(),createdBy:n==null?void 0:n.id};g.isPdf?he.billPdfUrl=g.fileUrl:he.billPhotoUrl=g.fileUrl,await q("POST","/api/transactions",he)},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),x({title:"Success",description:"Expense recorded successfully"}),j.reset(),je(null),se(null),I(!1)},onError:t=>{x({title:"Error",description:t.message||"Failed to record expense",variant:"destructive"})}}),C=h.filter(t=>t.txnType==="cash_in"||t.txnType==="pos_in"||t.txnType==="fonepay_in"||t.txnType==="revenue"||t.txnType&&t.txnType.includes("_in")),oe=h.filter(t=>(t.txnType==="cash_out"||t.txnType==="vendor_payment"||t.txnType&&t.txnType.includes("_out"))&&t.txnType!=="cash_deposit_request"),ce=C.filter(t=>t.paymentMethod==="cash").reduce((t,s)=>t+Number(s.amount||0),0),me=C.filter(t=>t.paymentMethod==="pos").reduce((t,s)=>t+Number(s.amount||0),0),xe=C.filter(t=>t.paymentMethod==="fonepay").reduce((t,s)=>t+Number(s.amount||0),0),b=C.reduce((t,s)=>t+Number(s.amount||0),0),A=oe.reduce((t,s)=>t+Number(s.amount||0),0),P=b-A,ye=b>0?P/b*100:0,Ae=h.filter(t=>t.paymentMethod==="cash"),Oe=h.filter(t=>t.paymentMethod==="pos"),Ve=h.filter(t=>t.paymentMethod==="fonepay");h.filter(t=>t.txnType==="vendor_payment").reduce((t,s)=>t+Number(s.amount||0),0);const Ne=h.filter(t=>t.txnType==="bank_deposit"),O=Ne.reduce((t,s)=>t+Number(s.amount||0),0),_e=me+xe+O,$e=ce-O,Le=[{key:"description",label:"Request",sortable:!0},{key:"department",label:"Department",sortable:!0},{key:"reportedBy",label:"Raised By",render:(t,s)=>typeof t=="object"&&(t!=null&&t.username)?t.username:"Unknown"},{key:"status",label:"Status",sortable:!0},{key:"createdAt",label:"Date",sortable:!0}],Ke=[{key:"txnType",label:"Type",sortable:!0},{key:"amount",label:"Amount",sortable:!0,render:t=>a(t)},{key:"paymentMethod",label:"Method",sortable:!0},{key:"purpose",label:"Purpose",sortable:!0,render:(t,s)=>s.purpose==="room_checkout_payment"&&s.details?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:t}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Room ",s.details.roomNumber," - ",s.details.guestName,s.details.numberOfDays&&` (${s.details.numberOfDays} day${s.details.numberOfDays>1?"s":""})`]})]}):t},{key:"details",label:"Details",render:(t,s)=>{var r,m;return s.txnType==="cash_deposit_request"?(r=s.reference)!=null&&r.includes("APPROVED")?e.jsxs(M,{className:"bg-green-600 text-white","data-testid":`status-approved-${s.id}`,children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),"Approved"]}):(m=s.reference)!=null&&m.includes("REJECTED")?e.jsxs(M,{variant:"destructive","data-testid":`status-rejected-${s.id}`,children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),"Rejected"]}):e.jsx(M,{variant:"secondary","data-testid":`status-pending-${s.id}`,children:"Pending"}):s.purpose==="room_checkout_payment"&&t?e.jsxs("div",{className:"text-xs space-y-1",children:[t.roomCharges>0&&e.jsxs("div",{className:"text-muted-foreground",children:["Room: ",a(t.roomCharges)]}),t.mealPlanCharges>0&&e.jsxs("div",{className:"text-muted-foreground",children:["Meals: ",a(t.mealPlanCharges)]}),t.foodCharges>0&&e.jsxs("div",{className:"text-muted-foreground",children:["Food: ",a(t.foodCharges)]}),t.totalTax>0&&e.jsxs("div",{className:"text-muted-foreground",children:["Tax: ",a(t.totalTax)]}),t.discountAmount>0&&e.jsxs("div",{className:"text-green-600",children:["Discount: -",a(t.discountAmount)]})]}):"-"}},{key:"createdAt",label:"Date",sortable:!0}],Ue=[{key:"name",label:"Vendor Name",sortable:!0},{key:"contact",label:"Contact",render:t=>typeof t=="object"&&(t!=null&&t.phone)?t.phone:"N/A"},{key:"createdAt",label:"Added",sortable:!0}],Qe=[{key:"purpose",label:"Expense",sortable:!0},{key:"amount",label:"Amount",sortable:!0,render:t=>a(t)},{key:"paymentMethod",label:"Payment Method",sortable:!0},{key:"createdAt",label:"Date",sortable:!0}],ze=[{label:"Pay",action:t=>{te(t),p.setValue("vendorId",t.id),B(!0)}}],Je=[],Ge=h.filter(t=>t.txnType==="cash_out"||t.txnType==="vendor_payment");return Te||Be||Re?e.jsx(ve,{title:"Finance Dashboard",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading financial data..."})]})})}):e.jsx(ve,{title:"Finance Dashboard",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(L,{title:"Total Revenue",value:a(b),icon:e.jsx(we,{}),iconColor:"text-green-500",trend:{value:C.length,label:"transactions",isPositive:!0}}),e.jsx(L,{title:"Net Revenue",value:a(P),icon:e.jsx(Ce,{}),iconColor:"text-blue-500",trend:{value:Number(ye.toFixed(1)),label:"profit margin",isPositive:ye>0}}),e.jsx(L,{title:"Total Expenses",value:a(A),icon:e.jsx(Pe,{}),iconColor:"text-red-500",trend:{value:oe.length,label:"transactions",isPositive:!1}}),e.jsx(L,{title:"Pending Cash Deposits",value:ae.length,icon:e.jsx(Z,{}),iconColor:"text-orange-500"})]}),e.jsxs(E,{children:[e.jsxs(F,{children:[e.jsx(S,{children:"Bank Balance & Cash Flow"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Bank balance includes POS + Fonepay revenue. Cash deposits to bank are deducted from cash."})]}),e.jsx(T,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-blue-950 dark:to-indigo-950 rounded-lg border-2 border-blue-200 dark:border-blue-800","data-testid":"balance-bank",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(et,{className:"h-12 w-12 text-blue-600 dark:text-blue-400"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bank Balance"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:a(_e)})]})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"POS Revenue:"}),e.jsx("span",{className:"font-medium",children:a(me)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Fonepay Revenue:"}),e.jsx("span",{className:"font-medium",children:a(xe)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cash Deposits:"}),e.jsx("span",{className:"font-medium",children:a(O)})]})]})]}),e.jsxs("div",{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-100 dark:from-green-950 dark:to-emerald-950 rounded-lg border-2 border-green-200 dark:border-green-800","data-testid":"balance-cash",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(Z,{className:"h-12 w-12 text-green-600 dark:text-green-400"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cash on Hand"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:a($e)})]})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cash Revenue:"}),e.jsx("span",{className:"font-medium",children:a(ce)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Deposited to Bank:"}),e.jsxs("span",{className:"font-medium text-red-600 dark:text-red-400",children:["-",a(O)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Deposits Count:"}),e.jsx("span",{className:"font-medium",children:Ne.length})]})]})]})]})})]}),e.jsxs(E,{children:[e.jsx(F,{children:e.jsx(S,{children:"Revenue by Payment Method"})}),e.jsx(T,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center p-6 bg-green-50 dark:bg-green-950 rounded-lg","data-testid":"revenue-cash",children:[e.jsx(Z,{className:"h-12 w-12 mx-auto mb-4 text-green-600 dark:text-green-400"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Cash Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:a(ce)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Ae.length," total transactions"]})]}),e.jsxs("div",{className:"text-center p-6 bg-blue-50 dark:bg-blue-950 rounded-lg","data-testid":"revenue-pos",children:[e.jsx(tt,{className:"h-12 w-12 mx-auto mb-4 text-blue-600 dark:text-blue-400"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"POS Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:a(me)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Oe.length," total transactions"]})]}),e.jsxs("div",{className:"text-center p-6 bg-purple-50 dark:bg-purple-950 rounded-lg","data-testid":"revenue-fonepay",children:[e.jsx(st,{className:"h-12 w-12 mx-auto mb-4 text-purple-600 dark:text-purple-400"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Fonepay Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:a(xe)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Ve.length," total transactions"]})]})]})})]}),e.jsx(K,{title:"Maintenance Requests from Departments",data:Me,columns:Le,searchPlaceholder:"Search maintenance requests..."}),e.jsx(K,{title:"Recent Transactions",data:h.slice(0,20),columns:Ke,searchPlaceholder:"Search transactions..."}),e.jsx(K,{title:"Expense Tracking",data:Ge,columns:Qe,actions:Je,onAdd:()=>I(!0),addButtonLabel:"Add Expense",searchPlaceholder:"Search expenses..."}),e.jsx(K,{title:"Vendor Management",data:ne,columns:Ue,actions:ze,onAdd:()=>R(!0),addButtonLabel:"Add Vendor",searchPlaceholder:"Search vendors..."}),e.jsxs(E,{children:[e.jsx(F,{children:e.jsx(S,{children:"Monthly Financial Summary"})}),e.jsx(T,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg","data-testid":"summary-revenue",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:a(b)}),e.jsx("div",{className:"text-sm text-green-700",children:"Total Revenue"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg","data-testid":"summary-expenses",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:a(A)}),e.jsx("div",{className:"text-sm text-red-700",children:"Total Expenses"})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg","data-testid":"summary-profit",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a(P)}),e.jsx("div",{className:"text-sm text-blue-700",children:"Net Profit"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg","data-testid":"summary-margin",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[b>0?(P/b*100).toFixed(1):0,"%"]}),e.jsx("div",{className:"text-sm text-purple-700",children:"Profit Margin"})]})]})})]}),ae.length>0&&e.jsxs(E,{children:[e.jsx(F,{children:e.jsx(S,{children:"Pending Cash Deposit Requests"})}),e.jsx(T,{children:e.jsx("div",{className:"space-y-3",children:ae.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border-2 border-orange-200 rounded-lg bg-orange-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Z,{className:"h-4 w-4 text-orange-600"}),e.jsx("h4",{className:"font-semibold text-foreground",children:t.purpose})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.reference}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(M,{variant:"outline",className:"text-orange-700 border-orange-300",children:a(Number(t.amount))}),e.jsx(M,{variant:"secondary",className:"text-xs",children:new Date(t.createdAt||"").toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(f,{size:"sm",variant:"outline",className:"text-green-600 border-green-600 hover:bg-green-50",onClick:()=>fe.mutate(t.id),disabled:fe.isPending,"data-testid":`button-approve-${t.id}`,children:[e.jsx(ke,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(f,{size:"sm",variant:"outline",className:"text-red-600 border-red-600 hover:bg-red-50",onClick:()=>ge.mutate(t.id),disabled:ge.isPending,"data-testid":`button-reject-${t.id}`,children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]},t.id))})})]}),e.jsxs(E,{children:[e.jsx(F,{children:e.jsx(S,{children:"Cash Flow Analysis"})}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-50 rounded-lg","data-testid":"cashflow-inflow",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{className:"text-green-500 mr-3 h-6 w-6"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:"Cash Inflow"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Revenue from all sources"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-green-600",children:a(b)}),e.jsxs("p",{className:"text-sm text-green-700",children:[C.length," transactions"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 rounded-lg","data-testid":"cashflow-outflow",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Pe,{className:"text-red-500 mr-3 h-6 w-6"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:"Cash Outflow"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Expenses and vendor payments"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-red-600",children:a(A)}),e.jsxs("p",{className:"text-sm text-red-700",children:[oe.length," transactions"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-lg","data-testid":"cashflow-net",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(we,{className:"text-blue-500 mr-3 h-6 w-6"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:"Net Cash Flow"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Inflow minus outflow"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-blue-600",children:a(P)}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Profit margin: ",b>0?(P/b*100).toFixed(1):0,"%"]})]})]})]})})]}),e.jsx(U,{open:qe,onOpenChange:ee,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsx(z,{children:e.jsx(J,{children:"Deposit Cash to Bank"})}),e.jsx($,{...w,children:e.jsxs("form",{onSubmit:w.handleSubmit(t=>re.mutate(t)),className:"space-y-4",children:[e.jsx(l,{control:w.control,name:"amount",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Amount *"}),e.jsx(o,{children:e.jsx(u,{...t,type:"number",step:"0.01",placeholder:"0.00","data-testid":"input-bank-amount"})})]})}),e.jsx(l,{control:w.control,name:"bankName",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Bank Name *"}),e.jsx(o,{children:e.jsx(u,{...t,placeholder:"Enter bank name","data-testid":"input-bank-name"})})]})}),e.jsx(l,{control:w.control,name:"notes",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Notes (Optional)"}),e.jsx(o,{children:e.jsx(G,{...t,placeholder:"Additional notes...",rows:2,"data-testid":"textarea-bank-notes"})})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(f,{type:"submit",className:"flex-1",disabled:re.isPending,"data-testid":"button-submit-bank-deposit",children:re.isPending?"Processing...":"Deposit to Bank"}),e.jsx(f,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>ee(!1),"data-testid":"button-cancel-bank-deposit",children:"Cancel"})]})]})})]})}),e.jsx(U,{open:Ee,onOpenChange:B,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsx(z,{children:e.jsx(J,{children:"Vendor Payment"})}),e.jsx($,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(t=>ie.mutate(t)),className:"space-y-4",children:[e.jsx(l,{control:p.control,name:"vendorId",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Vendor *"}),e.jsxs(H,{onValueChange:t.onChange,value:t.value,children:[e.jsx(o,{children:e.jsx(W,{"data-testid":"select-vendor",children:e.jsx(X,{placeholder:"Select vendor"})})}),e.jsx(Y,{children:ne.map(s=>e.jsx(c,{value:s.id,children:s.name},s.id))})]})]})}),e.jsx(l,{control:p.control,name:"amount",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Amount *"}),e.jsx(o,{children:e.jsx(u,{...t,type:"number",step:"0.01",placeholder:"0.00","data-testid":"input-vendor-amount"})})]})}),e.jsx(l,{control:p.control,name:"paymentMethod",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Payment Method *"}),e.jsxs(H,{onValueChange:t.onChange,value:t.value,children:[e.jsx(o,{children:e.jsx(W,{"data-testid":"select-payment-method",children:e.jsx(X,{placeholder:"Select payment method"})})}),e.jsxs(Y,{children:[e.jsx(c,{value:"cash",children:"Cash"}),e.jsx(c,{value:"cheque",children:"Cheque"}),e.jsx(c,{value:"pos",children:"POS"}),e.jsx(c,{value:"fonepay",children:"Fonepay"})]})]})]})}),p.watch("paymentMethod")==="cheque"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{control:p.control,name:"chequeNumber",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Cheque Number *"}),e.jsx(o,{children:e.jsx(u,{...t,placeholder:"Enter cheque number","data-testid":"input-cheque-number"})})]})}),e.jsx(l,{control:p.control,name:"bankName",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Bank Name *"}),e.jsx(o,{children:e.jsx(u,{...t,placeholder:"Which bank cheque issued from","data-testid":"input-cheque-bank"})})]})})]}),e.jsx(l,{control:p.control,name:"notes",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Notes (Optional)"}),e.jsx(o,{children:e.jsx(G,{...t,placeholder:"Additional notes...",rows:2,"data-testid":"textarea-vendor-notes"})})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(f,{type:"submit",className:"flex-1",disabled:ie.isPending,"data-testid":"button-submit-vendor-payment",children:ie.isPending?"Processing...":"Process Payment"}),e.jsx(f,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>{B(!1),te(null)},"data-testid":"button-cancel-vendor-payment",children:"Cancel"})]})]})})]})}),e.jsx(U,{open:Fe,onOpenChange:R,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsx(z,{children:e.jsx(J,{children:"Add New Vendor"})}),e.jsx($,{...N,children:e.jsxs("form",{onSubmit:N.handleSubmit(t=>le.mutate(t)),className:"space-y-4",children:[e.jsx(l,{control:N.control,name:"name",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Vendor Name *"}),e.jsx(o,{children:e.jsx(u,{...t,placeholder:"Enter vendor name","data-testid":"input-vendor-name"})})]})}),e.jsx(l,{control:N.control,name:"phone",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Phone"}),e.jsx(o,{children:e.jsx(u,{...t,placeholder:"Enter phone number","data-testid":"input-vendor-phone"})})]})}),e.jsx(l,{control:N.control,name:"email",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Email"}),e.jsx(o,{children:e.jsx(u,{...t,type:"email",placeholder:"Enter email address","data-testid":"input-vendor-email"})})]})}),e.jsx(l,{control:N.control,name:"address",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Address"}),e.jsx(o,{children:e.jsx(G,{...t,placeholder:"Enter address",rows:2,"data-testid":"textarea-vendor-address"})})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(f,{type:"submit",className:"flex-1",disabled:le.isPending,"data-testid":"button-submit-add-vendor",children:le.isPending?"Adding...":"Add Vendor"}),e.jsx(f,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>R(!1),"data-testid":"button-cancel-add-vendor",children:"Cancel"})]})]})})]})}),e.jsx(U,{open:Se,onOpenChange:I,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsx(z,{children:e.jsx(J,{children:"Add New Expense"})}),e.jsx($,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(t=>de.mutate(t)),className:"space-y-4",children:[e.jsx(l,{control:j.control,name:"category",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Category *"}),e.jsxs(H,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(o,{children:e.jsx(W,{"data-testid":"select-expense-category",children:e.jsx(X,{})})}),e.jsxs(Y,{children:[e.jsx(c,{value:"utilities",children:"Utilities"}),e.jsx(c,{value:"maintenance",children:"Maintenance"}),e.jsx(c,{value:"supplies",children:"Supplies"}),e.jsx(c,{value:"salaries",children:"Salaries"}),e.jsx(c,{value:"rent",children:"Rent"}),e.jsx(c,{value:"insurance",children:"Insurance"}),e.jsx(c,{value:"marketing",children:"Marketing"}),e.jsx(c,{value:"other",children:"Other"})]})]})]})}),e.jsx(l,{control:j.control,name:"amount",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Amount *"}),e.jsx(o,{children:e.jsx(u,{...t,type:"number",step:"0.01",placeholder:"0.00","data-testid":"input-expense-amount"})})]})}),e.jsx(l,{control:j.control,name:"paymentMethod",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Payment Method *"}),e.jsxs(H,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(o,{children:e.jsx(W,{"data-testid":"select-expense-payment-method",children:e.jsx(X,{})})}),e.jsxs(Y,{children:[e.jsx(c,{value:"cash",children:"Cash"}),e.jsx(c,{value:"cheque",children:"Cheque"}),e.jsx(c,{value:"pos",children:"POS"}),e.jsx(c,{value:"fonepay",children:"Fonepay"})]})]})]})}),j.watch("paymentMethod")==="cheque"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{control:j.control,name:"chequeNumber",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Cheque Number *"}),e.jsx(o,{children:e.jsx(u,{...t,placeholder:"Enter cheque number","data-testid":"input-expense-cheque-number"})})]})}),e.jsx(l,{control:j.control,name:"bankName",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Bank Name *"}),e.jsx(o,{children:e.jsx(u,{...t,placeholder:"Which bank cheque issued from","data-testid":"input-expense-cheque-bank"})})]})})]}),e.jsx(l,{control:j.control,name:"description",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Description *"}),e.jsx(o,{children:e.jsx(G,{...t,placeholder:"Expense description",rows:3,"data-testid":"textarea-expense-description"})})]})}),e.jsx(l,{control:j.control,name:"billInvoiceNumber",render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:"Bill/Invoice Number *"}),e.jsx(o,{children:e.jsx(u,{...t,placeholder:"Enter bill or invoice number","data-testid":"input-bill-invoice-number"})})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Bill Photo/PDF *"}),e.jsx(u,{type:"file",accept:"image/jpeg,image/jpg,image/png,application/pdf",onChange:Ie,"data-testid":"input-bill-document"}),y&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Selected: ",y.name," (",(y.size/1024).toFixed(2)," KB)"]}),be&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:be,alt:"Bill preview",className:"max-w-full h-auto max-h-48 rounded border"})}),y&&y.type==="application/pdf"&&e.jsx("div",{className:"text-sm text-blue-600",children:"PDF file selected - preview not available"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(f,{type:"submit",className:"flex-1",disabled:de.isPending,"data-testid":"button-submit-add-expense",children:de.isPending?"Recording...":"Record Expense"}),e.jsx(f,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>I(!1),"data-testid":"button-cancel-add-expense",children:"Cancel"})]})]})})]})})]})})}export{Nt as default};
