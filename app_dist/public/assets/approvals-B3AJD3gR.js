import{u as O,r as d,l as A,d as T,j as e,C as $,m as _,n as K,a as V,p as h,B as r,s as z,k as D,A as P}from"./index-Dk6nXF67.js";import{D as Q,C as H}from"./dashboard-layout-BUO8e75G.js";import{D as f,a as N,b,c as y,d as w,e as C}from"./dialog-mWSLCdZX.js";import{T as X}from"./textarea-BAi4nzW_.js";import{C as G}from"./circle-alert-BbQxKC8I.js";import{E as J,e as W}from"./users-Dxbor6Q1.js";function re(){const{toast:n}=O(),[t,i]=d.useState(null),[R,c]=d.useState(!1),[S,o]=d.useState(!1),[k,u]=d.useState(!1),[l,j]=d.useState(""),{data:g=[],isLoading:B}=A({queryKey:["/api/hotels/current/transactions",{pendingApproval:"true"}],refetchInterval:3e3}),{data:E=[]}=A({queryKey:["/api/hotels/current/users"]}),p=T({mutationFn:async s=>D("POST",`/api/transactions/${s}/approve`),onSuccess:()=>{n({title:"Transaction Approved",description:"The transaction has been successfully approved."}),P.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),c(!1),i(null)},onError:s=>{n({title:"Approval Failed",description:s.message||"Failed to approve transaction",variant:"destructive"})}}),x=T({mutationFn:async({transactionId:s,reason:a})=>D("POST",`/api/transactions/${s}/reject`,{reason:a}),onSuccess:()=>{n({title:"Transaction Rejected",description:"The transaction has been rejected."}),P.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),o(!1),i(null),j("")},onError:s=>{n({title:"Rejection Failed",description:s.message||"Failed to reject transaction",variant:"destructive"})}}),I=s=>{i(s),c(!0)},F=s=>{i(s),o(!0)},U=s=>{i(s),u(!0)},q=()=>{t&&p.mutate(t.id)},L=()=>{t&&l.trim().length>=10?x.mutate({transactionId:t.id,reason:l}):n({title:"Validation Error",description:"Rejection reason must be at least 10 characters",variant:"destructive"})},v=s=>{const a=E.find(M=>M.id===s);return(a==null?void 0:a.username)||(a==null?void 0:a.fullName)||"Unknown"},m=s=>({cash_out:"Cash Out",expense:"Expense",vendor_payment:"Vendor Payment",miscellaneous:"Miscellaneous",revenue:"Revenue",cash_in:"Cash In"})[s]||s;return e.jsxs(Q,{title:"Pending Approvals",children:[e.jsx("div",{className:"space-y-6",children:e.jsxs($,{children:[e.jsx(_,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-amber-500"}),"Transactions Pending Approval (",g.length,")"]})}),e.jsx(V,{children:B?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):g.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No pending approvals"}):e.jsx("div",{className:"space-y-4",children:g.map(s=>e.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow","data-testid":`transaction-${s.id}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-lg",children:h(Number(s.amount))}),e.jsx("span",{className:"px-2 py-1 bg-amber-100 text-amber-800 rounded-md text-xs font-medium",children:m(s.txnType)})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Purpose: ",s.purpose||"N/A"]}),e.jsxs("p",{children:["Created by: ",v(s.createdBy)]}),e.jsxs("p",{children:["Date: ",new Date(s.createdAt).toLocaleDateString()]}),s.billInvoiceNumber&&e.jsxs("p",{children:["Invoice #: ",s.billInvoiceNumber]}),!s.billPhotoUrl&&!s.billPdfUrl&&s.txnType==="cash_out"&&e.jsx("p",{className:"text-red-600 font-medium",children:"⚠️ No bill document provided"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>U(s),"data-testid":`button-view-${s.id}`,children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsxs(r,{size:"sm",variant:"default",className:"bg-green-600 hover:bg-green-700",onClick:()=>I(s),disabled:p.isPending,"data-testid":`button-approve-${s.id}`,children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(r,{size:"sm",variant:"destructive",onClick:()=>F(s),disabled:x.isPending,"data-testid":`button-reject-${s.id}`,children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]})},s.id))})})]})}),e.jsx(f,{open:R,onOpenChange:c,children:e.jsxs(N,{"data-testid":"dialog-approve",children:[e.jsxs(b,{children:[e.jsx(y,{children:"Approve Transaction"}),e.jsx(w,{children:"Are you sure you want to approve this transaction?"})]}),t&&e.jsxs("div",{className:"space-y-2 py-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ",h(Number(t.amount))]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",m(t.txnType)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Purpose:"})," ",t.purpose||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Created by:"})," ",v(t.createdBy)]})]}),e.jsxs(C,{children:[e.jsx(r,{variant:"outline",onClick:()=>c(!1),"data-testid":"button-cancel-approve",children:"Cancel"}),e.jsx(r,{onClick:q,disabled:p.isPending,"data-testid":"button-confirm-approve",children:p.isPending?"Approving...":"Approve"})]})]})}),e.jsx(f,{open:S,onOpenChange:o,children:e.jsxs(N,{"data-testid":"dialog-reject",children:[e.jsxs(b,{children:[e.jsx(y,{children:"Reject Transaction"}),e.jsx(w,{children:"Please provide a reason for rejecting this transaction (minimum 10 characters)."})]}),t&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ",h(Number(t.amount))]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",m(t.txnType)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Purpose:"})," ",t.purpose||"N/A"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"rejection-reason",children:"Rejection Reason *"}),e.jsx(X,{id:"rejection-reason",placeholder:"Enter reason for rejection...",value:l,onChange:s=>j(s.target.value),className:"min-h-[100px]","data-testid":"textarea-rejection-reason"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[l.length,"/10 characters minimum"]})]})]}),e.jsxs(C,{children:[e.jsx(r,{variant:"outline",onClick:()=>{o(!1),j("")},"data-testid":"button-cancel-reject",children:"Cancel"}),e.jsx(r,{variant:"destructive",onClick:L,disabled:x.isPending||l.trim().length<10,"data-testid":"button-confirm-reject",children:x.isPending?"Rejecting...":"Reject"})]})]})}),e.jsx(f,{open:k,onOpenChange:u,children:e.jsxs(N,{className:"max-w-2xl","data-testid":"dialog-details",children:[e.jsx(b,{children:e.jsx(y,{children:"Transaction Details"})}),t&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Amount"}),e.jsx("p",{className:"font-semibold text-lg",children:h(Number(t.amount))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx("p",{className:"font-medium",children:m(t.txnType)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Purpose"}),e.jsx("p",{children:t.purpose||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Payment Method"}),e.jsx("p",{children:t.paymentMethod||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Created By"}),e.jsx("p",{children:v(t.createdBy)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Date"}),e.jsx("p",{children:new Date(t.createdAt).toLocaleString()})]}),t.billInvoiceNumber&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Invoice Number"}),e.jsx("p",{children:t.billInvoiceNumber})]}),t.reference&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Reference"}),e.jsx("p",{children:t.reference})]})]}),t.billPhotoUrl&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Bill Photo"}),e.jsx("img",{src:t.billPhotoUrl,alt:"Bill",className:"max-w-full rounded-lg border"})]}),!t.billPhotoUrl&&!t.billPdfUrl&&t.txnType==="cash_out"&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-red-800 font-medium",children:"⚠️ No bill document provided"}),e.jsx("p",{className:"text-sm text-red-600 mt-1",children:"This transaction requires approval as no bill evidence was submitted."})]})]}),e.jsx(C,{children:e.jsx(r,{onClick:()=>u(!1),"data-testid":"button-close-details",children:"Close"})})]})})]})}export{re as default};
