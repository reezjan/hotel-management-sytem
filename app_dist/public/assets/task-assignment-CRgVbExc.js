import{v as G,r as D,b as W,l as y,d as b,j as e,C as x,a as g,s as o,I as C,B as S}from"./index-Dk6nXF67.js";import{D as X,C as A}from"./dashboard-layout-BUO8e75G.js";import{D as Y}from"./data-table-BEvwFoVx.js";import{S as T,a as k,b as N,c as v,d as n}from"./select-Gj2YppMn.js";import{T as Z}from"./textarea-BAi4nzW_.js";import{D as ee,a as se,b as te,c as ae}from"./dialog-mWSLCdZX.js";import{t as i}from"./index-Dmezy7bQ.js";import{C as P}from"./circle-alert-BbQxKC8I.js";import{c as I,U as re}from"./users-Dxbor6Q1.js";import"./badge-P46XOlcm.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";function je(){const{confirm:E}=G(),[F,m]=D.useState(!1),[a,l]=D.useState({title:"",description:"",assignedTo:"",priority:"medium",dueDateTime:""}),p=W(),{data:O=[]}=y({queryKey:["/api/hotels/current/users"],refetchInterval:3e3}),u=O.filter(s=>{var t;return["waiter","kitchen_staff","bartender","barista","cashier"].includes(((t=s.role)==null?void 0:t.name)||"")}),{data:w=[]}=y({queryKey:["/api/attendance/daily"],refetchInterval:3e3}),{data:q=[],isLoading:L}=y({queryKey:["/api/hotels/current/tasks"],refetchInterval:3e3}),h=q.filter(s=>u.some(t=>t.id===s.assignedTo)),j=b({mutationFn:async s=>{const t=await fetch("/api/hotels/current/tasks",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!t.ok){const r=await t.json();throw new Error(r.message||"Failed to create task")}return t.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/hotels/current/tasks"]}),m(!1),l({title:"",description:"",assignedTo:"",priority:"medium",dueDateTime:""}),i.success("Task assigned successfully")},onError:s=>{i.error(s.message)}}),K=b({mutationFn:async({taskId:s,status:t})=>{const r=await fetch(`/api/hotels/current/tasks/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:t})});if(!r.ok)throw new Error("Failed to update task");return r.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/hotels/current/tasks"]}),i.success("Task status updated")},onError:s=>{i.error(s.message)}}),U=()=>{if(!a.title||!a.assignedTo){i.error("Please fill in title and assign to a staff member");return}const{dueDateTime:s,...t}=a;j.mutate({...t,dueDate:s||null})},Q=(s,t)=>{K.mutate({taskId:s.id,status:t})},B=async s=>{await E({title:"Delete Task",description:`Are you sure you want to delete "${s.title}"?`,confirmText:"Delete",cancelText:"Cancel",variant:"destructive",onConfirm:async()=>{try{if(!(await fetch(`/api/hotels/current/tasks/${s.id}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Failed to delete task");p.invalidateQueries({queryKey:["/api/hotels/current/tasks"]}),i.success("Task deleted successfully")}catch(t){i.error(t.message)}}})},M=s=>{switch(s){case"completed":return e.jsx(A,{className:"h-4 w-4 text-green-500"});case"performing":return e.jsx(I,{className:"h-4 w-4 text-orange-500"});default:return e.jsx(P,{className:"h-4 w-4 text-gray-500"})}},V=s=>{switch(s){case"high":return"text-red-600 bg-red-100";case"medium":return"text-orange-600 bg-orange-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},$=[{key:"title",label:"Task",sortable:!0},{key:"assignedTo",label:"Assigned To",render:(s,t)=>{var d,c;const r=u.find(f=>f.id===t.assignedTo);return r?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.username}),e.jsx("div",{className:"text-sm text-muted-foreground",children:(c=(d=r.role)==null?void 0:d.name)==null?void 0:c.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase())})]}):"Unknown Staff"}},{key:"priority",label:"Priority",render:s=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${V(s)}`,children:(s==null?void 0:s.charAt(0).toUpperCase())+(s==null?void 0:s.slice(1))})},{key:"status",label:"Status",render:(s,t)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[M(s),e.jsxs(T,{value:s,onValueChange:r=>Q(t,r),children:[e.jsx(k,{className:"w-32",children:e.jsx(N,{})}),e.jsxs(v,{children:[e.jsx(n,{value:"pending",children:"Pending"}),e.jsx(n,{value:"performing",children:"In Progress"}),e.jsx(n,{value:"completed",children:"Completed"})]})]})]})},{key:"dueDateTime",label:"Due Date",sortable:!0,render:s=>s?new Date(s).toLocaleDateString():"No due date"}],_=[{label:"Delete",action:B,variant:"destructive"}],H=h.filter(s=>s.status==="pending").length,J=h.filter(s=>s.status==="performing").length,R=h.filter(s=>s.status==="completed").length,z=u.filter(s=>w.some(t=>t.userId===s.id&&t.status==="active")).length;return e.jsx(X,{title:"Task Assignment",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(x,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending Tasks"}),e.jsx("p",{className:"text-2xl font-bold",children:H})]}),e.jsx(P,{className:"h-8 w-8 text-gray-500"})]})})}),e.jsx(x,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-bold",children:J})]}),e.jsx(I,{className:"h-8 w-8 text-orange-500"})]})})}),e.jsx(x,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Completed Today"}),e.jsx("p",{className:"text-2xl font-bold",children:R})]}),e.jsx(A,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(x,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Staff On Duty"}),e.jsx("p",{className:"text-2xl font-bold",children:z})]}),e.jsx(re,{className:"h-8 w-8 text-blue-500"})]})})})]}),e.jsx(Y,{title:"Restaurant Tasks",data:h,columns:$,actions:_,isLoading:L,onAdd:()=>m(!0),addButtonLabel:"Assign New Task",searchPlaceholder:"Search tasks..."}),e.jsx(ee,{open:F,onOpenChange:m,children:e.jsxs(se,{className:"max-w-md",children:[e.jsx(te,{children:e.jsx(ae,{children:"Assign New Task"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"title",children:"Task Title *"}),e.jsx(C,{id:"title",value:a.title,onChange:s=>l({...a,title:s.target.value}),placeholder:"Enter task title"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"description",children:"Description"}),e.jsx(Z,{id:"description",value:a.description,onChange:s=>l({...a,description:s.target.value}),placeholder:"Enter task description",rows:3})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"assignedTo",children:"Assign To *"}),e.jsxs(T,{value:a.assignedTo,onValueChange:s=>l({...a,assignedTo:s}),children:[e.jsx(k,{children:e.jsx(N,{placeholder:"Select staff member"})}),e.jsx(v,{children:u.map(s=>{var r,d;const t=w.some(c=>c.userId===s.id&&c.status==="active");return e.jsx(n,{value:s.id,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:s.username}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",(d=(r=s.role)==null?void 0:r.name)==null?void 0:d.replace(/_/g," "),")"]}),t&&e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500"})]})},s.id)})})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"priority",children:"Priority"}),e.jsxs(T,{value:a.priority,onValueChange:s=>l({...a,priority:s}),children:[e.jsx(k,{children:e.jsx(N,{})}),e.jsxs(v,{children:[e.jsx(n,{value:"low",children:"Low"}),e.jsx(n,{value:"medium",children:"Medium"}),e.jsx(n,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"dueDateTime",children:"Due Date & Time"}),e.jsx(C,{id:"dueDateTime",type:"datetime-local",value:a.dueDateTime,onChange:s=>l({...a,dueDateTime:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(S,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(S,{onClick:U,disabled:j.isPending,children:j.isPending?"Assigning...":"Assign Task"})]})]})]})})]})})}export{je as default};
