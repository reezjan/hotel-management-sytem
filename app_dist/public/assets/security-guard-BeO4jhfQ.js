import{q as W,u as X,b as Y,r as $,l as D,d as y,j as e,C as o,m as u,n as h,a as m,B as x,y as F,s as r,I as d,k as f}from"./index-Dk6nXF67.js";import{D as Z,y as ee,_ as I}from"./dashboard-layout-BUO8e75G.js";import{S as b}from"./stats-card-DnI6mJO0.js";import{T as te}from"./textarea-BAi4nzW_.js";import{S as se,a as ie,b as ae,c as ne,d as L}from"./select-Gj2YppMn.js";import{T as re,a as ce,b as N,c as C}from"./tabs-B2htHbJV.js";import{c as de,S as le,a as oe}from"./users-Dxbor6Q1.js";import{f as k}from"./format-BOBWS5Wu.js";import"./circle-alert-BbQxKC8I.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";function Ne(){const{user:a}=W(),{toast:i}=X(),p=Y(),[n,v]=$.useState({vehicleNumber:"",driverName:"",purpose:""}),[s,c]=$.useState({title:"",location:"",description:"",priority:"medium",photo:""}),{data:O=[],isLoading:A}=D({queryKey:["/api/hotels/current/security/tasks"],refetchInterval:3e3}),{data:H=[],isLoading:R}=D({queryKey:["/api/hotels/current/vehicle-logs"],refetchInterval:3e3}),{data:E=[],isLoading:K}=D({queryKey:["/api/hotels/current/maintenance-requests"],refetchInterval:3e3}),M=y({mutationFn:async t=>await f("POST","/api/hotels/current/vehicle-logs",t),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/hotels/current/vehicle-logs"]}),i({title:"Vehicle checked in successfully"}),v({vehicleNumber:"",driverName:"",purpose:""})},onError:t=>{i({title:"Failed to check in vehicle",description:t.message||"An error occurred",variant:"destructive"})}}),P=y({mutationFn:async t=>await f("PATCH",`/api/vehicle-logs/${t}/checkout`,{}),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/hotels/current/vehicle-logs"]}),i({title:"Vehicle checked out successfully"})},onError:t=>{i({title:"Failed to check out vehicle",description:t.message||"An error occurred",variant:"destructive"})}}),j=y({mutationFn:async({taskId:t,status:g})=>await f("PATCH",`/api/tasks/${t}/status`,{status:g}),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/hotels/current/security/tasks"]}),i({title:"Task status updated successfully"})},onError:t=>{i({title:"Failed to update task",description:t.message||"An error occurred",variant:"destructive"})}}),S=y({mutationFn:async t=>await f("POST","/api/hotels/current/maintenance-requests",t),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/hotels/current/maintenance-requests"]}),i({title:"Maintenance request sent to Security Head successfully"}),c({title:"",location:"",description:"",priority:"medium",photo:""})},onError:t=>{i({title:"Failed to send maintenance request",description:t.message||"An error occurred",variant:"destructive"})}}),B=t=>{if(t.preventDefault(),!n.vehicleNumber||!n.driverName){i({title:"Vehicle number and driver name are required",variant:"destructive"});return}M.mutate(n)},Q=t=>{if(t.preventDefault(),!s.title||!s.location){i({title:"Title and location are required",variant:"destructive"});return}S.mutate(s)},_=t=>{var q;const g=(q=t.target.files)==null?void 0:q[0];if(g){const w=new FileReader;w.onloadend=()=>{c({...s,photo:w.result})},w.readAsDataURL(g)}},l=O.filter(t=>t.assignedTo===(a==null?void 0:a.id)),z=l.filter(t=>t.status==="pending"),J=l.filter(t=>t.status==="in_progress"),U=l.filter(t=>t.status==="completed"),T=H.filter(t=>t.recordedBy===(a==null?void 0:a.id)),G=T.filter(t=>!t.checkOut),V=E.filter(t=>t.reportedBy===(a==null?void 0:a.id));return e.jsx(Z,{title:"Surveillance Officer Dashboard",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(b,{title:"Pending Tasks",value:z.length,icon:e.jsx(de,{}),iconColor:"text-orange-500"}),e.jsx(b,{title:"In Progress",value:J.length,icon:e.jsx(le,{}),iconColor:"text-blue-500"}),e.jsx(b,{title:"Completed",value:U.length,icon:e.jsx(ee,{}),iconColor:"text-green-500"}),e.jsx(b,{title:"Active Vehicles",value:G.length,icon:e.jsx(I,{}),iconColor:"text-purple-500"})]}),e.jsxs(re,{defaultValue:"tasks",className:"w-full",children:[e.jsxs(ce,{className:"grid w-full grid-cols-4",children:[e.jsx(N,{value:"tasks","data-testid":"tab-tasks",children:"My Tasks"}),e.jsx(N,{value:"vehicles","data-testid":"tab-vehicles",children:"Vehicle Logs"}),e.jsx(N,{value:"maintenance","data-testid":"tab-maintenance",children:"Maintenance"}),e.jsx(N,{value:"checkin","data-testid":"tab-checkin",children:"Check-in Vehicle"})]}),e.jsx(C,{value:"tasks",children:e.jsxs(o,{children:[e.jsx(u,{children:e.jsx(h,{children:"My Assigned Tasks"})}),e.jsx(m,{children:A?e.jsx("div",{className:"text-center py-8","data-testid":"loading-tasks",children:"Loading tasks..."}):l.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground","data-testid":"no-tasks",children:"No tasks assigned yet."}):e.jsx("div",{className:"space-y-4",children:l.map(t=>e.jsx("div",{className:"p-4 border rounded-lg","data-testid":`task-${t.id}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-medium","data-testid":`task-title-${t.id}`,children:t.title}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${t.priority==="high"?"bg-red-100 text-red-800":t.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:t.priority}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${t.status==="completed"?"bg-green-100 text-green-800":t.status==="in_progress"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,"data-testid":`task-status-${t.id}`,children:t.status})]}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.description}),t.dueDate&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Due: ",k(new Date(t.dueDate),"MMM dd, yyyy HH:mm")]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[t.status==="pending"&&e.jsx(x,{size:"sm",onClick:()=>j.mutate({taskId:t.id,status:"in_progress"}),disabled:j.isPending,"data-testid":`button-start-${t.id}`,children:"Start"}),t.status==="in_progress"&&e.jsx(x,{size:"sm",variant:"outline",onClick:()=>j.mutate({taskId:t.id,status:"completed"}),disabled:j.isPending,"data-testid":`button-complete-${t.id}`,children:"Complete"})]})]})},t.id))})})]})}),e.jsx(C,{value:"vehicles",children:e.jsxs(o,{children:[e.jsx(u,{children:e.jsx(h,{children:"My Vehicle Logs"})}),e.jsx(m,{children:R?e.jsx("div",{className:"text-center py-8","data-testid":"loading-vehicles",children:"Loading vehicle logs..."}):T.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground","data-testid":"no-vehicles",children:"No vehicle logs yet."}):e.jsx("div",{className:"space-y-4",children:T.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg","data-testid":`vehicle-${t.id}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium","data-testid":`vehicle-number-${t.id}`,children:t.vehicleNumber})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:["Driver: ",t.driverName," • Purpose: ",t.purpose]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Check-in: ",k(new Date(t.checkIn),"MMM dd, yyyy HH:mm"),t.checkOut&&` • Check-out: ${k(new Date(t.checkOut),"MMM dd, yyyy HH:mm")}`]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs ${t.checkOut?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800"}`,"data-testid":`vehicle-status-${t.id}`,children:t.checkOut?"Checked Out":"On Premises"}),!t.checkOut&&e.jsx(x,{size:"sm",variant:"outline",onClick:()=>P.mutate(t.id),disabled:P.isPending,"data-testid":`button-checkout-${t.id}`,children:"Check Out"})]})]},t.id))})})]})}),e.jsxs(C,{value:"maintenance",children:[e.jsxs(o,{children:[e.jsxs(u,{children:[e.jsx(h,{children:"My Maintenance Requests"}),e.jsx(F,{children:"Requests sent to Security Head"})]}),e.jsx(m,{children:K?e.jsx("div",{className:"text-center py-8","data-testid":"loading-maintenance",children:"Loading maintenance requests..."}):V.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground","data-testid":"no-maintenance",children:"No maintenance requests yet."}):e.jsx("div",{className:"space-y-4",children:V.map(t=>e.jsx("div",{className:"p-4 border rounded-lg","data-testid":`maintenance-${t.id}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"h-4 w-4 text-orange-500"}),e.jsx("h4",{className:"font-medium","data-testid":`maintenance-title-${t.id}`,children:t.title}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${t.priority==="high"?"bg-red-100 text-red-800":t.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:t.priority})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.description}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Location: ",t.location]}),e.jsxs("span",{"data-testid":`maintenance-status-${t.id}`,children:["Status: ",t.status]}),e.jsx("span",{children:k(new Date(t.createdAt),"MMM dd, yyyy")})]})]})})},t.id))})})]}),e.jsxs(o,{className:"mt-6",children:[e.jsxs(u,{children:[e.jsx(h,{children:"Submit New Maintenance Request"}),e.jsx(F,{children:"Report maintenance issues to Security Head"})]}),e.jsx(m,{children:e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"title",children:"Issue Title *"}),e.jsx(d,{id:"title","data-testid":"input-maintenance-title",value:s.title,onChange:t=>c({...s,title:t.target.value}),placeholder:"e.g., CCTV Camera Malfunction",required:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"location",children:"Location *"}),e.jsx(d,{id:"location","data-testid":"input-maintenance-location",value:s.location,onChange:t=>c({...s,location:t.target.value}),placeholder:"e.g., Main Entrance",required:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"priority",children:"Priority"}),e.jsxs(se,{value:s.priority,onValueChange:t=>c({...s,priority:t}),children:[e.jsx(ie,{"data-testid":"select-maintenance-priority",children:e.jsx(ae,{})}),e.jsxs(ne,{children:[e.jsx(L,{value:"low",children:"Low"}),e.jsx(L,{value:"medium",children:"Medium"}),e.jsx(L,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"description",children:"Description"}),e.jsx(te,{id:"description","data-testid":"textarea-maintenance-description",value:s.description,onChange:t=>c({...s,description:t.target.value}),placeholder:"Detailed description of the issue"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"photo",children:"Photo (optional)"}),e.jsx(d,{id:"photo",type:"file",accept:"image/*","data-testid":"input-maintenance-photo",onChange:_}),s.photo&&e.jsx("img",{src:s.photo,alt:"Preview",className:"mt-2 h-32 rounded"})]}),e.jsx(x,{type:"submit",disabled:S.isPending,"data-testid":"button-submit-maintenance",children:S.isPending?"Submitting...":"Submit Request"})]})})]})]}),e.jsx(C,{value:"checkin",children:e.jsxs(o,{children:[e.jsxs(u,{children:[e.jsx(h,{children:"Vehicle Check-in"}),e.jsx(F,{children:"Register a vehicle entering the premises"})]}),e.jsx(m,{children:e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"vehicleNumber",children:"Vehicle Number *"}),e.jsx(d,{id:"vehicleNumber","data-testid":"input-vehicle-number",value:n.vehicleNumber,onChange:t=>v({...n,vehicleNumber:t.target.value}),placeholder:"e.g., BA-1234",required:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"driverName",children:"Driver Name *"}),e.jsx(d,{id:"driverName","data-testid":"input-driver-name",value:n.driverName,onChange:t=>v({...n,driverName:t.target.value}),placeholder:"e.g., John Doe",required:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"purpose",children:"Purpose"}),e.jsx(d,{id:"purpose","data-testid":"input-vehicle-purpose",value:n.purpose,onChange:t=>v({...n,purpose:t.target.value}),placeholder:"e.g., Delivery"})]}),e.jsx(x,{type:"submit",disabled:M.isPending,"data-testid":"button-checkin-vehicle",children:M.isPending?"Checking in...":"Check In Vehicle"})]})})]})})]})]})})}export{Ne as default};
