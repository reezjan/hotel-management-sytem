import{l as u,j as e,C as x,m as h,n as m,a as g,x as j}from"./index-Dk6nXF67.js";import{D as N,U as k,h as D}from"./dashboard-layout-BUO8e75G.js";import{B as p}from"./badge-P46XOlcm.js";import{S as l}from"./stats-card-DnI6mJO0.js";import{U as T}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";function b(){const{data:y=[],isLoading:o}=u({queryKey:["/api/hotels/current/users"],refetchInterval:3e3,queryFn:async()=>{const t=await fetch("/api/hotels/current/users",{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch staff");return t.json()}}),{data:n=[]}=u({queryKey:["/api/attendance/daily"],refetchInterval:3e3,queryFn:async()=>{const t=await fetch("/api/attendance/daily",{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch attendance");return t.json()}}),i=y.filter(t=>{var a;return((a=t.role)==null?void 0:a.name)==="housekeeping_staff"}),f=n.filter(t=>t.status==="active").map(t=>t.userId),d=i.filter(t=>f.includes(t.id)),c=i.filter(t=>!f.includes(t.id));return e.jsx(N,{title:"Duty Tracking",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(l,{title:"Total Staff",value:i.length,icon:e.jsx(T,{}),iconColor:"text-blue-500"}),e.jsx(l,{title:"On Duty",value:d.length,icon:e.jsx(k,{}),iconColor:"text-green-500"}),e.jsx(l,{title:"Off Duty",value:c.length,icon:e.jsx(D,{}),iconColor:"text-gray-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(m,{children:"Staff On Duty"})}),e.jsx(g,{children:o?e.jsx("p",{className:"text-muted-foreground",children:"Loading..."}):d.length===0?e.jsx("p",{className:"text-muted-foreground","data-testid":"no-online-staff",children:"No staff currently on duty"}):e.jsx("div",{className:"space-y-3",children:d.map((t,a)=>{const s=n.find(r=>r.userId===t.id&&r.status==="active");return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg","data-testid":`online-staff-${a}`,children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:t.username}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.phone})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(p,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100",variant:"secondary",children:"On Duty"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s!=null&&s.clockInTime?j(s.clockInTime):"Active"})]})]},t.id)})})})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(m,{children:"Staff Off Duty"})}),e.jsx(g,{children:o?e.jsx("p",{className:"text-muted-foreground",children:"Loading..."}):c.length===0?e.jsx("p",{className:"text-muted-foreground","data-testid":"no-offline-staff",children:"All staff are on duty"}):e.jsx("div",{className:"space-y-3",children:c.map((t,a)=>{const s=n.filter(r=>r.userId===t.id&&r.status==="completed").sort((r,v)=>new Date(v.clockOutTime).getTime()-new Date(r.clockOutTime).getTime())[0];return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg","data-testid":`offline-staff-${a}`,children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:t.username}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.phone})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(p,{className:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100",variant:"secondary",children:"Off Duty"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s!=null&&s.clockOutTime?j(s.clockOutTime):"No recent activity"})]})]},t.id)})})})]})]})]})})}export{b as default};
