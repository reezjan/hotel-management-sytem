import{q as T,u as $,b as I,r as a,l as A,d as B,j as e,C as w,m as S,n as C,a as P,s as i,I as x,B as K,k as Q}from"./index-Dk6nXF67.js";import{D as U,F as R,o as k}from"./dashboard-layout-BUO8e75G.js";import{T as E}from"./textarea-BAi4nzW_.js";import{B as D}from"./badge-P46XOlcm.js";import{S as H,a as O,b as V,c as _,d as p}from"./select-Gj2YppMn.js";import{u as W}from"./use-realtime-query-2TJdEol3.js";import{c as z,h as G}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";import"./use-websocket-ChOW8gRL.js";function de(){const{user:r}=T(),{toast:l}=$(),F=I(),[c,g]=a.useState(""),[o,j]=a.useState(""),[y,f]=a.useState("medium"),[u,v]=a.useState(""),[n,b]=a.useState(""),{data:N=[]}=A({queryKey:["/api/hotels/current/maintenance-requests"],refetchInterval:3e3,enabled:!!r,select:t=>t.filter(d=>{var s;return((s=d.reportedBy)==null?void 0:s.id)===(r==null?void 0:r.id)})});W({queryKey:["/api/hotels/current/maintenance-requests"],refetchInterval:3e3,events:["maintenance:created","maintenance:updated","maintenance:deleted"]});const m=B({mutationFn:async t=>{await Q("POST","/api/hotels/current/maintenance-requests",t)},onSuccess:()=>{F.invalidateQueries({queryKey:["/api/hotels/current/maintenance-requests"]}),l({title:"Maintenance request submitted successfully"}),g(""),j(""),f("medium"),v(""),b("")},onError:()=>{l({title:"Failed to submit request",description:"Please try again later",variant:"destructive"})}}),q=t=>{if(t.preventDefault(),!c||!o||!u||!n){l({title:"Missing information",description:"Please fill in all required fields including photo",variant:"destructive"});return}m.mutate({title:c,description:o,priority:y,location:u,photo:n,status:"pending"})},M=t=>{switch(t){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},L=t=>{switch(t){case"completed":return e.jsx(G,{className:"h-5 w-5 text-green-600"});case"in_progress":return e.jsx(k,{className:"h-5 w-5 text-blue-600"});case"pending":default:return e.jsx(z,{className:"h-5 w-5 text-orange-500"})}};return e.jsx(U,{title:"Maintenance Requests",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(C,{className:"flex items-center",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),"Submit New Request"]})}),e.jsx(P,{children:e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title",children:"Issue Title *"}),e.jsx(x,{id:"title",placeholder:"e.g., Oven temperature issue",value:c,onChange:t=>g(t.target.value),required:!0,"data-testid":"input-title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"location",children:"Location *"}),e.jsx(x,{id:"location",placeholder:"e.g., Main Kitchen, Prep Area",value:u,onChange:t=>v(t.target.value),required:!0,"data-testid":"input-location"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"priority",children:"Priority *"}),e.jsxs(H,{value:y,onValueChange:f,children:[e.jsx(O,{id:"priority",className:"h-11","data-testid":"select-priority",children:e.jsx(V,{})}),e.jsxs(_,{children:[e.jsx(p,{value:"low",children:"Low - Can wait"}),e.jsx(p,{value:"medium",children:"Medium - Soon"}),e.jsx(p,{value:"high",children:"High - Urgent"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"description",children:"Description *"}),e.jsx(E,{id:"description",placeholder:"Provide detailed information about the issue...",value:o,onChange:t=>j(t.target.value),rows:4,required:!0,"data-testid":"input-description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"photo",children:"Photo *"}),e.jsx(x,{id:"photo",type:"file",accept:"image/*",required:!0,"data-testid":"input-photo",onChange:t=>{var s;const d=(s=t.target.files)==null?void 0:s[0];if(d){const h=new FileReader;h.onloadend=()=>{b(h.result)},h.readAsDataURL(d)}}}),n&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:n,alt:"Preview",className:"max-w-full h-32 object-cover rounded border","data-testid":"img-photo-preview"})})]}),e.jsx(K,{type:"submit",className:"w-full h-11 min-h-11",disabled:m.isPending,"data-testid":"button-submit-request",children:m.isPending?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Submit Request"]})})]})})]}),e.jsxs(w,{children:[e.jsx(S,{children:e.jsx(C,{children:"My Requests"})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-3",children:N.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8","data-testid":"text-no-requests",children:"No maintenance requests submitted yet"}):N.map(t=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-2 hover:bg-accent/50 transition-colors","data-testid":`card-request-${t.id}`,children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[L(t.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-foreground leading-tight","data-testid":`text-title-${t.id}`,children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1","data-testid":`text-location-${t.id}`,children:t.location})]})]})}),e.jsx("p",{className:"text-sm text-muted-foreground pl-8","data-testid":`text-description-${t.id}`,children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 pl-8",children:[e.jsx(D,{className:M(t.priority),variant:"outline","data-testid":`badge-priority-${t.id}`,children:t.priority.toUpperCase()}),e.jsx(D,{variant:"secondary","data-testid":`badge-status-${t.id}`,children:t.status.replace("_"," ").toUpperCase()}),e.jsx("span",{className:"text-xs text-muted-foreground","data-testid":`text-date-${t.id}`,children:new Date(t.createdAt).toLocaleDateString()})]}),t.resolvedAt&&e.jsxs("p",{className:"text-xs text-green-600 pl-8","data-testid":`text-resolved-${t.id}`,children:["âœ“ Resolved on ",new Date(t.resolvedAt).toLocaleDateString()]})]},t.id))})})]})]})})}export{de as default};
