import{r as i,l as D,b as L,d as y,j as e,B as u,s as h,I as S,C as H,m as K,n as O,a as Q,D as U,E as z,G as V,J as _,K as G,M as J,N as Y,O as W,k as b}from"./index-Dk6nXF67.js";import{T as X}from"./textarea-BAi4nzW_.js";import{S as Z,a as ee,b as ae,c as se,d as te}from"./select-Gj2YppMn.js";import{D as le,f as ne,a as ie,b as re,c as de}from"./dialog-mWSLCdZX.js";import{T as oe,a as ce,b as M,c as r,d as pe,e as d}from"./table-BAc8EiUx.js";import{B as E}from"./badge-P46XOlcm.js";import{t as l}from"./index-Dmezy7bQ.js";import{D as ue,a as me,x as he,p as xe,T as je}from"./dashboard-layout-BUO8e75G.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";import"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";const v=[{value:"EP",label:"EP - European Plan",description:"Room only, no meals included"},{value:"BB",label:"BB - Bed & Breakfast",description:"Room with breakfast"},{value:"AP",label:"AP - American Plan",description:"Room with all meals"},{value:"MAP",label:"MAP - Modified American Plan",description:"Room with breakfast and one meal"}];function Me(){var A;const[w,o]=i.useState(!1),[c,x]=i.useState(null),[j,P]=i.useState(null),[t,B]=i.useState(""),[s,n]=i.useState({planType:"",planName:"",pricePerPerson:"",description:""}),{data:p}=D({queryKey:["/api/user"],refetchInterval:3e3}),f=L();i.useEffect(()=>{p!=null&&p.hotelId&&B(p.hotelId)},[p]);const{data:N=[],isLoading:F}=D({queryKey:["/api/hotels",t,"meal-plans"],enabled:!!t,refetchInterval:3e3}),T=y({mutationFn:async a=>b("POST",`/api/hotels/${t}/meal-plans`,a),onSuccess:()=>{f.invalidateQueries({queryKey:["/api/hotels",t,"meal-plans"]}),l.success("Meal plan created successfully"),m(),o(!1)},onError:()=>{l.error("Failed to create meal plan")}}),C=y({mutationFn:async a=>b("PUT",`/api/hotels/${t}/meal-plans/${a.id}`,a.values),onSuccess:()=>{f.invalidateQueries({queryKey:["/api/hotels",t,"meal-plans"]}),l.success("Meal plan updated successfully"),m(),o(!1),x(null)},onError:()=>{l.error("Failed to update meal plan")}}),$=y({mutationFn:async a=>b("DELETE",`/api/hotels/${t}/meal-plans/${a}`),onSuccess:()=>{f.invalidateQueries({queryKey:["/api/hotels",t,"meal-plans"]}),l.success("Meal plan deleted successfully"),P(null)},onError:()=>{l.error("Failed to delete meal plan")}}),m=()=>{n({planType:"",planName:"",pricePerPerson:"",description:""}),x(null)},q=a=>{x(a),n({planType:a.planType,planName:a.planName,pricePerPerson:a.pricePerPerson,description:a.description||""}),o(!0)},I=a=>{if(a.preventDefault(),!s.planType||!s.planName||!s.pricePerPerson){l.error("Please fill in all required fields");return}c?C.mutate({id:c.id,values:s}):T.mutate(s)},k=a=>{const g=v.find(R=>R.value===a);n({...s,planType:a,planName:(g==null?void 0:g.label)||a})};return e.jsxs(ue,{title:"Meal Plans",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"heading-meal-plans",children:"Meal Plans"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage meal plan add-ons for room bookings"})]}),e.jsxs(le,{open:w,onOpenChange:a=>{o(a),a||m()},children:[e.jsx(ne,{asChild:!0,children:e.jsxs(u,{"data-testid":"button-add-meal-plan",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Add Meal Plan"]})}),e.jsxs(ie,{children:[e.jsx(re,{children:e.jsx(de,{children:c?"Edit Meal Plan":"Add Meal Plan"})}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"planType",children:"Plan Type *"}),e.jsxs(Z,{value:s.planType,onValueChange:k,disabled:!!c,children:[e.jsx(ee,{"data-testid":"select-plan-type",children:e.jsx(ae,{placeholder:"Select plan type"})}),e.jsx(se,{children:v.map(a=>e.jsx(te,{value:a.value,children:a.label},a.value))})]}),s.planType&&e.jsx("p",{className:"text-sm text-muted-foreground",children:(A=v.find(a=>a.value===s.planType))==null?void 0:A.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"planName",children:"Plan Name *"}),e.jsx(S,{id:"planName",value:s.planName,onChange:a=>n({...s,planName:a.target.value}),placeholder:"e.g., BB - Bed & Breakfast",required:!0,"data-testid":"input-plan-name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"pricePerPerson",children:"Price per Person *"}),e.jsx(S,{id:"pricePerPerson",type:"number",step:"0.01",min:"0",value:s.pricePerPerson,onChange:a=>n({...s,pricePerPerson:a.target.value}),placeholder:"0.00",required:!0,"data-testid":"input-price-per-person"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"description",children:"Description (Optional)"}),e.jsx(X,{id:"description",value:s.description,onChange:a=>n({...s,description:a.target.value}),placeholder:"Additional details about this meal plan...",rows:3,"data-testid":"input-description"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>{o(!1),m()},"data-testid":"button-cancel",children:"Cancel"}),e.jsx(u,{type:"submit",disabled:T.isPending||C.isPending,"data-testid":"button-submit-meal-plan",children:c?"Update":"Create"})]})]})]})]})]}),e.jsxs(H,{children:[e.jsx(K,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5"}),"Available Meal Plans"]})}),e.jsx(Q,{children:F?e.jsx("div",{className:"text-center py-8",children:"Loading..."}):N.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No meal plans configured. Add your first meal plan to get started."}):e.jsxs(oe,{children:[e.jsx(ce,{children:e.jsxs(M,{children:[e.jsx(r,{children:"Plan Type"}),e.jsx(r,{children:"Plan Name"}),e.jsx(r,{children:"Price per Person"}),e.jsx(r,{children:"Description"}),e.jsx(r,{children:"Status"}),e.jsx(r,{className:"text-right",children:"Actions"})]})}),e.jsx(pe,{children:N.map(a=>e.jsxs(M,{"data-testid":`row-meal-plan-${a.id}`,children:[e.jsx(d,{children:e.jsx(E,{variant:"outline","data-testid":`badge-plan-type-${a.id}`,children:a.planType})}),e.jsx(d,{"data-testid":`text-plan-name-${a.id}`,children:a.planName}),e.jsxs(d,{"data-testid":`text-price-${a.id}`,children:["NPR ",parseFloat(a.pricePerPerson).toFixed(2)]}),e.jsx(d,{className:"max-w-xs truncate","data-testid":`text-description-${a.id}`,children:a.description||"-"}),e.jsx(d,{children:e.jsx(E,{variant:a.isActive?"default":"secondary",children:a.isActive?"Active":"Inactive"})}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>q(a),"data-testid":`button-edit-${a.id}`,children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>P(a.id),"data-testid":`button-delete-${a.id}`,children:e.jsx(je,{className:"h-4 w-4"})})]})})]},a.id))})]})})]})]}),e.jsx(U,{open:!!j,onOpenChange:a=>!a&&P(null),children:e.jsxs(z,{children:[e.jsxs(V,{children:[e.jsx(_,{children:"Delete Meal Plan"}),e.jsx(G,{children:"Are you sure you want to delete this meal plan? This action cannot be undone."})]}),e.jsxs(J,{children:[e.jsx(Y,{"data-testid":"button-cancel-delete",children:"Cancel"}),e.jsx(W,{onClick:()=>j&&$.mutate(j),"data-testid":"button-confirm-delete",children:"Delete"})]})]})})]})}export{Me as default};
