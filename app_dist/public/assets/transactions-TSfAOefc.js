import{q as Y,u as Z,r as b,l as ee,c as se,d as te,j as e,C as o,a as x,p as i,m as V,n as q,B as v,ax as L,F as ne,e as m,f as h,g as u,h as p,I as F,k as ae,A as le}from"./index-Dk6nXF67.js";import{D as re,a0 as ce,b as de,w as ie,a as oe}from"./dashboard-layout-BUO8e75G.js";import{S as j,a as f,b as y,c as g,d as n}from"./select-Gj2YppMn.js";import{D as xe,a as me,b as he,c as ue}from"./dialog-mWSLCdZX.js";import{u as pe}from"./use-realtime-query-2TJdEol3.js";import{T as je,b as fe,D as B,d as ye}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";import"./use-websocket-ChOW8gRL.js";function Pe(){const{user:a}=Y(),{toast:T}=Z(),[E,N]=b.useState(!1),[C,U]=b.useState("all"),[w,$]=b.useState("all"),[K,Q]=b.useState("all"),{data:H=[]}=ee({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3,enabled:!!(a!=null&&a.hotelId)});pe({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3,events:["transaction:created","transaction:updated"]});const r=se({defaultValues:{txnType:"cash_in",amount:"",paymentMethod:"cash",purpose:"",reference:""}}),M=te({mutationFn:async s=>{await ae("POST","/api/transactions",{hotelId:a==null?void 0:a.hotelId,txnType:s.txnType,amount:parseFloat(s.amount),paymentMethod:s.paymentMethod,purpose:s.purpose,reference:s.reference,createdBy:a==null?void 0:a.id})},onSuccess:()=>{le.invalidateQueries({queryKey:["/api/hotels/current/transactions"]}),T({title:"Transaction created successfully"}),r.reset(),N(!1)},onError:()=>{T({title:"Failed to create transaction",variant:"destructive"})}}),z=s=>{M.mutate(s)},l=H.filter(s=>{const t=C==="all"||s.txnType===C,d=w==="all"||s.paymentMethod===w;return t&&d}),P=l.filter(s=>{var t;return s.txnType==="cash_in"||s.txnType==="pos_in"||s.txnType==="fonepay_in"||((t=s.txnType)==null?void 0:t.includes("_in"))}),k=l.filter(s=>{var t;return s.txnType==="cash_out"||s.txnType==="vendor_payment"||((t=s.txnType)==null?void 0:t.includes("_out"))}),_=P.reduce((s,t)=>s+Number(t.amount||0),0),I=k.reduce((s,t)=>s+Number(t.amount||0),0),D=_-I,O=l.filter(s=>s.paymentMethod==="cash"),A=l.filter(s=>s.paymentMethod==="pos"),R=l.filter(s=>s.paymentMethod==="fonepay"),W=O.reduce((s,t)=>s+Number(t.amount||0),0),G=A.reduce((s,t)=>s+Number(t.amount||0),0),J=R.reduce((s,t)=>s+Number(t.amount||0),0),X=()=>{const s=[["Date","Type","Amount","Payment Method","Purpose","Reference"],...l.map(c=>[L(c.createdAt),c.txnType,c.amount,c.paymentMethod,c.purpose||"",c.reference||""])].map(c=>c.join(",")).join(`
`),t=new Blob([s],{type:"text/csv"}),d=URL.createObjectURL(t),S=document.createElement("a");S.href=d,S.download=`transactions_${new Date().toISOString().split("T")[0]}.csv`,S.click(),URL.revokeObjectURL(d),T({title:"Transactions exported successfully"})};return e.jsx(re,{title:"Transaction Management",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(o,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Cash In"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:i(_)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[P.length," transactions"]})]}),e.jsx(je,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(o,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Cash Out"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:i(I)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[k.length," transactions"]})]}),e.jsx(fe,{className:"h-8 w-8 text-red-500"})]})})}),e.jsx(o,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Net Cash Flow"}),e.jsx("p",{className:`text-2xl font-bold ${D>=0?"text-green-600":"text-red-600"}`,children:i(D)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Current balance"})]}),e.jsx(B,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(o,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold",children:l.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Filtered results"})]}),e.jsx(ce,{className:"h-8 w-8 text-purple-500"})]})})})]}),e.jsxs(o,{children:[e.jsx(V,{children:e.jsx(q,{children:"Payment Method Breakdown"})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cash"}),e.jsx("p",{className:"text-xl font-bold",children:i(W)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[O.length," transactions"]})]})]})}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"POS"}),e.jsx("p",{className:"text-xl font-bold",children:i(G)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[A.length," transactions"]})]})]})}),e.jsx("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fonepay"}),e.jsx("p",{className:"text-xl font-bold",children:i(J)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[R.length," transactions"]})]})]})})]})})]}),e.jsxs(o,{children:[e.jsx(V,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx(q,{children:"All Transactions"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{onClick:X,variant:"outline","data-testid":"button-export",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsxs(v,{onClick:()=>N(!0),"data-testid":"button-add-transaction",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Add Transaction"]})]})]})}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Transaction Type"}),e.jsxs(j,{value:C,onValueChange:U,children:[e.jsx(f,{"data-testid":"filter-type",children:e.jsx(y,{})}),e.jsxs(g,{children:[e.jsx(n,{value:"all",children:"All Types"}),e.jsx(n,{value:"cash_in",children:"Cash In"}),e.jsx(n,{value:"cash_out",children:"Cash Out"}),e.jsx(n,{value:"pos_in",children:"POS In"}),e.jsx(n,{value:"fonepay_in",children:"Fonepay In"}),e.jsx(n,{value:"vendor_payment",children:"Vendor Payment"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Payment Method"}),e.jsxs(j,{value:w,onValueChange:$,children:[e.jsx(f,{"data-testid":"filter-payment",children:e.jsx(y,{})}),e.jsxs(g,{children:[e.jsx(n,{value:"all",children:"All Methods"}),e.jsx(n,{value:"cash",children:"Cash"}),e.jsx(n,{value:"pos",children:"POS"}),e.jsx(n,{value:"fonepay",children:"Fonepay"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Date Range"}),e.jsxs(j,{value:K,onValueChange:Q,children:[e.jsx(f,{"data-testid":"filter-date",children:e.jsx(y,{})}),e.jsxs(g,{children:[e.jsx(n,{value:"all",children:"All Time"}),e.jsx(n,{value:"today",children:"Today"}),e.jsx(n,{value:"week",children:"This Week"}),e.jsx(n,{value:"month",children:"This Month"})]})]})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Payment Method"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Purpose"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Reference"})]})}),e.jsx("tbody",{children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-muted-foreground",children:"No transactions found"})}):l.map(s=>{var t,d;return e.jsxs("tr",{className:"border-t hover:bg-muted/50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:L(s.createdAt)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs ${(t=s.txnType)!=null&&t.includes("_in")?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}`,children:s.txnType})}),e.jsx("td",{className:`px-4 py-3 text-sm font-medium ${(d=s.txnType)!=null&&d.includes("_in")?"text-green-600":"text-red-600"}`,children:i(Number(s.amount))}),e.jsx("td",{className:"px-4 py-3 text-sm capitalize",children:s.paymentMethod}),e.jsx("td",{className:"px-4 py-3 text-sm",children:s.purpose||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:s.reference||"-"})]},s.id)})})]})})})]})]}),e.jsx(xe,{open:E,onOpenChange:N,children:e.jsxs(me,{children:[e.jsx(he,{children:e.jsx(ue,{children:"Add New Transaction"})}),e.jsx(ne,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(z),className:"space-y-4",children:[e.jsx(m,{control:r.control,name:"txnType",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"Transaction Type *"}),e.jsxs(j,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(p,{children:e.jsx(f,{"data-testid":"input-txn-type",children:e.jsx(y,{})})}),e.jsxs(g,{children:[e.jsx(n,{value:"cash_in",children:"Cash In"}),e.jsx(n,{value:"cash_out",children:"Cash Out"}),e.jsx(n,{value:"pos_in",children:"POS In"}),e.jsx(n,{value:"fonepay_in",children:"Fonepay In"}),e.jsx(n,{value:"vendor_payment",children:"Vendor Payment"})]})]})]})}),e.jsx(m,{control:r.control,name:"amount",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"Amount *"}),e.jsx(p,{children:e.jsx(F,{...s,type:"number",step:"0.01",placeholder:"0.00","data-testid":"input-amount"})})]})}),e.jsx(m,{control:r.control,name:"paymentMethod",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"Payment Method *"}),e.jsxs(j,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(p,{children:e.jsx(f,{"data-testid":"input-payment-method",children:e.jsx(y,{})})}),e.jsxs(g,{children:[e.jsx(n,{value:"cash",children:"Cash"}),e.jsx(n,{value:"pos",children:"POS"}),e.jsx(n,{value:"fonepay",children:"Fonepay"})]})]})]})}),e.jsx(m,{control:r.control,name:"purpose",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"Purpose"}),e.jsx(p,{children:e.jsx(F,{...s,placeholder:"Transaction purpose","data-testid":"input-purpose"})})]})}),e.jsx(m,{control:r.control,name:"reference",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"Reference"}),e.jsx(p,{children:e.jsx(F,{...s,placeholder:"Reference number or note","data-testid":"input-reference"})})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{type:"submit",className:"flex-1",disabled:M.isPending,"data-testid":"button-submit",children:M.isPending?"Creating...":"Create Transaction"}),e.jsx(v,{type:"button",variant:"outline",className:"flex-1",onClick:()=>N(!1),children:"Cancel"})]})]})})]})})]})})}export{Pe as default};
