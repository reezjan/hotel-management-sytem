import{v as F,r as p,b as O,l as j,d as _,j as e,C as u,a as m,s as n,I as i,B as y}from"./index-Dk6nXF67.js";import{D as q}from"./dashboard-layout-BUO8e75G.js";import{D as P}from"./data-table-BEvwFoVx.js";import{D as T,a as I,b as L,c as R}from"./dialog-mWSLCdZX.js";import{S as K,a as $,b as B,c as M,d as g}from"./select-Gj2YppMn.js";import{t as c}from"./index-Dmezy7bQ.js";import{U as Q,S as v,E as S}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./badge-P46XOlcm.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";function se(){const{confirm:N}=F(),[b,o]=p.useState(!1),[a,l]=p.useState({username:"",email:"",phone:"",fullName:"",address:"",password:"",role:"surveillance_officer"}),f=O(),{data:w=[],isLoading:C}=j({queryKey:["/api/hotels/current/users"],refetchInterval:3e3}),d=w.filter(s=>{var r,t;return((r=s.role)==null?void 0:r.name)==="security_guard"||((t=s.role)==null?void 0:t.name)==="surveillance_officer"}),{data:x=[]}=j({queryKey:["/api/attendance/daily"],refetchInterval:3e3}),h=_({mutationFn:async s=>{const r=await fetch("/api/hotels/current/users",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...s,confirmPassword:s.password})});if(!r.ok){const t=await r.json();throw new Error(t.message||"Failed to create security staff")}return r.json()},onSuccess:()=>{f.invalidateQueries({queryKey:["/api/hotels/current/users"]}),o(!1),l({username:"",email:"",phone:"",fullName:"",address:"",password:"",role:"surveillance_officer"}),c.success("Security staff created successfully")},onError:s=>{c.error(s.message)}}),D=()=>{if(!a.username||!a.email||!a.password||!a.phone||!a.fullName||!a.address||!a.role){c.error("Please fill in all required fields (username, email, password, phone, full name, address, and role)");return}h.mutate(a)},E=async s=>{await N({title:"Remove Security Staff",description:`Are you sure you want to remove ${s.fullName||s.username}?`,confirmText:"Remove",cancelText:"Cancel",variant:"destructive",onConfirm:async()=>{try{if(!(await fetch(`/api/hotels/current/users/${s.id}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Failed to delete security staff");f.invalidateQueries({queryKey:["/api/hotels/current/users"]}),c.success("Security staff removed successfully")}catch(r){c.error(r.message)}}})},A=[{key:"fullName",label:"Name",sortable:!0,render:(s,r)=>s&&s.trim()?`${s} (${r.username})`:r.username||"-"},{key:"role",label:"Role",sortable:!0,render:s=>{var r;return e.jsxs("div",{className:"flex items-center space-x-2",children:[(s==null?void 0:s.name)==="security_guard"&&e.jsx(v,{className:"h-4 w-4 text-blue-500"}),(s==null?void 0:s.name)==="surveillance_officer"&&e.jsx(S,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{children:(r=s==null?void 0:s.name)==null?void 0:r.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())})]})}},{key:"email",label:"Email",sortable:!0},{key:"phone",label:"Phone",sortable:!0},{key:"address",label:"Address",sortable:!0,render:s=>s||"-"},{key:"id",label:"Status",render:s=>{const r=x.some(t=>t.userId===s&&t.status==="active");return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs ${r?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:r?"On Duty":"Off Duty"})}},{key:"lastLogin",label:"Last Active",sortable:!0,render:s=>s?new Date(s).toLocaleString("en-GB",{timeZone:"Asia/Kathmandu"}):"Never"}],k=[{label:"Remove",action:E,variant:"destructive"}];return e.jsx(q,{title:"Security Staff Management",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(u,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Staff"}),e.jsx("p",{className:"text-2xl font-bold",children:d.length})]}),e.jsx(Q,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(u,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"On Duty"}),e.jsx("p",{className:"text-2xl font-bold",children:d.filter(s=>x.some(r=>r.userId===s.id&&r.status==="active")).length})]}),e.jsx("div",{className:"h-8 w-8 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx("div",{className:"h-4 w-4 rounded-full bg-green-500"})})]})})}),e.jsx(u,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Security Guards"}),e.jsx("p",{className:"text-2xl font-bold",children:d.filter(s=>{var r;return((r=s.role)==null?void 0:r.name)==="security_guard"}).length})]}),e.jsx(v,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(u,{children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Surveillance Officers"}),e.jsx("p",{className:"text-2xl font-bold",children:d.filter(s=>{var r;return((r=s.role)==null?void 0:r.name)==="surveillance_officer"}).length})]}),e.jsx(S,{className:"h-8 w-8 text-purple-500"})]})})})]}),e.jsx(P,{title:"Security Staff",data:d,columns:A,actions:k,isLoading:C,onAdd:()=>o(!0),addButtonLabel:"Add Security Staff",searchPlaceholder:"Search security staff..."}),e.jsx(T,{open:b,onOpenChange:o,children:e.jsxs(I,{children:[e.jsx(L,{children:e.jsx(R,{children:"Add Security Staff"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"username",children:"Username *"}),e.jsx(i,{id:"username",value:a.username,onChange:s=>l({...a,username:s.target.value}),placeholder:"Enter username"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"email",children:"Email *"}),e.jsx(i,{id:"email",type:"email",value:a.email,onChange:s=>l({...a,email:s.target.value}),placeholder:"Enter email"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"phone",children:"Phone *"}),e.jsx(i,{id:"phone",value:a.phone,onChange:s=>l({...a,phone:s.target.value}),placeholder:"Enter phone number",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"fullName",children:"Full Name *"}),e.jsx(i,{id:"fullName",value:a.fullName,onChange:s=>l({...a,fullName:s.target.value}),placeholder:"Enter full name",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"address",children:"Address *"}),e.jsx(i,{id:"address",value:a.address,onChange:s=>l({...a,address:s.target.value}),placeholder:"Enter address",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"role",children:"Role *"}),e.jsxs(K,{value:a.role,onValueChange:s=>l({...a,role:s}),children:[e.jsx($,{children:e.jsx(B,{placeholder:"Select role"})}),e.jsxs(M,{children:[e.jsx(g,{value:"surveillance_officer",children:"Surveillance Officer"}),e.jsx(g,{value:"security_guard",children:"Security Guard"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"password",children:"Password *"}),e.jsx(i,{id:"password",type:"password",value:a.password,onChange:s=>l({...a,password:s.target.value}),placeholder:"Enter password"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(y,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(y,{onClick:D,disabled:h.isPending,children:h.isPending?"Creating...":"Create Staff"})]})]})]})})]})})}export{se as default};
