import{z as l,u as K,q as W,b as Z,r as j,l as O,c as $,d as J,j as e,B as q,C as X,m as Y,n as ee,y as te,a as se,F as ne,e as g,f,g as b,h as y,i as v,I as T,t as ae,k as ie}from"./index-Dk6nXF67.js";import{D as re,a as oe,c as le,C as ce,a1 as ue}from"./dashboard-layout-BUO8e75G.js";import{D as de,a as me,b as xe,c as he}from"./dialog-mWSLCdZX.js";import{S as M,a as F,b as P,c as E,d as L}from"./select-Gj2YppMn.js";import{B as C}from"./badge-P46XOlcm.js";import{c as pe}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";const o={WEIGHT:"weight",VOLUME:"volume",COUNT:"count",CUSTOM:"custom"},je={MG:"mg",G:"g",KG:"kg",OZ:"oz",LB:"lb"},ge={ML:"ml",L:"L",TSP:"tsp",TBSP:"tbsp",CUP:"cup",FL_OZ:"fl_oz"},fe={PIECE:"piece",DOZEN:"dozen",PACK:"pack"},R=Object.values(je),D=Object.values(ge),V=Object.values(fe);l.object({inventoryItemId:l.string().uuid(),quantity:l.number().positive(),unit:l.string(),customFactor:l.number().positive().optional()});function be(i,n){const a=[];switch(i){case o.WEIGHT:return[...R,...a];case o.VOLUME:return[...D,...a];case o.COUNT:return[...V,...a];case o.CUSTOM:return a;default:return a}}function ye(i){const n=i.toLowerCase();if(R.includes(n))return o.WEIGHT;if(D.includes(n))return o.VOLUME;if(V.includes(n))return o.COUNT;const a=["kilogram","gram","milligram","pound","ounce","ton","tonne"],k=["liter","litre","milliliter","millilitre","gallon","quart","pint","teaspoon","tablespoon"],m=["unit","item","box","bottle","can","bag"];return a.some(u=>n.includes(u))?o.WEIGHT:k.some(u=>n.includes(u))?o.VOLUME:(m.some(u=>n.includes(u)),o.COUNT)}function ve(i){return{mg:"Milligrams",g:"Grams",kg:"Kilograms",oz:"Ounces",lb:"Pounds",ml:"Milliliters",L:"Liters",tsp:"Teaspoons",tbsp:"Tablespoons",cup:"Cups",fl_oz:"Fluid Ounces",piece:"Pieces",dozen:"Dozen",pack:"Packs"}[i]||i}const Ce=l.object({itemId:l.string().min(1,"Please select an item"),quantity:l.string().min(1,"Quantity is required").refine(i=>{const n=i.trim(),a=Number(n);return n!==""&&Number.isFinite(a)&&a>0},{message:"Quantity must be a valid positive number"}),unit:l.string().min(1,"Unit is required"),notes:l.string().optional()});function Me(){const{toast:i}=K(),{user:n}=W(),a=Z(),[k,m]=j.useState(!1),[u,B]=j.useState(null),[w,N]=j.useState([]),{data:p=[]}=O({queryKey:["/api/hotels/current/inventory-items"],refetchInterval:3e3}),z={kitchen_staff:"kitchen",waiter:"restaurant",bartender:"bar",barista:"bar",housekeeping_staff:"housekeeping",front_desk:"front_desk",security_guard:"security",surveillance_officer:"security"},S=j.useMemo(()=>{var d;const t=(d=n==null?void 0:n.role)==null?void 0:d.name;if(!t)return p;const s=z[t];return s?p.filter(c=>{const x=c.departments||[];return x.includes("all")||x.includes(s)}):p},[p,n]),{data:I=[]}=O({queryKey:["/api/hotels/current/stock-requests/my-requests"],refetchInterval:3e3}),r=$({resolver:ae(Ce),defaultValues:{itemId:"",quantity:"",unit:"",notes:""}}),U=J({mutationFn:async t=>await ie("POST","/api/hotels/current/stock-requests",{...t,quantity:parseFloat(t.quantity)}),onSuccess:()=>{a.invalidateQueries({queryKey:["/api/hotels/current/stock-requests/my-requests"]}),i({title:"Success",description:"Stock request submitted successfully"}),m(!1),r.reset()},onError:t=>{i({title:"Error",description:t.message||"Failed to submit stock request",variant:"destructive"})}}),Q=t=>{const s=S.find(d=>d.id===t);if(s){B(s),r.setValue("itemId",t);const c=s.baseUnit||"piece",x=ye(c);if(x){const h=be(x);if(h&&h.length>0){N(h);const G=h.find(H=>H===c)||h[0];r.setValue("unit",G)}else N([c]),r.setValue("unit",c)}else N([c]),r.setValue("unit",c)}},_=t=>{U.mutate(t)},A=t=>{switch(t){case"pending":return e.jsxs(C,{variant:"outline",className:"bg-yellow-50",children:[e.jsx(pe,{className:"w-3 h-3 mr-1"})," Pending"]});case"approved":return e.jsxs(C,{variant:"outline",className:"bg-blue-50",children:[e.jsx(ue,{className:"w-3 h-3 mr-1"})," Ready to Pickup"]});case"delivered":return e.jsxs(C,{variant:"outline",className:"bg-green-50",children:[e.jsx(ce,{className:"w-3 h-3 mr-1"})," Delivered"]});default:return e.jsx(C,{variant:"outline",children:t})}};return e.jsx(re,{title:"Request Stock",children:e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Request Stock"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-sm sm:text-base",children:"Request inventory items from the storekeeper"})]}),e.jsxs(q,{onClick:()=>m(!0),"data-testid":"button-request-stock",className:"w-full sm:w-auto",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"New Request"]})]}),e.jsxs(X,{children:[e.jsxs(Y,{children:[e.jsx(ee,{children:"My Stock Requests"}),e.jsx(te,{children:"View the status of your stock requests"})]}),e.jsx(se,{children:I.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(le,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No stock requests yet"})]}):e.jsx("div",{className:"space-y-3",children:I.map(t=>{const s=S.find(d=>d.id===t.itemId);return e.jsxs("div",{className:"border rounded-lg p-3 sm:p-4 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3","data-testid":`request-${t.id}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold","data-testid":`text-item-${t.id}`,children:(s==null?void 0:s.name)||"Unknown Item"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Quantity: ",t.quantity," ",t.unit]}),t.notes&&e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:["Notes: ",t.notes]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Requested: ",new Date(t.createdAt).toLocaleString()]})]}),e.jsx("div",{"data-testid":`status-${t.id}`,className:"self-start sm:self-center",children:A(t.status)})]},t.id)})})})]}),e.jsx(de,{open:k,onOpenChange:m,children:e.jsxs(me,{className:"max-w-md",children:[e.jsx(xe,{children:e.jsx(he,{children:"Request Stock"})}),e.jsx(ne,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(_),className:"space-y-4",children:[e.jsx(g,{control:r.control,name:"itemId",render:({field:t})=>e.jsxs(f,{children:[e.jsx(b,{children:"Item"}),e.jsxs(M,{value:t.value,onValueChange:s=>{t.onChange(s),Q(s)},children:[e.jsx(y,{children:e.jsx(F,{"data-testid":"select-item",children:e.jsx(P,{placeholder:"Select item"})})}),e.jsx(E,{children:S.map(s=>e.jsxs(L,{value:s.id,children:[s.name," (",s.baseStockQty||s.stockQty||0," ",s.baseUnit||s.unit||"units"," available)"]},s.id))})]}),e.jsx(v,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(g,{control:r.control,name:"quantity",render:({field:t})=>e.jsxs(f,{children:[e.jsx(b,{children:"Quantity"}),e.jsx(y,{children:e.jsx(T,{type:"number",step:"0.001",placeholder:"Enter quantity",...t,"data-testid":"input-quantity"})}),e.jsx(v,{})]})}),e.jsx(g,{control:r.control,name:"unit",render:({field:t})=>e.jsxs(f,{children:[e.jsx(b,{children:"Unit"}),e.jsxs(M,{value:t.value,onValueChange:t.onChange,disabled:!u||w.length===0,children:[e.jsx(y,{children:e.jsx(F,{"data-testid":"select-unit",children:e.jsx(P,{placeholder:"Select unit"})})}),e.jsx(E,{children:w.map(s=>e.jsxs(L,{value:s,children:[ve(s)," (",s,")"]},s))})]}),e.jsx(v,{})]})})]}),e.jsx(g,{control:r.control,name:"notes",render:({field:t})=>e.jsxs(f,{children:[e.jsx(b,{children:"Notes (Optional)"}),e.jsx(y,{children:e.jsx(T,{placeholder:"Any additional notes",...t,"data-testid":"input-notes"})}),e.jsx(v,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(q,{type:"button",variant:"outline",onClick:()=>m(!1),"data-testid":"button-cancel",children:"Cancel"}),e.jsx(q,{type:"submit",disabled:U.isPending,"data-testid":"button-submit",children:U.isPending?"Submitting...":"Submit Request"})]})]})})]})})]})})}export{Me as default};
