import{o as T,r as v,b as S,l as y,d as L,j as e,C as c,m as j,n as f,a as u,B as m,s as i,I as g}from"./index-Dk6nXF67.js";import{D as R,a as k,C as F}from"./dashboard-layout-BUO8e75G.js";import{D as P}from"./data-table-BEvwFoVx.js";import{S as E,a as I,b as B,c as A,d as M}from"./select-Gj2YppMn.js";import{T as O}from"./textarea-BAi4nzW_.js";import{D as K,a as Q,b as H,c as V}from"./dialog-mWSLCdZX.js";import{B as J}from"./badge-P46XOlcm.js";import{t as h}from"./index-Dmezy7bQ.js";import{C as U}from"./circle-alert-BbQxKC8I.js";import{e as X}from"./users-Dxbor6Q1.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";function le(){T();const[D,l]=v.useState(!1),[s,r]=v.useState({leaveType:"",startDate:"",endDate:"",reason:""}),p=S(),{data:x=[],isLoading:q}=y({queryKey:["/api/hotels/current/leave-requests/my-requests"],refetchInterval:3e3,queryFn:async()=>{const a=await fetch("/api/hotels/current/leave-requests/my-requests",{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch leave requests");return a.json()}}),{data:o=[]}=y({queryKey:["/api/leave-balances"],refetchInterval:3e3,queryFn:async()=>{const a=await fetch("/api/leave-balances",{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch leave balances");return a.json()}}),d=L({mutationFn:async a=>{const t=await fetch("/api/hotels/current/leave-requests",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)});if(!t.ok){const n=await t.json();throw new Error(n.message||"Failed to create leave request")}return t.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/hotels/current/leave-requests/my-requests"]}),p.invalidateQueries({queryKey:["/api/leave-balances"]}),l(!1),r({leaveType:"",startDate:"",endDate:"",reason:""}),h.success("Leave request submitted successfully")},onError:a=>{h.error(a.message)}}),C=()=>{if(!s.leaveType||!s.startDate||!s.endDate||!s.reason){h.error("Please fill in all required fields");return}d.mutate(s)},N=a=>{const t={pending:{variant:"secondary",icon:U},approved:{variant:"default",icon:F},rejected:{variant:"destructive",icon:X}},n=t[a]||t.pending,w=n.icon;return e.jsxs(J,{variant:n.variant,className:"flex items-center gap-1 w-fit",children:[e.jsx(w,{className:"w-3 h-3"}),a.charAt(0).toUpperCase()+a.slice(1)]})},b=[{key:"leaveType",label:"Leave Type",sortable:!0,render:a=>(a==null?void 0:a.name)||"N/A"},{key:"startDate",label:"Start Date",sortable:!0,render:a=>new Date(a).toLocaleDateString()},{key:"endDate",label:"End Date",sortable:!0,render:a=>new Date(a).toLocaleDateString()},{key:"totalDays",label:"Days",sortable:!0},{key:"status",label:"Status",sortable:!0,render:a=>N(a)}];return e.jsx(R,{title:"My Leave Requests",children:e.jsxs("div",{className:"space-y-6 p-4 sm:p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[o.map(a=>{var t;return e.jsxs(c,{children:[e.jsx(j,{className:"pb-3",children:e.jsx(f,{className:"text-sm font-medium text-muted-foreground",children:((t=a.leaveTypeDetails)==null?void 0:t.name)||a.leaveType||"Leave Type"})}),e.jsxs(u,{children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("div",{className:"text-2xl font-bold",children:a.remainingDays}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["of ",a.totalDays," days"]})]}),e.jsx("div",{className:"mt-2 h-2 bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${a.remainingDays/a.totalDays*100}%`}})})]})]},a.id)}),o.length===0&&e.jsx(c,{className:"col-span-full",children:e.jsx(u,{className:"pt-6 text-center text-muted-foreground",children:"No leave balance information available"})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Leave Requests"}),e.jsxs(m,{onClick:()=>l(!0),className:"gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Request Leave"]})]}),e.jsxs(c,{children:[e.jsx(j,{children:e.jsx(f,{children:"My Leave Requests"})}),e.jsx(u,{children:q?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Loading..."}):x.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:'No leave requests yet. Click "Request Leave" to submit your first request.'}):e.jsx(P,{title:"My Requests",data:x,columns:b,searchPlaceholder:"Search requests..."})})]}),e.jsx(K,{open:D,onOpenChange:l,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsx(H,{children:e.jsx(V,{children:"Request Leave"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"leaveType",children:"Leave Type *"}),e.jsxs(E,{value:s.leaveType,onValueChange:a=>r({...s,leaveType:a}),children:[e.jsx(I,{id:"leaveType",children:e.jsx(B,{placeholder:"Select leave type"})}),e.jsx(A,{children:o.map(a=>{var t;return e.jsxs(M,{value:a.leavePolicyId,children:[(t=a.leavePolicy)==null?void 0:t.name," (",a.remainingDays," days available)"]},a.id)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"startDate",children:"Start Date *"}),e.jsx(g,{id:"startDate",type:"date",value:s.startDate,onChange:a=>r({...s,startDate:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"endDate",children:"End Date *"}),e.jsx(g,{id:"endDate",type:"date",value:s.endDate,onChange:a=>r({...s,endDate:a.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"reason",children:"Reason *"}),e.jsx(O,{id:"reason",placeholder:"Please provide a reason for your leave request",value:s.reason,onChange:a=>r({...s,reason:a.target.value}),rows:3})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>{l(!1),r({leaveType:"",startDate:"",endDate:"",reason:""})},className:"flex-1",children:"Cancel"}),e.jsx(m,{onClick:C,disabled:d.isPending,className:"flex-1",children:d.isPending?"Submitting...":"Submit Request"})]})]})]})})]})})}export{le as default};
