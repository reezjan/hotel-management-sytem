import{o as $,b as _,l as h,r as C,j as t,p as T,C as m,m as p,n as f,a as j,B as v}from"./index-Dk6nXF67.js";import{D as B,B as q,C as I}from"./dashboard-layout-BUO8e75G.js";import{S as N}from"./stats-card-DnI6mJO0.js";import{u as L}from"./use-websocket-ChOW8gRL.js";import{D as U,U as A,S as H,R as z}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";var P=Object.defineProperty,V=(a,s,n)=>s in a?P(a,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[s]=n,y=(a,s,n)=>V(a,typeof s!="symbol"?s+"":s,n);const E=Symbol.for("constructDateFrom");function k(a,s){return typeof a=="function"?a(s):a&&typeof a=="object"&&E in a?a[E](s):a instanceof Date?new a.constructor(s):new Date(s)}function x(a,s){return k(a,a)}function W(a,s,n){const i=x(a);return isNaN(s)?k(a,NaN):(s&&i.setDate(i.getDate()+s),i)}function F(a){const s=x(a),n=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return n.setUTCFullYear(s.getFullYear()),+a-+n}function G(a,...s){const n=k.bind(null,s.find(i=>typeof i=="object"));return s.map(n)}function M(a,s){const n=x(a);return n.setHours(0,0,0,0),n}function J(a,s,n){const[i,c]=G(void 0,a,s),o=M(i),d=M(c),u=+o-F(o),b=+d-F(d);return Math.round((u-b)/864e5)}function X(a,s){const n=x(a);return n.setHours(23,59,59,999),n}function Z(a,s,n){const i=+x(a),[c,o]=[+x(s.start),+x(s.end)].sort((d,u)=>d-u);return i>=c&&i<=o}const e=[];e[1975]=[31,31,32,32,31,30,30,29,30,29,30,30,365];e[1976]=[31,32,31,32,31,30,30,30,29,29,30,31,366];e[1977]=[30,32,31,32,31,31,29,30,30,29,29,31,365];e[1978]=[31,31,32,31,31,31,30,29,30,29,30,30,365];e[1979]=e[1975];e[1980]=e[1976];e[1981]=[31,31,31,32,31,31,29,30,30,29,29,31,365];e[1982]=e[1978];e[1983]=e[1975];e[1984]=e[1976];e[1985]=[31,31,31,32,31,31,29,30,30,29,30,30,365];e[1986]=e[1978];e[1987]=[31,32,31,32,31,30,30,29,30,29,30,30,365];e[1988]=e[1976];e[1989]=[31,31,31,32,31,31,30,29,30,29,30,30,365];e[1990]=e[1978];e[1991]=[31,32,31,32,31,30,30,30,29,29,30,30,365];e[1992]=[31,32,31,32,31,30,30,30,29,30,29,31,366];e[1993]=e[1989];e[1994]=e[1978];e[1995]=e[1991];e[1996]=e[1992];e[1997]=e[1978];e[1998]=[31,31,32,31,32,30,30,29,30,29,30,30,365];e[1999]=e[1976];e[2e3]=[30,32,31,32,31,30,30,30,29,30,29,31,365];e[2001]=e[1978];e[2002]=e[1975];e[2003]=e[1976];e[2004]=e[2e3];e[2005]=e[1978];e[2006]=e[1975];e[2007]=e[1976];e[2008]=e[1981];e[2009]=e[1978];e[2010]=e[1975];e[2011]=e[1976];e[2012]=e[1985];e[2013]=e[1978];e[2014]=e[1975];e[2015]=e[1976];e[2016]=e[1985];e[2017]=e[1978];e[2018]=e[1987];e[2019]=e[1992];e[2020]=e[1989];e[2021]=e[1978];e[2022]=e[1991];e[2023]=e[1992];e[2024]=e[1989];e[2025]=e[1978];e[2026]=e[1976];e[2027]=e[2e3];e[2028]=e[1978];e[2029]=e[1998];e[2030]=e[1976];e[2031]=e[2e3];e[2032]=e[1978];e[2033]=e[1975];e[2034]=e[1976];e[2035]=e[1977];e[2036]=e[1978];e[2037]=e[1975];e[2038]=e[1976];e[2039]=e[1985];e[2040]=e[1978];e[2041]=e[1975];e[2042]=e[1976];e[2043]=e[1985];e[2044]=e[1978];e[2045]=e[1987];e[2046]=e[1976];e[2047]=e[1989];e[2048]=e[1978];e[2049]=e[1991];e[2050]=e[1992];e[2051]=e[1989];e[2052]=e[1978];e[2053]=e[1991];e[2054]=e[1992];e[2055]=e[1978];e[2056]=e[1998];e[2057]=e[1976];e[2058]=e[2e3];e[2059]=e[1978];e[2060]=e[1975];e[2061]=e[1976];e[2062]=[30,32,31,32,31,31,29,30,29,30,29,31,365];e[2063]=e[1978];e[2064]=e[1975];e[2065]=e[1976];e[2066]=e[1981];e[2067]=e[1978];e[2068]=e[1975];e[2069]=e[1976];e[2070]=e[1985];e[2071]=e[1978];e[2072]=e[1987];e[2073]=e[1976];e[2074]=e[1989];e[2075]=e[1978];e[2076]=e[1991];e[2077]=e[1992];e[2078]=e[1989];e[2079]=e[1978];e[2080]=e[1991];e[2081]=e[1992];e[2082]=e[1989];e[2083]=e[1978];e[2084]=e[1976];e[2085]=e[2e3];e[2086]=e[1978];e[2087]=e[1975];e[2088]=e[1976];e[2089]=e[2e3];e[2090]=e[1978];e[2091]=e[1975];e[2092]=e[1976];e[2093]=e[1981];e[2094]=e[1978];e[2095]=e[1975];e[2096]=e[1976];e[2097]=e[1985];e[2098]=e[1978];e[2099]=e[1975];class K{constructor(s){y(this,"startDate",new Date("1918-04-13")),y(this,"endDate",new Date("2043-04-13")),y(this,"dateRangeError","The input date is out of supported range."),y(this,"inputYear"),y(this,"inputMonth"),y(this,"inputDate");const[n,i,c]=this.parseDateString(s);this.inputYear=n,this.inputMonth=i,this.inputDate=c}parseDateString(s){const n=this.numToEn(s).replace(/[./|,]/g,"-").trim(),[i,c,o]=n.split("-").map(Number);return[i,c,o]}numToEn(s){const n=["०","१","२","३","४","५","६","७","८","९"];return s.replace(/[०१२३४५६७८९]/g,i=>n.indexOf(i).toString())}numToDay(s){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][s]}getAdDate(s,n,i){let c=0;for(let o=1975;o<s;o++)c+=e[o][12];for(let o=0;o<n-1;o++)c+=e[s][o];return c+=i-1,W(this.startDate,c)}getBsDate(s){const n=new Date(s);let i=J(n,this.startDate);for(const c in e){const o=e[c][12];if(i>=o){i-=o;continue}for(let d=0;d<12;d++){const u=e[c][d];if(i>=u){i-=u;continue}return{year:Number(c),month:d+1,date:i+1}}}throw new Error(this.dateRangeError)}toAd(){if(this.inputYear<1975||this.inputYear>2099)throw new Error(this.dateRangeError);const s=this.getAdDate(this.inputYear,this.inputMonth,this.inputDate),n=this.numToDay(s.getDay());return{year:s.getFullYear(),month:s.getMonth()+1,date:s.getDate(),day:n}}toBs(){const s=`${this.inputYear}-${this.inputMonth}-${this.inputDate}`,n=new Date(s);if(!Z(n,{start:M(this.startDate),end:X(this.endDate)}))throw new Error(this.dateRangeError);const i=this.getBsDate(s),c=this.numToDay(n.getDay());return{...i,day:c}}}function ce(){const[,a]=$(),s=_(),n=L(),{data:i=[]}=h({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3}),{data:c=[]}=h({queryKey:["/api/hotels/current/rooms"],refetchInterval:3e3}),{data:o=[]}=h({queryKey:["/api/hotels/current/users"],refetchInterval:3e3}),{data:d=[]}=h({queryKey:["/api/hotels/current/inventory-items"],refetchInterval:3e3}),{data:u}=h({queryKey:["/api/hotels/current"],refetchInterval:3e3}),{data:b=[]}=h({queryKey:["/api/attendance/daily"],refetchInterval:3e3}),{data:O=[]}=h({queryKey:["/api/hotels/current/transactions",{pendingApproval:"true"}],refetchInterval:3e3});C.useEffect(()=>{const r=[n.on("transaction:created",()=>{s.invalidateQueries({queryKey:["/api/hotels/current/transactions"]})}),n.on("transaction:updated",()=>{s.invalidateQueries({queryKey:["/api/hotels/current/transactions"]})}),n.on("room:updated",()=>{s.invalidateQueries({queryKey:["/api/hotels/current/rooms"]})}),n.on("stock:updated",()=>{s.invalidateQueries({queryKey:["/api/hotels/current/inventory-items"]})}),n.on("attendance:updated",()=>{s.invalidateQueries({queryKey:["/api/attendance/daily"]})}),n.on("guest:created",()=>{s.invalidateQueries({queryKey:["/api/hotels/current"]})}),n.on("guest:updated",()=>{s.invalidateQueries({queryKey:["/api/hotels/current"]})})];return()=>{r.forEach(l=>l())}},[n,s]);const D=C.useMemo(()=>{const r=new Date;return new K(`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`).toBs()},[]),R=C.useMemo(()=>i.filter(r=>{try{const l=new Date(r.createdAt),g=new K(`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`).toBs();return g.year===D.year&&g.month===D.month}catch{return!1}}),[i,D]).filter(r=>["revenue","cash_in","pos_in","fonepay_in"].includes(r.txnType)).reduce((r,l)=>r+(Number(l.amount)||0),0),w=c.filter(r=>r.isOccupied).length,Q=c.length>0?w/c.length*100:0,Y=d.filter(r=>Number(r.baseStockQty)<=Number(r.reorderLevel)).length;return t.jsx(B,{title:"Owner Dashboard",currentHotel:u==null?void 0:u.name,children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(N,{title:"Total Revenue",value:T(R),icon:t.jsx(U,{}),iconColor:"text-green-500"}),t.jsx(N,{title:"Room Occupancy",value:`${Q.toFixed(0)}%`,icon:t.jsx(q,{}),iconColor:"text-blue-500"}),t.jsx(N,{title:"Total Staff",value:o.length,icon:t.jsx(A,{}),iconColor:"text-purple-500"}),t.jsx("div",{onClick:()=>a("/owner/approvals"),className:"cursor-pointer hover:shadow-lg transition-shadow","data-testid":"card-pending-approvals",children:t.jsx(N,{title:"Pending Approvals",value:O.length,icon:t.jsx(I,{}),iconColor:"text-amber-500"})})]}),t.jsxs(m,{children:[t.jsx(p,{children:t.jsx(f,{children:"Owner Operations"})}),t.jsx(j,{children:t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs(v,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-audit",onClick:()=>a("/owner/audit-transparency"),children:[t.jsx(H,{className:"h-6 w-6"}),t.jsx("span",{className:"text-sm",children:"Audit & Transparency"})]}),t.jsxs(v,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-financial",onClick:()=>a("/owner/financial"),children:[t.jsx(z,{className:"h-6 w-6"}),t.jsx("span",{className:"text-sm",children:"Financial"})]}),t.jsxs(v,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-occupancy",onClick:()=>a("/owner/occupancy"),children:[t.jsx(q,{className:"h-6 w-6"}),t.jsx("span",{className:"text-sm",children:"Occupancy"})]}),t.jsxs(v,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-staff",onClick:()=>a("/owner/staff"),children:[t.jsx(A,{className:"h-6 w-6"}),t.jsx("span",{className:"text-sm",children:"Staff"})]})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[t.jsxs(m,{children:[t.jsx(p,{children:t.jsx(f,{children:"Financial Summary"})}),t.jsx(j,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Total Revenue:"}),t.jsx("span",{className:"font-bold text-green-600",children:T(R)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Transactions:"}),t.jsx("span",{className:"font-medium",children:i.length})]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"View detailed financial reports in Financial Overview"})]})})]}),t.jsxs(m,{children:[t.jsx(p,{children:t.jsx(f,{children:"Room Summary"})}),t.jsx(j,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Total Rooms:"}),t.jsx("span",{className:"font-bold",children:c.length})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Occupied:"}),t.jsx("span",{className:"font-medium text-blue-600",children:w})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Available:"}),t.jsx("span",{className:"font-medium text-green-600",children:c.length-w})]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"View detailed room status in Room Occupancy"})]})})]}),t.jsxs(m,{children:[t.jsx(p,{children:t.jsx(f,{children:"Staff Summary"})}),t.jsx(j,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Total Staff:"}),t.jsx("span",{className:"font-bold",children:o.length})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"On Duty:"}),t.jsx("span",{className:"font-medium text-green-600",children:o.filter(r=>b.some(l=>l.userId===r.id&&l.status==="active")).length})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Active:"}),t.jsx("span",{className:"font-medium",children:o.filter(r=>r.isActive).length})]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Manage staff in Staff Management"})]})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs(m,{children:[t.jsx(p,{children:t.jsx(f,{children:"Recent Transactions"})}),t.jsx(j,{children:t.jsxs("div",{className:"space-y-2",children:[i.slice(0,5).map((r,l)=>{var S,g;return t.jsxs("div",{className:"flex justify-between items-center p-2 border-b",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium",children:r.purpose||((S=r.txnType)==null?void 0:S.replace(/_/g," "))}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[new Date(r.createdAt).toLocaleDateString()," • ",(g=r.paymentMethod)==null?void 0:g.replace(/_/g," ")]})]}),t.jsx("div",{className:`text-sm font-bold ${["revenue","cash_in","pos_in","fonepay_in"].includes(r.txnType)?"text-green-600":"text-red-600"}`,children:T(Number(r.amount))})]},r.id||l)}),i.length===0&&t.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No recent transactions"})]})})]}),t.jsxs(m,{children:[t.jsx(p,{children:t.jsx(f,{children:"Inventory Alerts"})}),t.jsx(j,{children:t.jsxs("div",{className:"space-y-2",children:[d.filter(r=>Number(r.baseStockQty)<=Number(r.reorderLevel)).slice(0,5).map((r,l)=>t.jsxs("div",{className:"flex justify-between items-center p-2 border-b",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium",children:r.name}),t.jsx("div",{className:"text-xs text-orange-600",children:"Low Stock"})]}),t.jsxs("div",{className:"text-sm",children:[Number(r.baseStockQty).toFixed(2)," ",r.baseUnit,r.packageUnit&&` (${Number(r.packageStockQty).toFixed(2)} ${r.packageUnit})`]})]},r.id||l)),Y===0&&t.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"All items are well stocked"})]})})]})]})]})})}export{ce as default};
