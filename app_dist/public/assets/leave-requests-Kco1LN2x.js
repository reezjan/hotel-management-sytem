import{o as A,r as j,b as O,l as g,d as M,j as e,B as p,C as l,a as c,s as o,I as f}from"./index-Dk6nXF67.js";import{D as V,C as y}from"./dashboard-layout-BUO8e75G.js";import{D as $}from"./data-table-BEvwFoVx.js";import{S as z,a as K,b as Q,c as U,d as n}from"./select-Gj2YppMn.js";import{T as _}from"./textarea-BAi4nzW_.js";import{D as H,a as J,b as X,c as G}from"./dialog-mWSLCdZX.js";import{B as W}from"./badge-P46XOlcm.js";import{t as x}from"./index-Dmezy7bQ.js";import{f as Y,c as v,e as D}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";function ue(){const[,b]=A(),[N,d]=j.useState(!1),[s,r]=j.useState({leaveType:"",startDate:"",endDate:"",reason:""}),q=O(),{data:i=[],isLoading:w}=g({queryKey:["/api/hotels/current/leave-requests/my-requests"],refetchInterval:3e3,queryFn:async()=>{const t=await fetch("/api/hotels/current/leave-requests/my-requests",{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch leave requests");return t.json()}}),{data:S=[]}=g({queryKey:["/api/leave-balances"],refetchInterval:3e3,queryFn:async()=>{const t=await fetch("/api/leave-balances",{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch leave balances");return t.json()}}),u=M({mutationFn:async t=>{const a=await fetch("/api/hotels/current/leave-requests",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(!a.ok){const h=await a.json();throw new Error(h.message||"Failed to create leave request")}return a.json()},onSuccess:()=>{q.invalidateQueries({queryKey:["/api/hotels/current/leave-requests/my-requests"]}),d(!1),r({leaveType:"",startDate:"",endDate:"",reason:""}),x.success("Leave request submitted successfully")},onError:t=>{x.error(t.message)}}),C=()=>{if(!s.leaveType||!s.startDate||!s.endDate){x.error("Please fill in all required fields");return}if(new Date(s.endDate)<new Date(s.startDate)){x.error("End date must be after start date");return}u.mutate(s)},T=t=>{switch(t){case"approved":return e.jsx(y,{className:"h-4 w-4 text-green-500"});case"rejected":return e.jsx(D,{className:"h-4 w-4 text-red-500"});default:return e.jsx(v,{className:"h-4 w-4 text-orange-500"})}},L=t=>{switch(t){case"approved":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-orange-100 text-orange-800 border-orange-200"}},m=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),k=(t,a)=>{const h=new Date(t),B=new Date(a),P=Math.abs(B.getTime()-h.getTime());return Math.ceil(P/(1e3*60*60*24))+1},R=[{key:"leaveType",label:"Type",sortable:!0,render:t=>e.jsx("span",{className:"font-medium capitalize","data-testid":`text-type-${t}`,children:t==null?void 0:t.replace(/_/g," ")})},{key:"startDate",label:"Start Date",sortable:!0,render:t=>e.jsx("span",{"data-testid":"text-startdate",children:m(t)})},{key:"endDate",label:"End Date",sortable:!0,render:t=>e.jsx("span",{"data-testid":"text-enddate",children:m(t)})},{key:"duration",label:"Duration",render:(t,a)=>e.jsxs("span",{className:"text-sm text-muted-foreground","data-testid":"text-duration",children:[k(a.startDate,a.endDate)," day(s)"]})},{key:"status",label:"Status",render:t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[T(t),e.jsx(W,{variant:"outline",className:L(t),"data-testid":`badge-status-${t}`,children:(t==null?void 0:t.charAt(0).toUpperCase())+(t==null?void 0:t.slice(1))})]})},{key:"reason",label:"Reason",render:t=>e.jsx("span",{className:"text-sm text-muted-foreground max-w-xs truncate","data-testid":"text-reason",children:t||"No reason provided"})},{key:"managerNotes",label:"Manager Notes",render:t=>e.jsx("span",{className:"text-sm text-muted-foreground max-w-xs truncate","data-testid":"text-managernotes",children:t||"-"})},{key:"createdAt",label:"Submitted",sortable:!0,render:t=>e.jsx("span",{"data-testid":"text-submitted",children:m(t)})}],F=i.filter(t=>t.status==="pending").length,E=i.filter(t=>t.status==="approved").length,I=i.filter(t=>t.status==="rejected").length;return e.jsx(V,{title:"Leave Requests",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>b("/security-head"),"data-testid":"button-back",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"heading-leave-requests",children:"Leave Requests"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage your leave requests"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:S.map(t=>e.jsx(l,{"data-testid":`balance-card-${t.leaveType}`,children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-muted-foreground capitalize",children:[t.leaveType.replace(/_/g," ")," Leave Balance"]}),e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsx("p",{className:"text-3xl font-bold","data-testid":`balance-remaining-${t.leaveType}`,children:parseFloat(t.remainingDays)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["/ ",parseFloat(t.totalDays)," days"]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Used: ",parseFloat(t.usedDays)," days"]})]})})},t.id))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(l,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold","data-testid":"text-pending",children:F})]}),e.jsx(v,{className:"h-8 w-8 text-orange-500"})]})})}),e.jsx(l,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold","data-testid":"text-approved",children:E})]}),e.jsx(y,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(l,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold","data-testid":"text-rejected",children:I})]}),e.jsx(D,{className:"h-8 w-8 text-red-500"})]})})})]}),e.jsx($,{title:"My Leave Requests",data:i,columns:R,isLoading:w,onAdd:()=>d(!0),addButtonLabel:"Request Leave",searchPlaceholder:"Search leave requests..."}),e.jsx(H,{open:N,onOpenChange:d,children:e.jsxs(J,{className:"max-w-md",children:[e.jsx(X,{children:e.jsx(G,{children:"Request Leave"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"leaveType",children:"Leave Type *"}),e.jsxs(z,{value:s.leaveType,onValueChange:t=>r({...s,leaveType:t}),children:[e.jsx(K,{"data-testid":"select-leavetype",children:e.jsx(Q,{placeholder:"Select leave type"})}),e.jsxs(U,{children:[e.jsx(n,{value:"sick",children:"Sick Leave"}),e.jsx(n,{value:"vacation",children:"Vacation"}),e.jsx(n,{value:"personal",children:"Personal Leave"}),e.jsx(n,{value:"emergency",children:"Emergency Leave"}),e.jsx(n,{value:"family",children:"Family Leave"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"startDate",children:"Start Date *"}),e.jsx(f,{id:"startDate",type:"date",value:s.startDate,onChange:t=>r({...s,startDate:t.target.value}),min:new Date().toISOString().split("T")[0],"data-testid":"input-startdate"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"endDate",children:"End Date *"}),e.jsx(f,{id:"endDate",type:"date",value:s.endDate,onChange:t=>r({...s,endDate:t.target.value}),min:s.startDate||new Date().toISOString().split("T")[0],"data-testid":"input-enddate"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"reason",children:"Reason"}),e.jsx(_,{id:"reason",value:s.reason,onChange:t=>r({...s,reason:t.target.value}),placeholder:"Please provide a reason for your leave request",rows:3,"data-testid":"textarea-reason"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(p,{variant:"outline",onClick:()=>d(!1),"data-testid":"button-cancel",children:"Cancel"}),e.jsx(p,{onClick:C,disabled:u.isPending,"data-testid":"button-submit",children:u.isPending?"Submitting...":"Submit Request"})]})]})]})})]})})}export{ue as default};
