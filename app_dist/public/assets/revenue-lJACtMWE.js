import{q as I,r as U,l as Y,j as e,C as d,m as h,n as j,a as c,p as n}from"./index-Dk6nXF67.js";import{D as _,B as A,x as F,J as $}from"./dashboard-layout-BUO8e75G.js";import{S as q,a as E,b as G,c as K,d as b}from"./select-Gj2YppMn.js";import{u as Q}from"./use-realtime-query-2TJdEol3.js";import{C as V,T as W,D as H}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";import"./use-websocket-ChOW8gRL.js";function re(){const{user:v}=I(),[P,L]=U.useState("month"),{data:B=[]}=Y({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3,enabled:!!(v!=null&&v.hotelId)});Q({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3,events:["transaction:created","transaction:updated"]});const O=(()=>{const s=new Date,t=new Date(s.getFullYear(),s.getMonth(),s.getDate());switch(P){case"today":return r=>new Date(r.createdAt)>=t;case"week":const a=new Date(t);return a.setDate(t.getDate()-t.getDay()),r=>new Date(r.createdAt)>=a;case"month":const i=new Date(s.getFullYear(),s.getMonth(),1);return r=>new Date(r.createdAt)>=i;case"year":const o=new Date(s.getFullYear(),0,1);return r=>new Date(r.createdAt)>=o;default:return()=>!0}})(),m=B.filter(s=>{var t;return(s.txnType==="cash_in"||s.txnType==="pos_in"||s.txnType==="fonepay_in"||((t=s.txnType)==null?void 0:t.includes("_in")))&&O(s)}),x=m.filter(s=>{var t,a;return((t=s.purpose)==null?void 0:t.toLowerCase().includes("room"))||((a=s.purpose)==null?void 0:a.toLowerCase().includes("checkout"))}),u=m.filter(s=>{var t,a;return((t=s.purpose)==null?void 0:t.toLowerCase().includes("restaurant"))||((a=s.purpose)==null?void 0:a.toLowerCase().includes("food"))}),y=m.filter(s=>{var t,a;return((t=s.purpose)==null?void 0:t.toLowerCase().includes("bar"))||((a=s.purpose)==null?void 0:a.toLowerCase().includes("drink"))}),k=m.filter(s=>!x.includes(s)&&!u.includes(s)&&!y.includes(s)),p=x.reduce((s,t)=>s+Number(t.amount||0),0),g=u.reduce((s,t)=>s+Number(t.amount||0),0),N=y.reduce((s,t)=>s+Number(t.amount||0),0),f=k.reduce((s,t)=>s+Number(t.amount||0),0),l=p+g+N+f,w=l>0?p/l*100:0,R=l>0?g/l*100:0,D=l>0?N/l*100:0,C=l>0?f/l*100:0;return e.jsx(_,{title:"Revenue Reports",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(d,{children:e.jsx(h,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx(j,{children:"Revenue Analysis by Department"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsxs(q,{value:P,onValueChange:L,children:[e.jsx(E,{className:"w-40","data-testid":"select-period",children:e.jsx(G,{})}),e.jsxs(K,{children:[e.jsx(b,{value:"today",children:"Today"}),e.jsx(b,{value:"week",children:"This Week"}),e.jsx(b,{value:"month",children:"This Month"}),e.jsx(b,{value:"year",children:"This Year"})]})]})]})]})})}),e.jsx(d,{className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white",children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90",children:"Total Revenue"}),e.jsx("p",{className:"text-4xl font-bold mt-2",children:n(l)}),e.jsxs("p",{className:"text-sm opacity-90 mt-1",children:[m.length," transactions"]})]}),e.jsx(W,{className:"h-16 w-16 opacity-50"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(d,{children:e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(A,{className:"h-10 w-10 text-blue-500"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:[w.toFixed(1),"%"]})]}),e.jsx("h3",{className:"font-semibold mb-1",children:"Rooms Revenue"}),e.jsx("p",{className:"text-2xl font-bold",children:n(p)}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[x.length," transactions"]})]})}),e.jsx(d,{children:e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(F,{className:"h-10 w-10 text-orange-500"}),e.jsxs("span",{className:"text-2xl font-bold text-orange-600",children:[R.toFixed(1),"%"]})]}),e.jsx("h3",{className:"font-semibold mb-1",children:"Restaurant Revenue"}),e.jsx("p",{className:"text-2xl font-bold",children:n(g)}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[u.length," transactions"]})]})}),e.jsx(d,{children:e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx($,{className:"h-10 w-10 text-purple-500"}),e.jsxs("span",{className:"text-2xl font-bold text-purple-600",children:[D.toFixed(1),"%"]})]}),e.jsx("h3",{className:"font-semibold mb-1",children:"Bar Revenue"}),e.jsx("p",{className:"text-2xl font-bold",children:n(N)}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[y.length," transactions"]})]})}),e.jsx(d,{children:e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(H,{className:"h-10 w-10 text-green-500"}),e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:[C.toFixed(1),"%"]})]}),e.jsx("h3",{className:"font-semibold mb-1",children:"Other Revenue"}),e.jsx("p",{className:"text-2xl font-bold",children:n(f)}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[k.length," transactions"]})]})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Meal Plan Revenue Analysis"]})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-4",children:(()=>{const s=m.filter(a=>{var i;return((i=a.details)==null?void 0:i.mealPlanCharges)&&Number(a.details.mealPlanCharges)>0}),t=s.reduce((a,i)=>{var o;return a+Number(((o=i.details)==null?void 0:o.mealPlanCharges)||0)},0);return t===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No meal plan revenue data available"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Meal Plan Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 mt-1",children:n(t)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.length," reservations"]})]}),e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Average per Guest"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 mt-1",children:n(s.length>0?t/s.length:0)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"per reservation"})]}),e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"% of Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600 mt-1",children:[l>0?(t/l*100).toFixed(1):0,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["of ",n(l)]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Recent Meal Plan Transactions"}),e.jsx("div",{className:"space-y-2",children:s.slice(0,5).map((a,i)=>{var o,r,T,S,M;return e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-muted rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:((o=a.details)==null?void 0:o.guestName)||"Guest"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((r=a.details)==null?void 0:r.numberOfDays)||1," days Ã— ",n(Number(((T=a.details)==null?void 0:T.mealPlanCharges)||0)/(((S=a.details)==null?void 0:S.numberOfDays)||1)),"/day"]})]}),e.jsx("span",{className:"font-bold text-green-600",children:n(Number(((M=a.details)==null?void 0:M.mealPlanCharges)||0))})]},i)})})]})]})})()})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(j,{children:"Revenue Distribution"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"font-medium",children:"Rooms"}),e.jsxs("span",{className:"text-muted-foreground",children:[n(p)," (",w.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-500 h-3 rounded-full",style:{width:`${w}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"font-medium",children:"Restaurant"}),e.jsxs("span",{className:"text-muted-foreground",children:[n(g)," (",R.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"bg-orange-500 h-3 rounded-full",style:{width:`${R}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"font-medium",children:"Bar"}),e.jsxs("span",{className:"text-muted-foreground",children:[n(N)," (",D.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"bg-purple-500 h-3 rounded-full",style:{width:`${D}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"font-medium",children:"Other"}),e.jsxs("span",{className:"text-muted-foreground",children:[n(f)," (",C.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"bg-green-500 h-3 rounded-full",style:{width:`${C}%`}})})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Room Revenue Details"]})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-2",children:[x.slice(0,5).map((s,t)=>{var a;return e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-muted rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.purpose||"Room Charge"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(a=s.paymentMethod)==null?void 0:a.toUpperCase()})]}),e.jsx("span",{className:"font-bold text-green-600",children:n(Number(s.amount))})]},t)}),x.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No room revenue transactions"})]})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Restaurant Revenue Details"]})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-2",children:[u.slice(0,5).map((s,t)=>{var a;return e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-muted rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.purpose||"Restaurant Sale"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(a=s.paymentMethod)==null?void 0:a.toUpperCase()})]}),e.jsx("span",{className:"font-bold text-green-600",children:n(Number(s.amount))})]},t)}),u.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No restaurant revenue transactions"})]})})]})]})]})})}export{re as default};
