import{q as k,b as R,l as v,d as B,j as e,C as l,m as d,n as o,a as c,B as m}from"./index-Dk6nXF67.js";import{D,O as x,C as p,Q as A}from"./dashboard-layout-BUO8e75G.js";import{D as S}from"./data-table-BEvwFoVx.js";import{B as h}from"./badge-P46XOlcm.js";import{t as g}from"./index-Dmezy7bQ.js";import{C as T}from"./circle-alert-BbQxKC8I.js";import"./users-Dxbor6Q1.js";function z(){k();const b=R(),{data:n=[],isLoading:f}=v({queryKey:["/api/hotels/current/maintenance-requests"],refetchInterval:3e3,select:t=>{const s=["waiter","kitchen_staff","bartender","barista","cashier"];return t.filter(a=>{var r,u;return s.includes(((u=(r=a.reportedBy)==null?void 0:r.role)==null?void 0:u.name)||"")})}}),i=B({mutationFn:async({id:t,status:s,notes:a})=>{const r=await fetch(`/api/maintenance-requests/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:s,notes:a})});if(!r.ok)throw new Error("Failed to update request");return r.json()},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/hotels/current/maintenance-requests"]}),g.success("Request status updated")},onError:t=>{g.error(t.message)}}),j=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-blue-100 text-blue-800";case"in_progress":return"bg-blue-100 text-blue-800";case"resolved":return"bg-green-100 text-green-800";case"declined":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},y=t=>{switch(t){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-orange-100 text-orange-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},N=[{key:"title",label:"Issue",sortable:!0},{key:"location",label:"Location",sortable:!0},{key:"reportedBy",label:"Reported By",render:t=>{var s,a;return e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:(t==null?void 0:t.username)||"Unknown"}),e.jsx("div",{className:"text-xs text-gray-500",children:(a=(s=t==null?void 0:t.role)==null?void 0:s.name)==null?void 0:a.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase())})]})}},{key:"priority",label:"Priority",render:t=>e.jsx(h,{className:y(t),children:t==null?void 0:t.toUpperCase()})},{key:"status",label:"Status",render:t=>e.jsx(h,{className:j(t),children:t==null?void 0:t.replace(/_/g," ").toUpperCase()})},{key:"createdAt",label:"Date",sortable:!0,render:t=>new Date(t).toLocaleDateString("en-GB")},{key:"actions",label:"Actions",render:(t,s)=>e.jsxs("div",{className:"flex gap-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{size:"sm",variant:"outline",className:"text-green-600 hover:text-green-700 hover:bg-green-50",onClick:()=>i.mutate({id:s.id,status:"approved"}),"data-testid":`button-approve-${s.id}`,children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(m,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>i.mutate({id:s.id,status:"declined"}),"data-testid":`button-decline-${s.id}`,children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"Decline"]})]}),s.status==="approved"&&e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>i.mutate({id:s.id,status:"resolved"}),"data-testid":`button-resolve-${s.id}`,children:[e.jsx(p,{className:"h-4 w-4 mr-1"}),"Resolve"]})]})}],C=n.filter(t=>t.status==="pending"),w=n.filter(t=>t.status==="approved"),q=n.filter(t=>t.status==="resolved");return e.jsxs(D,{title:"Maintenance Requests",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs(l,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Pending"}),e.jsx(T,{className:"h-4 w-4 text-yellow-500"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:C.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting action"})]})]}),e.jsxs(l,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Approved"}),e.jsx(x,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Being handled"})]})]}),e.jsxs(l,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Resolved"}),e.jsx(p,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:q.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Completed"})]})]})]}),e.jsx(S,{data:n,columns:N,title:"Staff Maintenance Requests",isLoading:f})]})}export{z as default};
