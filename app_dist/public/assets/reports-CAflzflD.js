import{u as M,r as I,l as p,j as e,p as u,C as m,m as h,n as f,a as j,s as g,I as F,B as b}from"./index-Dk6nXF67.js";import{D as U,d as V}from"./dashboard-layout-BUO8e75G.js";import{S as P,a as Q,b as Y,c as z,d as C}from"./select-Gj2YppMn.js";import{S}from"./stats-card-DnI6mJO0.js";import{u as y}from"./use-realtime-query-2TJdEol3.js";import{D as B,T as G,F as E,d as R}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";import"./use-websocket-ChOW8gRL.js";function ce(){const{toast:$}=M(),[c,D]=I.useState({from:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],to:new Date().toISOString().split("T")[0]}),[O,_]=I.useState("financial"),{data:q=[]}=p({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3}),{data:l=[]}=p({queryKey:["/api/hotels/current/rooms"],refetchInterval:3e3}),{data:o=[]}=p({queryKey:["/api/hotels/current/users"],refetchInterval:3e3}),{data:K=[]}=p({queryKey:["/api/hotels/current/inventory-items"],refetchInterval:3e3}),{data:k=[]}=p({queryKey:["/api/attendance/daily"],refetchInterval:3e3});p({queryKey:["/api/hotels/current/vendors"],refetchInterval:3e3}),y({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3,events:["transaction:created","transaction:updated"]}),y({queryKey:["/api/hotels/current/rooms"],refetchInterval:3e3,events:["room:updated","room:created"]}),y({queryKey:["/api/hotels/current/users"],refetchInterval:3e3,events:["user:created","user:updated"]}),y({queryKey:["/api/hotels/current/inventory-items"],refetchInterval:3e3,events:["inventory:created","inventory:updated","inventory:deleted"]}),y({queryKey:["/api/attendance/daily"],refetchInterval:3e3,events:["attendance:updated"]});const x=q.filter(t=>{const a=new Date(t.createdAt),r=new Date(c.from),s=new Date(c.to);return s.setHours(23,59,59,999),a>=r&&a<=s}),i=x.filter(t=>t.txnType==="revenue").reduce((t,a)=>t+(Number(a.amount)||0),0),d=x.filter(t=>t.txnType==="expense").reduce((t,a)=>t+(Number(a.amount)||0),0),w=l.length>0?l.filter(t=>t.isOccupied).length/l.length*100:0,v=o.filter(t=>t.isActive).length,T=(t,a)=>{const r=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),n=URL.createObjectURL(r);s.setAttribute("href",n),s.setAttribute("download",a),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)},N=t=>{const a=new Date(c.from).toLocaleDateString(),r=new Date(c.to).toLocaleDateString();if(t==="financial"){let s=`Financial Report (${a} - ${r})

`;s+=`SUMMARY
`,s+=`Total Revenue,${i}
`,s+=`Total Expenses,${d}
`,s+=`Net Profit,${i-d}
`,s+=`Profit Margin,${i>0?((i-d)/i*100).toFixed(1):0}%

`,s+=`TRANSACTIONS
`,s+=`Date,Type,Purpose,Amount,Payment Method
`,x.forEach(n=>{s+=`${new Date(n.createdAt).toLocaleDateString()},${n.txnType},"${n.purpose||""}",${n.amount},${n.paymentMethod||""}
`}),T(s,`financial_report_${c.from}_to_${c.to}.csv`),$({title:"Financial Report Exported",description:"CSV file downloaded successfully"})}else if(t==="occupancy"){let s=`Occupancy Report (${a} - ${r})

`;s+=`Room Number,Type,Status,Occupied
`,l.forEach(n=>{s+=`${n.roomNumber},${n.type||"Standard"},${n.isOccupied?"Occupied":"Available"},${n.isOccupied?"Yes":"No"}
`}),s+=`
SUMMARY
`,s+=`Total Rooms,${l.length}
`,s+=`Occupied Rooms,${l.filter(n=>n.isOccupied).length}
`,s+=`Available Rooms,${l.filter(n=>!n.isOccupied).length}
`,s+=`Occupancy Rate,${w.toFixed(1)}%
`,T(s,`occupancy_report_${c.from}_to_${c.to}.csv`),$({title:"Occupancy Report Exported",description:"CSV file downloaded successfully"})}else if(t==="staff"){let s=`Staff Report (${a} - ${r})

`;s+=`Username,Full Name,Role,Status,Email
`,o.forEach(n=>{var A;s+=`${n.username},${n.fullName||""},${((A=n.role)==null?void 0:A.name)||""},${n.isActive?"Active":"Inactive"},${n.email||""}
`}),s+=`
SUMMARY
`,s+=`Total Staff,${o.length}
`,s+=`Active Staff,${v}
`,s+=`Inactive Staff,${o.length-v}
`,T(s,`staff_report_${c.from}_to_${c.to}.csv`),$({title:"Staff Report Exported",description:"CSV file downloaded successfully"})}},L=()=>{N(O)};return e.jsx(U,{title:"Financial Report",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Financial Reports"}),e.jsx("p",{className:"text-muted-foreground",children:"Comprehensive financial insights and analytics"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(S,{title:"Total Revenue",value:u(i),icon:e.jsx(B,{}),iconColor:"text-green-500"}),e.jsx(S,{title:"Total Expenses",value:u(d),icon:e.jsx(G,{}),iconColor:"text-red-500"}),e.jsx(S,{title:"Occupancy Rate",value:`${w.toFixed(1)}%`,icon:e.jsx(V,{}),iconColor:"text-blue-500"}),e.jsx(S,{title:"Active Staff",value:v,icon:e.jsx(E,{}),iconColor:"text-purple-500"})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Generate Report"]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"report-type",children:"Report Type"}),e.jsxs(P,{value:O,onValueChange:_,children:[e.jsx(Q,{"data-testid":"select-report-type",children:e.jsx(Y,{placeholder:"Select report type"})}),e.jsxs(z,{children:[e.jsx(C,{value:"financial",children:"Financial Report"}),e.jsx(C,{value:"occupancy",children:"Occupancy Report"}),e.jsx(C,{value:"staff",children:"Staff Report"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"date-from",children:"From Date"}),e.jsx(F,{id:"date-from",type:"date",value:c.from,onChange:t=>D(a=>({...a,from:t.target.value})),"data-testid":"input-date-from"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"date-to",children:"To Date"}),e.jsx(F,{id:"date-to",type:"date",value:c.to,onChange:t=>D(a=>({...a,to:t.target.value})),"data-testid":"input-date-to"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Actions"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(b,{onClick:L,className:"flex-1","data-testid":"button-generate",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Generate"]})})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(m,{children:[e.jsx(h,{children:e.jsx(f,{className:"text-lg",children:"Financial Summary"})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Revenue:"}),e.jsx("span",{className:"font-bold text-green-600",children:u(i)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Expenses:"}),e.jsx("span",{className:"font-bold text-red-600",children:u(d)})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{children:"Net Profit:"}),e.jsx("span",{className:"font-bold",children:u(i-d)})]}),e.jsxs(b,{variant:"outline",size:"sm",className:"w-full",onClick:()=>N("financial"),"data-testid":"button-export-financial",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Export Financial Report"]})]})})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsx(f,{className:"text-lg",children:"Occupancy Summary"})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Rooms:"}),e.jsx("span",{className:"font-bold",children:l.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Occupied:"}),e.jsx("span",{className:"font-bold",children:l.filter(t=>t.isOccupied).length})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{children:"Occupancy Rate:"}),e.jsxs("span",{className:"font-bold",children:[w.toFixed(1),"%"]})]}),e.jsxs(b,{variant:"outline",size:"sm",className:"w-full",onClick:()=>N("occupancy"),"data-testid":"button-export-occupancy",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Export Occupancy Report"]})]})})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsx(f,{className:"text-lg",children:"Staff Summary"})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Staff:"}),e.jsx("span",{className:"font-bold",children:o.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Active:"}),e.jsx("span",{className:"font-bold text-green-600",children:v})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{children:"On Duty Now:"}),e.jsx("span",{className:"font-bold",children:o.filter(t=>k.some(a=>a.userId===t.id&&a.status==="active")).length})]}),e.jsxs(b,{variant:"outline",size:"sm",className:"w-full",onClick:()=>N("staff"),"data-testid":"button-export-staff",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Export Staff Report"]})]})})]})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsx(f,{children:"Recent Activity Summary"})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Recent Transactions"}),e.jsx("div",{className:"space-y-2",children:x.length>0?x.slice(0,5).map((t,a)=>{var r;return e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"truncate",children:t.purpose||((r=t.txnType)==null?void 0:r.replace(/_/g," "))}),e.jsx("span",{className:`font-medium ${t.txnType==="revenue"?"text-green-600":"text-red-600"}`,children:u(Number(t.amount))})]},t.id||a)}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No transactions in selected date range"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Low Stock Items"}),e.jsx("div",{className:"space-y-2",children:K.filter(t=>Number(t.stockQty)<=Number(t.reorderLevel)).slice(0,5).map((t,a)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"truncate",children:t.name}),e.jsxs("span",{className:"text-orange-600 font-medium",children:[t.stockQty," ",t.unit]})]},t.id||a))})]})]})})})]})]})})}export{ce as default};
