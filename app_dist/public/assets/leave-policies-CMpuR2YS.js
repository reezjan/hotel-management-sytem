import{u as K,v as H,r as y,l as T,d as f,j as e,C as o,m as L,n as A,y as Q,B as d,a as u,s as r,I as c,X as S,k as j,A as g}from"./index-Dk6nXF67.js";import{D as P,a as M,S as $,j as z,T as R}from"./dashboard-layout-BUO8e75G.js";import{S as V}from"./switch-D9nocxgh.js";import{u as B}from"./use-realtime-query-2TJdEol3.js";import"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./index-D-DdYU4C.js";import"./use-websocket-ChOW8gRL.js";function _(){const{toast:t}=K(),{confirm:k}=H(),[N,m]=y.useState(null),[v,p]=y.useState(!1),[s,i]=y.useState({leaveType:"",displayName:"",defaultDays:0,isActive:!0}),{data:n}=T({queryKey:["/api/hotels/current"],refetchInterval:3e3}),{data:C=[],isLoading:E}=T({queryKey:["/api/hotels/current/leave-policies"],refetchInterval:3e3});B({queryKey:["/api/hotels/current/leave-policies"],refetchInterval:3e3,events:["leave-policy:created","leave-policy:updated","leave-policy:deleted"]});const w=f({mutationFn:async a=>await j("POST","/api/hotels/current/leave-policies",a),onSuccess:()=>{g.invalidateQueries({queryKey:["/api/hotels/current/leave-policies"]}),t({title:"Success",description:"Leave policy created successfully"}),p(!1),x()},onError:()=>{t({title:"Error",description:"Failed to create leave policy",variant:"destructive"})}}),h=f({mutationFn:async({id:a,data:l})=>await j("PATCH",`/api/leave-policies/${a}`,l),onSuccess:()=>{g.invalidateQueries({queryKey:["/api/hotels/current/leave-policies"]}),t({title:"Success",description:"Leave policy updated successfully"}),m(null),x()},onError:()=>{t({title:"Error",description:"Failed to update leave policy",variant:"destructive"})}}),D=f({mutationFn:async a=>await j("DELETE",`/api/leave-policies/${a}`,{}),onSuccess:()=>{g.invalidateQueries({queryKey:["/api/hotels/current/leave-policies"]}),t({title:"Success",description:"Leave policy deleted successfully"})},onError:()=>{t({title:"Error",description:"Failed to delete leave policy",variant:"destructive"})}}),x=()=>{i({leaveType:"",displayName:"",defaultDays:0,isActive:!0})},F=()=>{if(!s.leaveType||!s.displayName||s.defaultDays<=0){t({title:"Validation Error",description:"Please fill all fields correctly",variant:"destructive"});return}w.mutate(s)},I=a=>{if(!s.displayName||s.defaultDays<=0){t({title:"Validation Error",description:"Please fill all fields correctly",variant:"destructive"});return}h.mutate({id:a,data:{displayName:s.displayName,defaultDays:s.defaultDays,isActive:s.isActive}})},q=a=>{m(a.id),i({leaveType:a.leaveType,displayName:a.displayName,defaultDays:a.defaultDays,isActive:a.isActive})},b=()=>{m(null),p(!1),x()};return E?e.jsx(P,{title:"Leave Policies",currentHotel:n==null?void 0:n.name,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading leave policies..."})})}):e.jsx(P,{title:"Leave Policies",currentHotel:n==null?void 0:n.name,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(o,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Leave Policy Configuration"}),e.jsx(Q,{children:"Configure annual leave days for different leave types. These settings will apply to all staff members."})]}),!v&&e.jsxs(d,{onClick:()=>p(!0),"data-testid":"button-add-policy",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Add Leave Policy"]})]})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[v&&e.jsx(o,{className:"border-2 border-primary",children:e.jsx(u,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"new-leave-type",children:"Leave Type"}),e.jsx(c,{id:"new-leave-type",placeholder:"e.g., sick, vacation",value:s.leaveType,onChange:a=>i({...s,leaveType:a.target.value.toLowerCase()}),"data-testid":"input-leave-type"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"new-display-name",children:"Display Name"}),e.jsx(c,{id:"new-display-name",placeholder:"e.g., Sick Leave",value:s.displayName,onChange:a=>i({...s,displayName:a.target.value}),"data-testid":"input-display-name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"new-default-days",children:"Annual Days"}),e.jsx(c,{id:"new-default-days",type:"number",min:"0",placeholder:"e.g., 15",value:s.defaultDays||"",onChange:a=>i({...s,defaultDays:parseInt(a.target.value)||0}),"data-testid":"input-default-days"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs(d,{onClick:F,disabled:w.isPending,"data-testid":"button-save-new-policy",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Save"]}),e.jsxs(d,{variant:"outline",onClick:b,"data-testid":"button-cancel-new",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Cancel"]})]})]})})}),C.length===0&&!v?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No leave policies configured yet."}),e.jsx("p",{className:"text-sm",children:'Click "Add Leave Policy" to create your first policy.'})]}):e.jsx("div",{className:"space-y-3",children:C.map(a=>e.jsx(o,{className:N===a.id?"border-2 border-primary":"",children:e.jsx(u,{className:"pt-6",children:N===a.id?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Leave Type"}),e.jsx(c,{value:a.leaveType,disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:`edit-display-name-${a.id}`,children:"Display Name"}),e.jsx(c,{id:`edit-display-name-${a.id}`,value:s.displayName,onChange:l=>i({...s,displayName:l.target.value}),"data-testid":`input-edit-display-name-${a.id}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:`edit-default-days-${a.id}`,children:"Annual Days"}),e.jsx(c,{id:`edit-default-days-${a.id}`,type:"number",min:"0",value:s.defaultDays||"",onChange:l=>i({...s,defaultDays:parseInt(l.target.value)||0}),"data-testid":`input-edit-days-${a.id}`})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs(d,{onClick:()=>I(a.id),disabled:h.isPending,"data-testid":`button-save-${a.id}`,children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Save"]}),e.jsxs(d,{variant:"outline",onClick:b,"data-testid":`button-cancel-${a.id}`,children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Leave Type"}),e.jsx("p",{className:"font-medium","data-testid":`text-leave-type-${a.id}`,children:a.leaveType})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Display Name"}),e.jsx("p",{className:"font-medium","data-testid":`text-display-name-${a.id}`,children:a.displayName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Annual Days"}),e.jsxs("p",{className:"font-medium","data-testid":`text-days-${a.id}`,children:[a.defaultDays," days"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{checked:a.isActive,onCheckedChange:l=>{h.mutate({id:a.id,data:{isActive:l}})},"data-testid":`switch-active-${a.id}`}),e.jsx("span",{className:"text-sm","data-testid":`text-status-${a.id}`,children:a.isActive?"Active":"Inactive"})]})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(d,{variant:"outline",size:"icon",onClick:()=>q(a),"data-testid":`button-edit-${a.id}`,children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx(d,{variant:"outline",size:"icon",onClick:async()=>{await k({title:"Delete Leave Policy",description:"Are you sure you want to delete this leave policy?",confirmText:"Delete",cancelText:"Cancel",variant:"destructive",onConfirm:()=>{D.mutate(a.id)}})},disabled:D.isPending,"data-testid":`button-delete-${a.id}`,children:e.jsx(R,{className:"h-4 w-4"})})]})]})})},a.id))})]})})]}),e.jsxs(o,{children:[e.jsx(L,{children:e.jsx(A,{children:"How Leave Policies Work"})}),e.jsxs(u,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Leave Type:"})," A unique identifier for the leave category (e.g., sick, vacation, personal)"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Display Name:"}),' The user-friendly name shown to staff (e.g., "Sick Leave", "Annual Vacation")']}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Annual Days:"})," The number of leave days allocated to each staff member per year"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Status:"})," Active policies are available for staff to use; inactive policies are hidden"]}),e.jsx("p",{children:"• Leave balances are automatically initialized for all active staff members at the beginning of each year"}),e.jsx("p",{children:"• Changes to leave policies will apply to new leave balance allocations in future years"})]})]})]})})}export{_ as default};
