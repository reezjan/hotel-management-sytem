import{q as E,u as H,b as Q,r as b,c as V,l as m,d as D,j as e,C as U,m as G,n as _,a as z,B as g,F as J,e as h,f as x,g as p,h as j,k as v}from"./index-Dk6nXF67.js";import{D as W,E as X,U as Y}from"./dashboard-layout-BUO8e75G.js";import{D as Z,a as ee,b as se,c as te}from"./dialog-mWSLCdZX.js";import{T as ne}from"./textarea-BAi4nzW_.js";import{S as k,a as A,b as S,c as T,d as l}from"./select-Gj2YppMn.js";import{B as o}from"./badge-P46XOlcm.js";import{S as f}from"./stats-card-DnI6mJO0.js";import{c as ae,h as w}from"./users-Dxbor6Q1.js";import{f as R}from"./format-BOBWS5Wu.js";import"./circle-alert-BbQxKC8I.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";function fe(){const{user:i}=E(),{toast:y}=H(),N=Q(),[F,d]=b.useState(!1),[t,M]=b.useState(null),a=V({defaultValues:{assignedTo:"",description:"",priority:"high"}}),{data:r=[],isLoading:$}=m({queryKey:["/api/hotels/current/room-cleaning-queue"],refetchInterval:5e3,refetchIntervalInBackground:!0}),{data:q=[]}=m({queryKey:["/api/hotels/current/users"],refetchInterval:5e3,refetchIntervalInBackground:!0}),{data:B=[]}=m({queryKey:["/api/attendance/daily"]}),c=q.filter(s=>{var n;return((n=s.role)==null?void 0:n.name)==="housekeeping_staff"}).filter(s=>B.some(n=>n.userId===s.id&&n.status==="active")),C=r.filter(s=>s.status==="pending"),I=r.filter(s=>s.status==="assigned"),O=r.filter(s=>s.status==="completed"),u=D({mutationFn:async s=>{await v("POST","/api/hotels/current/tasks",{hotelId:i==null?void 0:i.hotelId,createdBy:i==null?void 0:i.id,assignedTo:s.assignedTo,title:`Clean Room ${s.roomNumber}`,description:s.description||`Clean room ${s.roomNumber} after checkout`,status:"pending",priority:s.priority,context:{type:"room_cleaning",roomId:s.roomId,roomNumber:s.roomNumber,guestName:s.guestName,checkoutAt:s.checkoutAt,queueId:s.queueId}}),await v("PUT",`/api/hotels/current/room-cleaning-queue/${s.queueId}`,{status:"assigned",taskId:s.taskId})},onSuccess:()=>{N.invalidateQueries({queryKey:["/api/hotels/current/room-cleaning-queue"]}),N.invalidateQueries({queryKey:["/api/hotels/current/tasks"]}),y({title:"Cleaning task assigned successfully"}),d(!1),a.reset()},onError:s=>{y({title:s.message||"Failed to assign task",variant:"destructive"})}}),P=s=>{M(s),d(!0),a.reset({assignedTo:"",description:`Clean room ${s.roomNumber} after checkout`,priority:"high"})},L=s=>{t&&u.mutate({assignedTo:s.assignedTo,roomId:t.roomId,roomNumber:t.roomNumber,guestName:t.guestName,checkoutAt:t.checkoutAt,description:s.description,priority:s.priority,queueId:t.id})},K=s=>{switch(s){case"pending":return e.jsx(o,{variant:"destructive","data-testid":"badge-status-pending",children:"Pending"});case"assigned":return e.jsx(o,{variant:"default","data-testid":"badge-status-assigned",children:"Assigned"});case"completed":return e.jsx(o,{variant:"secondary","data-testid":"badge-status-completed",children:"Completed"});default:return e.jsx(o,{children:s})}};return e.jsxs(W,{title:"Room Cleaning Queue",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(f,{title:"Pending Cleaning",value:C.length,icon:e.jsx(X,{}),iconColor:"text-red-500"}),e.jsx(f,{title:"Assigned Tasks",value:I.length,icon:e.jsx(ae,{}),iconColor:"text-blue-500"}),e.jsx(f,{title:"Completed Today",value:O.length,icon:e.jsx(w,{}),iconColor:"text-green-500"})]}),e.jsxs(U,{children:[e.jsx(G,{children:e.jsx(_,{children:"Checked-Out Rooms Requiring Cleaning"})}),e.jsxs(z,{children:[$?e.jsx("p",{className:"text-muted-foreground",children:"Loading cleaning queue..."}):r.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4","data-testid":"no-rooms-message",children:"No rooms in cleaning queue"}):e.jsx("div",{className:"space-y-4",children:r.map((s,n)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg","data-testid":`queue-item-${n}`,children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h4",{className:"font-medium text-lg","data-testid":`text-room-${s.roomNumber}`,children:["Room ",s.roomNumber]}),K(s.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-muted-foreground",children:[e.jsxs("div",{"data-testid":`text-guest-${n}`,children:[e.jsx("span",{className:"font-medium",children:"Guest: "}),s.guestName||"N/A"]}),e.jsxs("div",{"data-testid":`text-checkout-${n}`,children:[e.jsx("span",{className:"font-medium",children:"Checked Out: "}),s.checkoutAt?R(new Date(s.checkoutAt),"MMM dd, yyyy hh:mm a"):"N/A"]})]}),s.status==="assigned"&&e.jsxs("div",{className:"text-sm text-blue-600",children:[e.jsx("span",{className:"font-medium",children:"Status: "}),"Cleaning task assigned to staff"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="pending"&&e.jsxs(g,{onClick:()=>P(s),disabled:c.length===0,"data-testid":`button-assign-${n}`,children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Assign Staff"]}),s.status==="completed"&&e.jsxs(o,{variant:"secondary",children:[e.jsx(w,{className:"w-4 h-4 mr-1"}),"Cleaned"]})]})]},s.id))}),c.length===0&&C.length>0&&e.jsx("div",{className:"mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"No housekeeping staff is currently online. Tasks can be assigned once staff members are on duty."})})]})]})]}),e.jsx(Z,{open:F,onOpenChange:d,children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsx(te,{children:"Assign Cleaning Task"})}),e.jsx(J,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(L),className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("p",{className:"text-sm font-medium",children:["Room: ",t==null?void 0:t.roomNumber]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Guest: ",(t==null?void 0:t.guestName)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Checked Out: ",t!=null&&t.checkoutAt?R(new Date(t.checkoutAt),"MMM dd, yyyy hh:mm a"):"N/A"]})]}),e.jsx(h,{control:a.control,name:"assignedTo",render:({field:s})=>e.jsxs(x,{children:[e.jsx(p,{children:"Assign to Staff Member"}),e.jsxs(k,{onValueChange:s.onChange,value:s.value,children:[e.jsx(j,{children:e.jsx(A,{"data-testid":"select-staff",children:e.jsx(S,{placeholder:"Select staff member"})})}),e.jsx(T,{children:c.map(n=>e.jsxs(l,{value:n.id,children:[n.username," (On Duty)"]},n.id))})]})]})}),e.jsx(h,{control:a.control,name:"priority",render:({field:s})=>e.jsxs(x,{children:[e.jsx(p,{children:"Priority"}),e.jsxs(k,{onValueChange:s.onChange,value:s.value,children:[e.jsx(j,{children:e.jsx(A,{"data-testid":"select-priority",children:e.jsx(S,{placeholder:"Select priority"})})}),e.jsxs(T,{children:[e.jsx(l,{value:"low",children:"Low"}),e.jsx(l,{value:"medium",children:"Medium"}),e.jsx(l,{value:"high",children:"High"})]})]})]})}),e.jsx(h,{control:a.control,name:"description",render:({field:s})=>e.jsxs(x,{children:[e.jsx(p,{children:"Description / Instructions"}),e.jsx(j,{children:e.jsx(ne,{...s,placeholder:"Additional cleaning instructions...",rows:3,"data-testid":"input-description"})})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>d(!1),"data-testid":"button-cancel",children:"Cancel"}),e.jsx(g,{type:"submit",disabled:u.isPending,"data-testid":"button-submit",children:u.isPending?"Assigning...":"Assign Task"})]})]})})]})})]})}export{fe as default};
