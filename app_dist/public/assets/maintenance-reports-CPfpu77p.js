import{q as F,u as R,b as q,c as M,l as I,d as B,j as e,C as h,m as p,n as j,a as g,F as L,e as r,f as a,g as i,h as o,I as y,B as T,k as A}from"./index-Dk6nXF67.js";import{D,o as P}from"./dashboard-layout-BUO8e75G.js";import{T as k}from"./textarea-BAi4nzW_.js";import{S as E,a as H,b as K,c as Q,d as l}from"./select-Gj2YppMn.js";import{B as b}from"./badge-P46XOlcm.js";import{a as V}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";function X(){const{user:s}=F(),{toast:d}=R(),f=q(),n=M({defaultValues:{title:"",location:"",description:"",priority:"medium"}}),{data:m=[],isLoading:N}=I({queryKey:["/api/hotels/current/maintenance-requests"],refetchInterval:3e3,queryFn:async()=>{const t=await fetch("/api/hotels/current/maintenance-requests",{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch maintenance requests");return(await t.json()).filter(C=>{var x;return((x=C.reportedBy)==null?void 0:x.id)===(s==null?void 0:s.id)})},enabled:!!(s!=null&&s.id)}),c=B({mutationFn:async t=>{await A("POST","/api/maintenance-requests",{hotelId:s==null?void 0:s.hotelId,reportedBy:s==null?void 0:s.id,title:t.title,location:t.location,description:t.description,priority:t.priority,status:"pending"})},onSuccess:()=>{f.invalidateQueries({queryKey:["/api/hotels/current/maintenance-requests"]}),d({title:"Maintenance request submitted successfully"}),n.reset()},onError:t=>{d({title:t.message||"Failed to submit request",variant:"destructive"})}}),w=t=>{c.mutate(t)},v=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-800";case"in_progress":return"bg-blue-100 text-blue-800";case"resolved":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},S=t=>{switch(t){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-orange-100 text-orange-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return e.jsx(D,{title:"Maintenance Reports",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(h,{children:[e.jsx(p,{children:e.jsxs(j,{className:"flex items-center space-x-2",children:[e.jsx(P,{className:"h-5 w-5"}),e.jsx("span",{children:"Report Maintenance Issue"})]})}),e.jsx(g,{children:e.jsx(L,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(w),className:"space-y-4",children:[e.jsx(r,{control:n.control,name:"title",render:({field:t})=>e.jsxs(a,{children:[e.jsx(i,{children:"Issue Title"}),e.jsx(o,{children:e.jsx(y,{...t,placeholder:"e.g., Broken AC in Room 305","data-testid":"input-title"})})]})}),e.jsx(r,{control:n.control,name:"location",render:({field:t})=>e.jsxs(a,{children:[e.jsx(i,{children:"Location"}),e.jsx(o,{children:e.jsx(y,{...t,placeholder:"e.g., Room 305, Floor 3","data-testid":"input-location"})})]})}),e.jsx(r,{control:n.control,name:"description",render:({field:t})=>e.jsxs(a,{children:[e.jsx(i,{children:"Description"}),e.jsx(o,{children:e.jsx(k,{...t,placeholder:"Describe the maintenance issue in detail...",rows:4,"data-testid":"textarea-description"})})]})}),e.jsx(r,{control:n.control,name:"priority",render:({field:t})=>e.jsxs(a,{children:[e.jsx(i,{children:"Priority"}),e.jsxs(E,{onValueChange:t.onChange,value:t.value,children:[e.jsx(o,{children:e.jsx(H,{"data-testid":"select-priority",children:e.jsx(K,{})})}),e.jsxs(Q,{children:[e.jsx(l,{value:"low",children:"Low"}),e.jsx(l,{value:"medium",children:"Medium"}),e.jsx(l,{value:"high",children:"High"})]})]})]})}),e.jsxs(T,{type:"submit",disabled:c.isPending,className:"w-full","data-testid":"button-submit",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),c.isPending?"Submitting...":"Submit Request"]})]})})})]}),e.jsxs(h,{children:[e.jsx(p,{children:e.jsx(j,{children:"My Maintenance Requests"})}),e.jsx(g,{children:N?e.jsx("p",{className:"text-muted-foreground",children:"Loading..."}):m.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4","data-testid":"no-requests",children:"No maintenance requests submitted"}):e.jsx("div",{className:"space-y-3",children:m.map((t,u)=>e.jsxs("div",{className:"p-4 border rounded-lg","data-testid":`request-item-${u}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-foreground",children:t.title}),e.jsx(b,{className:v(t.status),variant:"secondary",children:t.status})]}),t.location&&e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:[e.jsx("strong",{children:"Location:"})," ",t.location]}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(b,{className:S(t.priority),variant:"outline",children:[t.priority," priority"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(t.createdAt).toLocaleString("en-GB",{timeZone:"Asia/Kathmandu"})})]})]},t.id))})})]})]})})}export{X as default};
