import{q as ce,u as oe,b as ue,r as N,l as x,d as p,j as e,C as f,m as j,n as v,a as g,B as c,s as n,I as o,aw as he,k as y}from"./index-Dk6nXF67.js";import{D as me,_ as F,z as H,i as xe}from"./dashboard-layout-BUO8e75G.js";import{S as b}from"./stats-card-DnI6mJO0.js";import{T as pe}from"./textarea-BAi4nzW_.js";import{S as U,a as E,b as Q,c as z,d as C}from"./select-Gj2YppMn.js";import{D as R,f as _,a as B,b as G,c as J,d as W,e as X}from"./dialog-mWSLCdZX.js";import{T as fe,a as je,b as w,c as k}from"./tabs-B2htHbJV.js";import{U as ve,S as ge,a as ye}from"./users-Dxbor6Q1.js";import{f as L}from"./format-BOBWS5Wu.js";import"./circle-alert-BbQxKC8I.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";function Le(){ce();const{toast:r}=oe(),m=ue(),[Y,P]=N.useState(!1),[Z,q]=N.useState(!1),[t,u]=N.useState({username:"",password:"",email:"",phone:"",fullName:"",address:""}),[i,h]=N.useState({assignedTo:"",title:"",description:"",priority:"medium",dueDate:""}),{data:l=[],isLoading:ee}=x({queryKey:["/api/hotels/current/security/officers"],refetchInterval:3e3}),{data:T=[],isLoading:se}=x({queryKey:["/api/hotels/current/security/tasks"],refetchInterval:3e3}),{data:D=[],isLoading:te}=x({queryKey:["/api/hotels/current/vehicle-logs"],refetchInterval:3e3}),{data:ae=[],isLoading:ie}=x({queryKey:["/api/hotels/current/maintenance-requests"],refetchInterval:3e3}),{data:O=[]}=x({queryKey:["/api/attendance/daily"],refetchInterval:3e3}),S=ae.filter(s=>{var a,d;return((d=(a=s.reportedBy)==null?void 0:a.role)==null?void 0:d.name)==="surveillance_officer"}),M=p({mutationFn:async s=>await y("POST","/api/hotels/current/security/officers",s),onSuccess:()=>{m.invalidateQueries({queryKey:["/api/hotels/current/security/officers"]}),r({title:"Surveillance Officer created successfully"}),P(!1),u({username:"",password:"",email:"",phone:"",fullName:"",address:""})},onError:s=>{r({title:"Failed to create officer",description:s.message||"An error occurred",variant:"destructive"})}}),$=p({mutationFn:async s=>await y("POST","/api/hotels/current/security/tasks",s),onSuccess:()=>{m.invalidateQueries({queryKey:["/api/hotels/current/security/tasks"]}),r({title:"Task assigned successfully"}),q(!1),h({assignedTo:"",title:"",description:"",priority:"medium",dueDate:""})},onError:s=>{r({title:"Failed to create task",description:s.message||"An error occurred",variant:"destructive"})}}),A=p({mutationFn:async s=>await y("PUT",`/api/maintenance-requests/${s}`,{status:"approved"}),onSuccess:()=>{m.invalidateQueries({queryKey:["/api/hotels/current/maintenance-requests"]}),r({title:"Maintenance request approved successfully"})},onError:s=>{r({title:"Failed to approve request",description:s.message||"An error occurred",variant:"destructive"})}}),I=p({mutationFn:async s=>await y("PUT",`/api/maintenance-requests/${s}`,{status:"resolved"}),onSuccess:()=>{m.invalidateQueries({queryKey:["/api/hotels/current/maintenance-requests"]}),r({title:"Maintenance request marked as resolved"})},onError:s=>{r({title:"Failed to resolve request",description:s.message||"An error occurred",variant:"destructive"})}}),K=p({mutationFn:async s=>await y("PUT",`/api/maintenance-requests/${s}`,{status:"declined"}),onSuccess:()=>{m.invalidateQueries({queryKey:["/api/hotels/current/maintenance-requests"]}),r({title:"Maintenance request declined successfully"})},onError:s=>{r({title:"Failed to decline request",description:s.message||"An error occurred",variant:"destructive"})}}),re=s=>{if(s.preventDefault(),!t.username||!t.password||!t.email||!t.phone||!t.fullName||!t.address){r({title:"All fields are required (username, password, email, phone, full name, and address)",variant:"destructive"});return}M.mutate(t)},ne=s=>{if(s.preventDefault(),!i.assignedTo||!i.title){r({title:"Please select an officer and enter task title",variant:"destructive"});return}$.mutate(i)},V=l.filter(s=>O.some(a=>a.userId===s.id&&a.status==="active")),de=T.filter(s=>s.status==="pending"),le=D.filter(s=>!s.checkOut);return S.filter(s=>s.status==="pending"),e.jsx(me,{title:"Security Head Dashboard",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(b,{title:"Surveillance Officers",value:l.length,icon:e.jsx(ve,{}),iconColor:"text-blue-500"}),e.jsx(b,{title:"On Duty",value:V.length,icon:e.jsx(ge,{}),iconColor:"text-green-500",trend:{value:l.length>0?Math.round(V.length/l.length*100):0,label:"coverage",isPositive:!0}}),e.jsx(b,{title:"Vehicles on Premises",value:le.length,icon:e.jsx(F,{}),iconColor:"text-purple-500"}),e.jsx(b,{title:"Pending Tasks",value:de.length,icon:e.jsx(H,{}),iconColor:"text-orange-500"})]}),e.jsxs(f,{children:[e.jsx(j,{children:e.jsx(v,{children:"Quick Actions"})}),e.jsx(g,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs(R,{open:Y,onOpenChange:P,children:[e.jsx(_,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-add-officer",children:[e.jsx(xe,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Add Officer"})]})}),e.jsxs(B,{"data-testid":"dialog-create-officer",children:[e.jsxs(G,{children:[e.jsx(J,{children:"Create Surveillance Officer"}),e.jsx(W,{children:"Create a new surveillance officer account with username and password"})]}),e.jsxs("form",{onSubmit:re,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"username",children:"Username *"}),e.jsx(o,{id:"username","data-testid":"input-officer-username",value:t.username,onChange:s=>u({...t,username:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"password",children:"Password *"}),e.jsx(o,{id:"password",type:"password","data-testid":"input-officer-password",value:t.password,onChange:s=>u({...t,password:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"email",children:"Email *"}),e.jsx(o,{id:"email",type:"email","data-testid":"input-officer-email",value:t.email,onChange:s=>u({...t,email:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"phone",children:"Phone *"}),e.jsx(o,{id:"phone","data-testid":"input-officer-phone",value:t.phone,onChange:s=>u({...t,phone:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"fullName",children:"Full Name *"}),e.jsx(o,{id:"fullName","data-testid":"input-officer-fullname",value:t.fullName,onChange:s=>u({...t,fullName:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"address",children:"Address *"}),e.jsx(o,{id:"address","data-testid":"input-officer-address",value:t.address,onChange:s=>u({...t,address:s.target.value}),required:!0})]}),e.jsx(X,{children:e.jsx(c,{type:"submit",disabled:M.isPending,"data-testid":"button-submit-officer",children:M.isPending?"Creating...":"Create Officer"})})]})]})]}),e.jsxs(R,{open:Z,onOpenChange:q,children:[e.jsx(_,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-assign-task",children:[e.jsx(H,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Assign Task"})]})}),e.jsxs(B,{"data-testid":"dialog-create-task",children:[e.jsxs(G,{children:[e.jsx(J,{children:"Assign Task to Officer"}),e.jsx(W,{children:"Create a new task and assign it to a surveillance officer"})]}),e.jsxs("form",{onSubmit:ne,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"officer",children:"Assign To *"}),e.jsxs(U,{value:i.assignedTo,onValueChange:s=>h({...i,assignedTo:s}),children:[e.jsx(E,{"data-testid":"select-task-officer",children:e.jsx(Q,{placeholder:"Select an officer"})}),e.jsx(z,{children:l.map(s=>{const a=O.some(d=>d.userId===s.id&&d.status==="active");return e.jsxs(C,{value:s.id,children:[s.username," ",a?"(On Duty)":"(Off Duty)"]},s.id)})})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"title",children:"Task Title *"}),e.jsx(o,{id:"title","data-testid":"input-task-title",value:i.title,onChange:s=>h({...i,title:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"description",children:"Description"}),e.jsx(pe,{id:"description","data-testid":"textarea-task-description",value:i.description,onChange:s=>h({...i,description:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"priority",children:"Priority"}),e.jsxs(U,{value:i.priority,onValueChange:s=>h({...i,priority:s}),children:[e.jsx(E,{"data-testid":"select-task-priority",children:e.jsx(Q,{})}),e.jsxs(z,{children:[e.jsx(C,{value:"low",children:"Low"}),e.jsx(C,{value:"medium",children:"Medium"}),e.jsx(C,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"dueDate",children:"Due Date"}),e.jsx(o,{id:"dueDate",type:"datetime-local","data-testid":"input-task-duedate",value:i.dueDate,onChange:s=>h({...i,dueDate:s.target.value})})]}),e.jsx(X,{children:e.jsx(c,{type:"submit",disabled:$.isPending,"data-testid":"button-submit-task",children:$.isPending?"Assigning...":"Assign Task"})})]})]})]}),e.jsx(he,{href:"/security-head/vehicles",children:e.jsxs(c,{variant:"outline",className:"h-20 w-full flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-vehicle-logs",children:[e.jsx(F,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"View Vehicles"})]})})]})})]}),e.jsxs(fe,{defaultValue:"officers",className:"w-full",children:[e.jsxs(je,{className:"grid w-full grid-cols-4",children:[e.jsx(w,{value:"officers","data-testid":"tab-officers",children:"Officers"}),e.jsx(w,{value:"tasks","data-testid":"tab-tasks",children:"Tasks"}),e.jsx(w,{value:"vehicles","data-testid":"tab-vehicles",children:"Vehicles"}),e.jsx(w,{value:"maintenance","data-testid":"tab-maintenance",children:"Maintenance"})]}),e.jsx(k,{value:"officers",children:e.jsxs(f,{children:[e.jsx(j,{children:e.jsx(v,{children:"Surveillance Officers"})}),e.jsx(g,{children:ee?e.jsx("div",{className:"text-center py-8","data-testid":"loading-officers",children:"Loading officers..."}):l.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground","data-testid":"no-officers",children:"No surveillance officers yet. Create one to get started."}):e.jsx("div",{className:"space-y-4",children:l.map(s=>{const a=O.some(d=>d.userId===s.id&&d.status==="active");return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg","data-testid":`officer-${s.id}`,children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${a?"bg-green-500":"bg-gray-400"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium","data-testid":`officer-name-${s.id}`,children:s.username}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.email||"No email"," • ",s.phone||"No phone"]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs ${a?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,"data-testid":`officer-status-${s.id}`,children:a?"On Duty":"Off Duty"})})]},s.id)})})})]})}),e.jsx(k,{value:"tasks",children:e.jsxs(f,{children:[e.jsx(j,{children:e.jsx(v,{children:"Assigned Tasks"})}),e.jsx(g,{children:se?e.jsx("div",{className:"text-center py-8","data-testid":"loading-tasks",children:"Loading tasks..."}):T.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground","data-testid":"no-tasks",children:"No tasks assigned yet."}):e.jsx("div",{className:"space-y-4",children:T.map(s=>{const a=l.find(d=>d.id===s.assignedTo);return e.jsx("div",{className:"p-4 border rounded-lg","data-testid":`task-${s.id}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-medium","data-testid":`task-title-${s.id}`,children:s.title}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${s.priority==="high"?"bg-red-100 text-red-800":s.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:s.priority})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{"data-testid":`task-assignee-${s.id}`,children:["Assigned to: ",(a==null?void 0:a.username)||"Unknown"]}),e.jsxs("span",{"data-testid":`task-status-${s.id}`,children:["Status: ",s.status]}),s.dueDate&&e.jsxs("span",{children:["Due: ",L(new Date(s.dueDate),"MMM dd, yyyy")]})]})]})})},s.id)})})})]})}),e.jsx(k,{value:"vehicles",children:e.jsxs(f,{children:[e.jsx(j,{children:e.jsx(v,{children:"Vehicle Check-in/Check-out Logs"})}),e.jsx(g,{children:te?e.jsx("div",{className:"text-center py-8","data-testid":"loading-vehicles",children:"Loading vehicle logs..."}):D.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground","data-testid":"no-vehicles",children:"No vehicle logs yet."}):e.jsx("div",{className:"space-y-4",children:D.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg","data-testid":`vehicle-${s.id}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium","data-testid":`vehicle-number-${s.id}`,children:s.vehicleNumber})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:["Driver: ",s.driverName," • Purpose: ",s.purpose]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Check-in: ",L(new Date(s.checkIn),"MMM dd, yyyy HH:mm"),s.checkOut&&` • Check-out: ${L(new Date(s.checkOut),"MMM dd, yyyy HH:mm")}`]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs ${s.checkOut?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800"}`,"data-testid":`vehicle-status-${s.id}`,children:s.checkOut?"Checked Out":"On Premises"})]},s.id))})})]})}),e.jsx(k,{value:"maintenance",children:e.jsxs(f,{children:[e.jsx(j,{children:e.jsx(v,{children:"Maintenance Requests from Officers"})}),e.jsx(g,{children:ie?e.jsx("div",{className:"text-center py-8","data-testid":"loading-maintenance",children:"Loading maintenance requests..."}):S.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground","data-testid":"no-maintenance",children:"No maintenance requests from officers yet."}):e.jsx("div",{className:"space-y-4",children:S.map(s=>{var a;return e.jsx("div",{className:"p-4 border rounded-lg","data-testid":`maintenance-${s.id}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"h-4 w-4 text-orange-500"}),e.jsx("h4",{className:"font-medium","data-testid":`maintenance-title-${s.id}`,children:s.title}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${s.priority==="high"?"bg-red-100 text-red-800":s.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:s.priority})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Reported by: ",((a=s.reportedBy)==null?void 0:a.username)||"Unknown"]}),e.jsxs("span",{children:["Location: ",s.location]}),e.jsxs("span",{"data-testid":`maintenance-status-${s.id}`,children:["Status: ",s.status]})]})]}),s.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{size:"sm",variant:"default",onClick:()=>A.mutate(s.id),disabled:A.isPending,"data-testid":`button-approve-${s.id}`,children:"Approve"}),e.jsx(c,{size:"sm",variant:"destructive",onClick:()=>K.mutate(s.id),disabled:K.isPending,"data-testid":`button-decline-${s.id}`,children:"Decline"})]}),s.status==="approved"&&e.jsx(c,{size:"sm",variant:"default",onClick:()=>I.mutate(s.id),disabled:I.isPending,"data-testid":`button-resolve-${s.id}`,children:"Mark as Resolved"})]})},s.id)})})})]})})]})]})})}export{Le as default};
