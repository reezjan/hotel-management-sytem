import{q as he,u as pe,b as ve,r as n,l as ee,d as F,j as e,C as xe,m as ge,n as ye,a as je,s as i,I as r,B as l,k as L}from"./index-Dk6nXF67.js";import{D as ke,c as be,d as Se}from"./dashboard-layout-BUO8e75G.js";import{D as te}from"./data-table-BEvwFoVx.js";import{S as P}from"./stats-card-DnI6mJO0.js";import{D as E,a as Q,b as w,c as T,d as q}from"./dialog-mWSLCdZX.js";import{T as se}from"./textarea-BAi4nzW_.js";import{u as Ne}from"./use-realtime-query-2TJdEol3.js";import{a as fe,b as Ce}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./badge-P46XOlcm.js";import"./use-websocket-ChOW8gRL.js";function Re(){const{user:R}=he(),{toast:o}=pe(),u=ve(),[m,h]=n.useState(!1),[c,p]=n.useState(!1),[ae,v]=n.useState(!1),[A,x]=n.useState(!1),[s,g]=n.useState(null),[y,j]=n.useState(""),[K,k]=n.useState(""),[O,b]=n.useState(""),[$,S]=n.useState("piece"),[M,N]=n.useState(""),[B,f]=n.useState(""),[H,C]=n.useState(""),[U,V]=n.useState(""),{data:d=[]}=ee({queryKey:["/api/hotels/current/inventory-items"],refetchInterval:3e3}),{data:ie=[]}=ee({queryKey:["/api/hotels/current/inventory-consumptions"],refetchInterval:3e3});Ne({queryKey:["/api/hotels/current/inventory-items"],refetchInterval:3e3,events:["inventory:created","inventory:updated","inventory:deleted"]}),n.useEffect(()=>{s&&c?(j(s.name||""),k(s.description||""),b(s.sku||""),S(s.unit||s.baseUnit||"piece"),N(s.reorderLevel||""),f(s.storageLocation||""),C(s.costPerUnit||"")):s&&m?V(s.baseStockQty||""):!c&&!A&&!m&&I()},[s,c,A,m]);const I=()=>{j(""),k(""),b(""),S("piece"),N(""),f(""),C(""),V("")},z=F({mutationFn:async t=>{await L("POST","/api/hotels/current/inventory-items",t)},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/hotels/current/inventory-items"]}),o({title:"Success",description:"Inventory item created successfully!"}),x(!1),I()},onError:()=>{o({title:"Error",description:"Failed to create inventory item",variant:"destructive"})}}),G=F({mutationFn:async({id:t,data:a})=>{await L("PUT",`/api/hotels/current/inventory-items/${t}`,a)},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/hotels/current/inventory-items"]}),o({title:"Success",description:"Inventory item updated successfully!"}),p(!1),I()},onError:()=>{o({title:"Error",description:"Failed to update inventory item",variant:"destructive"})}}),J=F({mutationFn:async t=>{await L("DELETE",`/api/hotels/current/inventory-items/${t}`)},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/hotels/current/inventory-items"]}),o({title:"Success",description:"Inventory item removed successfully!"}),v(!1),g(null)},onError:()=>{o({title:"Error",description:"Failed to remove inventory item",variant:"destructive"})}}),W=F({mutationFn:async({id:t,data:a})=>{await L("PUT",`/api/hotels/current/inventory-items/${t}`,a)},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/hotels/current/inventory-items"]}),o({title:"Success",description:"Stock updated successfully!"}),h(!1),I()},onError:()=>{o({title:"Error",description:"Failed to update stock",variant:"destructive"})}}),Y=()=>{if(!y.trim()){o({title:"Error",description:"Item name is required",variant:"destructive"});return}const t={hotelId:R==null?void 0:R.hotelId,name:y,description:K||null,sku:O||"AUTO",unit:$||"piece",packageUnit:null,baseUnitsPerPackage:"0",packageStockQty:"0",baseStockQty:"0",reorderLevel:M||"0",storageLocation:B||null,costPerUnit:H||"0",departments:[]};s&&c?G.mutate({id:s.id,data:t}):z.mutate(t)},ne=()=>{if(!U||Number(U)<0){o({title:"Error",description:"Please enter a valid stock quantity",variant:"destructive"});return}W.mutate({id:s.id,data:{baseStockQty:U}})},re=()=>{s&&J.mutate(s.id)},oe=d.length,Z=d.filter(t=>Number(t.baseStockQty)<=Number(t.reorderLevel)).length,_=d.filter(t=>Number(t.baseStockQty)===0).length,le=d.reduce((t,a)=>t+Number(a.baseStockQty)*(Number(a.costPerUnit)||0),0),de=[{key:"name",label:"Item Name",sortable:!0},{key:"sku",label:"SKU",sortable:!0},{key:"description",label:"Description",sortable:!0},{key:"baseStockQty",label:"Current Stock",sortable:!0,render:(t,a)=>{const D=Number(t||0).toFixed(2),X=Number(a.packageStockQty||0).toFixed(2),me=a.unit||a.baseUnit||"piece";return`${D} ${me}${a.packageUnit?` (${X} ${a.packageUnit})`:""}`}},{key:"reorderLevel",label:"Reorder Level",sortable:!0},{key:"unit",label:"Unit",sortable:!0,render:(t,a)=>t||a.baseUnit||"piece"},{key:"costPerUnit",label:"Cost/Unit",sortable:!0,render:t=>`NPR ${Number(t||0).toFixed(2)}`},{key:"storageLocation",label:"Storage",sortable:!0},{key:"status",label:"Status",render:(t,a)=>{const D=Number(a.baseStockQty),X=Number(a.reorderLevel);return D===0?e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs",children:"Out of Stock"}):D<=X?e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs",children:"Low Stock"}):e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs",children:"In Stock"})}}],ce=[{key:"itemName",label:"Item",sortable:!0},{key:"qty",label:"Quantity",sortable:!0},{key:"reason",label:"Reason",sortable:!0},{key:"createdAt",label:"Date",sortable:!0,render:t=>new Date(t).toLocaleDateString()}],ue=[{label:"Update Stock",action:t=>{g(t),h(!0)}},{label:"Edit Item",action:t=>{g(t),p(!0)}},{label:"Remove",action:t=>{g(t),v(!0)},variant:"destructive"}];return e.jsx(ke,{title:"Inventory Tracking",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(P,{title:"Total Items",value:oe,icon:e.jsx(be,{}),iconColor:"text-blue-500"}),e.jsx(P,{title:"Low Stock Items",value:Z,icon:e.jsx(fe,{}),iconColor:"text-yellow-500"}),e.jsx(P,{title:"Out of Stock",value:_,icon:e.jsx(Ce,{}),iconColor:"text-red-500"}),e.jsx(P,{title:"Total Value",value:`NPR ${le.toLocaleString()}`,icon:e.jsx(Se,{}),iconColor:"text-green-500"})]}),e.jsxs(xe,{children:[e.jsx(ge,{children:e.jsx(ye,{children:"Stock Status Overview"})}),e.jsx(je,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center p-6 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:d.filter(t=>Number(t.baseStockQty)>Number(t.reorderLevel)).length}),e.jsx("div",{className:"text-sm text-green-700 mt-2",children:"Items in Stock"})]}),e.jsxs("div",{className:"text-center p-6 bg-yellow-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:Z}),e.jsx("div",{className:"text-sm text-yellow-700 mt-2",children:"Low Stock Items"})]}),e.jsxs("div",{className:"text-center p-6 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:_}),e.jsx("div",{className:"text-sm text-red-700 mt-2",children:"Out of Stock"})]})]})})]}),e.jsx(te,{title:"Inventory Items",data:d,columns:de,actions:ue,onAdd:()=>x(!0),addButtonLabel:"Add Inventory Item",searchPlaceholder:"Search inventory..."}),e.jsx(te,{title:"Recent Inventory Consumptions",data:ie.slice(0,20),columns:ce,searchPlaceholder:"Search consumptions..."}),e.jsx(E,{open:m,onOpenChange:h,children:e.jsxs(Q,{children:[e.jsxs(w,{children:[e.jsxs(T,{children:["Update Stock - ",s==null?void 0:s.name]}),e.jsx(q,{children:"Adjust inventory stock quantity"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"stock-qty",children:["Current Stock (",(s==null?void 0:s.unit)||(s==null?void 0:s.baseUnit)||"units",")"]}),e.jsx(r,{id:"stock-qty",type:"number",value:U,onChange:t=>V(t.target.value),placeholder:"Enter stock quantity","data-testid":"input-stock-qty"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(l,{variant:"outline",onClick:()=>h(!1),"data-testid":"button-cancel-update-stock",children:"Cancel"}),e.jsx(l,{onClick:ne,disabled:W.isPending,"data-testid":"button-update-stock",children:W.isPending?"Updating...":"Update Stock"})]})]})]})}),e.jsx(E,{open:c,onOpenChange:p,children:e.jsxs(Q,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(w,{children:[e.jsxs(T,{children:["Edit Item - ",s==null?void 0:s.name]}),e.jsx(q,{children:"Update inventory item details"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-name",children:"Item Name *"}),e.jsx(r,{id:"edit-name",value:y,onChange:t=>j(t.target.value),placeholder:"Enter item name","data-testid":"input-item-name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-sku",children:"SKU"}),e.jsx(r,{id:"edit-sku",value:O,onChange:t=>b(t.target.value),placeholder:"Enter SKU","data-testid":"input-sku"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-description",children:"Description"}),e.jsx(se,{id:"edit-description",value:K,onChange:t=>k(t.target.value),placeholder:"Enter description","data-testid":"input-description"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-unit",children:"Unit"}),e.jsx(r,{id:"edit-unit",value:$,onChange:t=>S(t.target.value),placeholder:"e.g., piece, kg, liter","data-testid":"input-unit"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-reorder-level",children:"Reorder Level"}),e.jsx(r,{id:"edit-reorder-level",type:"number",value:M,onChange:t=>N(t.target.value),placeholder:"Minimum stock level","data-testid":"input-reorder-level"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-storage",children:"Storage Location"}),e.jsx(r,{id:"edit-storage",value:B,onChange:t=>f(t.target.value),placeholder:"Storage location","data-testid":"input-storage"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-cost",children:"Cost Per Unit"}),e.jsx(r,{id:"edit-cost",type:"number",value:H,onChange:t=>C(t.target.value),placeholder:"Cost per unit","data-testid":"input-cost"})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(l,{variant:"outline",onClick:()=>p(!1),"data-testid":"button-cancel-edit",children:"Cancel"}),e.jsx(l,{onClick:Y,disabled:G.isPending,"data-testid":"button-save-item",children:G.isPending?"Saving...":"Save Changes"})]})]})]})}),e.jsx(E,{open:ae,onOpenChange:v,children:e.jsxs(Q,{children:[e.jsxs(w,{children:[e.jsxs(T,{children:["Remove Item - ",s==null?void 0:s.name]}),e.jsx(q,{children:"Are you sure you want to remove this item?"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"This action cannot be undone. The item will be permanently removed from the inventory."}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(l,{variant:"outline",onClick:()=>v(!1),"data-testid":"button-cancel-remove",children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:re,disabled:J.isPending,"data-testid":"button-confirm-remove",children:J.isPending?"Removing...":"Remove Item"})]})]})]})}),e.jsx(E,{open:A,onOpenChange:x,children:e.jsxs(Q,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(w,{children:[e.jsx(T,{children:"Add Inventory Item"}),e.jsx(q,{children:"Create a new inventory item"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"add-name",children:"Item Name *"}),e.jsx(r,{id:"add-name",value:y,onChange:t=>j(t.target.value),placeholder:"Enter item name","data-testid":"input-item-name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"add-sku",children:"SKU"}),e.jsx(r,{id:"add-sku",value:O,onChange:t=>b(t.target.value),placeholder:"Enter SKU","data-testid":"input-sku"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"add-description",children:"Description"}),e.jsx(se,{id:"add-description",value:K,onChange:t=>k(t.target.value),placeholder:"Enter description","data-testid":"input-description"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"add-unit",children:"Unit"}),e.jsx(r,{id:"add-unit",value:$,onChange:t=>S(t.target.value),placeholder:"e.g., piece, kg, liter","data-testid":"input-unit"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"add-reorder-level",children:"Reorder Level"}),e.jsx(r,{id:"add-reorder-level",type:"number",value:M,onChange:t=>N(t.target.value),placeholder:"Minimum stock level","data-testid":"input-reorder-level"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"add-storage",children:"Storage Location"}),e.jsx(r,{id:"add-storage",value:B,onChange:t=>f(t.target.value),placeholder:"Storage location","data-testid":"input-storage"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"add-cost",children:"Cost Per Unit"}),e.jsx(r,{id:"add-cost",type:"number",value:H,onChange:t=>C(t.target.value),placeholder:"Cost per unit","data-testid":"input-cost"})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(l,{variant:"outline",onClick:()=>x(!1),"data-testid":"button-cancel-add",children:"Cancel"}),e.jsx(l,{onClick:Y,disabled:z.isPending,"data-testid":"button-create-item",children:z.isPending?"Creating...":"Create Item"})]})]})]})})]})})}export{Re as default};
