import{q as K,u as z,b as V,r,l as O,d as D,j as e,C as F,m as M,n as I,a as R,a2 as G,B as j,s as l,I as f,k as B}from"./index-Dk6nXF67.js";import{D as J,y,F as L}from"./dashboard-layout-BUO8e75G.js";import{S as c}from"./stats-card-DnI6mJO0.js";import{B as A}from"./badge-P46XOlcm.js";import{T as W}from"./textarea-BAi4nzW_.js";import{S as X,a as Y,b as Z,c as _,d as v}from"./select-Gj2YppMn.js";import{c as ee}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./index-CC2mel_A.js";import"./index-D-DdYU4C.js";function he(){const{user:a}=K(),{toast:o}=z(),b=V(),[te,U]=r.useState(null),[u,S]=r.useState(""),[m,C]=r.useState(""),[N,T]=r.useState("medium"),[h,w]=r.useState(""),[d,k]=r.useState(""),{data:i=[]}=O({queryKey:["/api/users",a==null?void 0:a.id,"tasks"],enabled:!!(a!=null&&a.id),refetchInterval:5e3,refetchIntervalInBackground:!0}),p=D({mutationFn:async({taskId:t,status:s})=>{await B("PUT",`/api/tasks/${t}`,{status:s})},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/users",a==null?void 0:a.id,"tasks"]}),o({title:"Task updated successfully"}),U(null)}}),x=D({mutationFn:async t=>{await B("POST","/api/hotels/current/maintenance-requests",t)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/hotels/current/maintenance-requests"]}),o({title:"Maintenance request submitted successfully"}),S(""),C(""),T("medium"),w(""),k("")},onError:()=>{o({title:"Failed to submit request",description:"Please try again later",variant:"destructive"})}}),H=i.filter(t=>t.status==="pending"),E=i.filter(t=>t.status==="performing"),q=i.filter(t=>t.status==="completed").filter(t=>{const s=new Date().toDateString();return new Date(t.updatedAt||t.createdAt).toDateString()===s}),P=(t,s)=>{p.mutate({taskId:t.id,status:s})},Q=t=>{if(t.preventDefault(),!u||!m||!h||!d){o({title:"Missing information",description:"Please fill in all required fields including photo",variant:"destructive"});return}x.mutate({title:u,description:m,priority:N,location:h,photo:d,status:"pending"})},$=t=>{switch(t){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return e.jsx(J,{title:"Housekeeping Staff Dashboard",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(c,{title:"Pending Tasks",value:H.length,icon:e.jsx(ee,{}),iconColor:"text-orange-500"}),e.jsx(c,{title:"In Progress",value:E.length,icon:e.jsx(y,{}),iconColor:"text-blue-500"}),e.jsx(c,{title:"Completed Today",value:q.length,icon:e.jsx(y,{}),iconColor:"text-green-500",trend:{value:q.length>0?100:0,label:"completion rate",isPositive:!0}}),e.jsx(c,{title:"Total Tasks",value:i.length,icon:e.jsx(y,{}),iconColor:"text-purple-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{children:[e.jsx(M,{children:e.jsx(I,{children:"My Tasks"})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-3",children:i.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4","data-testid":"no-tasks-message",children:"No tasks assigned"}):i.slice(0,10).map((t,s)=>{var n;return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg","data-testid":`task-item-${s}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-foreground",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(A,{className:$(t.priority),variant:"outline",children:((n=t.priority)==null?void 0:n.toUpperCase())||"MEDIUM"}),e.jsx(A,{className:G(t.status),variant:"secondary",children:t.status}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(t.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[t.status==="pending"&&e.jsx(j,{size:"sm",onClick:()=>P(t,"performing"),disabled:p.isPending,"data-testid":`button-start-task-${s}`,children:"Start"}),t.status==="performing"&&e.jsx(j,{size:"sm",onClick:()=>P(t,"completed"),disabled:p.isPending,"data-testid":`button-complete-task-${s}`,children:"Complete"})]})]},t.id)})})})]}),e.jsxs(F,{children:[e.jsx(M,{children:e.jsxs(I,{className:"flex items-center",children:[e.jsx(L,{className:"h-5 w-5 mr-2"}),"Submit Maintenance Request"]})}),e.jsx(R,{children:e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"title",children:"Issue Title *"}),e.jsx(f,{id:"title",placeholder:"e.g., Broken AC in Room 201",value:u,onChange:t=>S(t.target.value),required:!0,"data-testid":"input-maintenance-title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"location",children:"Location *"}),e.jsx(f,{id:"location",placeholder:"e.g., Room 201, Hallway 2nd Floor",value:h,onChange:t=>w(t.target.value),required:!0,"data-testid":"input-maintenance-location"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"priority",children:"Priority *"}),e.jsxs(X,{value:N,onValueChange:T,children:[e.jsx(Y,{id:"priority",className:"h-11","data-testid":"select-maintenance-priority",children:e.jsx(Z,{})}),e.jsxs(_,{children:[e.jsx(v,{value:"low",children:"Low - Can wait"}),e.jsx(v,{value:"medium",children:"Medium - Soon"}),e.jsx(v,{value:"high",children:"High - Urgent"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"description",children:"Description *"}),e.jsx(W,{id:"description",placeholder:"Provide detailed information about the issue...",value:m,onChange:t=>C(t.target.value),rows:4,required:!0,"data-testid":"textarea-maintenance-description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"photo",children:"Photo *"}),e.jsx(f,{id:"photo",type:"file",accept:"image/*",required:!0,"data-testid":"input-maintenance-photo",onChange:t=>{var n;const s=(n=t.target.files)==null?void 0:n[0];if(s){const g=new FileReader;g.onloadend=()=>{k(g.result)},g.readAsDataURL(s)}}}),d&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:d,alt:"Preview",className:"max-w-full h-32 object-cover rounded border"})})]}),e.jsx(j,{type:"submit",className:"w-full h-11 min-h-11",disabled:x.isPending,"data-testid":"button-submit-maintenance",children:x.isPending?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Submit Request"]})})]})})]})]})]})})}export{he as default};
