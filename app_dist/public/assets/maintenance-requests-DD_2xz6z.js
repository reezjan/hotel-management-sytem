import{u as f,b,l as q,d as g,j as o}from"./index-Dk6nXF67.js";import{D as k}from"./dashboard-layout-BUO8e75G.js";import{D as R}from"./data-table-BEvwFoVx.js";import"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./badge-P46XOlcm.js";function F(){const{toast:a}=f(),u=b(),{data:l=[],isLoading:c}=q({queryKey:["/api/hotels/current/maintenance-requests"],refetchInterval:3e3,queryFn:async()=>{const e=await fetch("/api/hotels/current/maintenance-requests",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch maintenance requests");return(await e.json()).filter(t=>{var r,i;return((i=(r=t.reportedBy)==null?void 0:r.role)==null?void 0:i.name)==="housekeeping_staff"})}}),s=g({mutationFn:async({id:e,status:n})=>{const t=await fetch(`/api/hotels/current/maintenance-requests/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:n})});if(!t.ok)throw new Error("Failed to update request");return t.json()},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/hotels/current/maintenance-requests"]}),a({title:"Request updated successfully"})},onError:e=>{a({title:e.message,variant:"destructive"})}}),d=e=>{s.mutate({id:e.id,status:"declined"})},p=e=>{s.mutate({id:e.id,status:"fixing"})},m=e=>{s.mutate({id:e.id,status:"resolved"})},y=[{key:"title",label:"Issue",sortable:!0},{key:"location",label:"Location",sortable:!0},{key:"reportedBy",label:"Reported By",render:e=>(e==null?void 0:e.username)||"Unknown"},{key:"priority",label:"Priority",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"createdAt",label:"Reported At",sortable:!0,render:e=>new Date(e).toLocaleString("en-GB",{timeZone:"Asia/Kathmandu"})}],h=[{label:"Declined",action:e=>d(e),show:e=>e.status!=="approved"&&e.status!=="resolved"&&e.status!=="declined"},{label:"Fixing",action:e=>p(e),show:e=>e.status!=="resolved"&&e.status!=="fixing"&&e.status!=="declined"},{label:"Resolved",action:e=>m(e),show:e=>(e.status==="approved"||e.status==="fixing")&&e.status!=="resolved"}];return o.jsx(k,{title:"Maintenance Requests",children:o.jsx(R,{title:"Maintenance Requests from Housekeeping Staff",data:l,columns:y,actions:h,searchPlaceholder:"Search maintenance requests...",isLoading:c})})}export{F as default};
