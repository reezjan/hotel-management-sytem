import{o as L,b as V,l as c,r as K,j as e,C as h,m as p,n as g,a as y,B as n}from"./index-Dk6nXF67.js";import{D as R,b as u,q as f,e as _,r as O,s as P}from"./dashboard-layout-BUO8e75G.js";import{S as d}from"./stats-card-DnI6mJO0.js";import{D as m}from"./data-table-BEvwFoVx.js";import{u as U}from"./use-websocket-ChOW8gRL.js";import{R as b,T as z,U as B}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./badge-P46XOlcm.js";function J(){const[,s]=L(),o=V(),l=U(),{data:j=[]}=c({queryKey:["/api/hotels/current/users"],refetchInterval:3e3}),{data:v=[]}=c({queryKey:["/api/attendance/daily"],refetchInterval:3e3}),{data:i=[]}=c({queryKey:["/api/hotels/current/transactions"],refetchInterval:3e3}),{data:x=[]}=c({queryKey:["/api/hotels/current/vouchers"],refetchInterval:3e3}),{data:N=[]}=c({queryKey:["/api/hotels/current/rooms"],refetchInterval:3e3});K.useEffect(()=>{const a=[l.on("transaction:created",()=>{o.invalidateQueries({queryKey:["/api/hotels/current/transactions"]})}),l.on("transaction:updated",()=>{o.invalidateQueries({queryKey:["/api/hotels/current/transactions"]})}),l.on("room:updated",()=>{o.invalidateQueries({queryKey:["/api/hotels/current/rooms"]})}),l.on("attendance:updated",()=>{o.invalidateQueries({queryKey:["/api/attendance/daily"]})})];return()=>{a.forEach(t=>t())}},[l,o]);const C=i.filter(a=>a.paymentMethod==="cash").reduce((a,t)=>a+Number(t.amount),0),k=i.filter(a=>a.paymentMethod==="pos").reduce((a,t)=>a+Number(t.amount),0),w=i.filter(a=>a.paymentMethod==="fonepay").reduce((a,t)=>a+Number(t.amount),0),S=[{key:"username",label:"Name",sortable:!0},{key:"role",label:"Role",sortable:!0,render:a=>{var t;return(t=a==null?void 0:a.name)==null?void 0:t.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase())}},{key:"id",label:"Status",render:a=>{const t=v.some(r=>r.userId===a&&r.status==="active");return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t?"On Duty":"Off Duty"})}},{key:"createdAt",label:"Hired",sortable:!0}],T=[{key:"code",label:"Code",sortable:!0},{key:"discountAmount",label:"Discount",sortable:!0},{key:"discountType",label:"Type",sortable:!0},{key:"validUntil",label:"Expires",sortable:!0},{key:"usedCount",label:"Used",sortable:!0},{key:"maxUses",label:"Max Uses",sortable:!0}],A=[{key:"roomNumber",label:"Room",sortable:!0},{key:"roomType",label:"Type",render:(a,t)=>{var r;return((r=t.roomType)==null?void 0:r.name)||"Standard"}},{key:"isOccupied",label:"Status",render:a=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${a?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:a?"Occupied":"Available"})}],D=[{label:"View",action:a=>s("/manager/staff")},{label:"Manage",action:a=>s("/manager/staff"),variant:"outline"}],M=[{label:"View",action:a=>s("/manager/discount-vouchers")},{label:"Manage",action:a=>s("/manager/discount-vouchers"),variant:"outline"}],q=[{label:"View",action:a=>s("/manager/room-setup")},{label:"Manage",action:a=>s("/manager/room-setup"),variant:"outline"}];return e.jsx(R,{title:"Manager Dashboard",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(d,{title:"Cash Transactions",value:`रु${C.toLocaleString()}`,icon:e.jsx(b,{}),iconColor:"text-green-500"}),e.jsx(d,{title:"POS Transactions",value:`रु${k.toLocaleString()}`,icon:e.jsx(u,{}),iconColor:"text-blue-500"}),e.jsx(d,{title:"Fonepay Transactions",value:`रु${w.toLocaleString()}`,icon:e.jsx(z,{}),iconColor:"text-purple-500"}),e.jsx(d,{title:"Active Vouchers",value:x.length,icon:e.jsx(f,{}),iconColor:"text-orange-500"})]}),e.jsxs(h,{children:[e.jsx(p,{children:e.jsx(g,{children:"Manager Operations"})}),e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[e.jsxs(n,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-add-staff",onClick:()=>s("/manager/staff"),children:[e.jsx(B,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Add Staff"})]}),e.jsxs(n,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-vendor-payment",onClick:()=>s("/manager/vendor-payments"),children:[e.jsx(u,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Vendor Payment"})]}),e.jsxs(n,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-create-voucher",onClick:()=>s("/manager/discount-vouchers"),children:[e.jsx(f,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Create Voucher"})]}),e.jsxs(n,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-room-setup",onClick:()=>s("/manager/room-setup"),children:[e.jsx(_,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Room Setup"})]}),e.jsxs(n,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-amenities",onClick:()=>s("/manager/amenities"),children:[e.jsx(b,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Amenities"})]}),e.jsxs(n,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-hall-bookings",onClick:()=>s("/hall-bookings"),children:[e.jsx(O,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Hall Bookings"})]}),e.jsxs(n,{variant:"outline",className:"h-20 flex flex-col items-center justify-center gap-0.5 p-0 [&_svg]:size-6","data-testid":"button-transactions",onClick:()=>s("/manager/transactions"),children:[e.jsx(P,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Transactions"})]})]})})]}),e.jsx(m,{title:"Staff Management",data:j,columns:S,actions:D,onAdd:()=>s("/manager/staff"),addButtonLabel:"Add Staff Member",searchPlaceholder:"Search staff..."}),e.jsx(m,{title:"Discount Vouchers",data:x,columns:T,actions:M,onAdd:()=>s("/manager/discount-vouchers"),addButtonLabel:"Create Voucher",searchPlaceholder:"Search vouchers..."}),e.jsx(m,{title:"Room Management",data:N,columns:A,actions:q,onAdd:()=>s("/manager/room-setup"),addButtonLabel:"Add Room",searchPlaceholder:"Search rooms..."}),e.jsxs(h,{children:[e.jsx(p,{children:e.jsx(g,{children:"Recent Vendor Payments"})}),e.jsx(y,{children:e.jsx("div",{className:"space-y-3",children:i.filter(a=>a.txnType==="vendor_payment").slice(0,5).map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded","data-testid":`payment-item-${t}`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{className:"text-blue-500 mr-3 h-5 w-5"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:a.purpose||"Vendor Payment"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Payment method: ",a.paymentMethod]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"font-bold text-gray-900 dark:text-gray-100",children:["रु",Number(a.amount).toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:new Date(a.createdAt).toLocaleDateString()})]})]},a.id||t))})})]})]})})}export{J as default};
