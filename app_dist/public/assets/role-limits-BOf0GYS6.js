import{r as c,j as e,w as u,P as k,u as D,l as S,d as q,L as p,C as v,m as j,n as f,y as W,a as g,I as h,B as M,k as V,A as $}from"./index-Dk6nXF67.js";import{D as b,I as E,S as P}from"./dashboard-layout-BUO8e75G.js";import{C as N}from"./checkbox-C2gKal6E.js";import{T as B,a as F,b as w,c as i,d as H,e as o}from"./table-BAc8EiUx.js";import{S as K}from"./users-Dxbor6Q1.js";import"./circle-alert-BbQxKC8I.js";import"./index-D-DdYU4C.js";const Q=k("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),y=c.forwardRef(({className:r,variant:t,...n},l)=>e.jsx("div",{ref:l,role:"alert",className:u(Q({variant:t}),r),...n}));y.displayName="Alert";const T=c.forwardRef(({className:r,...t},n)=>e.jsx("h5",{ref:n,className:u("mb-1 font-medium leading-none tracking-tight",r),...t}));T.displayName="AlertTitle";const A=c.forwardRef(({className:r,...t},n)=>e.jsx("div",{ref:n,className:u("text-sm [&_p]:leading-relaxed",r),...t}));A.displayName="AlertDescription";function Y(){const{toast:r}=D(),[t,n]=c.useState([]),{data:l,isLoading:C}=S({queryKey:["/api/hotels/current/role-limits"]});c.useEffect(()=>{l&&n(l)},[l]);const m=q({mutationFn:async()=>await V("PUT","/api/hotels/current/role-limits",t),onSuccess:()=>{$.invalidateQueries({queryKey:["/api/hotels/current/role-limits"]}),r({title:"Role Limits Saved",description:"Transaction limits have been updated successfully."})},onError:a=>{r({title:"Error",description:a.message||"Failed to save role limits",variant:"destructive"})}}),d=(a,s,L)=>{n(R=>R.map(x=>x.roleId===a?{...x,[s]:L}:x))},I=()=>{m.mutate()};return C?e.jsx(b,{title:"Role Transaction Limits",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(p,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsx(b,{title:"Role Transaction Limits",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(y,{"data-testid":"alert-role-limits-info",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(T,{children:"Configure Role-Based Transaction Limits"}),e.jsx(A,{children:"Set financial limits and permissions for each role to enhance security and control. Leave fields empty for no limit."})]}),e.jsxs(v,{children:[e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Transaction Limits by Role"]}),e.jsx(W,{children:"Configure maximum transaction amounts and approval thresholds for each role"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(B,{children:[e.jsx(F,{children:e.jsxs(w,{children:[e.jsx(i,{className:"min-w-[150px]",children:"Role"}),e.jsx(i,{className:"min-w-[150px]",children:"Max Transaction"}),e.jsx(i,{className:"min-w-[150px]",children:"Max Daily Total"}),e.jsx(i,{className:"min-w-[150px]",children:"Approval Above"}),e.jsx(i,{className:"w-[120px]",children:"Can Void"}),e.jsx(i,{className:"w-[150px]",children:"Approve Wastage"})]})}),e.jsx(H,{children:t.map(a=>e.jsxs(w,{"data-testid":`row-role-limit-${a.roleId}`,children:[e.jsx(o,{className:"font-medium",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:a.roleName}),a.roleDescription&&e.jsx("div",{className:"text-xs text-muted-foreground",children:a.roleDescription})]})}),e.jsx(o,{children:e.jsx(h,{type:"number",step:"0.01",placeholder:"No limit",value:a.maxTransactionAmount||"",onChange:s=>d(a.roleId,"maxTransactionAmount",s.target.value||null),className:"w-full","data-testid":`input-max-transaction-${a.roleId}`})}),e.jsx(o,{children:e.jsx(h,{type:"number",step:"0.01",placeholder:"No limit",value:a.maxDailyAmount||"",onChange:s=>d(a.roleId,"maxDailyAmount",s.target.value||null),className:"w-full","data-testid":`input-max-daily-${a.roleId}`})}),e.jsx(o,{children:e.jsx(h,{type:"number",step:"0.01",placeholder:"No approval",value:a.requiresApprovalAbove||"",onChange:s=>d(a.roleId,"requiresApprovalAbove",s.target.value||null),className:"w-full","data-testid":`input-approval-above-${a.roleId}`})}),e.jsx(o,{children:e.jsx(N,{checked:a.canVoidTransactions,onCheckedChange:s=>d(a.roleId,"canVoidTransactions",s),"data-testid":`checkbox-void-${a.roleId}`})}),e.jsx(o,{children:e.jsx(N,{checked:a.canApproveWastage,onCheckedChange:s=>d(a.roleId,"canApproveWastage",s),"data-testid":`checkbox-wastage-${a.roleId}`})})]},a.roleId))})]})}),e.jsx("div",{className:"mt-6 flex justify-end gap-4",children:e.jsx(M,{onClick:I,disabled:m.isPending,"data-testid":"button-save-limits",children:m.isPending?e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Save All Limits"]})})})]})]}),e.jsxs(v,{children:[e.jsx(j,{children:e.jsx(f,{children:"How Limits Work"})}),e.jsxs(g,{className:"space-y-4 text-sm text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"text-foreground",children:"Max Transaction Amount:"})," The maximum amount a user with this role can process in a single transaction. Transactions exceeding this limit will be rejected."]}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-foreground",children:"Max Daily Total:"})," The maximum total amount a user can process per day. Once this limit is reached, no more transactions can be created until the next day."]}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-foreground",children:"Approval Required Above:"})," Transactions above this amount will require approval from a manager or owner, even if they're below the max transaction amount."]}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-foreground",children:"Can Void Transactions:"})," When enabled, users with this role can void (cancel) transactions with a reason. This is typically restricted to managers and owners."]}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-foreground",children:"Can Approve Wastage:"})," When enabled, users with this role can approve wastage reports from other staff members."]})]})]})]})})}export{Y as default};
